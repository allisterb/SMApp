(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.User=c.User||{};e=c.Meaning=c.Meaning||{};f=c.Intent=c.Intent||{};g=c.Entity=c.Entity||{};h=c.Interpreter=c.Interpreter||{};i=c.Resource=c.Resource||{};j=c.NLU=c.NLU||{};k=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};l=c.CUI=c.CUI||{};m=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};n=c.ClientExtensions=c.ClientExtensions||{};o=c.Client=c.Client||{};p=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};q=a.IntelliFactory;r=q&&q.Runtime;s=a.WebSharper;t=s&&s.List;u=s&&s.Seq;v=s&&s.Random;w=s&&s.Arrays;x=a.jQuery;y=a.console;z=s&&s.UI;A=z&&z.Doc;B=s&&s.Utils;C=s&&s.Concurrency;D=s&&s.Unchecked;E=s&&s.Remoting;F=E&&E.AjaxRemotingProvider;d.New=function(G){return{UserName:G};};e=c.Meaning=r.Class({get_TopIntent:function(){return t.head(t.sortBy(function(G){return G.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,e);f=c.Intent=r.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,f);g=c.Entity=r.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,g);h=c.Interpreter=r.Class({get_Options:function(){return(this.get_Unwrap())[1];},get_Func:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0[0],this.$0[1]];}},null,h);i.New=function(G,H,I){return{Name:G,Description:H,Url:I};};j.HelloUser=function(G){var H,I;return(I=j.Hello(G),I!=null&&I.$==1&&(I.$0.$==1&&(I.$0.$1.$==0&&(I.$0.$0.get_Role()==="contact"&&(H=I.$0.$0,true)))))?{$:1,$0:H}:null;};j.Hello=function(G){var H,I;return G!=null&&G.$==1&&(I=j.Intent("Hello",G.$0),I!=null&&I.$==1&&(H=I.$0,true))?{$:1,$0:H}:null;};j.QuickHelp=function(G){return G==="help"?{$:0,$0:null}:G==="voices"?{$:1,$0:null}:G==="debug on"?{$:2,$0:null}:G==="debug off"?{$:3,$0:null}:G==="voice 1"?{$:4,$0:null}:G==="voice 2"?{$:5,$0:null}:{$:6,$0:null};};j.Intent=function(G,H){return H.get_TopIntent().get_Name()===G&&H.get_TopIntent().get_Confidence()>j.intentConfidenceThreshold()?{$:1,$0:t.filter(function(I){return I.get_Confidence()>j.entityConfidenceThreshold();},H.get_Entities())}:null;};j.entityConfidenceThreshold=function(){k.$cctor();return k.entityConfidenceThreshold;};j.set_entityConfidenceThreshold=function(G){k.$cctor();k.entityConfidenceThreshold=G;};j.intentConfidenceThreshold=function(){k.$cctor();return k.intentConfidenceThreshold;};j.set_intentConfidenceThreshold=function(G){k.$cctor();k.intentConfidenceThreshold=G;};k.$cctor=function(){k.$cctor=a.ignore;k.intentConfidenceThreshold=0.85;k.entityConfidenceThreshold=0.85;};l.helloUserPhrases=function(){m.$cctor();return m.helloUserPhrases;};l.helloPhrases=function(){m.$cctor();return m.helloPhrases;};l.getRandomPhrase=function(G){return u.nth(l.rng().Next(0,G.get_Length()),G);};l.rng=function(){m.$cctor();return m.rng;};m.$cctor=function(){m.$cctor=a.ignore;m.rng=new v.New();m.helloPhrases=t.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello I am Selma. How can I help?"]);m.helloUserPhrases=t.ofArray(["Hi $user, welcome back.","Welcome $user, nice to see you again..","Hello $user","Good to see you $user."]);};n.toArray=function(G){return w.map(a.id,x.makeArray(G));};n.info=function(G){y.info(G);};n.error=function(G){x.error(G);};n["Terminal.Push"]=function(G,H){var I,J;I=H.get_Func();J=H.get_Options();G.push(r.CreateFuncWithThis(I),J);};n["Terminal.Echo'"]=function(G,H){G.disable();G.echo(H);G.enable();};o.Term=function(){var G,H;G=r.ThisFunc(function(I,J){return((o.Main().get_Func())(I))(J);});H=o.Main().get_Options();a.$("#main").terminal(G,H);o.context().unshift({$:0,$0:o.Main()});return A.get_Empty();};o.Main=function(){p.$cctor();return p.Main;};o.stopSpeaking=function(){p.$cctor();return p.stopSpeaking;};o.sayRandom=function(G){o.say(l.getRandomPhrase(G));};o.sayVoices=function(){var G,H,I,J;G=n.toArray(a.speechSynthesis.getVoices());o.say((function(K){return function(L){return K("There are currently "+a.String(L)+" voices installed on this computer or device.");};}(a.id))(w.length(G)));for(H=0,I=w.length(G)-1;H<=I;H++){J=w.get(G,H);o.say(((((r.Curried(function(K,L,M,N){return K("Voice "+a.String(L)+": Name: "+B.toSafe(M)+" Local: "+B.prettyPrint(N)+".");},4))(a.id))(H))(J.name))(J.localService));}};o.say=function(G){var H;C.Start((H=null,C.Delay(function(){var I;I=new a.SpeechSynthesisUtterance(G);I.voice=o.currentVoice();a.speechSynthesis.speak(I);return C.Zero();})),null);};o.initSpeech=function(){var G,H,I,J,K,L;I=n.toArray(a.speechSynthesis.getVoices());for(J=0,K=w.length(I)-1;J<=K;J++){L=w.get(I,J);D.Equals(o.currentVoice(),null)&&(L.name.indexOf("Microsoft Zira")!=-1||L.name.indexOf("English Female")!=-1)?(o.set_currentVoice(L),n.info((function(M){return function(N){return M("Using voice "+B.toSafe(N)+".");};}(a.id))(o.currentVoice().name))):void 0;}D.Equals(o.currentVoice(),null)&&w.length(I)>0?(o.set_currentVoice(w.get(I,0)),G=new a.SpeechSynthesisUtterance(function(M){return M("Using the default speech synthesis voice.");}(a.id)),C.Start((H=null,C.Delay(function(){a.speechSynthesis.speak(G);return C.Zero();})),null)):D.Equals(o.currentVoice(),null)?n.error("No speech synthesis voice is available. In order to use Selma you must install a speech synthesis voice on this device or computer."):void 0;};o.context=function(){p.$cctor();return p.context;};o.transcribe=function(){p.$cctor();return p.transcribe;};o.set_transcribe=function(G){p.$cctor();p.transcribe=G;};o.debugMode=function(){p.$cctor();return p.debugMode;};o.set_debugMode=function(G){p.$cctor();p.debugMode=G;};o.currentVoice=function(){p.$cctor();return p.currentVoice;};o.set_currentVoice=function(G){p.$cctor();p.currentVoice=G;};p.$cctor=function(){var G;p.$cctor=a.ignore;function H(I,J){var K,L;D.Equals(o.currentVoice(),null)?o.initSpeech():void 0;K=j.QuickHelp(J);return K.$==1?o.sayVoices():K.$==2?(o.set_debugMode(true),o.say(function(M){return M("Debug mode is now on.");}(a.id))):K.$==3?(o.set_debugMode(false),o.say(function(M){return M("Debug mode is now off.");}(a.id))):K.$==4?o.say("Quick voice 1"):K.$==5?o.say("Quick voice 2"):K.$==6?(I.disable(),C.Start((L=null,C.Delay(function(){return C.Combine(C.Bind((new F.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:-274465762",[J]),function(M){var N,O;N=j.HelloUser(M);return N!=null&&N.$==1?(I.echo((function(P){return function(Q){return P("This is the hello intent. The user name is "+B.toSafe(Q)+".");};}(a.id))(N.$0.get_Value())),C.Zero()):(O=j.Hello(M),O!=null&&O.$==1)?(o.sayRandom(l.helloPhrases()),C.Zero()):(I.echo("This is the whatever intent"),C.Zero());}),C.Delay(function(){I.enable();return C.Zero();}));})),null)):o.say("This is the quick help command");}p.currentVoice=null;p.debugMode=false;p.transcribe=false;p.context=[];p.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;p.Main=new h({$:0,$0:[function(I){return function(J){return H(I,J);};},(G={},G.name="Main",G.greetings="Welcome to Selma. Type hello to begin or help for more assistance.",G.prompt=">",G)]});};}());
