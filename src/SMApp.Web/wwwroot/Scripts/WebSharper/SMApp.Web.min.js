(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=c.Bs=c.Bs||{};i=b.NLU=b.NLU||{};j=i.Babelfy=i.Babelfy||{};k=j.ApiResponse=j.ApiResponse||{};l=j.TokenFragment=j.TokenFragment||{};m=j.CharFragment=j.CharFragment||{};n=i.Witai=i.Witai||{};o=n.Utterance=n.Utterance||{};p=n.Intent=n.Intent||{};q=n.Entity=n.Entity||{};r=n.Trait=n.Trait||{};s=n["Utterance'"]=n["Utterance'"]||{};t=n["Value'"]=n["Value'"]||{};u=i.QnAMaker=i.QnAMaker||{};v=u.ITSQuestion=u.ITSQuestion||{};w=u.ITSAnswerContext=u.ITSAnswerContext||{};x=u.ITSAnswer=u.ITSAnswer||{};y=u.ITSAnswers=u.ITSAnswers||{};z=c.TypingDNA=c.TypingDNA||{};A=z.Response=z.Response||{};B=c.FacialRecognition=c.FacialRecognition||{};C=a.StartupCode$SMApp_Web$FacialRecognition=a.StartupCode$SMApp_Web$FacialRecognition||{};D=c.NLG=c.NLG||{};E=a.StartupCode$SMApp_Web$NLG=a.StartupCode$SMApp_Web$NLG||{};F=c.NLU=c.NLU||{};G=F.Intent=F.Intent||{};H=F.Trait=F.Trait||{};I=F.Entity=F.Entity||{};J=F.Utterance=F.Utterance||{};K=F.Question=F.Question||{};L=F.QuestionType=F.QuestionType||{};M=F.Voice=F.Voice||{};N=M["Entity'"]=M["Entity'"]||{};O=F.Text=F.Text||{};P=O["Utterance'"]=O["Utterance'"]||{};Q=O["Intent'"]=O["Intent'"]||{};R=O["Entity'"]=O["Entity'"]||{};S=O["Trait'"]=O["Trait'"]||{};T=F.Domain=F.Domain||{};U=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};V=c.CUI=c.CUI||{};W=V.MicState=V.MicState||{};X=V.ClientState=V.ClientState||{};Y=V.Interpreter=V.Interpreter||{};Z=V.CUI=V.CUI||{};_0=c.Dialogue=c.Dialogue||{};_1=_0.Dialogue=_0.Dialogue||{};_2=c.User=c.User||{};_3=a.StartupCode$SMApp_Web$User=a.StartupCode$SMApp_Web$User||{};_4=c.Main=c.Main||{};_5=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};_6=c.Client=c.Client||{};_7=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};_8=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};_9=a.GeneratedPrintf=a.GeneratedPrintf||{};_=a.WebSharper;$=_&&_.UI;ba=$&&$.Client;bb=ba&&ba.Templates;bc=$&&$.Doc;bd=$&&$.AttrProxy;be=_&&_.Arrays;bf=a.IntelliFactory;bg=bf&&bf.Runtime;bh=_&&_.Utils;bi=a.console;bj=a.jQuery;bk=_&&_.Strings;bl=_&&_.List;bm=_&&_.Seq;bn=$&&$.AttrModule;bo=_&&_.Concurrency;bp=a.JSON;bq=_&&_.Random;br=_&&_.Collections;bs=br&&br.Map;bt=_&&_.JavaScript;bu=bt&&bt.Pervasives;bv=a.SDK;bw=_&&_.Operators;bx=_&&_.Remoting;by=bx&&bx.AjaxRemotingProvider;bz=a.Wit;bA=a.document;bB=_&&_.Unchecked;bC=br&&br.Dictionary;d.speechSynthesis=function(){return a.speechSynthesis;};d.questionBox=function(bD,bE,bF){var bG,bH;(bG=a.Sweetalert2((bH={},bH.titleText=bD,bH.text=bE,bH.type="question",bH.input="text",bH.confirmButtonText="Ok",bH)),bG).then(bF);};d.elementHTML=function(bD){return bD.innerHTML;};d.createElement=function(bD){var bE;bE=self.document.createElement("div");self.document.appendChild(bE);bb.LoadLocalTemplates("");bc.RunAppend(bE,bD);};d.container=function(bD){return bc.Element("div",[d.cls("container")],bD);};d.dindex=function(bD){return bd.Create("data-index",a.String(bD));};d.cls=function(bD){return bd.Create("class",bD);};d.eid=function(bD){return bd.Create("id",bD);};d.termOutput=function(){return be.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(bD){return bD.toLowerCase();};d.debug=function(bD,bE){d.info((((bg.Curried3(function(bF,bG,bH){return bF("DEBUG: "+bh.toSafe(bG)+": "+bh.prettyPrint(bH));}))(a.id))(bD.toUpperCase()))(bE));};d.error=function(bD){bi.error(bD);};d.info=function(bD){bi.info(bD);};d.jserror=function(bD){bj.error(bD);};d.toArray=function(bD){return be.map(a.id,bj.makeArray(bD));};d["Terminal.EchoHtml'"]=function(bD,bE){bD.pause();bD.echo(bE,d.rawOpt());bD.resume();};d["Terminal.Echo'"]=function(bD,bE){bD.pause();bD.echo(bE);bD.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=bg.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(bD){function bE(bF){return function(bG){var bH,bI,bJ,bK,bL,bM,bN;bI=bk.replicate(bF," ");switch(bG.$==0?bG.$1.$==1?bG.$1.$0.$==2?bG.$1.$1.$==0?(bH=[bG.$1.$0.$0,bG.$0],1):(bH=[bG.$1,bG.$0],2):(bH=[bG.$1,bG.$0],2):(bH=[bG.$1,bG.$0],2):bG.$==2?(bH=bG.$0,3):(bH=[bG.$0,bG.$1],0)){case 0:return bH[0]+"=\""+bH[1]+"\"";case 1:bJ=bH[1];return bI+"<"+bJ+">"+bH[0]+"</"+bJ+">\r\n";case 2:bK=bH[1];bL=bl.partition(function(bO){return bO.$==1;},bH[0]);bM=bL[1];bN=bL[0];return bM.$==0?bI+"<"+bK+(bN.$===0?"":" "+bk.concat(" ",bl.ofSeq(bm.delay(function(){return bm.map(function(bO){return(bE(0))(bO);},bN);}))))+"/>\r\n":bI+"<"+bK+(bN.$===0?"":" "+bk.concat(" ",bl.ofSeq(bm.delay(function(){return bm.map(function(bO){return(bE(0))(bO);},bN);}))))+">\r\n"+bk.concat("",bl.ofSeq(bm.delay(function(){return bm.map(function(bO){return(bE(bF+1))(bO);},bM);})))+bI+"</"+bK+">\r\n";case 3:return bI+bH+"\r\n";}};}return(bE(0))(bD);};f.alt=function(bD){return new e({$:1,$0:"alt",$1:bD});};f.src=function(bD){return new e({$:1,$0:"src",$1:bD});};f.cls=function(bD){return new e({$:1,$0:"class",$1:bD});};f.str=function(bD){return e.toString(bD);};f.op_PercentEquals=function(bD,bE){return new e({$:1,$0:bD,$1:bE});};f.op_Splice=function(bD){var bE;return bl.ofArray([new e({$:2,$0:(bE=bD,a.String(bE))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(bD,bE){return new e({$:0,$0:bD,$1:bE});};g.$cctor=function(){var bD;g.$cctor=a.ignore;g.rawOpt=(bD={},bD.raw=true,bD);g.html=function(bE){return f.elem("html",bE);};g.head=function(bE){return f.elem("head",bE);};g.title=function(bE){return f.elem("title",bE);};g.style=function(bE){return f.elem("style",bE);};g.body=function(bE){return f.elem("body",bE);};g.div=function(bE){return f.elem("div",bE);};g.br=function(bE){return f.elem("br",bE);};g.section=function(bE){return f.elem("section",bE);};g.span=function(bE){return f.elem("span",bE);};g.table=function(bE){return f.elem("table",bE);};g.thead=function(bE){return f.elem("thead",bE);};g.tbody=function(bE){return f.elem("tbody",bE);};g.tfoot=function(bE){return f.elem("tfoot",bE);};g.img=function(bE){return f.elem("img",bE);};g.map=function(bE){return f.elem("map",bE);};g.area=function(bE){return f.elem("area",bE);};g.p=function(bE){return f.elem("p",bE);};g.a=function(bE){return f.elem("a",bE);};g.tr=function(bE){return f.elem("tr",bE);};g.td=function(bE){return f.elem("td",bE);};g.th=function(bE){return f.elem("th",bE);};g.ul=function(bE){return f.elem("ul",bE);};g.li=function(bE){return f.elem("li",bE);};g.h1=function(bE){return f.elem("h1",bE);};g.h2=function(bE){return f.elem("h1",bE);};g.h3=function(bE){return f.elem("h1",bE);};g.h4=function(bE){return f.elem("h1",bE);};g.strong=function(bE){return f.elem("strong",bE);};};h.Radio=function(bD,bE,bF,bG,bH){return bc.Element("div",new bl.T({$:1,$0:d.cls("radio"),$1:bE}),[bc.Element("label",bG,[bc.Radio(bH,true,bF),bc.TextNode(bD)])]);};h.checkbox=function(bD,bE,bF,bG,bH){return bc.Element("div",new bl.T({$:1,$0:d.cls("checkbox"),$1:bE}),[bc.Element("label",bG,[bc.CheckBox(bH,bF),bc.TextNode(bD)])]);};h.textArea=function(bD,bE,bF,bG,bH){return bc.Element("div",new bl.T({$:1,$0:d.cls("form-group"),$1:bE}),[bc.Element("label",bG,[bc.TextNode(bD)]),bc.InputArea(new bl.T({$:1,$0:d.cls("form-control"),$1:bH}),bF)]);};h.inputPassword=function(bD,bE,bF,bG,bH){return bc.Element("div",new bl.T({$:1,$0:d.cls("form-group"),$1:bE}),[bc.Element("label",bG,[bc.TextNode(bD)]),bc.PasswordBox(new bl.T({$:1,$0:d.cls("form-control"),$1:bH}),bF)]);};h.input=function(bD,bE,bF,bG,bH){return bc.Element("div",new bl.T({$:1,$0:d.cls("form-group"),$1:bE}),[bc.Element("label",bG,[bc.TextNode(bD)]),bc.Input([d.cls("form-control"),bH],bF)]);};h.btnSecondary=function(bD,bE,bF){return bc.Element("button",[d.eid(bD),d.cls("btn btn-secondary"),bn.Handler("click",bF)],[bc.TextNode(bE)]);};h.btnPrimary=function(bD,bE,bF){return bc.Element("button",[d.eid(bD),d.cls("btn btn-primary"),bn.Handler("click",bF)],[bc.TextNode(bE)]);};k.New=function(bD,bE,bF,bG,bH,bI,bJ,bK,bL){return{tokenFragment:bD,charFragment:bE,babelSynsetID:bF,DBpediaURL:bG,BabelNetURL:bH,score:bI,cohrenceScore:bJ,globalScore:bK,source:bL};};l.New=function(bD,bE){return{start:bD,end:bE};};m.New=function(bD,bE){return{start:bD,end:bE};};j.disambiguate=function(bD){function bE(bF,bG){var bH;bj.ajax((bH={},bH.url=(function(bI){return function(bJ){return bI("https://babelfy.io/v1/disambiguate?text="+bh.toSafe(bJ)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bD),bH.type="GET",bH.success=function(bI){return bF(bI);},bH.error=function(bI){return bG(new a.Error(bI.responseText));},bH));}return bo.FromContinuations(function(bF,bG,bH){return bE.apply(null,[bF,bG,bH]);});};o.New=function(bD,bE,bF,bG){return{text:bD,intents:bE,entities:bF,traits:bG};};p.New=function(bD,bE,bF){return{id:bD,name:bE,confidence:bF};};q.New=function(bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN){return{id:bD,name:bE,role:bF,start:bG,end:bH,body:bI,confidence:bJ,entities:bK,suggested:bL,value:bM,type:bN};};r.New=function(bD,bE,bF){return{id:bD,value:bE,confidence:bF};};s.New=function(bD){return{intent:bD};};t.New=function(bD){return{value:bD};};n.getMeaning2=function(bD,bE){function bF(bG,bH){var bI;bj.ajax((bI={},bI.url=(function(bJ){return function(bK){return bJ("https://api.wit.ai/message?q="+bh.toSafe(bK));};}(a.id))(bE),bI.type="GET",bI.beforeSend=function(bJ){return bJ.setRequestHeader("Authorization","Bearer "+bD);},bI.success=function(bJ){return bG(bJ);},bI.error=function(bJ){return bH(new a.Error(bJ.responseText));},bI));}return bo.FromContinuations(function(bG,bH,bI){return bF.apply(null,[bG,bH,bI]);});};n.getMeaning=function(bD,bE,bF,bG){var bH;bj.ajax((bH={},bH.url=(function(bI){return function(bJ){return bI("https://api.wit.ai/message?q="+bh.toSafe(bJ));};}(a.id))(bE),bH.type="GET",bH.beforeSend=function(bI){return bI.setRequestHeader("Authorization","Bearer "+bD);},bH.success=bF,bH.error=bG,bH));};v.New=function(bD){return{question:bD};};w.New=function(bD,bE){return{isContextOnly:bD,prompts:bE};};x.New=function(bD,bE,bF,bG,bH,bI,bJ){return{questions:bD,answer:bE,score:bF,id:bG,source:bH,metadata:bI,context:bJ};};y.New=function(bD){return{answers:bD};};u.getAnswer=function(bD){function bE(bF,bG){var bH;bj.ajax((bH={},bH.url="https://lerna.azurewebsites.net/qnamaker/knowledgebases/13a6a026-942b-4612-a8cb-654086ec76ee/generateAnswer",bH.type="POST",bH.beforeSend=function(bI){return bI.setRequestHeader("Authorization","EndpointKey e5a55563-b1b0-4343-8796-bda5a0509385");},bH.contentType="application/json",bH.dataType="json",bH.data=bp.stringify(v.New(bD)),bH.success=function(bI){return bF(bI);},bH.error=function(bI){return bG(new a.Error(bI.responseText));},bH));}return bo.FromContinuations(function(bF,bG,bH){return bE.apply(null,[bF,bG,bH]);});};A.New=function(bD,bE,bF,bG){return{name:bD,message:bE,message_code:bF,status:bG};};z.getSameTextTypingPattern=function(bD,bE){var bF;return bE.getTypingPattern((bF={type:1},bF.text=bD,bF.caseSensitive=true,bF));};B.a=function(){C.$cctor();return C.a;};C.$cctor=function(){C.$cctor=a.ignore;C.a=0;};D.waitAddPhrases=function(){E.$cctor();return E.waitAddPhrases;};D.waitRetrievePhrases=function(){E.$cctor();return E.waitRetrievePhrases;};D.helpPhrases=function(){E.$cctor();return E.helpPhrases;};D.helloUserPhrases=function(){E.$cctor();return E.helloUserPhrases;};D.helloPhrases=function(){E.$cctor();return E.helloPhrases;};D["getRandomPhrase'"]=function(bD){return D.replace_tok("$0","",bm.nth(D.rng().Next(0,bD.get_Length()),bD));};D.getRandomPhrase=function(bD,bE){return D.replace_tok("$0",bE,bm.nth(D.rng().Next(0,bD.get_Length()),bD));};D.replace_tok=function(bD,bE,bF){return bk.Replace(bF,bD,bE);};D.rng=function(){E.$cctor();return E.rng;};E.$cctor=function(){E.$cctor=a.ignore;E.rng=new bq.New();E.helloPhrases=bl.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);E.helloUserPhrases=bl.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);E.helpPhrases=bl.ofArray(["What can I help you with $0?"]);E.waitRetrievePhrases=bl.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);E.waitAddPhrases=bl.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};G=F.Intent=bg.Class({toString:function(){return(((bg.Curried3(function(bD,bE,bF){return bD("Intent("+bh.toSafe(bE)+", "+_8.p$2(bF)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);H=F.Trait=bg.Class({toString:function(){return(((bg.Curried3(function(bD,bE,bF){return bD("Trait("+bh.toSafe(bE)+", "+bh.prettyPrint(bF)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,H);I=F.Entity=bg.Class({toString:function(){return(((((bg.Curried(function(bD,bE,bF,bG,bH){return bD("Entity("+bh.toSafe(bE)+", "+bh.toSafe(bF)+", "+bh.toSafe(bG)+", "+_8.p$2(bH)+")");},5))(a.id))(this.get_Name()))(this.get_Role()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$3;},get_Value:function(){return this.$2;},get_Role:function(){return this.$1;},get_Name:function(){return this.$0;}},null,I);J=F.Utterance=bg.Class({toString:function(){return((((bg.Curried(function(bD,bE,bF,bG){return bD(_8.p(bE)+" "+_8.p$3(bF)+" "+_8.p$5(bG));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bD;bD=this.$3;return bD!=null?{$:1,$0:bl.sortBy(function(bE){return bE.get_Name();},bD.$0)}:null;},get_Traits:function(){var bD;bD=this.$2;return bD!=null?{$:1,$0:bl.sortBy(function(bE){return bE.get_Name();},bD.$0)}:null;},get_Intent:function(){return this.$1;},get_Text:function(){return this.$0;}},null,J);K=F.Question=bg.Class({toString:function(){return(((((bg.Curried(function(bD,bE,bF,bG,bH){return bD("Name: "+bh.toSafe(bE)+" Text: "+bh.toSafe(bF)+" Type: "+_8.p$8(bG)+" Module: "+bh.toSafe(bH));},5))(a.id))(this.get_Name()))(this.get_Text()))(this.get_Type()))(this.get_Module());},get_Module:function(){return this.$3;},get_Type:function(){return this.$2;},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,K);L.ConceptCompletion={$:3};L.Disjunctive={$:2};L.Verification={$:1};L.UserData={$:0};N.New=function(bD,bE,bF,bG,bH){return{body:bD,end:bE,start:bF,suggested:bG,value:bH};};M["Intent'"]=function(bD,bE){return!(bE.intent==null)?{$:1,$0:new G({$:0,$0:d.toLower(bE.intent.value),$1:null})}:null;};M["Trait'"]=function(bD){return!(bD.domain==null)?{$:1,$0:new H({$:0,$0:"domain",$1:d.toLower(bD.domain.value),$2:null})}:!(bD.dialogue_act==null)?{$:1,$0:new H({$:0,$0:"dialogue_act",$1:d.toLower(bD.dialogue_act.value),$2:null})}:null;};M["Entity'$1"]=function(bD){return!(bD.contact==null)?{$:1,$0:new I({$:0,$0:"contact",$1:"",$2:d.toLower(bD.contact.value),$3:null})}:null;};P=O["Utterance'"]=bg.Class({get_TopIntent:function(){return bl.head(bl.sortBy(function(bD){return bD.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$3;},get_Entities:function(){return this.$2;},get_Intents:function(){return this.$1;},get_Text:function(){return this.$0;}},null,P);Q=O["Intent'"]=bg.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,Q);R=O["Entity'"]=bg.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,R);S=O["Trait'"]=bg.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,S);O.HasUtterance=function(bD){var bE,bF,bG,bH,bI,bJ;return bD!=null&&bD.$==1&&(bD.$0.$2.get_Length()>0&&(bE=[bD.$0.$2,bD.$0.$1,bD,bD.$0.$0,bD.$0.$3],true))?(bF=bE[0],(bG=bE[2],(bH=bE[4],(bI=bE[1].$==0?null:{$:1,$0:new G({$:0,$0:bG.$0.get_TopIntent().get_Name(),$1:{$:1,$0:bG.$0.get_TopIntent().get_Confidence()}})},(bJ=bF.$==0?null:{$:1,$0:bl.map(function(bK){return new I({$:0,$0:bK.get_Name(),$1:d.toLower(bK.get_Role()),$2:bK.get_Value(),$3:{$:1,$0:bK.get_Confidence()}});},bl.filter(function(bK){return bK.get_Confidence()>O.entityConfidenceThreshold();},bF))},{$:1,$0:new J({$:0,$0:bE[3],$1:bI,$2:bH.$==0?null:{$:1,$0:bl.map(function(bK){return new H({$:0,$0:d.toLower(bK.get_Name()),$1:bK.get_Value(),$2:{$:1,$0:bK.get_Confidence()}});},bl.filter(function(bK){return bK.get_Confidence()>O.entityConfidenceThreshold();},bH))},$3:bJ})}))))):null;};O.entityConfidenceThreshold=function(){U.$cctor();return U.entityConfidenceThreshold;};O.set_entityConfidenceThreshold=function(bD){U.$cctor();U.entityConfidenceThreshold=bD;};O.intentConfidenceThreshold=function(){U.$cctor();return U.intentConfidenceThreshold;};O.set_intentConfidenceThreshold=function(bD){U.$cctor();U.intentConfidenceThreshold=bD;};O.getUtterance2=function(bD){var bE;bE=null;return bo.Delay(function(){return bo.Bind(n.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bD),function(bF){d.debug("NLU",(function(bG){return function(bH){return bG("Wit.ai returned "+_9.p(bH)+" ");};}(a.id))(bF));return bo.Return(new P({$:0,$0:bD,$1:bl.ofArray(be.map(function(bG){return new Q({$:0,$0:bG.name,$1:bG.confidence});},bF.intents)),$2:bl.map(function(bG){return new R({$:0,$0:bG.name,$1:bG.confidence,$2:bG.role,$3:bG.value});},bl.ofSeq(bm.concat(bm.map(function(bG){return bG[1];},bs.ToSeq(bF.entities))))),$3:bl.ofSeq(bm.map(function(bG){var bH;bH=bG[1];return new S({$:0,$0:bG[0],$1:be.get(bH,0).confidence,$2:be.get(bH,0).value});},bs.ToSeq(bF.traits)))}));});});};O.getUtterance=function(bD,bE){n.getMeaning("OOGDHEQL7JZRQASXN2N2GHFUKGO3SCNV",bD,function(bF){var bG,bH;d.debug("NLU",(function(bI){return function(bJ){return bI("Wit.ai returned: "+bh.prettyPrint(bJ));};}(a.id))(bF));bG=!(bF.intents==null)?bl.ofArray(be.map(function(bI){return new Q({$:0,$0:bI.name,$1:bI.confidence});},bF.intents)):bl.T.Empty;bH=!(bF.traits==null)?bl.ofSeq(bm.concat(bl.map(function(bI){return be.map(function(bJ){return new S({$:0,$0:bI,$1:bJ.confidence,$2:bJ.value});},bu.GetJS(bF.traits,[bI]));},bl.filter(function(bI){return!(bu.GetJS(bF.traits,[bI])==null);},O.trait_types())))):bl.T.Empty;return bE({$:1,$0:new P({$:0,$0:bD,$1:bG,$2:!(bF.entities==null)?bl.ofSeq(bm.concat(bl.map(function(bI){return be.map(function(bJ){return new R({$:0,$0:bJ.name,$1:bJ.confidence,$2:bJ.role,$3:bJ.value});},bu.GetJS(bF.entities,[bI]));},bl.filter(function(bI){return!(bu.GetJS(bF.entities,[bI])==null);},O.entity_types())))):bl.T.Empty,$3:bH})});},function(bF,bG,bH){d.error((((bg.Curried3(function(bI,bJ,bK){return bI("Wit.ai returned: "+bh.prettyPrint(bJ)+" "+bh.prettyPrint(bK));}))(a.id))(bG))(bH));return bE(null);});};O.trait_types=function(){U.$cctor();return U.trait_types;};O.entity_types=function(){U.$cctor();return U.entity_types;};O.QuickNumber=function(bD){var bE,bF,bG;return(bF=O.One(bD),bF!=null&&bF.$==1?(bE=bF.$0,true):(bG=O.Two(bD),bG!=null&&bG.$==1&&(bE=bG.$0,true)))?{$:1,$0:bE}:null;};O.Three=function(bD){var bE;return bD==="3"||bD==="three"?{$:1,$0:new J({$:0,$0:"three",$1:{$:1,$0:new G({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bl.ofArray([new I({$:0,$0:"wit/ordinal",$1:"",$2:"three",$3:{$:1,$0:1}})])}})}:null;};O.Two=function(bD){var bE;return bD==="2"||bD==="two"?{$:1,$0:new J({$:0,$0:"two",$1:{$:1,$0:new G({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bl.ofArray([new I({$:0,$0:"wit/ordinal",$1:"",$2:"two",$3:{$:1,$0:1}})])}})}:null;};O.One=function(bD){var bE;return bD==="1"||bD==="one"?{$:1,$0:new J({$:0,$0:"one",$1:{$:1,$0:new G({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bl.ofArray([new I({$:0,$0:"wit/ordinal",$1:"",$2:"one",$3:{$:1,$0:1}})])}})}:null;};O.QuickNo=function(bD){var bE;return bD==="no"||(bD==="nope"||(bD==="no way"||(bD==="nah"||(bD==="don't do it"||bD==="stop"))))?{$:1,$0:new J({$:0,$0:"no",$1:{$:1,$0:new G({$:0,$0:"reject",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};O.QuickYes=function(bD){var bE;return bD==="yes"||(bD==="ok"||(bD==="sure"||(bD==="yeah"||(bD==="yep"||(bD==="uh huh"||(bD==="go ahead"||bD==="go"))))))?{$:1,$0:new J({$:0,$0:"yes",$1:{$:1,$0:new G({$:0,$0:"verify",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};O.QuickHelp=function(bD){var bE;return bD==="help"||(bD==="help me"||(bD==="what's this?"||bD==="huh"))?{$:1,$0:new J({$:0,$0:"help",$1:{$:1,$0:new G({$:0,$0:"help",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};O.QuickHello=function(bD){var bE;return bD==="hello"||(bD==="hey"||(bD==="yo"||bD==="hi"))?{$:1,$0:new J({$:0,$0:"hello",$1:{$:1,$0:new G({$:0,$0:"greet",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};O.Voices=function(bD){return bD==="voices"?{$:1,$0:null}:null;};O.Debug=function(bD){return bD==="debug"?{$:1,$0:null}:null;};O.Blank=function(bD){return bD===""?{$:1,$0:null}:null;};T.Study=function(bD){return bD.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};F.Str=function(bD){var bE;return bD!=null&&bD.$==1&&(typeof bD.$0=="string"&&(bE=bD.$0,true))?{$:1,$0:bE}:null;};F.No=function(bD){var bE,bF;return(bF=F.Intent$1("reject",bD),bF!=null&&bF.$==1&&(bF.$0[0]==null&&(bF.$0[1]==null&&(bE=bD,true))))?{$:1,$0:bE}:null;};F.Yes=function(bD){var bE,bF;return(bF=F.Intent$1("verify",bD),bF!=null&&bF.$==1&&(bF.$0[0]==null&&(bF.$0[1]==null&&(bE=bD,true))))?{$:1,$0:bE}:null;};F.EntityManyofMany=function(bD,bE){return{$:1,$0:bs.OfArray(be.ofSeq(bl.map(function(bF){return bl.exists(function(bG){return bG.get_Role()===bF;},bE)?[bF,{$:1,$0:bl.filter(function(bG){return bG.get_Role()===bF;},bE)}]:[bF,null];},bD)))};};F.EntityManyOf1=function(bD,bE){var bF;return bE!=null&&bE.$==1&&(bl.exists(function(bG){return bG.get_Role()===bD;},bE.$0)&&(bF=bE.$0,true))?{$:1,$0:bl.filter(function(bG){return bG.get_Role()===bD;},bF)}:null;};F.Entity1OfAny=function(bD,bE){var bF;return bE!=null&&bE.$==1&&(bl.exists(function(bG){return bG.get_Role()===bD;},bE.$0)&&(bF=bE.$0,true))?{$:1,$0:bl.head(bl.sortBy(function(bG){return bG.get_Role();},bl.filter(function(bG){return bG.get_Role()===bD;},bF)))}:null;};F.Entity1Of1=function(bD,bE){var bF;return bE!=null&&bE.$==1&&(bE.$0.$==1&&(bE.$0.$1.$==0&&(bE.$0.$0.get_Role()===bD&&(bF=bE.$0.$0,true))))?{$:1,$0:bF}:null;};F.Intent$1=function(bD,bE){return bE.get_Intent()!=null&&bE.get_Intent().$0.get_Name()===bD?{$:1,$0:[bE.get_Traits(),bE.get_Entities()]}:null;};U.$cctor=function(){U.$cctor=a.ignore;U.entity_types=bl.ofArray(["wit$contact:name","wit$datetime:datetime","term:subject","term:object","term:verb"]);U.trait_types=bl.ofArray(["domain","dialogue_act"]);U.intentConfidenceThreshold=0.85;U.entityConfidenceThreshold=0.85;};W.MicReady={$:5};W.MicAudioEnd={$:4};W.MicAudioStart={$:3};W.MicDisconnected={$:2};W.MicConnecting={$:1};W.MicNotInitialized={$:0};X.ClientUnderstand={$:2};X.ClientReady={$:1};X.ClientNotInitialzed={$:0};Y=V.Interpreter=bg.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,Y);Z=V.CUI=bg.Class({GetSameTextTypingPattern:function(bD){return z.getSameTextTypingPattern(bD,this.TypingDNA);},SayVoices:function(){var bD,bE,bF;bD=this;bE=a.speechSynthesis.getVoices();!(bE==null)?(bF=d.toArray(bE),bD.Say((function(bG){return function(bH){return bG("There are currently "+a.String(bH)+" voices installed on this computer or device.");};}(a.id))(be.length(bF))),be.iteri(function(bG,bH){return bD.Say(((((bg.Curried(function(bI,bJ,bK,bL){return bI("Voice "+a.String(bJ)+". Name: "+bh.toSafe(bK)+", Local: "+bh.prettyPrint(bL)+".");},4))(a.id))(bG))(bH.name))(bH.localService));},bF)):void 0;},Wait:function(bD){this.Wait$1(function(){bo.Start(bD,null);});},Wait$1:function(bD){this["Echo'"]("please wait...");this.Term.pause();bD();this.Term.resume();},sayRandom:function(bD,bE){this.Say(D.getRandomPhrase(bD,bE));},SayAngry:function(bD){var bE,bF;bE=this;bo.Start((bF=null,bo.Delay(function(){return bo.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bv.chime(),bo.Zero()):bo.Zero(),bo.Delay(function(){a.addMessage(bE.Avatar,bD,"","");bE.Avatar.processMessages(0);return bo.Zero();}));})),null);},SayDoc:function(bD){var bE,bF,bG;bE=be.get(bj(".terminal-output").get(),0).childNodes.length;bF=bc.Element("div",[d.cls("terminal-command"),d.dindex(bE+1)],[bD]);bG=d.termOutput();bb.LoadLocalTemplates("");bc.RunAppend(bG,bF);},Say:function(bD){var bE,bF;bE=this;bo.Start((bF=null,bo.Delay(function(){return bo.Combine(a.speechSynthesis.speaking?(bv.chime(),bo.Zero()):bo.Zero(),bo.Delay(function(){bE.Avatar.addMessage(bD);bE.Avatar.processMessages(0);return bo.Zero();}));})),null);},Debug:function(bD,bE){d.debug(bD,bE);},"EchoHtml'":function(bD){var bE,bF;bE=(bF={},bF.raw=true,bF);this.Term.disable();this.Term.echo(bD,bE);this.Term.enable();},"Echo'":function(bD){this.Term.disable();this.Term.echo(bD);this.Term.enable();}},null,Z);Z.New=function(bD,bE,bF,bG,bH,bI){return new Z({Voice:bD,Mic:bE,Term:bF,Avatar:bG,Caption:bH,TypingDNA:bI});};_1=_0.Dialogue=bg.Class({get_Utterances:function(){return this.$4;},get_Output:function(){return this.$3;},get_DialogueQuestions:function(){return this.$2;},get_Props:function(){return this.$1;},get_Cui:function(){return this.$0;}},null,_1);_0["Response'_"]=function(bD,bE,bF,bG){var bH,bI,bJ;return(bI=_0.PropNotSet_(bD,"user",bG),bI!=null&&bI.$==1&&(_0.haveQuestion(bE,bF)&&bD.get_DialogueQuestions().length>0&&(bD.get_DialogueQuestions())[0].get_Name()===bF&&(bH=bI.$0,true)))?_0.have(bD,bF)?(bJ=bD.get_Props().get_Item(bF),(_0["delete"](bD,bF),{$:1,$0:[bH,{$:1,$0:bJ}]})):{$:1,$0:[bH,null]}:null;};_0.Response_=function(bD,bE,bF,bG){var bH,bI,bJ;return(bI=_0.PropSet_(bD,"user",bG),bI!=null&&bI.$==1&&(_0.haveQuestion(bE,bF)&&bD.get_DialogueQuestions().length>0&&(bD.get_DialogueQuestions())[0].get_Name()===bF&&(bH=bI.$0,true)))?_0.have(bD,bF)?(bJ=bD.get_Props().get_Item(bF),(_0["delete"](bD,bF),{$:1,$0:[bH,{$:1,$0:bJ}]})):{$:1,$0:[bH,null]}:null;};_0["User'_"]=function(bD,bE){var bF,bG;return(bG=_0.PropNotSet_(bD,"user",bE),bG!=null&&bG.$==1&&(bD.get_DialogueQuestions().length===0&&(bF=bG.$0,true)))?{$:1,$0:bF}:null;};_0.User_=function(bD,bE){var bF,bG;return(bG=_0.PropSet_(bD,"user",bE),bG!=null&&bG.$==1&&(bD.get_DialogueQuestions().length===0&&(bF=bG.$0,true)))?{$:1,$0:bF}:null;};_0.PropNotSet_=function(bD,bE,bF){return!_0.have(bD,bE)?{$:1,$0:bF}:null;};_0.PropSet_=function(bD,bE,bF){return _0.have(bD,bE)?{$:1,$0:bF}:null;};_0.Agenda_=function(bD,bE,bF){return bD.get_DialogueQuestions().length>0&&(bD.get_DialogueQuestions())[0].get_Module()===bE?{$:1,$0:null}:null;};_0.didNotUnderstand=function(bD,bE,bF){var bG;bE((function(bH){return function(bI){return bH(bh.toSafe(bI)+" interpreter did not understand utterance.");};}(a.id))(bF));_0.say(bD,"Sorry I didn't understand what you meant.");bD.get_DialogueQuestions().length>0?(bG=bm.nth(0,bD.get_DialogueQuestions()),_0.have(bD,bG.get_Name())?_0.say(bD,D.replace_tok("$0",bD.get_Props().get_Item(bG.get_Name()),bG.get_Text())):_0.say(bD,bG.get_Text())):void 0;};_0.dispatch=function(bD,bE,bF,bG){bE(((((bg.Curried(function(bH,bI,bJ,bK){return bH("Dispatch to module "+bh.toSafe(bI)+" utterances: "+bh.prettyPrint(bJ)+" questions: "+bh.prettyPrint(bK)+".");},4))(a.id))(bF))(bD.get_Utterances()))(bD.get_DialogueQuestions()));bG(bD);};_0["handle'"]=function(bD,bE,bF,bG){_0.popt(bD);bE((function(bH){return function(bI){return bH("Turn end: "+bh.toSafe(bI)+".");};}(a.id))(bF));bG();};_0.handle=function(bD,bE,bF,bG){_0.popu(bD);bE((function(bH){return function(bI){return bH("Handle: "+bh.toSafe(bI)+".");};}(a.id))(bF));bG();};_0.ask=function(bD,bE,bF,bG,bH){var bI,bJ;bI=_0.getQuestion(bE,bF).$0;_0.add(bD,bF,bG);_0.pushq(bD,bE,bF);bJ=D.replace_tok("$0",bG,bI.get_Text());_0.say(bD,bJ);bI.get_Type().$==0?d.questionBox("User Input",bJ,function(bK){_0.pushu(bD,new J({$:0,$0:bK,$1:null,$2:null,$3:null}));bH(bD);}):void 0;};_0.popt=function(bD){_0.popu(bD);_0.popq(bD);};_0.pushq=function(bD,bE,bF){var bG;bG=_0.getQuestion(bE,bF);bG==null?(function(bH){return function(bI){return bH("No such question: "+bh.toSafe(bI));};}(bw.FailWith))(bF):bD.get_DialogueQuestions().unshift(bG.$0);};_0.popq=function(bD){bD.get_DialogueQuestions().shift();};_0.popu=function(bD){bD.get_Utterances().shift();};_0.pushu=function(bD,bE){bD.get_Utterances().unshift(bE);};_0.haveQuestion=function(bD,bE){return bl.exists(function(bF){return bF.get_Name()===bE;},bD);};_0.getQuestion=function(bD,bE){return bm.tryFind(function(bF){return bF.get_Name()===bE;},bD);};_0.prop=function(bD,bE){return bD.get_Props().get_Item(bE);};_0["delete"]=function(bD,bE){bD.get_Props().Remove(bE);};_0.add=function(bD,bE,bF){bD.get_Props().Add(bE,bF);};_0.have=function(bD,bE){return bD.get_Props().ContainsKey(bE);};_0.question=function(bD,bE,bF,bG){return new K({$:0,$0:bE,$1:bF,$2:bG,$3:bD});};_0["sayRandom'"]=function(bD,bE){_0.sayRandom(bD,bE,"");};_0.sayRandom=function(bD,bE,bF){var bG;bG=D.getRandomPhrase(bE,bF);bD.get_Output().unshift(bG);bD.get_Cui().Say(bG);};_0.say=function(bD,bE){bD.get_Output().unshift(bE);_0["say'"](bD,bE);};_0["say'"]=function(bD,bE){bD.get_Cui().Say(bE);};_0.echo=function(bD,bE){(bD.get_Cui())["EchoHtml'"](bE);};_2.update=function(bD){var bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv;function cw(cM){_0.echo(bD,cM);}function cx(cM){_0.say(bD,cM);}function cy(cM,cN){return _0.sayRandom(bD,cM,cN);}function cz(cM,cN){return _0.add(bD,cM,cN);}function cA(cM){return _0.prop(bD,cM);}function cB(){return cA("user");}function cC(cM,cN,cO){return _0.ask(bD,_2.moduleQuestions(),cM,cN,cO);}function cD(cM){_2.debug(cM);}function cE(cM){return _0.User_(bD,cM);}function cF(cM){return _0["User'_"](bD,cM);}function cG(cM,cN){return _0.Response_(bD,_2.moduleQuestions(),cM,cN);}function cH(cM,cN){return _0["Response'_"](bD,_2.moduleQuestions(),cM,cN);}function cI(cM){var cN;cy(D.waitRetrievePhrases(),"user name");bo.Start((cN=null,bo.Delay(function(){return bo.Bind((new by.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-293062622",[cM]),function(cO){var cP;return cO==null?(cx((function(cQ){return function(cR){return cQ("I did not find a user with the name "+bh.toSafe(cR)+".");};}(a.id))(cM)),cC("addUser",cM,function(cQ){_2.update(cQ);}),bo.Zero()):(cP=cO.$0,bo.Bind((new by.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:738744556",[cP.Name]),function(){cz("user",cP);cy(D.helloUserPhrases(),(function(cQ){return function(cR){return cQ(bh.prettyPrint(cR));};}(a.id))(bF.get_Item("user")));return cP.LastLoggedIn!=null?bo.Bind((new by.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:1686065325",[cP.LastLoggedIn.$0]),function(cQ){cx((function(cR){return function(cS){return cR("You last logged in "+bh.toSafe(cS)+".");};}(a.id))(cQ));return bo.Zero();}):bo.Zero();}));});})),null);}function cJ(cM,cN){var cO;return bo.Start((cO=null,bo.Delay(function(){cy(D.waitAddPhrases(),"user");return bo.Bind((new by.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:738744556",[cM]),function(cP){return cP.$==1?(cx((function(cQ){return function(cR){return cQ("Sorry I was not able to add the user "+bh.toSafe(cR)+" to the system.");};}(a.id))(cM)),bo.Zero()):bo.Bind((new by.New()).Async("SMApp.Web:SMApp.Web.Server.addUserTypingPattern:-1977543655",[cM,cN]),function(cQ){return cQ.$==1?(cx((function(cR){return function(cS){return cR("Sorry I was not able to add the user "+bh.toSafe(cS)+" to the system.");};}(a.id))(cM)),bo.Zero()):(cz("user",cM),cx((function(cR){return function(cS){return cR("Hello "+bh.prettyPrint(cS)+", nice to meet you.");};}(a.id))(bF.get_Item("user"))),bo.Zero());});});})),null);}function cK(cM,cN,cO){var cP;return bo.Start((cP=null,bo.Delay(function(){cy(D.waitAddPhrases(),"symptom entry");return bo.Bind((new by.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:-1898030538",[cB().Name,cM,cN,cO]),function(cQ){return cQ.$==1?(cx(function(cR){return cR("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),bo.Zero()):(cx((function(cR){return function(cS){return cR("OK I added that "+bh.toSafe(cS)+" symptom to your journal.");};}(a.id))(cM)),bo.Zero());});})),null);}function cL(cM){_2.debug(cM);}bE=bD.$4;bF=bD.$1;bG=bD.$2;bH=bD.$0;_2.debug((((bg.Curried3(function(cM,cN,cO){return cM("Starting utterances:"+bh.prettyPrint(cN)+". Starting questions: "+bh.prettyPrint(cO)+".");}))(a.id))(bE))(bG));bI=bg.Curried(_0["handle'"],2,[bD,cD]);bJ=bl.ofSeq(bm.take(bE.length>=5?5:bE.length,bE));bJ.$==1&&(bL=cF(bJ.$0),bL!=null&&bL.$==1&&(bM=F.Intent$1("greet",bL.$0),bM!=null&&bM.$==1&&(bN=F.Entity1Of1("name",bM.$0[1]),bN!=null&&bN.$==1&&(bJ.$1.$==0&&(bK=bN.$0,true)))))?((bg.Curried(_0.handle,2,[bD,cL]))("loginUser"))(function(){cI(bK.get_Value());}):bJ.$==1&&(bP=cH("inputPassPhrase",bJ.$0),bP!=null&&bP.$==1&&(bQ=F.Str(bP.$0[1]),bQ!=null&&bQ.$==1&&(bJ.$1.$==0&&(bO=[bJ.$0,bQ.$0],true))))?(bR=bO[0],bS=bO[1],(bI("addUser"))(function(){bH.TypingDNA.stop();cJ(bS,bH.GetSameTextTypingPattern(bR.get_Text()));})):bJ.$==1&&(bU=F.Yes(bJ.$0),bU!=null&&bU.$==1&&(bV=cH("addUser",bU.$0),bV!=null&&bV.$==1&&(bW=F.Str(bV.$0[1]),bW!=null&&bW.$==1&&(bJ.$1.$==0&&(bT=bW.$0,true)))))?(bI("inputPassPhrase"))(function(){bH.TypingDNA.start();cC("inputPassPhrase",bT,function(cM){_2.update(cM);});}):bJ.$==1&&(bY=F.No(bJ.$0),bY!=null&&bY.$==1&&(bZ=cH("addUser",bY.$0),bZ!=null&&bZ.$==1&&(b0=F.Str(bZ.$0[1]),b0!=null&&b0.$==1&&(bJ.$1.$==0&&(bX=b0.$0,true)))))?(bI("no"))(function(){cx((function(cM){return function(cN){return cM("Ok I did not add the user "+bh.toSafe(cN)+". But you must login for me to help you.");};}(a.id))(bX));}):bJ.$==1&&(b2=cE(bJ.$0),b2!=null&&b2.$==1&&(b3=F.Intent$1("hello",b2.$0),b3!=null&&b3.$==1&&(b3.$0[0]==null&&(b4=F.Entity1Of1("name",b3.$0[1]),b4!=null&&b4.$==1&&(bJ.$1.$==0&&(b1=b4.$0,true))))))?bo.Start((b5=null,bo.Delay(function(){return bo.Bind((new by.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-293062622",[b1.get_Value()]),function(cM){return cM==null?(cx((function(cN){return function(cO){return cN("Sorry, the user "+bh.toSafe(cO)+" does not exist.");};}(a.id))(b1.get_Value())),bo.Zero()):(cC("switchUser",cM.$0.Name,function(cN){_2.update(cN);}),bo.Zero());});})),null):bJ.$==1&&(b7=F.Yes(bJ.$0),b7!=null&&b7.$==1&&(b8=cG("switchUser",b7.$0),b8!=null&&b8.$==1&&(b9=F.Str(b8.$0[1]),b9!=null&&b9.$==1&&(bJ.$1.$==0&&(b6=b9.$0,true)))))?(bF.set_Item("user",b6),cx((function(cM){return function(cN){return cM("Ok I switched to user "+bh.prettyPrint(cN)+".");};}(a.id))(b6))):bJ.$==1&&(b$=F.No(bJ.$0),b$!=null&&b$.$==1&&(ca=cG("switchUser",b$.$0),ca!=null&&ca.$==1&&(cb=F.Str(ca.$0[1]),cb!=null&&cb.$==1&&(bJ.$1.$==0&&(b_=cb.$0,true)))))?cx((function(cM){return function(cN){return cM("Ok I did not switch to user "+bh.toSafe(cN)+".");};}(a.id))(b_)):bJ.$==1&&(cd=cF(bJ.$0),cd!=null&&cd.$==1?(ce=F.Intent$1("kbquery",cd.$0),ce!=null&&ce.$==1)?bJ.$1.$==0&&(cc=cd.$0,true):(cf=cE(bJ.$0),cf!=null&&cf.$==1&&((cg=F.Intent$1("kbquery",cf.$0),cg!=null&&cg.$==1)&&(bJ.$1.$==0&&(cc=cf.$0,true)))):(ch=cE(bJ.$0),ch!=null&&ch.$==1&&((ci=F.Intent$1("kbquery",ch.$0),ci!=null&&ci.$==1)&&(bJ.$1.$==0&&(cc=ch.$0,true)))))?bo.Start((cj=null,bo.Delay(function(){return bo.Bind(u.getAnswer(cc.get_Text()),function(cM){var cN;return bo.Bind((cN=be.get(cM.answers,0).answer,(new by.New()).Async("SMApp.Web:SMApp.Web.Server.mdtohtml:125922947",[cN])),function(cO){var cP;return bo.Bind((cP=be.get(cM.answers,0).answer,(new by.New()).Async("SMApp.Web:SMApp.Web.Server.mdtotext:125922947",[cP])),function(cQ){cw(cO);cx(cQ);return bo.Zero();});});});})),null):bJ.$==1&&(cl=cE(bJ.$0),cl!=null&&cl.$==1&&(cm=F.Intent$1("symptom",cl.$0),cm!=null&&cm.$==1&&(cn=F.Entity1OfAny("symptom_name",cm.$0[1]),cn!=null&&cn.$==1&&(bJ.$1.$==0&&(ck=cn.$0,true)))))?bo.Start((co=null,bo.Delay(function(){cx("Ok I'll add that entry to your symptom journal");cK(ck.get_Value(),null,null);return bo.Zero();})),null):bJ.$==1&&(cq=F.Yes(bJ.$0),cq!=null&&cq.$==1&&((cr=cG("painVideo",cq.$0),cr!=null&&cr.$==1)&&bJ.$1.$==0))?bH["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bJ.$==1&&(ct=cE(bJ.$0),ct!=null&&ct.$==1&&(cu=F.Intent$1("medjournal",ct.$0),cu!=null&&cu.$==1&&((cv=cu.$0[1],cv!=null&&cv.$==1)&&(bJ.$1.$==0&&(cs=cu.$0[1].$0,true)))))?(cx("ok I added that entry to your medication journal."),cx("You should be careful not to take too many painkillers over a short period of time.")):_0.didNotUnderstand(bD,function(cM){_2.debug(cM);},_2.name());_2.debug((((bg.Curried3(function(cM,cN,cO){return cM("Ending utterances: "+bh.prettyPrint(cN)+". Ending questions:"+bh.prettyPrint(cO)+".");}))(a.id))(bE))(bG));};_2.haveQuestion=function(bD){return function(bE){return _0.haveQuestion(_2.moduleQuestions(),bE);};};_2.getQuestion=function(bD){return function(bE){return _0.getQuestion(_2.moduleQuestions(),bE);};};_2.moduleQuestions=function(){_3.$cctor();return _3.moduleQuestions;};_2.debug=function(bD){d.debug(_2.name(),bD);};_2.name=function(){_3.$cctor();return _3.name;};_3.$cctor=function(){_3.$cctor=a.ignore;_3.name="User";_3.moduleQuestions=bl.ofArray([new K({$:0,$0:"inputPassPhrase",$1:"Please type the phrase My name is {firstname} {lastname}",$2:L.UserData,$3:_2.name()}),new K({$:0,$0:"addUser",$1:"Do you want me to add the user $0?",$2:L.Verification,$3:_2.name()}),new K({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?",$2:L.Verification,$3:_2.name()})]);};_4.update=function(bD){var bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU;function bV(b0){_0.say(bD,b0);}function bW(b0){_0["sayRandom'"](bD,b0);}function bX(b0){_4.debug(b0);}function bY(b0){return _0["User'_"](bD,b0);}function bZ(b0){_4.debug(b0);}bE=bD.$4;bF=bD.$2;_4.debug((((bg.Curried3(function(b0,b1,b2){return b0("Starting utterances:"+bh.prettyPrint(b1)+". Starting questions: "+bh.prettyPrint(b2)+".");}))(a.id))(bE))(bF));bG=bg.Curried(_0.handle,2,[bD,bX]);bH=bl.ofSeq(bm.take(bE.length>=5?5:bE.length,bE));bI=_0.Agenda_(bD,_2.name(),bH);bI!=null&&bI.$==1?_2.update(bD):bH.$==1&&(bK=(bL=_0.PropNotSet_(bD,"started",bH.$0),bL!=null&&bL.$==1?{$:1,$0:bL.$0}:null),bK!=null&&bK.$==1&&(bM=bY(bK.$0),bM!=null&&bM.$==1&&(bN=F.Intent$1("greet",bM.$0),bN!=null&&bN.$==1&&(bN.$0[1]==null&&bH.$1.$==0))))?(_0.add(bD,"started",true),(bG("Hello"))(function(){bW(D.helloPhrases());})):bH.$==1&&(bP=bY(bH.$0),bP!=null&&bP.$==1&&(bQ=F.Intent$1("greet",bP.$0),bQ!=null&&bQ.$==1&&(bQ.$0[1]==null&&bH.$1.$==0)))?(bG("Hello"))(function(){bV("Hello, tell me your name to get started.");}):bH.$==1&&(bS=bY(bH.$0),bS!=null&&bS.$==1&&(bT=F.Intent$1("greet",bS.$0),bT!=null&&bT.$==1&&((bU=F.Entity1Of1("name",bT.$0[1]),bU!=null&&bU.$==1)&&bH.$1.$==0)))?((bg.Curried(_0.dispatch,2,[bD,bZ]))(_2.name()))(function(b0){_2.update(b0);}):_0.didNotUnderstand(bD,function(b0){_4.debug(b0);},_4.name());_4.debug((((bg.Curried3(function(b0,b1,b2){return b0("Ending utterances: "+bh.prettyPrint(b1)+". Ending questions:"+bh.prettyPrint(b2)+".");}))(a.id))(bE))(bF));};_4.haveQuestion=function(bD){return bl.exists(function(bE){return bE.get_Name()===bD;},_4.moduleQuestions());};_4.getQuestion=function(bD){return bm.tryFind(function(bE){return bE.get_Name()===bD;},_4.moduleQuestions());};_4.moduleQuestions=function(){_5.$cctor();return _5.moduleQuestions;};_4.debug=function(bD){d.debug(_4.name(),bD);};_4.name=function(){_5.$cctor();return _5.name;};_5.$cctor=function(){_5.$cctor=a.ignore;_5.name="Main";_5.moduleQuestions=bl.T.Empty;};_6.run=function(){var bD,bE;bD=bg.ThisFunc(function(bF,bG){return((_6.Main().get_Text())(bF))(bG);});bE=_6.Main().get_Options();a.$("#term").terminal(bD,bE);return bc.get_Empty();};_6.Main=function(){_7.$cctor();return _7.Main;};_6.initMic=function(bD){var bE,bF;_6.set_CUI((bE={$:1,$0:new bz.Microphone(bA.getElementById("microphone"))},Z.New(_6.CUI().Voice,bE,_6.CUI().Term,_6.CUI().Avatar,_6.CUI().Caption,_6.CUI().TypingDNA)));bF=_6.CUI().Mic.$0;bF.onconnecting=function(){_6.set_MicState(W.MicConnecting);return _6.debug("Mic connecting...");};bF.ondisconnected=function(){_6.set_MicState(W.MicDisconnected);return _6.debug("Mic disconnected.");};bF.onaudiostart=function(){_6.set_MicState(W.MicAudioStart);return _6.debug("Mic audio start...");};bF.onaudioend=function(){_6.set_MicState(W.MicAudioEnd);_6.debug("Mic audio end.");return _6.debug(self.lastMicData);};bF.onerror=function(bG){_6.set_MicState({$:6,$0:bG});return _6.debug((function(bH){return function(bI){return bH("Mic error : "+bh.toSafe(bI)+".");};}(a.id))(bG));};bF.onready=function(){_6.set_MicState(W.MicReady);return _6.debug("Mic ready.");};bF.onresult=function(bG,bH){return _6.ClientState().$==2?_6.echo("I'm still trying to understand what you said before."):_6.ClientState().$==0?d.error("Client is not intialized."):!(bG==null||bH==null)?(_6.set_MicState({$:7,$0:bG,$1:bH}),_6.debug((((bg.Curried3(function(bI,bJ,bK){return bI("Mic result: "+bh.prettyPrint(bJ)+" "+bh.prettyPrint(bK)+".");}))(a.id))(bG))(bH)),bD(bG,bH)):_6.debug("Mic: No result returned.");};bF.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};_6.sayRandom=function(bD,bE){_6.say(D.getRandomPhrase(bE,bD));};_6.say=function(bD){_6.Output().unshift(bD);_6["say'"](bD);};_6["say'"]=function(bD){_6.CUI().Say(bD);};_6.initSpeech=function(){var bD;bD=d.toArray(_6.synth().getVoices());be.length(bD)>0?(be.iter(function(bE){if(bB.Equals(_6.CUI().Voice,null)&&(bE.name.indexOf("Microsoft Zira")!=-1||bE.name.toLowerCase().indexOf("female")!=-1)){_6.set_CUI(Z.New({$:1,$0:bE},_6.CUI().Mic,_6.CUI().Term,_6.CUI().Avatar,_6.CUI().Caption,_6.CUI().TypingDNA));_6.debug((function(bF){return function(bG){return bF("Using browser speech synthesis voice "+bh.toSafe(bG)+".");};}(a.id))(_6.CUI().Voice.$0.name));}},bD),!bB.Equals(_6.CUI().Voice,null)?(_6.CUI().Avatar.nativeVoice=true,_6.CUI().Avatar.nativeVoiceName=_6.CUI().Voice.$0.name,_6.debug((function(bE){return function(bF){return bE("Using browser speech synthesis voice "+bh.toSafe(bF)+".");};}(a.id))(_6.CUI().Voice.$0.name))):void 0):void 0;bB.Equals(_6.CUI().Voice,null)?_6.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};_6.synth=function(){_7.$cctor();return _7.synth;};_6.push=function(bD){_6.Utterances().unshift(bD);return _6.Dialogue();};_6.Dialogue=function(){_7.$cctor();return _7.Dialogue;};_6.Utterances=function(){_7.$cctor();return _7.Utterances;};_6.Questions=function(){_7.$cctor();return _7.Questions;};_6.Output=function(){_7.$cctor();return _7.Output;};_6.Props=function(){_7.$cctor();return _7.Props;};_6.wait=function(bD){d["Terminal.Echo'"](_6.CUI().Term,"please wait");_6.CUI().Term.pause();bD();_6.CUI().Term.resume();};_6.debug=function(bD){d.debug("CLIENT",bD);};_6.echo=function(bD){d["Terminal.EchoHtml'"](_6.CUI().Term,(function(bE){return function(bF){return bE(bh.prettyPrint(bF));};}(a.id))(bD));};_6.ClientState=function(){_7.$cctor();return _7.ClientState;};_6.set_ClientState=function(bD){_7.$cctor();_7.ClientState=bD;};_6.MicState=function(){_7.$cctor();return _7.MicState;};_6.set_MicState=function(bD){_7.$cctor();_7.MicState=bD;};_6.CUI=function(){_7.$cctor();return _7.CUI;};_6.set_CUI=function(bD){_7.$cctor();_7.CUI=bD;};_7.$cctor=function(){var bD,bE,bF,bG;_7.$cctor=a.ignore;function bH(bJ,bK){var bL,bM,bN,bO,bP,bQ,bR;_6.debug((((bg.Curried3(function(bS,bT,bU){return bS("Voice: "+bh.prettyPrint(bT)+" "+bh.prettyPrint(bU));}))(a.id))(bJ))(bK));bL=(bM=M["Intent'"](bJ,bK),bM!=null&&bM.$==1?{$:1,$0:bM.$0}:null);bN=(bO=M["Trait'"](bK),bO!=null&&bO.$==1?{$:1,$0:bl.ofArray([bO.$0])}:null);bP=(bQ=M["Entity'$1"](bK),bQ!=null&&bQ.$==1?{$:1,$0:bl.ofArray([bQ.$0])}:null);bL==null&&(bN==null&&bP==null)?void 0:(_6.debug(((((bg.Curried(function(bS,bT,bU,bV){return bS("Voice: "+_8.p(bT)+" "+_8.p$3(bU)+" "+_8.p$5(bV));},4))(a.id))(bL))(bN))(bP)),_4.update(_6.push(new J({$:0,$0:"",$1:bL,$2:bN,$3:bP}))));}function bI(bJ,bK){var bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV;_6.set_CUI(Z.New(_6.CUI().Voice,_6.CUI().Mic,bJ,_6.CUI().Avatar,_6.CUI().Caption,_6.CUI().TypingDNA));bB.Equals(_6.CUI().Mic,null)?_6.initMic(bH):void 0;bB.Equals(_6.CUI().Voice,null)?_6.initSpeech():void 0;_6.ClientState().$===0?_6.set_ClientState(X.ClientReady):void 0;return(bL=O.Blank(bK),bL!=null&&bL.$==1)?_6["say'"]("Tell me what you want me to do or ask me a question."):(bM=O.Debug(bK),bM!=null&&bM.$==1)?(_6.debug((function(bW){return function(bX){return bW("Utterances: "+bh.prettyPrint(bX));};}(a.id))(_6.Utterances())),_6.debug((function(bW){return function(bX){return bW("Questions: "+bh.prettyPrint(bX));};}(a.id))(_6.Questions()))):(bN=O.Voices(bK),bN!=null&&bN.$==1)?(bO=d.toArray(d.speechSynthesis().getVoices()),(_6["say'"]((function(bW){return function(bX){return bW("There are currently "+a.String(bX)+" voices installed on this computer or device.");};}(a.id))(be.length(bO))),be.iteri(function(bW,bX){return _6["say'"](((((bg.Curried(function(bY,bZ,b0,b1){return bY("Voice "+a.String(bZ)+". Name: "+bh.toSafe(b0)+", Local: "+bh.prettyPrint(b1)+".");},4))(a.id))(bW))(bX.name))(bX.localService));},bO))):_6.ClientState().$==1?(bQ=O.QuickHello(bK),bQ!=null&&bQ.$==1?(bP=bQ.$0,true):(bR=O.QuickHelp(bK),bR!=null&&bR.$==1?(bP=bR.$0,true):(bS=O.QuickYes(bK),bS!=null&&bS.$==1?(bP=bS.$0,true):(bT=O.QuickNo(bK),bT!=null&&bT.$==1?(bP=bT.$0,true):(bU=O.QuickNumber(bK),bU!=null&&bU.$==1&&(bP=bU.$0,true))))))?(_6.debug((function(bW){return function(bX){return bW("Quick Text: "+_8.p$7(bX)+".");};}(a.id))(bP)),_4.update(_6.push(bP)),_6.set_ClientState(X.ClientReady)):_6.CUI().Wait((bV=null,bo.Delay(function(){_6.set_ClientState(X.ClientUnderstand);O.getUtterance(bK,function(bW){var bX,bY;bX=O.HasUtterance(bW);bX!=null&&bX.$==1?(bY=bX.$0,_6.debug(((((bg.Curried(function(bZ,b0,b1,b2){return bZ("Text: Intent: "+_8.p(b0)+", Traits: "+_8.p$3(b1)+", Entities: "+_8.p$5(b2)+".");},4))(a.id))(bY.get_Intent()))(bY.get_Traits()))(bY.get_Entities())),_4.update(_6.push(bY))):(_6.debug("Text: Did not receive a meaning from the server."),_6["say'"]("Sorry I did not understand what you said."));});_6.set_ClientState(X.ClientReady);return bo.Zero();}))):_6.ClientState().$==0?d.error("Client is not initialized."):_6["say'"]("I'm still trying to understand what you said before.");}_7.CUI=Z.New(null,null,null,(bv.applicationId="4277115329081938617",bD=new a.SDKConnection(),bE=new a.WebAvatar(),bE.version=8.5,bE.connection=bD,bE.avatar="20926186",bE.voice="cmu-slt",bE.voiceMod="default",bE.width=175,bE.createBox(),bE.addMessage(""),bE.processMessages(0),bE),false,(bF=new a.TypingDNA(),(bF.stop(),bF)));_7.MicState=W.MicNotInitialized;_7.ClientState=X.ClientNotInitialzed;_7.Props=new bC.New$5();_7.Output=[];_7.Questions=[];_7.Utterances=[];_7.Dialogue=new _1({$:0,$0:_6.CUI(),$1:_6.Props(),$2:_6.Questions(),$3:_6.Output(),$4:_6.Utterances()});_7.synth=a.speechSynthesis;_7.Main=new Y({$:0,$0:function(bJ){return bH(bJ[0],bJ[1]);},$1:[function(bJ){return function(bK){return bI(bJ,bK);};},(bG={},bG.name="Main",bG.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bG.prompt=">",bG)]});};_8.p$8=function(bD){return bD.$==3?"ConceptCompletion":bD.$==2?"Disjunctive":bD.$==1?"Verification":"UserData";};_9.p=function(bD){return"{"+("text = "+bh.prettyPrint(bD.text))+"; "+("intents = "+bh.printArray(function(bE){return _9.p$1(bE);},bD.intents))+"; "+("entities = "+bh.prettyPrint(bD.entities))+"; "+("traits = "+bh.prettyPrint(bD.traits))+"}";};_9.p$1=function(bD){return"{"+("id = "+bh.prettyPrint(bD.id))+"; "+("name = "+bh.prettyPrint(bD.name))+"; "+("confidence = "+bh.prettyPrint(bD.confidence))+"}";};_8.p$2=function(bD){return bD==null?"null":"Some "+bh.prettyPrint(bD.$0);};_8.p$1=function(bD){return"Intent ("+bh.prettyPrint(bD.$0)+", "+_8.p$2(bD.$1)+")";};_8.p=function(bD){return bD==null?"null":"Some "+_8.p$1(bD.$0);};_8.p$4=function(bD){return"Trait ("+bh.prettyPrint(bD.$0)+", "+bh.prettyPrint(bD.$1)+", "+_8.p$2(bD.$2)+")";};_8.p$3=function(bD){return bD==null?"null":"Some "+bh.printList(function(bE){return _8.p$4(bE);},bD.$0);};_8.p$6=function(bD){return"Entity ("+bh.prettyPrint(bD.$0)+", "+bh.prettyPrint(bD.$1)+", "+bh.prettyPrint(bD.$2)+", "+_8.p$2(bD.$3)+")";};_8.p$5=function(bD){return bD==null?"null":"Some "+bh.printList(function(bE){return _8.p$6(bE);},bD.$0);};_8.p$7=function(bD){return"Utterance ("+bh.prettyPrint(bD.$0)+", "+_8.p(bD.$1)+", "+_8.p$3(bD.$2)+", "+_8.p$5(bD.$3)+")";};}());
