(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=b.Bs=b.Bs||{};i=b.NLU=b.NLU||{};j=i.Babelfy=i.Babelfy||{};k=j.ApiResponse=j.ApiResponse||{};l=j.TokenFragment=j.TokenFragment||{};m=j.CharFragment=j.CharFragment||{};n=i.Witai=i.Witai||{};o=n.Utterance=n.Utterance||{};p=n.Intent=n.Intent||{};q=n.Entity=n.Entity||{};r=n.Trait=n.Trait||{};s=n["Utterance'"]=n["Utterance'"]||{};t=n["Value'"]=n["Value'"]||{};u=c.NLU=c.NLU||{};v=u.Intent=u.Intent||{};w=u.Trait=u.Trait||{};x=u.Entity=u.Entity||{};y=u.Utterance=u.Utterance||{};z=u.SSML=u.SSML||{};A=u.Response=u.Response||{};B=u.Task=u.Task||{};C=u.Voice=u.Voice||{};D=C["Entity'"]=C["Entity'"]||{};E=u.Text=u.Text||{};F=E["Utterance'"]=E["Utterance'"]||{};G=E["Intent'"]=E["Intent'"]||{};H=E["Entity'"]=E["Entity'"]||{};I=E["Trait'"]=E["Trait'"]||{};J=u.Domain=u.Domain||{};K=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};L=c.CUI=c.CUI||{};M=L.MicState=L.MicState||{};N=L.ClientState=L.ClientState||{};O=L.Interpreter=L.Interpreter||{};P=L.CUI=L.CUI||{};Q=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};R=c.Main=c.Main||{};S=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};T=c.Client=c.Client||{};U=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};V=a.GeneratedPrintf=a.GeneratedPrintf||{};W=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};X=a.WebSharper;Y=X&&X.UI;Z=Y&&Y.Client;_0=Z&&Z.Templates;_1=Y&&Y.Doc;_2=X&&X.Strings;_3=X&&X.Arrays;_4=a.IntelliFactory;_5=_4&&_4.Runtime;_6=X&&X.Utils;_7=a.console;_8=a.jQuery;_9=X&&X.List;_=X&&X.Seq;$=Y&&Y.AttrModule;ba=Y&&Y.AttrProxy;bb=X&&X.Concurrency;bc=X&&X.Collections;bd=bc&&bc.Map;be=X&&X.JavaScript;bf=be&&be.Pervasives;bg=a.SDK;bh=X&&X.Random;bi=X&&X.Operators;bj=X&&X.Remoting;bk=bj&&bj.AjaxRemotingProvider;bl=a.Wit;bm=a.document;bn=X&&X.Unchecked;bo=bc&&bc.Dictionary;d.speechSynthesis=function(){return a.speechSynthesis;};d.elementHTML=function(bp){return bp.innerHTML;};d.createElement=function(bp){var bq;bq=self.document.createElement("div");_0.LoadLocalTemplates("");_1.RunAppend(bq,bp);};d.replace_tok=function(bp,bq,br){return _2.Replace(br,bp,bq);};d.termOutput=function(){return _3.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(bp){return bp.toLowerCase();};d.debug=function(bp,bq){d.info((((_5.Curried3(function(br,bs,bt){return br("DEBUG: "+_6.toSafe(bs)+": "+_6.prettyPrint(bt));}))(a.id))(bp.toUpperCase()))(bq));};d.error=function(bp){_7.error(bp);};d.info=function(bp){_7.info(bp);};d.jserror=function(bp){_8.error(bp);};d.toArray=function(bp){return _3.map(a.id,_8.makeArray(bp));};d["Terminal.EchoHtml'"]=function(bp,bq){bp.pause();bp.echo(bq,d.rawOpt());bp.resume();};d["Terminal.Echo'"]=function(bp,bq){bp.pause();bp.echo(bq);bp.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=_5.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(bp){function bq(br){return function(bs){var bt,bu,bv,bw,bx,by,bz;bu=_2.replicate(br," ");switch(bs.$==0?bs.$1.$==1?bs.$1.$0.$==2?bs.$1.$1.$==0?(bt=[bs.$1.$0.$0,bs.$0],1):(bt=[bs.$1,bs.$0],2):(bt=[bs.$1,bs.$0],2):(bt=[bs.$1,bs.$0],2):bs.$==2?(bt=bs.$0,3):(bt=[bs.$0,bs.$1],0)){case 0:return bt[0]+"=\""+bt[1]+"\"";case 1:bv=bt[1];return bu+"<"+bv+">"+bt[0]+"</"+bv+">\r\n";case 2:bw=bt[1];bx=_9.partition(function(bA){return bA.$==1;},bt[0]);by=bx[1];bz=bx[0];return by.$==0?bu+"<"+bw+(bz.$===0?"":" "+_2.concat(" ",_9.ofSeq(_.delay(function(){return _.map(function(bA){return(bq(0))(bA);},bz);}))))+"/>\r\n":bu+"<"+bw+(bz.$===0?"":" "+_2.concat(" ",_9.ofSeq(_.delay(function(){return _.map(function(bA){return(bq(0))(bA);},bz);}))))+">\r\n"+_2.concat("",_9.ofSeq(_.delay(function(){return _.map(function(bA){return(bq(br+1))(bA);},by);})))+bu+"</"+bw+">\r\n";case 3:return bu+bt+"\r\n";}};}return(bq(0))(bp);};f.alt=function(bp){return new e({$:1,$0:"alt",$1:bp});};f.src=function(bp){return new e({$:1,$0:"src",$1:bp});};f.cls=function(bp){return new e({$:1,$0:"class",$1:bp});};f.str=function(bp){return e.toString(bp);};f.op_PercentEquals=function(bp,bq){return new e({$:1,$0:bp,$1:bq});};f.op_Splice=function(bp){var bq;return _9.ofArray([new e({$:2,$0:(bq=bp,a.String(bq))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(bp,bq){return new e({$:0,$0:bp,$1:bq});};g.$cctor=function(){var bp;g.$cctor=a.ignore;g.rawOpt=(bp={},bp.raw=true,bp);g.html=function(bq){return f.elem("html",bq);};g.head=function(bq){return f.elem("head",bq);};g.title=function(bq){return f.elem("title",bq);};g.style=function(bq){return f.elem("style",bq);};g.body=function(bq){return f.elem("body",bq);};g.div=function(bq){return f.elem("div",bq);};g.br=function(bq){return f.elem("br",bq);};g.section=function(bq){return f.elem("section",bq);};g.span=function(bq){return f.elem("span",bq);};g.table=function(bq){return f.elem("table",bq);};g.thead=function(bq){return f.elem("thead",bq);};g.tbody=function(bq){return f.elem("tbody",bq);};g.tfoot=function(bq){return f.elem("tfoot",bq);};g.img=function(bq){return f.elem("img",bq);};g.map=function(bq){return f.elem("map",bq);};g.area=function(bq){return f.elem("area",bq);};g.p=function(bq){return f.elem("p",bq);};g.a=function(bq){return f.elem("a",bq);};g.tr=function(bq){return f.elem("tr",bq);};g.td=function(bq){return f.elem("td",bq);};g.th=function(bq){return f.elem("th",bq);};g.ul=function(bq){return f.elem("ul",bq);};g.li=function(bq){return f.elem("li",bq);};g.h1=function(bq){return f.elem("h1",bq);};g.h2=function(bq){return f.elem("h1",bq);};g.h3=function(bq){return f.elem("h1",bq);};g.h4=function(bq){return f.elem("h1",bq);};g.strong=function(bq){return f.elem("strong",bq);};};h.Radio=function(bp,bq,br,bs,bt){return _1.Element("div",new _9.T({$:1,$0:h.cls("radio"),$1:bq}),[_1.Element("label",bs,[_1.Radio(bt,true,br),_1.TextNode(bp)])]);};h.checkbox=function(bp,bq,br,bs,bt){return _1.Element("div",new _9.T({$:1,$0:h.cls("checkbox"),$1:bq}),[_1.Element("label",bs,[_1.CheckBox(bt,br),_1.TextNode(bp)])]);};h.textArea=function(bp,bq,br,bs,bt){return _1.Element("div",new _9.T({$:1,$0:h.cls("form-group"),$1:bq}),[_1.Element("label",bs,[_1.TextNode(bp)]),_1.InputArea(new _9.T({$:1,$0:h.cls("form-control"),$1:bt}),br)]);};h.inputPassword=function(bp,bq,br,bs,bt){return _1.Element("div",new _9.T({$:1,$0:h.cls("form-group"),$1:bq}),[_1.Element("label",bs,[_1.TextNode(bp)]),_1.PasswordBox(new _9.T({$:1,$0:h.cls("form-control"),$1:bt}),br)]);};h.input=function(bp,bq,br,bs,bt){return _1.Element("div",new _9.T({$:1,$0:h.cls("form-group"),$1:bq}),[_1.Element("label",bs,[_1.TextNode(bp)]),_1.Input([h.cls("form-control"),bt],br)]);};h.btnSecondary=function(bp,bq,br){return _1.Element("button",[h.eid(bp),h.cls("btn btn-secondary"),$.Handler("click",br)],[_1.TextNode(bq)]);};h.btnPrimary=function(bp,bq,br){return _1.Element("button",[h.eid(bp),h.cls("btn btn-primary"),$.Handler("click",br)],[_1.TextNode(bq)]);};h.container=function(bp){return _1.Element("div",[h.cls("container")],bp);};h.dindex=function(bp){return ba.Create("data-index",a.String(bp));};h.cls=function(bp){return ba.Create("class",bp);};h.eid=function(bp){return ba.Create("id",bp);};k.New=function(bp,bq,br,bs,bt,bu,bv,bw,bx){return{tokenFragment:bp,charFragment:bq,babelSynsetID:br,DBpediaURL:bs,BabelNetURL:bt,score:bu,cohrenceScore:bv,globalScore:bw,source:bx};};l.New=function(bp,bq){return{start:bp,end:bq};};m.New=function(bp,bq){return{start:bp,end:bq};};j.disambiguate=function(bp){function bq(br,bs){var bt;_8.ajax((bt={},bt.url=(function(bu){return function(bv){return bu("https://babelfy.io/v1/disambiguate?text="+_6.toSafe(bv)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bp),bt.type="GET",bt.success=function(bu){return br(bu);},bt.error=function(bu){return bs(new a.Error(bu.responseText));},bt));}return bb.FromContinuations(function(br,bs,bt){return bq.apply(null,[br,bs,bt]);});};o.New=function(bp,bq,br,bs){return{text:bp,intents:bq,entities:br,traits:bs};};p.New=function(bp,bq,br){return{id:bp,name:bq,confidence:br};};q.New=function(bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz){return{id:bp,name:bq,role:br,start:bs,end:bt,body:bu,confidence:bv,entities:bw,suggested:bx,value:by,type:bz};};r.New=function(bp,bq,br){return{id:bp,value:bq,confidence:br};};s.New=function(bp){return{intent:bp};};t.New=function(bp){return{value:bp};};n.getMeaning2=function(bp,bq){function br(bs,bt){var bu;_8.ajax((bu={},bu.url=(function(bv){return function(bw){return bv("https://api.wit.ai/message?q="+_6.toSafe(bw));};}(a.id))(bq),bu.type="GET",bu.beforeSend=function(bv){return bv.setRequestHeader("Authorization","Bearer "+bp);},bu.success=function(bv){return bs(bv);},bu.error=function(bv){return bt(new a.Error(bv.responseText));},bu));}return bb.FromContinuations(function(bs,bt,bu){return br.apply(null,[bs,bt,bu]);});};n.getMeaning=function(bp,bq,br,bs){var bt;_8.ajax((bt={},bt.url=(function(bu){return function(bv){return bu("https://api.wit.ai/message?q="+_6.toSafe(bv));};}(a.id))(bq),bt.type="GET",bt.beforeSend=function(bu){return bu.setRequestHeader("Authorization","Bearer "+bp);},bt.success=br,bt.error=bs,bt));};v=u.Intent=_5.Class({toString:function(){return(((_5.Curried3(function(bp,bq,br){return bp("Intent("+_6.toSafe(bq)+", "+W.p$2(br)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,v);w=u.Trait=_5.Class({toString:function(){return(((_5.Curried3(function(bp,bq,br){return bp("Trait("+_6.toSafe(bq)+", "+_6.prettyPrint(br)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,w);x=u.Entity=_5.Class({toString:function(){return((((_5.Curried(function(bp,bq,br,bs){return bp("Entity("+_6.toSafe(bq)+", "+_6.toSafe(br)+", "+W.p$2(bs)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,x);y=u.Utterance=_5.Class({toString:function(){return((((_5.Curried(function(bp,bq,br,bs){return bp(W.p(bq)+" "+W.p$3(br)+" "+W.p$5(bs));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bp;bp=this.$2;return bp!=null?{$:1,$0:_9.sortBy(function(bq){return bq.get_Name();},bp.$0)}:null;},get_Traits:function(){var bp;bp=this.$1;return bp!=null?{$:1,$0:_9.sortBy(function(bq){return bq.get_Name();},bp.$0)}:null;},get_Intent:function(){return this.$0;}},null,y);z=u.SSML=_5.Class({toString:function(){return this.$0;}},null,z);A=u.Response=_5.Class({toString:function(){return this.$==1?this.$1.innerHTML:a.String(this.$0);},get_Text:function(){return this.$==1?a.String(this.$0):a.String(this.$0);}},null,A);B=u.Task=_5.Class({toString:function(){return(((_5.Curried3(function(bp,bq,br){return bp("Name: "+_6.toSafe(bq)+" Prompt: "+_6.toSafe(br));}))(a.id))(this.get_Name()))(a.String(this.get_Prompt()));},get_Prompt:function(){return this.$1;},get_Name:function(){return this.$0;}},null,B);D.New=function(bp,bq,br,bs,bt){return{body:bp,end:bq,start:br,suggested:bs,value:bt};};C["Intent'"]=function(bp,bq){return!(bq.intent==null)?{$:1,$0:new v({$:0,$0:d.toLower(bq.intent.value),$1:null})}:null;};C["Trait'"]=function(bp){return!(bp.domain==null)?{$:1,$0:new w({$:0,$0:"domain",$1:d.toLower(bp.domain.value),$2:null})}:!(bp.dialogue_act==null)?{$:1,$0:new w({$:0,$0:"dialogue_act",$1:d.toLower(bp.dialogue_act.value),$2:null})}:null;};C["Entity'$1"]=function(bp){return!(bp.contact==null)?{$:1,$0:new x({$:0,$0:"contact",$1:d.toLower(bp.contact.value),$2:null})}:null;};F=E["Utterance'"]=_5.Class({get_TopIntent:function(){return _9.head(_9.sortBy(function(bp){return bp.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$2;},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,F);G=E["Intent'"]=_5.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);H=E["Entity'"]=_5.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,H);I=E["Trait'"]=_5.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,I);E.HasUtterance=function(bp){var bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD;return bp!=null&&bp.$==1&&(bp.$0.$0.$==0&&(bp.$0.$1.get_Length()>0&&(bq=[bp.$0.$1,bp.$0.$2],true)))?(br=_9.map(function(bE){return new x({$:0,$0:d.toLower(bE.get_Role()),$1:bE.get_Value(),$2:{$:1,$0:bE.get_Confidence()}});},_9.filter(function(bE){return bE.get_Confidence()>E.entityConfidenceThreshold();},bq[0])),{$:1,$0:new y({$:0,$0:null,$1:{$:1,$0:_9.map(function(bE){return new w({$:0,$0:d.toLower(bE.get_Name()),$1:bE.get_Value(),$2:{$:1,$0:bE.get_Confidence()}});},_9.filter(function(bE){return bE.get_Confidence()>E.entityConfidenceThreshold();},bq[1]))},$2:{$:1,$0:br}})}):bp!=null&&bp.$==1&&(bp.$0.$1.$==0&&(bp.$0.$2.$==0&&(bp.$0.$0.get_Length()>0&&bp.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bs=[bp.$0.$0,bp],true))))?(bt=bs[1],{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:d.toLower(bt.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bt.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):bp!=null&&bp.$==1&&(bp.$0.$2.$==0&&(bp.$0.$0.get_Length()>0&&bp.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bu=[bp.$0.$0,bp],true)))?(bv=bu[1],(bw=_9.map(function(bE){return new x({$:0,$0:d.toLower(bE.get_Role()),$1:bE.get_Value(),$2:{$:1,$0:bE.get_Confidence()}});},_9.filter(function(bE){return bE.get_Confidence()>E.entityConfidenceThreshold();},bv.$0.get_Entities())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:d.toLower(bv.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bv.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:bw}})})):bp!=null&&bp.$==1&&(bp.$0.$1.$==0&&(bp.$0.$0.get_Length()>0&&bp.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bx=[bp.$0.$0,bp],true)))?(by=bx[1],(bz=_9.map(function(bE){return new w({$:0,$0:d.toLower(bE.get_Name()),$1:bE.get_Value(),$2:{$:1,$0:bE.get_Confidence()}});},_9.filter(function(bE){return bE.get_Confidence()>E.entityConfidenceThreshold();},by.$0.get_Traits())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:d.toLower(by.$0.get_TopIntent().get_Name()),$1:{$:1,$0:by.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bz},$2:null})})):bp!=null&&bp.$==1&&(bp.$0.$0.get_Length()>0&&bp.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bA=[bp.$0.$0,bp],true))?(bB=bA[1],(bC=_9.map(function(bE){return new x({$:0,$0:d.toLower(bE.get_Role()),$1:bE.get_Value(),$2:{$:1,$0:bE.get_Confidence()}});},_9.filter(function(bE){return bE.get_Confidence()>E.entityConfidenceThreshold();},bB.$0.get_Entities())),(bD=_9.map(function(bE){return new w({$:0,$0:d.toLower(bE.get_Name()),$1:bE.get_Value(),$2:{$:1,$0:bE.get_Confidence()}});},_9.filter(function(bE){return bE.get_Confidence()>E.entityConfidenceThreshold();},bB.$0.get_Traits())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:d.toLower(bB.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bB.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bD},$2:{$:1,$0:bC}})}))):null;};E.entityConfidenceThreshold=function(){K.$cctor();return K.entityConfidenceThreshold;};E.set_entityConfidenceThreshold=function(bp){K.$cctor();K.entityConfidenceThreshold=bp;};E.intentConfidenceThreshold=function(){K.$cctor();return K.intentConfidenceThreshold;};E.set_intentConfidenceThreshold=function(bp){K.$cctor();K.intentConfidenceThreshold=bp;};E.getUtterance2=function(bp){var bq;bq=null;return bb.Delay(function(){return bb.Bind(n.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bp),function(br){d.debug("NLU",(function(bs){return function(bt){return bs("Wit.ai returned "+V.p(bt)+" ");};}(a.id))(br));return bb.Return(new F({$:0,$0:_9.ofArray(_3.map(function(bs){return new G({$:0,$0:bs.name,$1:bs.confidence});},br.intents)),$1:_9.map(function(bs){return new H({$:0,$0:bs.name,$1:bs.confidence,$2:bs.role,$3:bs.value});},_9.ofSeq(_.concat(_.map(function(bs){return bs[1];},bd.ToSeq(br.entities))))),$2:_9.ofSeq(_.map(function(bs){var bt;bt=bs[1];return new I({$:0,$0:bs[0],$1:_3.get(bt,0).confidence,$2:_3.get(bt,0).value});},bd.ToSeq(br.traits)))}));});});};E.getUtterance=function(bp,bq){n.getMeaning("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bp,function(br){var bs,bt;d.debug("NLU",(function(bu){return function(bv){return bu("Wit.ai returned: "+_6.prettyPrint(bv));};}(a.id))(br));bs=!(br.intents==null)?_9.ofArray(_3.map(function(bu){return new G({$:0,$0:bu.name,$1:bu.confidence});},br.intents)):_9.T.Empty;bt=!(br.traits==null)?_9.ofSeq(_.concat(_9.map(function(bu){return _3.map(function(bv){return new I({$:0,$0:bu,$1:bv.confidence,$2:bv.value});},bf.GetJS(br.traits,[bu]));},_9.filter(function(bu){return!(bf.GetJS(br.traits,[bu])==null);},E.trait_types())))):_9.T.Empty;return bq({$:1,$0:new F({$:0,$0:bs,$1:!(br.entities==null)?_9.ofSeq(_.concat(_9.map(function(bu){return _3.map(function(bv){return new H({$:0,$0:bv.name,$1:bv.confidence,$2:bv.role,$3:bv.value});},bf.GetJS(br.entities,[bu]));},_9.filter(function(bu){return!(bf.GetJS(br.entities,[bu])==null);},E.entity_types())))):_9.T.Empty,$2:bt})});},function(br,bs,bt){d.error((((_5.Curried3(function(bu,bv,bw){return bu("Wit.ai returned: "+_6.prettyPrint(bv)+" "+_6.prettyPrint(bw));}))(a.id))(bs))(bt));return bq(null);});};E.trait_types=function(){K.$cctor();return K.trait_types;};E.entity_types=function(){K.$cctor();return K.entity_types;};E.QuickPrograms=function(bp){return bp==="programs"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};E.QuickNumber=function(bp){var bq,br,bs;return(br=E.One(bp),br!=null&&br.$==1?(bq=br.$0,true):(bs=E.Two(bp),bs!=null&&bs.$==1&&(bq=bs.$0,true)))?{$:1,$0:bq}:null;};E.Three=function(bp){var bq;return bp==="3"||bp==="three"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_9.ofArray([new x({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};E.Two=function(bp){var bq;return bp==="2"||bp==="two"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_9.ofArray([new x({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};E.One=function(bp){var bq;return bp==="1"||bp==="one"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_9.ofArray([new x({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};E.QuickNo=function(bp){var bq;return bp==="no"||(bp==="nope"||(bp==="no way"||(bp==="nah"||(bp==="don't do it"||bp==="stop"))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickYes=function(bp){var bq;return bp==="yes"||(bp==="ok"||(bp==="sure"||(bp==="yeah"||(bp==="yep"||(bp==="uh huh"||(bp==="go ahead"||bp==="go"))))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickHelp=function(bp){var bq;return bp==="help"||(bp==="help me"||(bp==="what's this?"||bp==="huh"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickHello=function(bp){var bq;return bp==="hello"||(bp==="hey"||(bp==="yo"||bp==="hi"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.Voices=function(bp){return bp==="voices"?{$:1,$0:null}:null;};E.Debug=function(bp){return bp==="debug"?{$:1,$0:null}:null;};E.Blank=function(bp){return bp===""?{$:1,$0:null}:null;};J.Study=function(bp){return bp.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};u.No=function(bp){var bq,br,bs,bt,bu,bv;return(br=u.Intent$1("no",bp),br!=null&&br.$==1&&(br.$0[0]==null&&(br.$0[1]==null&&(bq=bp,true))))?{$:1,$0:bq}:(bt=u.Intent$1("noresponse",bp),bt!=null&&bt.$==1&&(bt.$0[0]==null&&(bt.$0[1]==null&&(bs=bp,true))))?{$:1,$0:bs}:(bv=u.Intent$1("NoResponse",bp),bv!=null&&bv.$==1&&(bv.$0[0]==null&&(bv.$0[1]==null&&(bu=bp,true))))?{$:1,$0:bu}:null;};u.Yes=function(bp){var bq,br,bs,bt,bu,bv;return(br=u.Intent$1("yes",bp),br!=null&&br.$==1&&(br.$0[0]==null&&(br.$0[1]==null&&(bq=bp,true))))?{$:1,$0:bq}:(bt=u.Intent$1("yesresponse",bp),bt!=null&&bt.$==1&&(bt.$0[0]==null&&(bt.$0[1]==null&&(bs=bp,true))))?{$:1,$0:bs}:(bv=u.Intent$1("YesResponse",bp),bv!=null&&bv.$==1&&(bv.$0[0]==null&&(bv.$0[1]==null&&(bu=bp,true))))?{$:1,$0:bu}:null;};u.EntityManyofMany=function(bp,bq){return{$:1,$0:bd.OfArray(_3.ofSeq(_9.map(function(br){return _9.exists(function(bs){return bs.get_Name()===br;},bq)?[br,{$:1,$0:_9.filter(function(bs){return bs.get_Name()===br;},bq)}]:[br,null];},bp)))};};u.EntityManyOf1=function(bp,bq){var br;return bq!=null&&bq.$==1&&(_9.exists(function(bs){return bs.get_Name()===bp;},bq.$0)&&(br=bq.$0,true))?{$:1,$0:_9.filter(function(bs){return bs.get_Name()===bp;},br)}:null;};u.Entity1OfAny=function(bp,bq){var br;return bq!=null&&bq.$==1&&(_9.exists(function(bs){return bs.get_Name()===bp;},bq.$0)&&(br=bq.$0,true))?{$:1,$0:_9.head(_9.sortBy(function(bs){return bs.get_Name();},_9.filter(function(bs){return bs.get_Name()===bp;},br)))}:null;};u.Entity1Of1=function(bp,bq){var br;return bq!=null&&bq.$==1&&(bq.$0.$==1&&(bq.$0.$1.$==0&&(bq.$0.$0.get_Name()===bp&&(br=bq.$0.$0,true))))?{$:1,$0:br}:null;};u.Intent$1=function(bp,bq){return bq.get_Intent()!=null&&bq.get_Intent().$0.get_Name()===bp?{$:1,$0:[bq.get_Traits(),bq.get_Entities()]}:null;};K.$cctor=function(){K.$cctor=a.ignore;K.entity_types=_9.ofArray(["wit$contact:contact","wit$datetime:datetime","subject:subject","term:term","symptom_name:symptom_name"]);K.trait_types=_9.ofArray(["domain","dialogue_act","wit$sentiment"]);K.intentConfidenceThreshold=0.85;K.entityConfidenceThreshold=0.85;};M.MicReady={$:5};M.MicAudioEnd={$:4};M.MicAudioStart={$:3};M.MicDisconnected={$:2};M.MicConnecting={$:1};M.MicNotInitialized={$:0};N.ClientUnderstand={$:2};N.ClientReady={$:1};N.ClientNotInitialzed={$:0};O=L.Interpreter=_5.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,O);P=L.CUI=_5.Class({SayVoices:function(){var bp,bq,br;bp=this;bq=a.speechSynthesis.getVoices();!(bq==null)?(br=d.toArray(bq),bp.Say((function(bs){return function(bt){return bs("There are currently "+a.String(bt)+" voices installed on this computer or device.");};}(a.id))(_3.length(br))),_3.iteri(function(bs,bt){return bp.Say(((((_5.Curried(function(bu,bv,bw,bx){return bu("Voice "+a.String(bv)+". Name: "+_6.toSafe(bw)+", Local: "+_6.prettyPrint(bx)+".");},4))(a.id))(bs))(bt.name))(bt.localService));},br)):void 0;},Wait:function(bp){this.Wait$1(function(){bb.Start(bp,null);});},Wait$1:function(bp){this["Echo'"]("please wait...");this.Term.pause();bp();this.Term.resume();},sayRandom:function(bp,bq){this.Say(L.getRandomPhrase(bp,bq));},SayAngry:function(bp){var bq,br;bq=this;bb.Start((br=null,bb.Delay(function(){return bb.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bg.chime(),bb.Zero()):bb.Zero(),bb.Delay(function(){a.addMessage(bq.Avatar,bp,"","");bq.Avatar.processMessages(0);return bb.Zero();}));})),null);},Say:function(bp){var bq,br;bq=this;bb.Start((br=null,bb.Delay(function(){return bb.Combine(a.speechSynthesis.speaking?(bg.chime(),bb.Zero()):bb.Zero(),bb.Delay(function(){bq.Avatar.addMessage(bp);bq.Avatar.processMessages(0);return bb.Zero();}));})),null);},Debug:function(bp,bq){d.debug(bp,bq);},"EchoHtml'":function(bp){var bq,br;bq=(br={},br.raw=true,br);this.Term.disable();this.Term.echo(bp,bq);this.Term.enable();},"Echo'":function(bp){this.Term.disable();this.Term.echo(bp);this.Term.enable();}},null,P);P.New=function(bp,bq,br,bs,bt){return new P({Voice:bp,Mic:bq,Term:br,Avatar:bs,Caption:bt});};L.waitAddPhrases=function(){Q.$cctor();return Q.waitAddPhrases;};L.waitRetrievePhrases=function(){Q.$cctor();return Q.waitRetrievePhrases;};L.helpPhrases=function(){Q.$cctor();return Q.helpPhrases;};L.helloUserPhrases=function(){Q.$cctor();return Q.helloUserPhrases;};L.helloPhrases=function(){Q.$cctor();return Q.helloPhrases;};L["getRandomPhrase'"]=function(bp){return d.replace_tok("$0","",_.nth(L.rng().Next(0,bp.get_Length()),bp));};L.getRandomPhrase=function(bp,bq){return d.replace_tok("$0",bq,_.nth(L.rng().Next(0,bp.get_Length()),bp));};L.rng=function(){Q.$cctor();return Q.rng;};Q.$cctor=function(){Q.$cctor=a.ignore;Q.rng=new bh.New();Q.helloPhrases=_9.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);Q.helloUserPhrases=_9.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);Q.helpPhrases=_9.ofArray(["What can I help you with $0?"]);Q.waitRetrievePhrases=_9.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);Q.waitAddPhrases=_9.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};R.update=function(bp,bq,br,bs,bt){var bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch;function ci(cC){bp.Say(cC);}function cj(cC){bs.unshift(cC);ci(cC);}function ck(cC,cD){var cE;cE=L.getRandomPhrase(cC,cD);bs.unshift(cE);return bp.Say(cE);}function cl(cC){return bq.ContainsKey(cC);}function cm(cC){return bq.get_Item(cC);}function cn(cC,cD){return bq.Add(cC,cD);}function co(cC){bq.Remove(cC);}function cp(){return cm("user");}function cq(){bt.shift();}function cr(){br.shift();}function cs(cC){var cD;cD=R.getTask(cC);cD==null?(function(cE){return function(cF){return cE("No such task "+_6.toSafe(cF));};}(bi.FailWith))(cC):br.unshift(cD.$0);}function ct(cC,cD){cn(cC,cD);cs(cC);R.debug((function(cE){return function(cF){return cE("Added question: "+W.p$8(cF)+".");};}(a.id))(br[0]));return cj(d.replace_tok("$0",cD,R.getTask(cC).$0.get_Prompt().get_Text()));}function cu(cC,cD){return cl(cC)?{$:1,$0:cD}:null;}function cv(cC,cD){return!cl(cC)?{$:1,$0:cD}:null;}function cw(cC){var cD,cE;return(cE=cu("user",cC),cE!=null&&cE.$==1&&(br.length===0&&(cD=cE.$0,true)))?(cq(),{$:1,$0:cD}):null;}function cx(cC,cD){var cE,cF,cG;return(cF=cu("user",cD),cF!=null&&cF.$==1&&(R.haveTask(cC)&&br.length>0&&br[0].get_Name()===cC&&(cE=cF.$0,true)))?(cq(),cr(),cl(cC)?(cG=bq.get_Item(cC),(co(cC),{$:1,$0:[cE,{$:1,$0:cG}]})):{$:1,$0:[cE,null]}):null;}function cy(cC,cD){var cE,cF,cG;return(cF=cv("user",cD),cF!=null&&cF.$==1&&(R.haveTask(cC)&&br.length>0&&br[0].get_Name()===cC&&(cE=cF.$0,true)))?(cq(),cr(),cl(cC)?(cG=bq.get_Item(cC),(co(cC),{$:1,$0:[cE,{$:1,$0:cG}]})):{$:1,$0:[cE,null]}):null;}function cz(cC){var cD,cE;return(cE=cv("user",cC),cE!=null&&cE.$==1&&(br.length===0&&(cD=cE.$0,true)))?(cq(),{$:1,$0:cD}):null;}function cA(cC){var cD;return cC!=null&&cC.$==1&&(typeof cC.$0=="string"&&(cD=cC.$0,true))?{$:1,$0:cD}:null;}function cB(cC,cD,cE){var cF;return bb.Start((cF=null,bb.Delay(function(){ck(L.waitAddPhrases(),"symptom entry");return bb.Bind((new bk.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:843951578",[cp().Name,cC,cD,cE]),function(cG){return cG==null?(cj(function(cH){return cH("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),bb.Zero()):(cj((function(cH){return function(cI){return cH("OK I added that "+_6.toSafe(cI)+" symptom to your journal.");};}(a.id))(cC)),bb.Zero());});})),null);}R.debug((((_5.Curried3(function(cC,cD,cE){return cC("Starting utterances:"+_6.prettyPrint(cD)+". Starting tasks: "+_6.prettyPrint(cE)+".");}))(a.id))(bt))(br));bu=_9.ofSeq(_.take(bt.length>=5?5:bt.length,bt));bu.$==1&&(bw=(bx=cv("started",bu.$0),bx!=null&&bx.$==1?{$:1,$0:bx.$0}:null),bw!=null&&bw.$==1&&(by=cz(bw.$0),by!=null&&by.$==1&&(bz=u.Intent$1("hello",by.$0),bz!=null&&bz.$==1&&(bz.$0[1]==null&&bu.$1.$==0))))?(bq.Add("started",true),ck(L.helloPhrases(),"")):bu.$==1&&(bB=cz(bu.$0),bB!=null&&bB.$==1&&(bC=u.Intent$1("hello",bB.$0),bC!=null&&bC.$==1&&(bC.$0[1]==null&&bu.$1.$==0)))?cj("Hello, tell me your name to get started."):bu.$==1&&(bE=cz(bu.$0),bE!=null&&bE.$==1&&(bF=u.Intent$1("hello",bE.$0),bF!=null&&bF.$==1&&(bG=u.Entity1Of1("contact",bF.$0[1]),bG!=null&&bG.$==1&&(bu.$1.$==0&&(bD=bG.$0,true)))))?(bH=bD.get_Value(),ck(L.waitRetrievePhrases(),"user name"),bb.Start((bI=null,bb.Delay(function(){return bb.Bind((new bk.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:1952175506",[bH]),function(cC){var cD;return cC==null?(cj((function(cE){return function(cF){return cE("I did not find a user with the name "+_6.toSafe(cF)+".");};}(a.id))(bH)),ct("addUser",bH),bb.Zero()):(cD=cC.$0,bb.Bind((new bk.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:-535272755",[cD.Name]),function(){bq.Add("user",cD);ck(L.helloUserPhrases(),(function(cE){return function(cF){return cE(_6.prettyPrint(cF));};}(a.id))(bq.get_Item("user")));return cD.LastLoggedIn!=null?bb.Bind((new bk.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:191416212",[cD.LastLoggedIn.$0]),function(cE){cj((function(cF){return function(cG){return cF("You last logged in "+_6.toSafe(cG)+".");};}(a.id))(cE));return bb.Zero();}):bb.Zero();}));});})),null)):bu.$==1&&(bK=u.Yes(bu.$0),bK!=null&&bK.$==1&&(bL=cy("addUser",bK.$0),bL!=null&&bL.$==1&&(bM=cA(bL.$0[1]),bM!=null&&bM.$==1&&(bu.$1.$==0&&(bJ=bM.$0,true)))))?bb.Start((bN=null,bb.Delay(function(){ck(L.waitAddPhrases(),"user");return bb.Bind((new bk.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:-535272755",[bJ]),function(cC){return cC==null?(cj((function(cD){return function(cE){return cD("Sorry I was not able to add the user "+_6.toSafe(cE)+" to the system.");};}(a.id))(bJ)),bb.Zero()):(cn("user",bJ),cj((function(cD){return function(cE){return cD("Hello "+_6.prettyPrint(cE)+", nice to meet you.");};}(a.id))(bq.get_Item("user"))),bb.Zero());});})),null):bu.$==1&&(bP=u.No(bu.$0),bP!=null&&bP.$==1&&(bQ=cy("addUser",bP.$0),bQ!=null&&bQ.$==1&&(bR=cA(bQ.$0[1]),bR!=null&&bR.$==1&&(bu.$1.$==0&&(bO=bR.$0,true)))))?cj((function(cC){return function(cD){return cC("Ok I did not add the user "+_6.toSafe(cD)+". But you must login for me to help you.");};}(a.id))(bO)):bu.$==1&&((bT=cz(bu.$0),bT!=null&&bT.$==1)&&bu.$1.$==0)?cj("Could you introduce yourself so we can get started?"):bu.$==1&&(bV=cw(bu.$0),bV!=null&&bV.$==1&&(bW=u.Intent$1("hello",bV.$0),bW!=null&&bW.$==1&&(bW.$0[0]==null&&(bX=u.Entity1Of1("contact",bW.$0[1]),bX!=null&&bX.$==1&&(bu.$1.$==0&&(bU=bX.$0,true))))))?bb.Start((bY=null,bb.Delay(function(){return bb.Bind((new bk.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:1952175506",[bU.get_Value()]),function(cC){return cC==null?(cj((function(cD){return function(cE){return cD("Sorry, the user "+_6.toSafe(cE)+" does not exist.");};}(a.id))(bU.get_Value())),bb.Zero()):(ct("switchUser",cC.$0.Name),bb.Zero());});})),null):bu.$==1&&(b0=u.Yes(bu.$0),b0!=null&&b0.$==1&&(b1=cx("switchUser",b0.$0),b1!=null&&b1.$==1&&(b2=cA(b1.$0[1]),b2!=null&&b2.$==1&&(bu.$1.$==0&&(bZ=b2.$0,true)))))?(bq.set_Item("user",bZ),cj((function(cC){return function(cD){return cC("Ok I switched to user "+_6.prettyPrint(cD)+".");};}(a.id))(bZ))):bu.$==1&&(b4=u.No(bu.$0),b4!=null&&b4.$==1&&(b5=cx("switchUser",b4.$0),b5!=null&&b5.$==1&&(b6=cA(b5.$0[1]),b6!=null&&b6.$==1&&(bu.$1.$==0&&(b3=b6.$0,true)))))?cj((function(cC){return function(cD){return cC("Ok I did not switch to user "+_6.toSafe(cD)+".");};}(a.id))(b3)):bu.$==1&&(b8=cw(bu.$0),b8!=null&&b8.$==1&&(b9=u.Intent$1("symptom",b8.$0),b9!=null&&b9.$==1&&(b_=u.Entity1OfAny("symptom_name",b9.$0[1]),b_!=null&&b_.$==1&&(bu.$1.$==0&&(b7=b_.$0,true)))))?bb.Start((b$=null,bb.Delay(function(){cj("Ok I'll add that entry to your symptom journal");cB(b7.get_Value(),null,null);return bb.Zero();})),null):bu.$==1&&(cb=u.Yes(bu.$0),cb!=null&&cb.$==1&&((cc=cx("painVideo",cb.$0),cc!=null&&cc.$==1)&&bu.$1.$==0))?bp["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bu.$==1&&(ce=cw(bu.$0),ce!=null&&ce.$==1&&(cf=u.Intent$1("medjournal",ce.$0),cf!=null&&cf.$==1&&((cg=cf.$0[1],cg!=null&&cg.$==1)&&(bu.$1.$==0&&(cd=cf.$0[1].$0,true)))))?(cj("ok I added that entry to your medication journal."),cj("You should be careful not to take too many painkillers over a short period of time.")):(cq(),R.debug("Main interpreter did not understand utterance."),cj("Sorry I didn't understand what you meant."),br.length>0?(ch=_.nth(0,br),cl(ch.get_Name())?cj(d.replace_tok("$0",bq.get_Item(ch.get_Name()),a.String(ch))):cj(a.String(ch))):void 0);R.debug((((_5.Curried3(function(cC,cD,cE){return cC("Ending utterances: "+_6.prettyPrint(cD)+". Ending questions:"+_6.prettyPrint(cE)+".");}))(a.id))(bt))(br));};R.haveTask=function(bp){return _9.exists(function(bq){return bq.get_Name()===bp;},R.tasks());};R.getTask=function(bp){return _.tryFind(function(bq){return bq.get_Name()===bp;},R.tasks());};R.tasks=function(){S.$cctor();return S.tasks;};R.debug=function(bp){d.debug("Main",bp);};S.$cctor=function(){S.$cctor=a.ignore;S.tasks=_9.ofArray([new B({$:0,$0:"addUser",$1:new A({$:0,$0:new z({$:0,$0:"Do you want me to add the user $0?"})})}),new B({$:0,$0:"switchUser",$1:new A({$:0,$0:new z({$:0,$0:"Do you want me to switch to the user $0?"})})})]);};T.run=function(){var bp,bq;bp=_5.ThisFunc(function(br,bs){return((T.Main().get_Text())(br))(bs);});bq=T.Main().get_Options();a.$("#term").terminal(bp,bq);return _1.get_Empty();};T.Main=function(){U.$cctor();return U.Main;};T.initMic=function(bp){var bq,br;T.set_CUI((bq={$:1,$0:new bl.Microphone(bm.getElementById("microphone"))},P.New(T.CUI().Voice,bq,T.CUI().Term,T.CUI().Avatar,T.CUI().Caption)));br=T.CUI().Mic.$0;br.onconnecting=function(){T.set_MicState(M.MicConnecting);return T.debug("Mic connecting...");};br.ondisconnected=function(){T.set_MicState(M.MicDisconnected);return T.debug("Mic disconnected.");};br.onaudiostart=function(){T.set_MicState(M.MicAudioStart);return T.debug("Mic audio start...");};br.onaudioend=function(){T.set_MicState(M.MicAudioEnd);return T.debug("Mic audio end.");};br.onerror=function(bs){T.set_MicState({$:6,$0:bs});return T.debug((function(bt){return function(bu){return bt("Mic error : "+_6.toSafe(bu)+".");};}(a.id))(bs));};br.onready=function(){T.set_MicState(M.MicReady);return T.debug("Mic ready.");};br.onresult=function(bs,bt){return T.ClientState().$==2?T.echo("I'm still trying to understand what you said before."):T.ClientState().$==0?d.error("Client is not intialized."):!(bs==null||bt==null)?(T.set_MicState({$:7,$0:bs,$1:bt}),T.debug((((_5.Curried3(function(bu,bv,bw){return bu("Mic result: "+_6.prettyPrint(bv)+" "+_6.prettyPrint(bw)+".");}))(a.id))(bs))(bt)),bp(bs,bt)):T.debug("Mic: No result returned.");};br.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};T.sayRandom=function(bp,bq){T.say(L.getRandomPhrase(bq,bp));};T.say=function(bp){T.Responses().unshift(bp);T["say'"](bp);};T["say'"]=function(bp){T.CUI().Say(bp);};T.initSpeech=function(){var bp;bp=d.toArray(T.synth().getVoices());_3.length(bp)>0?(_3.iter(function(bq){if(bn.Equals(T.CUI().Voice,null)&&(bq.name.indexOf("Microsoft Zira")!=-1||bq.name.toLowerCase().indexOf("female")!=-1)){T.set_CUI(P.New({$:1,$0:bq},T.CUI().Mic,T.CUI().Term,T.CUI().Avatar,T.CUI().Caption));T.debug((function(br){return function(bs){return br("Using browser speech synthesis voice "+_6.toSafe(bs)+".");};}(a.id))(T.CUI().Voice.$0.name));}},bp),!bn.Equals(T.CUI().Voice,null)?(T.CUI().Avatar.nativeVoice=true,T.CUI().Avatar.nativeVoiceName=T.CUI().Voice.$0.name,T.debug((function(bq){return function(br){return bq("Using browser speech synthesis voice "+_6.toSafe(br)+".");};}(a.id))(T.CUI().Voice.$0.name))):void 0):void 0;bn.Equals(T.CUI().Voice,null)?T.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};T.synth=function(){U.$cctor();return U.synth;};T.push=function(bp){T.Utterances().unshift(bp);return T.Utterances();};T.Props=function(){U.$cctor();return U.Props;};T.Responses=function(){U.$cctor();return U.Responses;};T.Tasks=function(){U.$cctor();return U.Tasks;};T.Utterances=function(){U.$cctor();return U.Utterances;};T.wait=function(bp){d["Terminal.Echo'"](T.CUI().Term,"please wait");T.CUI().Term.pause();bp();T.CUI().Term.resume();};T.debug=function(bp){d.debug("CLIENT",bp);};T.echo=function(bp){d["Terminal.EchoHtml'"](T.CUI().Term,(function(bq){return function(br){return bq(_6.prettyPrint(br));};}(a.id))(bp));};T.ClientState=function(){U.$cctor();return U.ClientState;};T.set_ClientState=function(bp){U.$cctor();U.ClientState=bp;};T.MicState=function(){U.$cctor();return U.MicState;};T.set_MicState=function(bp){U.$cctor();U.MicState=bp;};T.CUI=function(){U.$cctor();return U.CUI;};T.set_CUI=function(bp){U.$cctor();U.CUI=bp;};U.$cctor=function(){var bp,bq,br;U.$cctor=a.ignore;function bs(bu,bv){var bw,bx,by,bz,bA,bB,bC,bD;T.debug((((_5.Curried3(function(bE,bF,bG){return bE("Voice: "+_6.prettyPrint(bF)+" "+_6.prettyPrint(bG));}))(a.id))(bu))(bv));bw=(bx=C["Intent'"](bu,bv),bx!=null&&bx.$==1?{$:1,$0:bx.$0}:null);by=(bz=C["Trait'"](bv),bz!=null&&bz.$==1?{$:1,$0:_9.ofArray([bz.$0])}:null);bA=(bB=C["Entity'$1"](bv),bB!=null&&bB.$==1?{$:1,$0:_9.ofArray([bB.$0])}:null);bw==null&&(by==null&&bA==null)?void 0:(T.debug(((((_5.Curried(function(bE,bF,bG,bH){return bE("Voice: "+W.p(bF)+" "+W.p$3(bG)+" "+W.p$5(bH));},4))(a.id))(bw))(by))(bA)),bD=T.push(new y({$:0,$0:bw,$1:by,$2:bA})),R.update(T.CUI(),T.Props(),T.Tasks(),T.Responses(),bD));}function bt(bu,bv){var bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK;T.set_CUI(P.New(T.CUI().Voice,T.CUI().Mic,bu,T.CUI().Avatar,T.CUI().Caption));bn.Equals(T.CUI().Mic,null)?T.initMic(bs):void 0;bn.Equals(T.CUI().Voice,null)?T.initSpeech():void 0;T.ClientState().$===0?T.set_ClientState(N.ClientReady):void 0;h.btnPrimary("btn0","test",function(){return function(){var bL;bL=T.push(new y({$:0,$0:null,$1:null,$2:null}));return R.update(T.CUI(),T.Props(),T.Tasks(),T.Responses(),bL);};});return(bw=E.Blank(bv),bw!=null&&bw.$==1)?T["say'"]("Tell me what you want me to do or ask me a question."):(bx=E.Debug(bv),bx!=null&&bx.$==1)?(T.debug((function(bL){return function(bM){return bL("Utterances: "+_6.prettyPrint(bM));};}(a.id))(T.Utterances())),T.debug((function(bL){return function(bM){return bL("Tasks: "+_6.prettyPrint(bM));};}(a.id))(T.Tasks())),by=_3.get(_8(".terminal-output").get(),0).childNodes.length,bz=h.btnPrimary("btn0","test",function(){return function(){var bL;bL=T.push(new y({$:0,$0:null,$1:null,$2:null}));return R.update(T.CUI(),T.Props(),T.Tasks(),T.Responses(),bL);};}),bA=_1.Element("div",[h.cls("terminal-command"),h.dindex(by+1)],[bz]),bB=d.termOutput(),_0.LoadLocalTemplates(""),_1.RunAppend(bB,bA)):(bC=E.Voices(bv),bC!=null&&bC.$==1)?(bD=d.toArray(d.speechSynthesis().getVoices()),(T["say'"]((function(bL){return function(bM){return bL("There are currently "+a.String(bM)+" voices installed on this computer or device.");};}(a.id))(_3.length(bD))),_3.iteri(function(bL,bM){return T["say'"](((((_5.Curried(function(bN,bO,bP,bQ){return bN("Voice "+a.String(bO)+". Name: "+_6.toSafe(bP)+", Local: "+_6.prettyPrint(bQ)+".");},4))(a.id))(bL))(bM.name))(bM.localService));},bD))):T.ClientState().$==1?(bF=E.QuickHello(bv),bF!=null&&bF.$==1?(bE=bF.$0,true):(bG=E.QuickHelp(bv),bG!=null&&bG.$==1?(bE=bG.$0,true):(bH=E.QuickYes(bv),bH!=null&&bH.$==1?(bE=bH.$0,true):(bI=E.QuickNo(bv),bI!=null&&bI.$==1&&(bE=bI.$0,true)))))?(T.debug((function(bL){return function(bM){return bL("Quick Text: "+W.p$7(bM)+".");};}(a.id))(bE)),bJ=T.push(bE),R.update(T.CUI(),T.Props(),T.Tasks(),T.Responses(),bJ),T.set_ClientState(N.ClientReady)):T.CUI().Wait((bK=null,bb.Delay(function(){T.set_ClientState(N.ClientUnderstand);E.getUtterance(bv,function(bL){var bM,bN,bO;bM=E.HasUtterance(bL);bM!=null&&bM.$==1?(bN=bM.$0,T.debug(((((_5.Curried(function(bP,bQ,bR,bS){return bP("Text: Intent: "+W.p(bQ)+", Traits: "+W.p$3(bR)+", Entities: "+W.p$5(bS));},4))(a.id))(bN.get_Intent()))(bN.get_Traits()))(bN.get_Entities())),bO=T.push(bN),R.update(T.CUI(),T.Props(),T.Tasks(),T.Responses(),bO)):(T.debug("Text: Did not receive a meaning from the server."),T["say'"]("Sorry I did not understand what you said."));});T.set_ClientState(N.ClientReady);return bb.Zero();}))):T.ClientState().$==0?d.error("Client is not initialized."):T["say'"]("I'm still trying to understand what you said before.");}U.CUI=P.New(null,null,null,(bg.applicationId="4277115329081938617",bp=new a.SDKConnection(),bq=new a.WebAvatar(),bq.version=8.5,bq.connection=bp,bq.avatar="20926186",bq.voice="cmu-slt",bq.voiceMod="default",bq.width=175,bq.createBox(),bq.addMessage(""),bq.processMessages(0),bq),false);U.MicState=M.MicNotInitialized;U.ClientState=N.ClientNotInitialzed;U.Utterances=[];U.Tasks=[];U.Responses=[];U.Props=new bo.New$5();U.synth=a.speechSynthesis;U.Main=new O({$:0,$0:function(bu){return bs(bu[0],bu[1]);},$1:[function(bu){return function(bv){return bt(bu,bv);};},(br={},br.name="Main",br.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",br.prompt=">",br)]});};V.p=function(bp){return"{"+("text = "+_6.prettyPrint(bp.text))+"; "+("intents = "+_6.printArray(function(bq){return V.p$1(bq);},bp.intents))+"; "+("entities = "+_6.prettyPrint(bp.entities))+"; "+("traits = "+_6.prettyPrint(bp.traits))+"}";};V.p$1=function(bp){return"{"+("id = "+_6.prettyPrint(bp.id))+"; "+("name = "+_6.prettyPrint(bp.name))+"; "+("confidence = "+_6.prettyPrint(bp.confidence))+"}";};W.p$8=function(bp){return"Task ("+_6.prettyPrint(bp.$0)+", "+W.p$9(bp.$1)+")";};W.p$9=function(bp){return bp.$==1?"Html ("+W.p$10(bp.$0)+", "+_6.prettyPrint(bp.$1)+")":"Ssml "+W.p$10(bp.$0);};W.p$10=function(bp){return"SSML "+_6.prettyPrint(bp.$0);};W.p$2=function(bp){return bp==null?"null":"Some "+_6.prettyPrint(bp.$0);};W.p$1=function(bp){return"Intent ("+_6.prettyPrint(bp.$0)+", "+W.p$2(bp.$1)+")";};W.p=function(bp){return bp==null?"null":"Some "+W.p$1(bp.$0);};W.p$4=function(bp){return"Trait ("+_6.prettyPrint(bp.$0)+", "+_6.prettyPrint(bp.$1)+", "+W.p$2(bp.$2)+")";};W.p$3=function(bp){return bp==null?"null":"Some "+_6.printList(function(bq){return W.p$4(bq);},bp.$0);};W.p$6=function(bp){return"Entity ("+_6.prettyPrint(bp.$0)+", "+_6.prettyPrint(bp.$1)+", "+W.p$2(bp.$2)+")";};W.p$5=function(bp){return bp==null?"null":"Some "+_6.printList(function(bq){return W.p$6(bq);},bp.$0);};W.p$7=function(bp){return"Utterance ("+W.p(bp.$0)+", "+W.p$3(bp.$1)+", "+W.p$5(bp.$2)+")";};}());
