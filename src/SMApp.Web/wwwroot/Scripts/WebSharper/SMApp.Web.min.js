(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=c.Bs=c.Bs||{};i=b.NLU=b.NLU||{};j=i.Babelfy=i.Babelfy||{};k=j.ApiResponse=j.ApiResponse||{};l=j.TokenFragment=j.TokenFragment||{};m=j.CharFragment=j.CharFragment||{};n=i.Witai=i.Witai||{};o=n.Utterance=n.Utterance||{};p=n.Intent=n.Intent||{};q=n.Entity=n.Entity||{};r=n.Trait=n.Trait||{};s=n["Utterance'"]=n["Utterance'"]||{};t=n["Value'"]=n["Value'"]||{};u=c.NLU=c.NLU||{};v=u.Intent=u.Intent||{};w=u.Trait=u.Trait||{};x=u.Entity=u.Entity||{};y=u.Utterance=u.Utterance||{};z=u.SSML=u.SSML||{};A=u.Response=u.Response||{};B=u.Task=u.Task||{};C=u.Voice=u.Voice||{};D=C["Entity'"]=C["Entity'"]||{};E=u.Text=u.Text||{};F=E["Utterance'"]=E["Utterance'"]||{};G=E["Intent'"]=E["Intent'"]||{};H=E["Entity'"]=E["Entity'"]||{};I=E["Trait'"]=E["Trait'"]||{};J=u.Domain=u.Domain||{};K=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};L=c.CUI=c.CUI||{};M=L.MicState=L.MicState||{};N=L.ClientState=L.ClientState||{};O=L.Interpreter=L.Interpreter||{};P=L.CUI=L.CUI||{};Q=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};R=c.Main=c.Main||{};S=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};T=c.Client=c.Client||{};U=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};V=a.GeneratedPrintf=a.GeneratedPrintf||{};W=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};X=a.WebSharper;Y=X&&X.UI;Z=Y&&Y.Client;_0=Z&&Z.Templates;_1=Y&&Y.Doc;_2=X&&X.Strings;_3=a.IntelliFactory;_4=_3&&_3.Runtime;_5=X&&X.Utils;_6=a.console;_7=a.jQuery;_8=X&&X.Arrays;_9=X&&X.List;_=X&&X.Seq;$=Y&&Y.AttrProxy;ba=X&&X.Concurrency;bb=X&&X.Collections;bc=bb&&bb.Map;bd=X&&X.JavaScript;be=bd&&bd.Pervasives;bf=a.SDK;bg=X&&X.Random;bh=X&&X.Operators;bi=X&&X.Remoting;bj=bi&&bi.AjaxRemotingProvider;bk=a.Wit;bl=a.document;bm=X&&X.Unchecked;bn=bb&&bb.Dictionary;d.speechSynthesis=function(){return a.speechSynthesis;};d.elementHTML=function(bo){return bo.innerHTML;};d.createElement=function(bo,bp){var bq;bq=self.document.createElement(bo);_0.LoadLocalTemplates("");_1.RunAppend(bq,bp);return bq;};d.replace_tok=function(bo,bp,bq){return _2.Replace(bq,bo,bp);};d.toLower=function(bo){return bo.toLowerCase();};d.debug=function(bo,bp){d.info((((_4.Curried3(function(bq,br,bs){return bq("DEBUG: "+_5.toSafe(br)+": "+_5.prettyPrint(bs));}))(a.id))(bo.toUpperCase()))(bp));};d.error=function(bo){_6.error(bo);};d.info=function(bo){_6.info(bo);};d.jserror=function(bo){_7.error(bo);};d.toArray=function(bo){return _8.map(a.id,_7.makeArray(bo));};d["Terminal.EchoHtml'"]=function(bo,bp){bo.pause();bo.echo(bp,d.rawOpt());bo.resume();};d["Terminal.Echo'"]=function(bo,bp){bo.pause();bo.echo(bp);bo.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=_4.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(bo){function bp(bq){return function(br){var bs,bt,bu,bv,bw,bx,by;bt=_2.replicate(bq," ");switch(br.$==0?br.$1.$==1?br.$1.$0.$==2?br.$1.$1.$==0?(bs=[br.$1.$0.$0,br.$0],1):(bs=[br.$1,br.$0],2):(bs=[br.$1,br.$0],2):(bs=[br.$1,br.$0],2):br.$==2?(bs=br.$0,3):(bs=[br.$0,br.$1],0)){case 0:return bs[0]+"=\""+bs[1]+"\"";case 1:bu=bs[1];return bt+"<"+bu+">"+bs[0]+"</"+bu+">\r\n";case 2:bv=bs[1];bw=_9.partition(function(bz){return bz.$==1;},bs[0]);bx=bw[1];by=bw[0];return bx.$==0?bt+"<"+bv+(by.$===0?"":" "+_2.concat(" ",_9.ofSeq(_.delay(function(){return _.map(function(bz){return(bp(0))(bz);},by);}))))+"/>\r\n":bt+"<"+bv+(by.$===0?"":" "+_2.concat(" ",_9.ofSeq(_.delay(function(){return _.map(function(bz){return(bp(0))(bz);},by);}))))+">\r\n"+_2.concat("",_9.ofSeq(_.delay(function(){return _.map(function(bz){return(bp(bq+1))(bz);},bx);})))+bt+"</"+bv+">\r\n";case 3:return bt+bs+"\r\n";}};}return(bp(0))(bo);};f.alt=function(bo){return new e({$:1,$0:"alt",$1:bo});};f.src=function(bo){return new e({$:1,$0:"src",$1:bo});};f.cls=function(bo){return new e({$:1,$0:"class",$1:bo});};f.str=function(bo){return e.toString(bo);};f.op_PercentEquals=function(bo,bp){return new e({$:1,$0:bo,$1:bp});};f.op_Splice=function(bo){var bp;return _9.ofArray([new e({$:2,$0:(bp=bo,a.String(bp))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(bo,bp){return new e({$:0,$0:bo,$1:bp});};g.$cctor=function(){var bo;g.$cctor=a.ignore;g.rawOpt=(bo={},bo.raw=true,bo);g.html=function(bp){return f.elem("html",bp);};g.head=function(bp){return f.elem("head",bp);};g.title=function(bp){return f.elem("title",bp);};g.style=function(bp){return f.elem("style",bp);};g.body=function(bp){return f.elem("body",bp);};g.div=function(bp){return f.elem("div",bp);};g.br=function(bp){return f.elem("br",bp);};g.section=function(bp){return f.elem("section",bp);};g.span=function(bp){return f.elem("span",bp);};g.table=function(bp){return f.elem("table",bp);};g.thead=function(bp){return f.elem("thead",bp);};g.tbody=function(bp){return f.elem("tbody",bp);};g.tfoot=function(bp){return f.elem("tfoot",bp);};g.img=function(bp){return f.elem("img",bp);};g.map=function(bp){return f.elem("map",bp);};g.area=function(bp){return f.elem("area",bp);};g.p=function(bp){return f.elem("p",bp);};g.a=function(bp){return f.elem("a",bp);};g.tr=function(bp){return f.elem("tr",bp);};g.td=function(bp){return f.elem("td",bp);};g.th=function(bp){return f.elem("th",bp);};g.ul=function(bp){return f.elem("ul",bp);};g.li=function(bp){return f.elem("li",bp);};g.h1=function(bp){return f.elem("h1",bp);};g.h2=function(bp){return f.elem("h1",bp);};g.h3=function(bp){return f.elem("h1",bp);};g.h4=function(bp){return f.elem("h1",bp);};g.strong=function(bp){return f.elem("strong",bp);};};h.Radio=function(bo,bp,bq,br,bs){return _1.Element("div",new _9.T({$:1,$0:h.cls("radio"),$1:bp}),[_1.Element("label",br,[_1.Radio(bs,true,bq),_1.TextNode(bo)])]);};h.checkbox=function(bo,bp,bq,br,bs){return _1.Element("div",new _9.T({$:1,$0:h.cls("checkbox"),$1:bp}),[_1.Element("label",br,[_1.CheckBox(bs,bq),_1.TextNode(bo)])]);};h.textArea=function(bo,bp,bq,br,bs){return _1.Element("div",new _9.T({$:1,$0:h.cls("form-group"),$1:bp}),[_1.Element("label",br,[_1.TextNode(bo)]),_1.InputArea(new _9.T({$:1,$0:h.cls("form-control"),$1:bs}),bq)]);};h.inputPassword=function(bo,bp,bq,br,bs){return _1.Element("div",new _9.T({$:1,$0:h.cls("form-group"),$1:bp}),[_1.Element("label",br,[_1.TextNode(bo)]),_1.PasswordBox(new _9.T({$:1,$0:h.cls("form-control"),$1:bs}),bq)]);};h.input=function(bo,bp,bq,br,bs){return _1.Element("div",new _9.T({$:1,$0:h.cls("form-group"),$1:bp}),[_1.Element("label",br,[_1.TextNode(bo)]),_1.Input([h.cls("form-control"),bs],bq)]);};h.btn=function(bo){return _1.Element("button",[h.eid(bo),h.cls("btn")],[]);};h.container=function(bo){return _1.Element("div",[h.cls("container")],bo);};h.cls=function(bo){return $.Create("class",bo);};h.eid=function(bo){return $.Create("id",bo);};k.New=function(bo,bp,bq,br,bs,bt,bu,bv,bw){return{tokenFragment:bo,charFragment:bp,babelSynsetID:bq,DBpediaURL:br,BabelNetURL:bs,score:bt,cohrenceScore:bu,globalScore:bv,source:bw};};l.New=function(bo,bp){return{start:bo,end:bp};};m.New=function(bo,bp){return{start:bo,end:bp};};j.disambiguate=function(bo){function bp(bq,br){var bs;_7.ajax((bs={},bs.url=(function(bt){return function(bu){return bt("https://babelfy.io/v1/disambiguate?text="+_5.toSafe(bu)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bo),bs.type="GET",bs.success=function(bt){return bq(bt);},bs.error=function(bt){return br(new a.Error(bt.responseText));},bs));}return ba.FromContinuations(function(bq,br,bs){return bp.apply(null,[bq,br,bs]);});};o.New=function(bo,bp,bq,br){return{text:bo,intents:bp,entities:bq,traits:br};};p.New=function(bo,bp,bq){return{id:bo,name:bp,confidence:bq};};q.New=function(bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by){return{id:bo,name:bp,role:bq,start:br,end:bs,body:bt,confidence:bu,entities:bv,suggested:bw,value:bx,type:by};};r.New=function(bo,bp,bq){return{id:bo,value:bp,confidence:bq};};s.New=function(bo){return{intent:bo};};t.New=function(bo){return{value:bo};};n.getMeaning2=function(bo,bp){function bq(br,bs){var bt;_7.ajax((bt={},bt.url=(function(bu){return function(bv){return bu("https://api.wit.ai/message?q="+_5.toSafe(bv));};}(a.id))(bp),bt.type="GET",bt.beforeSend=function(bu){return bu.setRequestHeader("Authorization","Bearer "+bo);},bt.success=function(bu){return br(bu);},bt.error=function(bu){return bs(new a.Error(bu.responseText));},bt));}return ba.FromContinuations(function(br,bs,bt){return bq.apply(null,[br,bs,bt]);});};n.getMeaning=function(bo,bp,bq,br){var bs;_7.ajax((bs={},bs.url=(function(bt){return function(bu){return bt("https://api.wit.ai/message?q="+_5.toSafe(bu));};}(a.id))(bp),bs.type="GET",bs.beforeSend=function(bt){return bt.setRequestHeader("Authorization","Bearer "+bo);},bs.success=bq,bs.error=br,bs));};v=u.Intent=_4.Class({toString:function(){return(((_4.Curried3(function(bo,bp,bq){return bo("Intent("+_5.toSafe(bp)+", "+W.p$2(bq)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,v);w=u.Trait=_4.Class({toString:function(){return(((_4.Curried3(function(bo,bp,bq){return bo("Trait("+_5.toSafe(bp)+", "+_5.prettyPrint(bq)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,w);x=u.Entity=_4.Class({toString:function(){return((((_4.Curried(function(bo,bp,bq,br){return bo("Entity("+_5.toSafe(bp)+", "+_5.toSafe(bq)+", "+W.p$2(br)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,x);y=u.Utterance=_4.Class({toString:function(){return((((_4.Curried(function(bo,bp,bq,br){return bo(W.p(bp)+" "+W.p$3(bq)+" "+W.p$5(br));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bo;bo=this.$2;return bo!=null?{$:1,$0:_9.sortBy(function(bp){return bp.get_Name();},bo.$0)}:null;},get_Traits:function(){var bo;bo=this.$1;return bo!=null?{$:1,$0:_9.sortBy(function(bp){return bp.get_Name();},bo.$0)}:null;},get_Intent:function(){return this.$0;}},null,y);z=u.SSML=_4.Class({toString:function(){return this.$0;}},null,z);A=u.Response=_4.Class({toString:function(){return this.$==1?this.$1.innerText:a.String(this.$0);},get_Text:function(){return this.$==1?a.String(this.$0):a.String(this.$0);}},null,A);B=u.Task=_4.Class({toString:function(){return(((_4.Curried3(function(bo,bp,bq){return bo("Name: "+_5.toSafe(bp)+" Prompt: "+_5.toSafe(bq));}))(a.id))(this.get_Name()))(a.String(this.get_Prompt()));},get_Prompt:function(){return this.$1;},get_Name:function(){return this.$0;}},null,B);D.New=function(bo,bp,bq,br,bs){return{body:bo,end:bp,start:bq,suggested:br,value:bs};};C["Intent'"]=function(bo,bp){return!(bp.intent==null)?{$:1,$0:new v({$:0,$0:d.toLower(bp.intent.value),$1:null})}:null;};C["Trait'"]=function(bo){return!(bo.domain==null)?{$:1,$0:new w({$:0,$0:"domain",$1:d.toLower(bo.domain.value),$2:null})}:!(bo.dialogue_act==null)?{$:1,$0:new w({$:0,$0:"dialogue_act",$1:d.toLower(bo.dialogue_act.value),$2:null})}:null;};C["Entity'$1"]=function(bo){return!(bo.contact==null)?{$:1,$0:new x({$:0,$0:"contact",$1:d.toLower(bo.contact.value),$2:null})}:null;};F=E["Utterance'"]=_4.Class({get_TopIntent:function(){return _9.head(_9.sortBy(function(bo){return bo.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$2;},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,F);G=E["Intent'"]=_4.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);H=E["Entity'"]=_4.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,H);I=E["Trait'"]=_4.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,I);E.HasUtterance=function(bo){var bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC;return bo!=null&&bo.$==1&&(bo.$0.$0.$==0&&(bo.$0.$1.get_Length()>0&&(bp=[bo.$0.$1,bo.$0.$2],true)))?(bq=_9.map(function(bD){return new x({$:0,$0:d.toLower(bD.get_Role()),$1:bD.get_Value(),$2:{$:1,$0:bD.get_Confidence()}});},_9.filter(function(bD){return bD.get_Confidence()>E.entityConfidenceThreshold();},bp[0])),{$:1,$0:new y({$:0,$0:null,$1:{$:1,$0:_9.map(function(bD){return new w({$:0,$0:d.toLower(bD.get_Name()),$1:bD.get_Value(),$2:{$:1,$0:bD.get_Confidence()}});},_9.filter(function(bD){return bD.get_Confidence()>E.entityConfidenceThreshold();},bp[1]))},$2:{$:1,$0:bq}})}):bo!=null&&bo.$==1&&(bo.$0.$1.$==0&&(bo.$0.$2.$==0&&(bo.$0.$0.get_Length()>0&&bo.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(br=[bo.$0.$0,bo],true))))?(bs=br[1],{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:d.toLower(bs.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bs.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):bo!=null&&bo.$==1&&(bo.$0.$2.$==0&&(bo.$0.$0.get_Length()>0&&bo.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bt=[bo.$0.$0,bo],true)))?(bu=bt[1],(bv=_9.map(function(bD){return new x({$:0,$0:d.toLower(bD.get_Role()),$1:bD.get_Value(),$2:{$:1,$0:bD.get_Confidence()}});},_9.filter(function(bD){return bD.get_Confidence()>E.entityConfidenceThreshold();},bu.$0.get_Entities())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:d.toLower(bu.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bu.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:bv}})})):bo!=null&&bo.$==1&&(bo.$0.$1.$==0&&(bo.$0.$0.get_Length()>0&&bo.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bw=[bo.$0.$0,bo],true)))?(bx=bw[1],(by=_9.map(function(bD){return new w({$:0,$0:d.toLower(bD.get_Name()),$1:bD.get_Value(),$2:{$:1,$0:bD.get_Confidence()}});},_9.filter(function(bD){return bD.get_Confidence()>E.entityConfidenceThreshold();},bx.$0.get_Traits())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:d.toLower(bx.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bx.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:by},$2:null})})):bo!=null&&bo.$==1&&(bo.$0.$0.get_Length()>0&&bo.$0.get_TopIntent().get_Confidence()>E.intentConfidenceThreshold()&&(bz=[bo.$0.$0,bo],true))?(bA=bz[1],(bB=_9.map(function(bD){return new x({$:0,$0:d.toLower(bD.get_Role()),$1:bD.get_Value(),$2:{$:1,$0:bD.get_Confidence()}});},_9.filter(function(bD){return bD.get_Confidence()>E.entityConfidenceThreshold();},bA.$0.get_Entities())),(bC=_9.map(function(bD){return new w({$:0,$0:d.toLower(bD.get_Name()),$1:bD.get_Value(),$2:{$:1,$0:bD.get_Confidence()}});},_9.filter(function(bD){return bD.get_Confidence()>E.entityConfidenceThreshold();},bA.$0.get_Traits())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:d.toLower(bA.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bA.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bC},$2:{$:1,$0:bB}})}))):null;};E.entityConfidenceThreshold=function(){K.$cctor();return K.entityConfidenceThreshold;};E.set_entityConfidenceThreshold=function(bo){K.$cctor();K.entityConfidenceThreshold=bo;};E.intentConfidenceThreshold=function(){K.$cctor();return K.intentConfidenceThreshold;};E.set_intentConfidenceThreshold=function(bo){K.$cctor();K.intentConfidenceThreshold=bo;};E.getUtterance2=function(bo){var bp;bp=null;return ba.Delay(function(){return ba.Bind(n.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bo),function(bq){d.debug("NLU",(function(br){return function(bs){return br("Wit.ai returned "+V.p(bs)+" ");};}(a.id))(bq));return ba.Return(new F({$:0,$0:_9.ofArray(_8.map(function(br){return new G({$:0,$0:br.name,$1:br.confidence});},bq.intents)),$1:_9.map(function(br){return new H({$:0,$0:br.name,$1:br.confidence,$2:br.role,$3:br.value});},_9.ofSeq(_.concat(_.map(function(br){return br[1];},bc.ToSeq(bq.entities))))),$2:_9.ofSeq(_.map(function(br){var bs;bs=br[1];return new I({$:0,$0:br[0],$1:_8.get(bs,0).confidence,$2:_8.get(bs,0).value});},bc.ToSeq(bq.traits)))}));});});};E.getUtterance=function(bo,bp){n.getMeaning("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bo,function(bq){var br,bs;d.debug("NLU",(function(bt){return function(bu){return bt("Wit.ai returned: "+_5.prettyPrint(bu));};}(a.id))(bq));br=!(bq.intents==null)?_9.ofArray(_8.map(function(bt){return new G({$:0,$0:bt.name,$1:bt.confidence});},bq.intents)):_9.T.Empty;bs=!(bq.traits==null)?_9.ofSeq(_.concat(_9.map(function(bt){return _8.map(function(bu){return new I({$:0,$0:bt,$1:bu.confidence,$2:bu.value});},be.GetJS(bq.traits,[bt]));},_9.filter(function(bt){return!(be.GetJS(bq.traits,[bt])==null);},E.trait_types())))):_9.T.Empty;return bp({$:1,$0:new F({$:0,$0:br,$1:!(bq.entities==null)?_9.ofSeq(_.concat(_9.map(function(bt){return _8.map(function(bu){return new H({$:0,$0:bu.name,$1:bu.confidence,$2:bu.role,$3:bu.value});},be.GetJS(bq.entities,[bt]));},_9.filter(function(bt){return!(be.GetJS(bq.entities,[bt])==null);},E.entity_types())))):_9.T.Empty,$2:bs})});},function(bq,br,bs){d.error((((_4.Curried3(function(bt,bu,bv){return bt("Wit.ai returned: "+_5.prettyPrint(bu)+" "+_5.prettyPrint(bv));}))(a.id))(br))(bs));return bp(null);});};E.trait_types=function(){K.$cctor();return K.trait_types;};E.entity_types=function(){K.$cctor();return K.entity_types;};E.QuickPrograms=function(bo){return bo==="programs"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};E.QuickNumber=function(bo){var bp,bq,br;return(bq=E.One(bo),bq!=null&&bq.$==1?(bp=bq.$0,true):(br=E.Two(bo),br!=null&&br.$==1&&(bp=br.$0,true)))?{$:1,$0:bp}:null;};E.Three=function(bo){var bp;return bo==="3"||bo==="three"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_9.ofArray([new x({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};E.Two=function(bo){var bp;return bo==="2"||bo==="two"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_9.ofArray([new x({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};E.One=function(bo){var bp;return bo==="1"||bo==="one"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_9.ofArray([new x({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};E.QuickNo=function(bo){var bp;return bo==="no"||(bo==="nope"||(bo==="no way"||(bo==="nah"||(bo==="don't do it"||bo==="stop"))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickYes=function(bo){var bp;return bo==="yes"||(bo==="ok"||(bo==="sure"||(bo==="yeah"||(bo==="yep"||(bo==="uh huh"||(bo==="go ahead"||bo==="go"))))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickHelp=function(bo){var bp;return bo==="help"||(bo==="help me"||(bo==="what's this?"||bo==="huh"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.QuickHello=function(bo){var bp;return bo==="hello"||(bo==="hey"||(bo==="yo"||bo==="hi"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};E.Voices=function(bo){return bo==="voices"?{$:1,$0:null}:null;};E.Debug=function(bo){return bo==="debug"?{$:1,$0:null}:null;};E.Blank=function(bo){return bo===""?{$:1,$0:null}:null;};J.Study=function(bo){return bo.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};u.No=function(bo){var bp,bq,br,bs,bt,bu;return(bq=u.Intent$1("no",bo),bq!=null&&bq.$==1&&(bq.$0[0]==null&&(bq.$0[1]==null&&(bp=bo,true))))?{$:1,$0:bp}:(bs=u.Intent$1("noresponse",bo),bs!=null&&bs.$==1&&(bs.$0[0]==null&&(bs.$0[1]==null&&(br=bo,true))))?{$:1,$0:br}:(bu=u.Intent$1("NoResponse",bo),bu!=null&&bu.$==1&&(bu.$0[0]==null&&(bu.$0[1]==null&&(bt=bo,true))))?{$:1,$0:bt}:null;};u.Yes=function(bo){var bp,bq,br,bs,bt,bu;return(bq=u.Intent$1("yes",bo),bq!=null&&bq.$==1&&(bq.$0[0]==null&&(bq.$0[1]==null&&(bp=bo,true))))?{$:1,$0:bp}:(bs=u.Intent$1("yesresponse",bo),bs!=null&&bs.$==1&&(bs.$0[0]==null&&(bs.$0[1]==null&&(br=bo,true))))?{$:1,$0:br}:(bu=u.Intent$1("YesResponse",bo),bu!=null&&bu.$==1&&(bu.$0[0]==null&&(bu.$0[1]==null&&(bt=bo,true))))?{$:1,$0:bt}:null;};u.EntityManyofMany=function(bo,bp){return{$:1,$0:bc.OfArray(_8.ofSeq(_9.map(function(bq){return _9.exists(function(br){return br.get_Name()===bq;},bp)?[bq,{$:1,$0:_9.filter(function(br){return br.get_Name()===bq;},bp)}]:[bq,null];},bo)))};};u.EntityManyOf1=function(bo,bp){var bq;return bp!=null&&bp.$==1&&(_9.exists(function(br){return br.get_Name()===bo;},bp.$0)&&(bq=bp.$0,true))?{$:1,$0:_9.filter(function(br){return br.get_Name()===bo;},bq)}:null;};u.Entity1OfAny=function(bo,bp){var bq;return bp!=null&&bp.$==1&&(_9.exists(function(br){return br.get_Name()===bo;},bp.$0)&&(bq=bp.$0,true))?{$:1,$0:_9.head(_9.sortBy(function(br){return br.get_Name();},_9.filter(function(br){return br.get_Name()===bo;},bq)))}:null;};u.Entity1Of1=function(bo,bp){var bq;return bp!=null&&bp.$==1&&(bp.$0.$==1&&(bp.$0.$1.$==0&&(bp.$0.$0.get_Name()===bo&&(bq=bp.$0.$0,true))))?{$:1,$0:bq}:null;};u.Intent$1=function(bo,bp){return bp.get_Intent()!=null&&bp.get_Intent().$0.get_Name()===bo?{$:1,$0:[bp.get_Traits(),bp.get_Entities()]}:null;};K.$cctor=function(){K.$cctor=a.ignore;K.entity_types=_9.ofArray(["wit$contact:contact","wit$datetime:datetime","subject:subject","term:term","symptom_name:symptom_name"]);K.trait_types=_9.ofArray(["domain","dialogue_act","wit$sentiment"]);K.intentConfidenceThreshold=0.85;K.entityConfidenceThreshold=0.85;};M.MicReady={$:5};M.MicAudioEnd={$:4};M.MicAudioStart={$:3};M.MicDisconnected={$:2};M.MicConnecting={$:1};M.MicNotInitialized={$:0};N.ClientUnderstand={$:2};N.ClientReady={$:1};N.ClientNotInitialzed={$:0};O=L.Interpreter=_4.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,O);P=L.CUI=_4.Class({SayVoices:function(){var bo,bp,bq;bo=this;bp=a.speechSynthesis.getVoices();!(bp==null)?(bq=d.toArray(bp),bo.Say((function(br){return function(bs){return br("There are currently "+a.String(bs)+" voices installed on this computer or device.");};}(a.id))(_8.length(bq))),_8.iteri(function(br,bs){return bo.Say(((((_4.Curried(function(bt,bu,bv,bw){return bt("Voice "+a.String(bu)+". Name: "+_5.toSafe(bv)+", Local: "+_5.prettyPrint(bw)+".");},4))(a.id))(br))(bs.name))(bs.localService));},bq)):void 0;},Wait:function(bo){this.Wait$1(function(){ba.Start(bo,null);});},Wait$1:function(bo){this["Echo'"]("please wait...");this.Term.pause();bo();this.Term.resume();},sayRandom:function(bo,bp){this.Say(L.getRandomPhrase(bo,bp));},SayAngry:function(bo){var bp,bq;bp=this;ba.Start((bq=null,ba.Delay(function(){return ba.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bf.chime(),ba.Zero()):ba.Zero(),ba.Delay(function(){a.addMessage(bp.Avatar,bo,"","");bp.Avatar.processMessages(0);return ba.Zero();}));})),null);},Say:function(bo){var bp,bq;bp=this;ba.Start((bq=null,ba.Delay(function(){return ba.Combine(a.speechSynthesis.speaking?(bf.chime(),ba.Zero()):ba.Zero(),ba.Delay(function(){bp.Avatar.addMessage(bo);bp.Avatar.processMessages(0);return ba.Zero();}));})),null);},Debug:function(bo,bp){d.debug(bo,bp);},"EchoHtml'":function(bo){var bp,bq;bp=(bq={},bq.raw=true,bq);this.Term.disable();this.Term.echo(bo,bp);this.Term.enable();},"Echo'":function(bo){this.Term.disable();this.Term.echo(bo);this.Term.enable();}},null,P);P.New=function(bo,bp,bq,br,bs){return new P({Voice:bo,Mic:bp,Term:bq,Avatar:br,Caption:bs});};L.waitAddPhrases=function(){Q.$cctor();return Q.waitAddPhrases;};L.waitRetrievePhrases=function(){Q.$cctor();return Q.waitRetrievePhrases;};L.helpPhrases=function(){Q.$cctor();return Q.helpPhrases;};L.helloUserPhrases=function(){Q.$cctor();return Q.helloUserPhrases;};L.helloPhrases=function(){Q.$cctor();return Q.helloPhrases;};L["getRandomPhrase'"]=function(bo){return d.replace_tok("$0","",_.nth(L.rng().Next(0,bo.get_Length()),bo));};L.getRandomPhrase=function(bo,bp){return d.replace_tok("$0",bp,_.nth(L.rng().Next(0,bo.get_Length()),bo));};L.rng=function(){Q.$cctor();return Q.rng;};Q.$cctor=function(){Q.$cctor=a.ignore;Q.rng=new bg.New();Q.helloPhrases=_9.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);Q.helloUserPhrases=_9.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);Q.helpPhrases=_9.ofArray(["What can I help you with $0?"]);Q.waitRetrievePhrases=_9.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);Q.waitAddPhrases=_9.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};R.update=function(bo,bp,bq,br,bs){var bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg;function ch(cC){bo.Say(cC);}function ci(cC){br.unshift(cC);ch(cC);}function cj(cC,cD){var cE;cE=L.getRandomPhrase(cC,cD);br.unshift(cE);return bo.Say(cE);}function ck(cC){return bp.ContainsKey(cC);}function cl(cC){return bp.get_Item(cC);}function cm(cC,cD){return bp.Add(cC,cD);}function cn(cC){bp.Remove(cC);}function co(){return cl("user");}function cp(){bs.shift();}function cq(){bq.shift();}function cr(cC){var cD;cD=R.getTask(cC);cD==null?(function(cE){return function(cF){return cE("No such task "+_5.toSafe(cF));};}(bh.FailWith))(cC):bq.unshift(cD.$0);}function cs(cC,cD){cm(cC,cD);cr(cC);R.debug((function(cE){return function(cF){return cE("Added question: "+W.p$8(cF)+".");};}(a.id))(bq[0]));return ci(d.replace_tok("$0",cD,R.getTask(cC).$0.get_Prompt().get_Text()));}function ct(cC,cD){return ck(cC)?{$:1,$0:cD}:null;}function cu(cC,cD){return!ck(cC)?{$:1,$0:cD}:null;}function cv(cC){var cD,cE;return(cE=ct("user",cC),cE!=null&&cE.$==1&&(bq.length===0&&(cD=cE.$0,true)))?(cp(),{$:1,$0:cD}):null;}function cw(cC,cD){var cE,cF,cG;return(cF=ct("user",cD),cF!=null&&cF.$==1&&(R.haveTask(cC)&&bq.length>0&&bq[0].get_Name()===cC&&(cE=cF.$0,true)))?(cp(),cq(),ck(cC)?(cG=bp.get_Item(cC),(cn(cC),{$:1,$0:[cE,{$:1,$0:cG}]})):{$:1,$0:[cE,null]}):null;}function cx(cC,cD){var cE,cF,cG;return(cF=cu("user",cD),cF!=null&&cF.$==1&&(R.haveTask(cC)&&bq.length>0&&bq[0].get_Name()===cC&&(cE=cF.$0,true)))?(cp(),cq(),ck(cC)?(cG=bp.get_Item(cC),(cn(cC),{$:1,$0:[cE,{$:1,$0:cG}]})):{$:1,$0:[cE,null]}):null;}function cy(cC){var cD,cE;return(cE=cu("user",cC),cE!=null&&cE.$==1&&(bq.length===0&&(cD=cE.$0,true)))?(cp(),{$:1,$0:cD}):null;}function cz(cC){var cD;return cC!=null&&cC.$==1&&(typeof cC.$0=="string"&&(cD=cC.$0,true))?{$:1,$0:cD}:null;}function cA(cC,cD,cE){var cF;return ba.Start((cF=null,ba.Delay(function(){cj(L.waitAddPhrases(),"symptom entry");return ba.Bind((new bj.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:-2083300243",[co().Name,cC,cD,cE]),function(cG){return cG==null?(ci(function(cH){return cH("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),ba.Zero()):(ci((function(cH){return function(cI){return cH("OK I added that "+_5.toSafe(cI)+" symptom to your journal.");};}(a.id))(cC)),ba.Zero());});})),null);}function cB(cC){var cD;cD=null;return ba.Delay(function(){cj(L.waitRetrievePhrases(),"symptom journal");return(new bj.New()).Async("SMApp.Web:SMApp.Web.Server.getSymptomJournal:-1469891901",[cC]);});}R.debug((((_4.Curried3(function(cC,cD,cE){return cC("Starting utterances:"+_5.prettyPrint(cD)+". Starting tasks: "+_5.prettyPrint(cE)+".");}))(a.id))(bs))(bq));bt=_9.ofSeq(_.take(bs.length>=5?5:bs.length,bs));bt.$==1&&(bv=(bw=cu("started",bt.$0),bw!=null&&bw.$==1?{$:1,$0:bw.$0}:null),bv!=null&&bv.$==1&&(bx=cy(bv.$0),bx!=null&&bx.$==1&&(by=u.Intent$1("hello",bx.$0),by!=null&&by.$==1&&(by.$0[1]==null&&bt.$1.$==0))))?(bp.Add("started",true),cj(L.helloPhrases(),"")):bt.$==1&&(bA=cy(bt.$0),bA!=null&&bA.$==1&&(bB=u.Intent$1("hello",bA.$0),bB!=null&&bB.$==1&&(bB.$0[1]==null&&bt.$1.$==0)))?ci("Hello, tell me your name to get started."):bt.$==1&&(bD=cy(bt.$0),bD!=null&&bD.$==1&&(bE=u.Intent$1("hello",bD.$0),bE!=null&&bE.$==1&&(bF=u.Entity1Of1("contact",bE.$0[1]),bF!=null&&bF.$==1&&(bt.$1.$==0&&(bC=bF.$0,true)))))?(bG=bC.get_Value(),cj(L.waitRetrievePhrases(),"user name"),ba.Start((bH=null,ba.Delay(function(){return ba.Bind((new bj.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:1580049957",[bG]),function(cC){var cD;return cC==null?(ci((function(cE){return function(cF){return cE("I did not find a user with the name "+_5.toSafe(cF)+".");};}(a.id))(bG)),cs("addUser",bG),ba.Zero()):(cD=cC.$0,ba.Bind((new bj.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:-369996851",[cD.Name]),function(){bp.Add("user",cD);cj(L.helloUserPhrases(),(function(cE){return function(cF){return cE(_5.prettyPrint(cF));};}(a.id))(bp.get_Item("user")));return cD.LastLoggedIn!=null?ba.Bind((new bj.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:-1201823722",[cD.LastLoggedIn.$0]),function(cE){ci((function(cF){return function(cG){return cF("You last logged in "+_5.toSafe(cG)+".");};}(a.id))(cE));return ba.Zero();}):ba.Zero();}));});})),null)):bt.$==1&&(bJ=u.Yes(bt.$0),bJ!=null&&bJ.$==1&&(bK=cx("addUser",bJ.$0),bK!=null&&bK.$==1&&(bL=cz(bK.$0[1]),bL!=null&&bL.$==1&&(bt.$1.$==0&&(bI=bL.$0,true)))))?ba.Start((bM=null,ba.Delay(function(){cj(L.waitAddPhrases(),"user");return ba.Bind((new bj.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:-369996851",[bI]),function(cC){return cC==null?(ci((function(cD){return function(cE){return cD("Sorry I was not able to add the user "+_5.toSafe(cE)+" to the system.");};}(a.id))(bI)),ba.Zero()):(cm("user",bI),ci((function(cD){return function(cE){return cD("Hello "+_5.prettyPrint(cE)+", nice to meet you.");};}(a.id))(bp.get_Item("user"))),ba.Zero());});})),null):bt.$==1&&(bO=u.No(bt.$0),bO!=null&&bO.$==1&&(bP=cx("addUser",bO.$0),bP!=null&&bP.$==1&&(bQ=cz(bP.$0[1]),bQ!=null&&bQ.$==1&&(bt.$1.$==0&&(bN=bQ.$0,true)))))?ci((function(cC){return function(cD){return cC("Ok I did not add the user "+_5.toSafe(cD)+". But you must login for me to help you.");};}(a.id))(bN)):bt.$==1&&((bS=cy(bt.$0),bS!=null&&bS.$==1)&&bt.$1.$==0)?ci("Could you introduce yourself so we can get started?"):bt.$==1&&(bU=cv(bt.$0),bU!=null&&bU.$==1&&(bV=u.Intent$1("hello",bU.$0),bV!=null&&bV.$==1&&(bV.$0[0]==null&&(bW=u.Entity1Of1("contact",bV.$0[1]),bW!=null&&bW.$==1&&(bt.$1.$==0&&(bT=bW.$0,true))))))?ba.Start((bX=null,ba.Delay(function(){return ba.Bind((new bj.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:1580049957",[bT.get_Value()]),function(cC){return cC==null?(ci((function(cD){return function(cE){return cD("Sorry, the user "+_5.toSafe(cE)+" does not exist.");};}(a.id))(bT.get_Value())),ba.Zero()):(cs("switchUser",cC.$0.Name),ba.Zero());});})),null):bt.$==1&&(bZ=u.Yes(bt.$0),bZ!=null&&bZ.$==1&&(b0=cw("switchUser",bZ.$0),b0!=null&&b0.$==1&&(b1=cz(b0.$0[1]),b1!=null&&b1.$==1&&(bt.$1.$==0&&(bY=b1.$0,true)))))?(bp.set_Item("user",bY),ci((function(cC){return function(cD){return cC("Ok I switched to user "+_5.prettyPrint(cD)+".");};}(a.id))(bY))):bt.$==1&&(b3=u.No(bt.$0),b3!=null&&b3.$==1&&(b4=cw("switchUser",b3.$0),b4!=null&&b4.$==1&&(b5=cz(b4.$0[1]),b5!=null&&b5.$==1&&(bt.$1.$==0&&(b2=b5.$0,true)))))?ci((function(cC){return function(cD){return cC("Ok I did not switch to user "+_5.toSafe(cD)+".");};}(a.id))(b2)):bt.$==1&&(b7=cv(bt.$0),b7!=null&&b7.$==1&&(b8=u.Intent$1("symptom",b7.$0),b8!=null&&b8.$==1&&(b9=u.Entity1OfAny("symptom_name",b8.$0[1]),b9!=null&&b9.$==1&&(bt.$1.$==0&&(b6=b9.$0,true)))))?ba.Start((b_=null,ba.Delay(function(){ci("Ok I'll add that entry to your symptom journal");cA(b6.get_Value(),null,null);return ba.Bind(cB(co().Name),function(){cs("painVideo","");return ba.Zero();});})),null):bt.$==1&&(ca=u.Yes(bt.$0),ca!=null&&ca.$==1&&((cb=cw("painVideo",ca.$0),cb!=null&&cb.$==1)&&bt.$1.$==0))?bo["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bt.$==1&&(cd=cv(bt.$0),cd!=null&&cd.$==1&&(ce=u.Intent$1("medjournal",cd.$0),ce!=null&&ce.$==1&&((cf=ce.$0[1],cf!=null&&cf.$==1)&&(bt.$1.$==0&&(cc=ce.$0[1].$0,true)))))?(ci("ok I added that entry to your medication journal."),ci("You should be careful not to take too many painkillers over a short period of time.")):(cp(),R.debug("Main interpreter did not understand utterance."),ci("Sorry I didn't understand what you meant."),bq.length>0?(cg=_.nth(0,bq),ck(cg.get_Name())?ci(d.replace_tok("$0",bp.get_Item(cg.get_Name()),a.String(cg))):ci(a.String(cg))):void 0);R.debug((((_4.Curried3(function(cC,cD,cE){return cC("Ending utterances: "+_5.prettyPrint(cD)+". Ending questions:"+_5.prettyPrint(cE)+".");}))(a.id))(bs))(bq));};R.haveTask=function(bo){return _9.exists(function(bp){return bp.get_Name()===bo;},R.tasks());};R.getTask=function(bo){return _.tryFind(function(bp){return bp.get_Name()===bo;},R.tasks());};R.tasks=function(){S.$cctor();return S.tasks;};R.debug=function(bo){d.debug("Main",bo);};S.$cctor=function(){S.$cctor=a.ignore;S.tasks=_9.ofArray([new B({$:0,$0:"addUser",$1:new A({$:0,$0:new z({$:0,$0:"Do you want me to add the user $0?"})})}),new B({$:0,$0:"switchUser",$1:new A({$:0,$0:new z({$:0,$0:"Do you want me to switch to the user $0?"})})})]);};T.run=function(){var bo,bp;bo=_4.ThisFunc(function(bq,br){return((T.Main().get_Text())(bq))(br);});bp=T.Main().get_Options();a.$("#term").terminal(bo,bp);return _1.get_Empty();};T.Main=function(){U.$cctor();return U.Main;};T.initMic=function(bo){var bp,bq;T.set_CUI((bp={$:1,$0:new bk.Microphone(bl.getElementById("microphone"))},P.New(T.CUI().Voice,bp,T.CUI().Term,T.CUI().Avatar,T.CUI().Caption)));bq=T.CUI().Mic.$0;bq.onconnecting=function(){T.set_MicState(M.MicConnecting);return T.debug("Mic connecting...");};bq.ondisconnected=function(){T.set_MicState(M.MicDisconnected);return T.debug("Mic disconnected.");};bq.onaudiostart=function(){T.set_MicState(M.MicAudioStart);return T.debug("Mic audio start...");};bq.onaudioend=function(){T.set_MicState(M.MicAudioEnd);return T.debug("Mic audio end.");};bq.onerror=function(br){T.set_MicState({$:6,$0:br});return T.debug((function(bs){return function(bt){return bs("Mic error : "+_5.toSafe(bt)+".");};}(a.id))(br));};bq.onready=function(){T.set_MicState(M.MicReady);return T.debug("Mic ready.");};bq.onresult=function(br,bs){return T.ClientState().$==2?T.echo("I'm still trying to understand what you said before."):T.ClientState().$==0?d.error("Client is not intialized."):!(br==null||bs==null)?(T.set_MicState({$:7,$0:br,$1:bs}),T.debug((((_4.Curried3(function(bt,bu,bv){return bt("Mic result: "+_5.prettyPrint(bu)+" "+_5.prettyPrint(bv)+".");}))(a.id))(br))(bs)),bo(br,bs)):T.debug("Mic: No result returned.");};bq.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};T.sayRandom=function(bo,bp){T.say(L.getRandomPhrase(bp,bo));};T.say=function(bo){T.Responses().unshift(bo);T["say'"](bo);};T["say'"]=function(bo){T.CUI().Say(bo);};T.initSpeech=function(){var bo;bo=d.toArray(T.synth().getVoices());_8.length(bo)>0?(_8.iter(function(bp){if(bm.Equals(T.CUI().Voice,null)&&(bp.name.indexOf("Microsoft Zira")!=-1||bp.name.toLowerCase().indexOf("female")!=-1)){T.set_CUI(P.New({$:1,$0:bp},T.CUI().Mic,T.CUI().Term,T.CUI().Avatar,T.CUI().Caption));T.debug((function(bq){return function(br){return bq("Using browser speech synthesis voice "+_5.toSafe(br)+".");};}(a.id))(T.CUI().Voice.$0.name));}},bo),!bm.Equals(T.CUI().Voice,null)?(T.CUI().Avatar.nativeVoice=true,T.CUI().Avatar.nativeVoiceName=T.CUI().Voice.$0.name,T.debug((function(bp){return function(bq){return bp("Using browser speech synthesis voice "+_5.toSafe(bq)+".");};}(a.id))(T.CUI().Voice.$0.name))):void 0):void 0;bm.Equals(T.CUI().Voice,null)?T.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};T.synth=function(){U.$cctor();return U.synth;};T.push=function(bo){T.Utterances().unshift(bo);return T.Utterances();};T.Props=function(){U.$cctor();return U.Props;};T.Responses=function(){U.$cctor();return U.Responses;};T.Tasks=function(){U.$cctor();return U.Tasks;};T.Utterances=function(){U.$cctor();return U.Utterances;};T.wait=function(bo){d["Terminal.Echo'"](T.CUI().Term,"please wait");T.CUI().Term.pause();bo();T.CUI().Term.resume();};T.debug=function(bo){d.debug("CLIENT",bo);};T.echo=function(bo){d["Terminal.EchoHtml'"](T.CUI().Term,(function(bp){return function(bq){return bp(_5.prettyPrint(bq));};}(a.id))(bo));};T.ClientState=function(){U.$cctor();return U.ClientState;};T.set_ClientState=function(bo){U.$cctor();U.ClientState=bo;};T.MicState=function(){U.$cctor();return U.MicState;};T.set_MicState=function(bo){U.$cctor();U.MicState=bo;};T.CUI=function(){U.$cctor();return U.CUI;};T.set_CUI=function(bo){U.$cctor();U.CUI=bo;};U.$cctor=function(){var bo,bp,bq;U.$cctor=a.ignore;function br(bt,bu){var bv,bw,bx,by,bz,bA,bB,bC;T.debug((((_4.Curried3(function(bD,bE,bF){return bD("Voice: "+_5.prettyPrint(bE)+" "+_5.prettyPrint(bF));}))(a.id))(bt))(bu));bv=(bw=C["Intent'"](bt,bu),bw!=null&&bw.$==1?{$:1,$0:bw.$0}:null);bx=(by=C["Trait'"](bu),by!=null&&by.$==1?{$:1,$0:_9.ofArray([by.$0])}:null);bz=(bA=C["Entity'$1"](bu),bA!=null&&bA.$==1?{$:1,$0:_9.ofArray([bA.$0])}:null);bv==null&&(bx==null&&bz==null)?void 0:(T.debug(((((_4.Curried(function(bD,bE,bF,bG){return bD("Voice: "+W.p(bE)+" "+W.p$3(bF)+" "+W.p$5(bG));},4))(a.id))(bv))(bx))(bz)),bC=T.push(new y({$:0,$0:bv,$1:bx,$2:bz})),R.update(T.CUI(),T.Props(),T.Tasks(),T.Responses(),bC));}function bs(bt,bu){var bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH;T.set_CUI(P.New(T.CUI().Voice,T.CUI().Mic,bt,T.CUI().Avatar,T.CUI().Caption));bm.Equals(T.CUI().Mic,null)?T.initMic(br):void 0;bm.Equals(T.CUI().Voice,null)?T.initSpeech():void 0;T.ClientState().$===0?T.set_ClientState(N.ClientReady):void 0;return(bv=E.Blank(bu),bv!=null&&bv.$==1)?T["say'"]("Tell me what you want me to do or ask me a question."):(bw=E.Debug(bu),bw!=null&&bw.$==1)?(T.debug((function(bI){return function(bJ){return bI("Utterances: "+_5.prettyPrint(bJ));};}(a.id))(T.Utterances())),T.debug((function(bI){return function(bJ){return bI("Tasks: "+_5.prettyPrint(bJ));};}(a.id))(T.Tasks())),bx=self.document.createElement("insert"),by=_1.Element("div",[$.Create("id","bar")],[]),_0.LoadLocalTemplates(""),_1.RunAppend(bx,by),T.debug(bx.innerHTML)):(bz=E.Voices(bu),bz!=null&&bz.$==1)?(bA=d.toArray(d.speechSynthesis().getVoices()),(T["say'"]((function(bI){return function(bJ){return bI("There are currently "+a.String(bJ)+" voices installed on this computer or device.");};}(a.id))(_8.length(bA))),_8.iteri(function(bI,bJ){return T["say'"](((((_4.Curried(function(bK,bL,bM,bN){return bK("Voice "+a.String(bL)+". Name: "+_5.toSafe(bM)+", Local: "+_5.prettyPrint(bN)+".");},4))(a.id))(bI))(bJ.name))(bJ.localService));},bA))):T.ClientState().$==1?(bC=E.QuickHello(bu),bC!=null&&bC.$==1?(bB=bC.$0,true):(bD=E.QuickHelp(bu),bD!=null&&bD.$==1?(bB=bD.$0,true):(bE=E.QuickYes(bu),bE!=null&&bE.$==1?(bB=bE.$0,true):(bF=E.QuickNo(bu),bF!=null&&bF.$==1&&(bB=bF.$0,true)))))?(T.debug((function(bI){return function(bJ){return bI("Quick Text: "+W.p$7(bJ)+".");};}(a.id))(bB)),bG=T.push(bB),R.update(T.CUI(),T.Props(),T.Tasks(),T.Responses(),bG),T.set_ClientState(N.ClientReady)):T.CUI().Wait((bH=null,ba.Delay(function(){T.set_ClientState(N.ClientUnderstand);E.getUtterance(bu,function(bI){var bJ,bK,bL;bJ=E.HasUtterance(bI);bJ!=null&&bJ.$==1?(bK=bJ.$0,T.debug(((((_4.Curried(function(bM,bN,bO,bP){return bM("Text: Intent: "+W.p(bN)+", Traits: "+W.p$3(bO)+", Entities: "+W.p$5(bP));},4))(a.id))(bK.get_Intent()))(bK.get_Traits()))(bK.get_Entities())),bL=T.push(bK),R.update(T.CUI(),T.Props(),T.Tasks(),T.Responses(),bL)):(T.debug("Text: Did not receive a meaning from the server."),T["say'"]("Sorry I did not understand what you said."));});T.set_ClientState(N.ClientReady);return ba.Zero();}))):T.ClientState().$==0?d.error("Client is not initialized."):T["say'"]("I'm still trying to understand what you said before.");}U.CUI=P.New(null,null,null,(bf.applicationId="4277115329081938617",bo=new a.SDKConnection(),bp=new a.WebAvatar(),bp.version=8.5,bp.connection=bo,bp.avatar="20926186",bp.voice="cmu-slt",bp.voiceMod="default",bp.width=175,bp.createBox(),bp.addMessage(""),bp.processMessages(0),bp),false);U.MicState=M.MicNotInitialized;U.ClientState=N.ClientNotInitialzed;U.Utterances=[];U.Tasks=[];U.Responses=[];U.Props=new bn.New$5();U.synth=a.speechSynthesis;U.Main=new O({$:0,$0:function(bt){return br(bt[0],bt[1]);},$1:[function(bt){return function(bu){return bs(bt,bu);};},(bq={},bq.name="Main",bq.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bq.prompt=">",bq)]});};V.p=function(bo){return"{"+("text = "+_5.prettyPrint(bo.text))+"; "+("intents = "+_5.printArray(function(bp){return V.p$1(bp);},bo.intents))+"; "+("entities = "+_5.prettyPrint(bo.entities))+"; "+("traits = "+_5.prettyPrint(bo.traits))+"}";};V.p$1=function(bo){return"{"+("id = "+_5.prettyPrint(bo.id))+"; "+("name = "+_5.prettyPrint(bo.name))+"; "+("confidence = "+_5.prettyPrint(bo.confidence))+"}";};W.p$8=function(bo){return"Task ("+_5.prettyPrint(bo.$0)+", "+W.p$9(bo.$1)+")";};W.p$9=function(bo){return bo.$==1?"Html ("+W.p$10(bo.$0)+", "+_5.prettyPrint(bo.$1)+")":"Ssml "+W.p$10(bo.$0);};W.p$10=function(bo){return"SSML "+_5.prettyPrint(bo.$0);};W.p$2=function(bo){return bo==null?"null":"Some "+_5.prettyPrint(bo.$0);};W.p$1=function(bo){return"Intent ("+_5.prettyPrint(bo.$0)+", "+W.p$2(bo.$1)+")";};W.p=function(bo){return bo==null?"null":"Some "+W.p$1(bo.$0);};W.p$4=function(bo){return"Trait ("+_5.prettyPrint(bo.$0)+", "+_5.prettyPrint(bo.$1)+", "+W.p$2(bo.$2)+")";};W.p$3=function(bo){return bo==null?"null":"Some "+_5.printList(function(bp){return W.p$4(bp);},bo.$0);};W.p$6=function(bo){return"Entity ("+_5.prettyPrint(bo.$0)+", "+_5.prettyPrint(bo.$1)+", "+W.p$2(bo.$2)+")";};W.p$5=function(bo){return bo==null?"null":"Some "+_5.printList(function(bp){return W.p$6(bp);},bo.$0);};W.p$7=function(bo){return"Utterance ("+W.p(bo.$0)+", "+W.p$3(bo.$1)+", "+W.p$5(bo.$2)+")";};}());
