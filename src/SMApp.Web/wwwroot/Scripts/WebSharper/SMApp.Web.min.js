(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=d.SweetAlert=d.SweetAlert||{};f=c._Html=c._Html||{};g=c.htmModule=c.htmModule||{};h=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};i=c.TypingDNA=c.TypingDNA||{};j=i.SaveResponse=i.SaveResponse||{};k=i.UserResponse=i.UserResponse||{};l=i.VerifyResponse=i.VerifyResponse||{};m=c.Bs=c.Bs||{};n=b.NLU=b.NLU||{};o=n.Witai=n.Witai||{};p=o.Utterance=o.Utterance||{};q=o.Intent=o.Intent||{};r=o.Entity=o.Entity||{};s=o.Trait=o.Trait||{};t=o["Utterance'"]=o["Utterance'"]||{};u=o["Value'"]=o["Value'"]||{};v=c.BabelNet=c.BabelNet||{};w=v.DisambiguateApiResponse=v.DisambiguateApiResponse||{};x=v.TokenFragment=v.TokenFragment||{};y=v.CharFragment=v.CharFragment||{};z=c.NLG=c.NLG||{};A=a.StartupCode$SMApp_Web$NLG=a.StartupCode$SMApp_Web$NLG||{};B=c.NLU=c.NLU||{};C=B.Intent=B.Intent||{};D=B.Trait=B.Trait||{};E=B.Entity=B.Entity||{};F=B.Utterance=B.Utterance||{};G=B.Voice=B.Voice||{};H=G["Entity'"]=G["Entity'"]||{};I=B.Text=B.Text||{};J=I["Utterance'"]=I["Utterance'"]||{};K=I["Intent'"]=I["Intent'"]||{};L=I["Entity'"]=I["Entity'"]||{};M=I["Trait'"]=I["Trait'"]||{};N=B.Domain=B.Domain||{};O=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};P=c.Knowledge=c.Knowledge||{};Q=P.EmotionalTrait=P.EmotionalTrait||{};R=P.Relation=P.Relation||{};S=P.Triple=P.Triple||{};T=P.Subject=P.Subject||{};U=P.Verb=P.Verb||{};V=P.Object=P.Object||{};W=c.CUI=c.CUI||{};X=W.MicState=W.MicState||{};Y=W.ClientState=W.ClientState||{};Z=W.Interpreter=W.Interpreter||{};_0=W.CUI=W.CUI||{};_1=c.Dialogue=c.Dialogue||{};_2=c.Question=c.Question||{};_3=c.QuestionType=c.QuestionType||{};_4=c.DialogueModule=c.DialogueModule||{};_5=c.QuestionDialogs=c.QuestionDialogs||{};_6=c.Questions=c.Questions||{};_7=c.User=c.User||{};_8=a.StartupCode$SMApp_Web$User=a.StartupCode$SMApp_Web$User||{};_9=c.Journal=c.Journal||{};_=a.StartupCode$SMApp_Web$Journal=a.StartupCode$SMApp_Web$Journal||{};$=c.Symptoms=c.Symptoms||{};ba=a.StartupCode$SMApp_Web$Symptoms=a.StartupCode$SMApp_Web$Symptoms||{};bb=c.Main=c.Main||{};bc=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};bd=c.Client=c.Client||{};be=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};bf=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};bg=a.GeneratedPrintf=a.GeneratedPrintf||{};bh=a.WebSharper;bi=bh&&bh.Arrays;bj=a.SweetAlert;bk=a.IntelliFactory;bl=bk&&bk.Runtime;bm=bh&&bh.Operators;bn=bh&&bh.UI;bo=bn&&bn.Doc;bp=bn&&bn.AttrProxy;bq=bn&&bn.Client;br=bq&&bq.Templates;bs=bh&&bh.Utils;bt=a.console;bu=a.jQuery;bv=bh&&bh.Strings;bw=bh&&bh.List;bx=bh&&bh.Seq;by=bn&&bn.AttrModule;bz=bh&&bh.Concurrency;bA=bh&&bh.Random;bB=bh&&bh.Collections;bC=bB&&bB.Map;bD=bh&&bh.JavaScript;bE=bD&&bD.Pervasives;bF=bh&&bh.ClientSideJson;bG=bF&&bF.Provider;bH=a.JSON;bI=a.SDK;bJ=bh&&bh.Unchecked;bK=bh&&bh.Remoting;bL=bK&&bK.AjaxRemotingProvider;bM=a.Wit;bN=a.document;bO=bB&&bB.Dictionary;d.getCameraCanvas=function(){return a.getCameraCanvas();};d.stopCamera=function(){return a.stopCamera();};d.startCamera=function(bP,bQ){return a.startCamera(bP,bQ);};d.speechSynthesis=function(){return a.speechSynthesis;};d.lastMicData=function(){return a.lastMicData;};d.Terminal=function(){return a.$("#term").terminal();};d.enableTerminal=function(){return a.$("#term").terminal().enable();};d.disableTerminal=function(){return a.$("#term").terminal().disable();};d.boxesWithTitles=function(bP){return bi.map(function(bQ){var bR;bR={};bR.titleText=bQ;return bR;},bP);};d.confirmQuestionBox=function(){bj.clickConfirm();};d.questionBox=function(bP,bQ,bR,bS,bT,bU,bV){var bW,bX,bY,bZ,b0,b1;bW=(bX=bS==null?(bY={},bY.titleText=bP,bY.text=bQ,bY.icon="question",bY.html="<div></div>",bY.allowOutsideClick=false,bY):(bZ=bS.$0[0],(b0={},b0.titleText=bP,b0.text=bQ,b0.icon="question",b0.width=a.String(bZ),b0.html=(((bl.Curried3(function(b2,b3,b4){return b2("<div class=\"swal2-content-custom\" style=\"width:"+a.String(b3)+"px;height:"+a.String(b4)+"px\"></div>");}))(a.id))(bZ))(bS.$0[1]),b0.allowOutsideClick=false,b0)),(bT!=null?bT.$0(bX):void 0,bR!=null&&bR.$==1?(b1=bR.$0,(bX.progressSteps=bi.ofSeq(bm.range(1,bi.length(b1))),bj.mixin(bX).queue(bi.create(bi.length(b1),bX)))):bj.fire(bX)));bU!=null?bU.$0():void 0;bW.then(bV);};e.get_QueueBoxes=function(){var bP;bP=bj.mixin({});return function(bQ){return bP.queue(bQ);};};d.getDialogueBoxInput=function(){return bi.get(a.jQuery(".swal2-input").get(),0);};d.getDialogueBoxCanvas=function(){return bi.get(a.jQuery("canvas.swal2-content").get(),0);};d.getDialogueBoxContent=function(){return bi.get(a.jQuery("#swal2-content").get(),0).firstChild;};d.createDialogueBoxCanvas=function(){return d.createCanvas("camera","640","480",bi.get(a.jQuery("#swal2-content").get(),0).firstChild);};d.createCanvas=function(bP,bQ,bR,bS){var bT;bT=bo.Element("canvas",[d.eid(bP),bp.Create("width",bQ),bp.Create("height",bR)],[]);br.LoadLocalTemplates("");bo.Run(bS,bT);return bS.firstChild;};d.elementHTML=function(bP){return bP.innerHTML;};d.createElement=function(bP){var bQ;bQ=self.document.createElement("div");self.document.appendChild(bQ);br.LoadLocalTemplates("");bo.RunAppend(bQ,bP);};d.getContainer=function(){return bi.get(a.jQuery("#container").get(),0).firstChild;};d.container=function(bP){return bo.Element("div",[d.cls("container")],bP);};d.dindex=function(bP){return bp.Create("data-index",a.String(bP));};d.cls=function(bP){return bp.Create("class",bP);};d.eid=function(bP){return bp.Create("id",bP);};d.getMic=function(){return bi.get(a.jQuery("#microphone").get(),0);};d.terminalOutput=function(){return bi.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(bP){return bP.toLowerCase();};d.debug=function(bP,bQ){d.info((((bl.Curried3(function(bR,bS,bT){return bR("DEBUG: "+bs.toSafe(bS)+": "+bs.prettyPrint(bT));}))(a.id))(bP.toUpperCase()))(bQ));};d.error=function(bP){bt.error(bP);};d.info=function(bP){bt.info(bP);};d.jserror=function(bP){bu.error(bP);};d.toArray=function(bP){return bi.map(a.id,bu.makeArray(bP));};d["Terminal.EchoHtml'"]=function(bP,bQ){bP.pause();bP.echo(bQ,d.rawOpt());bP.resume();};d["Terminal.Echo'"]=function(bP,bQ){bP.pause();bP.echo(bQ);bP.resume();};d.rawOpt=function(){h.$cctor();return h.rawOpt;};f=c._Html=bl.Class({toString:function(){return f.toString(this);}},null,f);f.toString=function(bP){function bQ(bR){return function(bS){var bT,bU,bV,bW,bX,bY,bZ;bU=bv.replicate(bR," ");switch(bS.$==0?bS.$1.$==1?bS.$1.$0.$==2?bS.$1.$1.$==0?(bT=[bS.$1.$0.$0,bS.$0],1):(bT=[bS.$1,bS.$0],2):(bT=[bS.$1,bS.$0],2):(bT=[bS.$1,bS.$0],2):bS.$==2?(bT=bS.$0,3):(bT=[bS.$0,bS.$1],0)){case 0:return bT[0]+"=\""+bT[1]+"\"";case 1:bV=bT[1];return bU+"<"+bV+">"+bT[0]+"</"+bV+">\r\n";case 2:bW=bT[1];bX=bw.partition(function(b0){return b0.$==1;},bT[0]);bY=bX[1];bZ=bX[0];return bY.$==0?bU+"<"+bW+(bZ.$===0?"":" "+bv.concat(" ",bw.ofSeq(bx.delay(function(){return bx.map(function(b0){return(bQ(0))(b0);},bZ);}))))+"/>\r\n":bU+"<"+bW+(bZ.$===0?"":" "+bv.concat(" ",bw.ofSeq(bx.delay(function(){return bx.map(function(b0){return(bQ(0))(b0);},bZ);}))))+">\r\n"+bv.concat("",bw.ofSeq(bx.delay(function(){return bx.map(function(b0){return(bQ(bR+1))(b0);},bY);})))+bU+"</"+bW+">\r\n";case 3:return bU+bT+"\r\n";}};}return(bQ(0))(bP);};g.alt=function(bP){return new f({$:1,$0:"alt",$1:bP});};g.src=function(bP){return new f({$:1,$0:"src",$1:bP});};g.cls=function(bP){return new f({$:1,$0:"class",$1:bP});};g.str=function(bP){return f.toString(bP);};g.op_PercentEquals=function(bP,bQ){return new f({$:1,$0:bP,$1:bQ});};g.op_Splice=function(bP){var bQ;return bw.ofArray([new f({$:2,$0:(bQ=bP,a.String(bQ))})]);};g.strong=function(){h.$cctor();return h.strong;};g.h4=function(){h.$cctor();return h.h4;};g.h3=function(){h.$cctor();return h.h3;};g.h2=function(){h.$cctor();return h.h2;};g.h1=function(){h.$cctor();return h.h1;};g.li=function(){h.$cctor();return h.li;};g.ul=function(){h.$cctor();return h.ul;};g.th=function(){h.$cctor();return h.th;};g.td=function(){h.$cctor();return h.td;};g.tr=function(){h.$cctor();return h.tr;};g.a=function(){h.$cctor();return h.a;};g.p=function(){h.$cctor();return h.p;};g.area=function(){h.$cctor();return h.area;};g.map=function(){h.$cctor();return h.map;};g.img=function(){h.$cctor();return h.img;};g.tfoot=function(){h.$cctor();return h.tfoot;};g.tbody=function(){h.$cctor();return h.tbody;};g.thead=function(){h.$cctor();return h.thead;};g.table=function(){h.$cctor();return h.table;};g.span=function(){h.$cctor();return h.span;};g.section=function(){h.$cctor();return h.section;};g.br=function(){h.$cctor();return h.br;};g.div=function(){h.$cctor();return h.div;};g.body=function(){h.$cctor();return h.body;};g.style=function(){h.$cctor();return h.style;};g.title=function(){h.$cctor();return h.title;};g.head=function(){h.$cctor();return h.head;};g.html=function(){h.$cctor();return h.html;};g.elem=function(bP,bQ){return new f({$:0,$0:bP,$1:bQ});};h.$cctor=function(){var bP;h.$cctor=a.ignore;h.rawOpt=(bP={},bP.raw=true,bP);h.html=function(bQ){return g.elem("html",bQ);};h.head=function(bQ){return g.elem("head",bQ);};h.title=function(bQ){return g.elem("title",bQ);};h.style=function(bQ){return g.elem("style",bQ);};h.body=function(bQ){return g.elem("body",bQ);};h.div=function(bQ){return g.elem("div",bQ);};h.br=function(bQ){return g.elem("br",bQ);};h.section=function(bQ){return g.elem("section",bQ);};h.span=function(bQ){return g.elem("span",bQ);};h.table=function(bQ){return g.elem("table",bQ);};h.thead=function(bQ){return g.elem("thead",bQ);};h.tbody=function(bQ){return g.elem("tbody",bQ);};h.tfoot=function(bQ){return g.elem("tfoot",bQ);};h.img=function(bQ){return g.elem("img",bQ);};h.map=function(bQ){return g.elem("map",bQ);};h.area=function(bQ){return g.elem("area",bQ);};h.p=function(bQ){return g.elem("p",bQ);};h.a=function(bQ){return g.elem("a",bQ);};h.tr=function(bQ){return g.elem("tr",bQ);};h.td=function(bQ){return g.elem("td",bQ);};h.th=function(bQ){return g.elem("th",bQ);};h.ul=function(bQ){return g.elem("ul",bQ);};h.li=function(bQ){return g.elem("li",bQ);};h.h1=function(bQ){return g.elem("h1",bQ);};h.h2=function(bQ){return g.elem("h1",bQ);};h.h3=function(bQ){return g.elem("h1",bQ);};h.h4=function(bQ){return g.elem("h1",bQ);};h.strong=function(bQ){return g.elem("strong",bQ);};};j.New=function(bP,bQ,bR,bS){return{name:bP,message:bQ,message_code:bR,status:bS};};k.New=function(bP,bQ,bR,bS,bT){return{message:bP,message_code:bQ,success:bR,count:bS,status:bT};};l.New=function(bP,bQ,bR,bS,bT,bU){return{message:bP,message_code:bQ,success:bR,result:bS,score:bT,confidence:bU};};m.Radio=function(bP,bQ,bR,bS,bT){return bo.Element("div",new bw.T({$:1,$0:d.cls("radio"),$1:bQ}),[bo.Element("label",bS,[bo.Radio(bT,true,bR),bo.TextNode(bP)])]);};m.checkbox=function(bP,bQ,bR,bS,bT){return bo.Element("div",new bw.T({$:1,$0:d.cls("checkbox"),$1:bQ}),[bo.Element("label",bS,[bo.CheckBox(bT,bR),bo.TextNode(bP)])]);};m.textArea=function(bP,bQ,bR,bS,bT){return bo.Element("div",new bw.T({$:1,$0:d.cls("form-group"),$1:bQ}),[bo.Element("label",bS,[bo.TextNode(bP)]),bo.InputArea(new bw.T({$:1,$0:d.cls("form-control"),$1:bT}),bR)]);};m.inputPassword=function(bP,bQ,bR,bS,bT){return bo.Element("div",new bw.T({$:1,$0:d.cls("form-group"),$1:bQ}),[bo.Element("label",bS,[bo.TextNode(bP)]),bo.PasswordBox(new bw.T({$:1,$0:d.cls("form-control"),$1:bT}),bR)]);};m.input=function(bP,bQ,bR,bS,bT){return bo.Element("div",new bw.T({$:1,$0:d.cls("form-group"),$1:bQ}),[bo.Element("label",bS,[bo.TextNode(bP)]),bo.Input([d.cls("form-control"),bT],bR)]);};m.btnSecondary=function(bP,bQ,bR){return bo.Element("button",[d.eid(bP),d.cls("btn btn-secondary"),by.Handler("click",bR)],[bo.TextNode(bQ)]);};m.btnPrimary=function(bP,bQ,bR){return bo.Element("button",[d.eid(bP),d.cls("btn btn-primary"),by.Handler("click",bR)],[bo.TextNode(bQ)]);};p.New=function(bP,bQ,bR,bS){return{text:bP,intents:bQ,entities:bR,traits:bS};};q.New=function(bP,bQ,bR){return{id:bP,name:bQ,confidence:bR};};r.New=function(bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ){return{id:bP,name:bQ,role:bR,start:bS,end:bT,body:bU,confidence:bV,entities:bW,suggested:bX,value:bY,type:bZ};};s.New=function(bP,bQ,bR){return{id:bP,value:bQ,confidence:bR};};t.New=function(bP){return{intent:bP};};u.New=function(bP){return{value:bP};};o.getMeaning2=function(bP,bQ){function bR(bS,bT){var bU;bu.ajax((bU={},bU.url=(function(bV){return function(bW){return bV("https://api.wit.ai/message?q="+bs.toSafe(bW));};}(a.id))(bQ),bU.type="GET",bU.beforeSend=function(bV){return bV.setRequestHeader("Authorization","Bearer "+bP);},bU.success=function(bV){return bS(bV);},bU.error=function(bV){return bT(new a.Error(bV.responseText));},bU));}return bz.FromContinuations(function(bS,bT,bU){return bR.apply(null,[bS,bT,bU]);});};o.getMeaning=function(bP,bQ,bR,bS){var bT;bu.ajax((bT={},bT.url=(function(bU){return function(bV){return bU("https://api.wit.ai/message?q="+bs.toSafe(bV));};}(a.id))(bQ),bT.type="GET",bT.beforeSend=function(bU){return bU.setRequestHeader("Authorization","Bearer "+bP);},bT.success=bR,bT.error=bS,bT));};w.New=function(bP,bQ,bR,bS,bT,bU,bV,bW,bX){return{tokenFragment:bP,charFragment:bQ,babelSynsetID:bR,DBpediaURL:bS,BabelNetURL:bT,score:bU,cohrenceScore:bV,globalScore:bW,source:bX};};x.New=function(bP,bQ){return{start:bP,end:bQ};};y.New=function(bP,bQ){return{start:bP,end:bQ};};v.disambiguate=function(bP){function bQ(bR,bS){var bT;bu.ajax((bT={},bT.url=(function(bU){return function(bV){return bU("https://babelfy.io/v1/disambiguate?text="+bs.toSafe(bV)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bP),bT.type="GET",bT.success=function(bU){return bR(bU);},bT.error=function(bU){return bS(new a.Error(bU.responseText));},bT));}return bz.FromContinuations(function(bR,bS,bT){return bQ.apply(null,[bR,bS,bT]);});};z.waitAddPhrases=function(){A.$cctor();return A.waitAddPhrases;};z.waitRetrievePhrases=function(){A.$cctor();return A.waitRetrievePhrases;};z.helpPhrases=function(){A.$cctor();return A.helpPhrases;};z.helloUserPhrases=function(){A.$cctor();return A.helloUserPhrases;};z.helloPhrases=function(){A.$cctor();return A.helloPhrases;};z["getRandomPhrase'"]=function(bP){return z.replace_tok("$0","",bx.nth(z.rng().Next(0,bP.get_Length()),bP));};z.getRandomPhrase=function(bP,bQ){return z.replace_tok("$0",bQ,bx.nth(z.rng().Next(0,bP.get_Length()),bP));};z.replace_tok=function(bP,bQ,bR){return bv.Replace(bR,bP,bQ);};z.rng=function(){A.$cctor();return A.rng;};A.$cctor=function(){A.$cctor=a.ignore;A.rng=new bA.New();A.helloPhrases=bw.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);A.helloUserPhrases=bw.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);A.helpPhrases=bw.ofArray(["What can I help you with $0?"]);A.waitRetrievePhrases=bw.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);A.waitAddPhrases=bw.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};C=B.Intent=bl.Class({toString:function(){return(((bl.Curried3(function(bP,bQ,bR){return bP("Intent("+bs.toSafe(bQ)+", "+bf.p$2(bR)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,C);D=B.Trait=bl.Class({toString:function(){return(((bl.Curried3(function(bP,bQ,bR){return bP("Trait("+bs.toSafe(bQ)+", "+bs.prettyPrint(bR)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,D);E=B.Entity=bl.Class({toString:function(){return(((((bl.Curried(function(bP,bQ,bR,bS,bT){return bP("Entity("+bs.toSafe(bQ)+", "+bs.toSafe(bR)+", "+bs.toSafe(bS)+", "+bf.p$2(bT)+")");},5))(a.id))(this.get_Name()))(this.get_Role()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$3;},get_Value:function(){return this.$2;},get_Role:function(){return this.$1;},get_Name:function(){return this.$0;}},null,E);F=B.Utterance=bl.Class({toString:function(){return((((bl.Curried(function(bP,bQ,bR,bS){return bP(bf.p(bQ)+" "+bf.p$3(bR)+" "+bf.p$5(bS));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bP;bP=this.$3;return bP!=null?{$:1,$0:bw.sortBy(function(bQ){return bQ.get_Name();},bP.$0)}:null;},get_Traits:function(){var bP;bP=this.$2;return bP!=null?{$:1,$0:bw.sortBy(function(bQ){return bQ.get_Name();},bP.$0)}:null;},get_Intent:function(){return this.$1;},get_Text:function(){return this.$0;}},null,F);H.New=function(bP,bQ,bR,bS,bT){return{body:bP,end:bQ,start:bR,suggested:bS,value:bT};};G["Intent'"]=function(bP,bQ){return!(bQ.intent==null)?{$:1,$0:new C({$:0,$0:d.toLower(bQ.intent.value),$1:null})}:null;};G["Trait'"]=function(bP){return!(bP.domain==null)?{$:1,$0:new D({$:0,$0:"domain",$1:d.toLower(bP.domain.value),$2:null})}:!(bP.dialogue_act==null)?{$:1,$0:new D({$:0,$0:"dialogue_act",$1:d.toLower(bP.dialogue_act.value),$2:null})}:null;};G["Entity'$1"]=function(bP){return!(bP.contact==null)?{$:1,$0:new E({$:0,$0:"contact",$1:"",$2:d.toLower(bP.contact.value),$3:null})}:null;};J=I["Utterance'"]=bl.Class({get_TopIntent:function(){return bw.head(bw.sortBy(function(bP){return bP.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$3;},get_Entities:function(){return this.$2;},get_Intents:function(){return this.$1;},get_Text:function(){return this.$0;}},null,J);K=I["Intent'"]=bl.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,K);L=I["Entity'"]=bl.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,L);M=I["Trait'"]=bl.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,M);I.HasUtterance=function(bP){var bQ,bR,bS,bT,bU,bV;return bP!=null&&bP.$==1&&(bP.$0.$2.get_Length()>0&&(bQ=[bP.$0.$2,bP.$0.$1,bP,bP.$0.$0,bP.$0.$3],true))?(bR=bQ[0],(bS=bQ[2],(bT=bQ[4],(bU=bQ[1].$==0?null:{$:1,$0:new C({$:0,$0:bS.$0.get_TopIntent().get_Name(),$1:{$:1,$0:bS.$0.get_TopIntent().get_Confidence()}})},(bV=bR.$==0?null:{$:1,$0:bw.map(function(bW){return new E({$:0,$0:bW.get_Name(),$1:d.toLower(bW.get_Role()),$2:bW.get_Value(),$3:{$:1,$0:bW.get_Confidence()}});},bw.filter(function(bW){return bW.get_Confidence()>I.entityConfidenceThreshold();},bR))},{$:1,$0:new F({$:0,$0:bQ[3],$1:bU,$2:bT.$==0?null:{$:1,$0:bw.map(function(bW){return new D({$:0,$0:d.toLower(bW.get_Name()),$1:bW.get_Value(),$2:{$:1,$0:bW.get_Confidence()}});},bw.filter(function(bW){return bW.get_Confidence()>I.entityConfidenceThreshold();},bT))},$3:bV})}))))):null;};I.entityConfidenceThreshold=function(){O.$cctor();return O.entityConfidenceThreshold;};I.set_entityConfidenceThreshold=function(bP){O.$cctor();O.entityConfidenceThreshold=bP;};I.intentConfidenceThreshold=function(){O.$cctor();return O.intentConfidenceThreshold;};I.set_intentConfidenceThreshold=function(bP){O.$cctor();O.intentConfidenceThreshold=bP;};I.getUtterance2=function(bP){var bQ;bQ=null;return bz.Delay(function(){return bz.Bind(o.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bP),function(bR){d.debug("NLU",(function(bS){return function(bT){return bS("Wit.ai returned "+bg.p$3(bT)+" ");};}(a.id))(bR));return bz.Return(new J({$:0,$0:bP,$1:bw.ofArray(bi.map(function(bS){return new K({$:0,$0:bS.name,$1:bS.confidence});},bR.intents)),$2:bw.map(function(bS){return new L({$:0,$0:bS.name,$1:bS.confidence,$2:bS.role,$3:bS.value});},bw.ofSeq(bx.concat(bx.map(function(bS){return bS[1];},bC.ToSeq(bR.entities))))),$3:bw.ofSeq(bx.map(function(bS){var bT;bT=bS[1];return new M({$:0,$0:bS[0],$1:bi.get(bT,0).confidence,$2:bi.get(bT,0).value});},bC.ToSeq(bR.traits)))}));});});};I.getUtterance=function(bP,bQ){o.getMeaning("OOGDHEQL7JZRQASXN2N2GHFUKGO3SCNV",bP,function(bR){var bS,bT;d.debug("NLU",(function(bU){return function(bV){return bU("Wit.ai returned: "+bs.prettyPrint(bV));};}(a.id))(bR));bS=!(bR.intents==null)?bw.ofArray(bi.map(function(bU){return new K({$:0,$0:bU.name,$1:bU.confidence});},bR.intents)):bw.T.Empty;bT=!(bR.traits==null)?bw.ofSeq(bx.concat(bw.map(function(bU){return bi.map(function(bV){return new M({$:0,$0:bU,$1:bV.confidence,$2:bV.value});},bE.GetJS(bR.traits,[bU]));},bw.filter(function(bU){return!(bE.GetJS(bR.traits,[bU])==null);},I.trait_types())))):bw.T.Empty;return bQ({$:1,$0:new J({$:0,$0:bP,$1:bS,$2:!(bR.entities==null)?bw.ofSeq(bx.concat(bw.map(function(bU){return bi.map(function(bV){return new L({$:0,$0:bV.name,$1:bV.confidence,$2:bV.role,$3:bV.value});},bE.GetJS(bR.entities,[bU]));},bw.filter(function(bU){return!(bE.GetJS(bR.entities,[bU])==null);},I.entity_types())))):bw.T.Empty,$3:bT})});},function(bR,bS,bT){d.error((((bl.Curried3(function(bU,bV,bW){return bU("Wit.ai returned: "+bs.prettyPrint(bV)+" "+bs.prettyPrint(bW));}))(a.id))(bS))(bT));return bQ(null);});};I.trait_types=function(){O.$cctor();return O.trait_types;};I.entity_types=function(){O.$cctor();return O.entity_types;};I.JournalEntry=function(bP){var bQ;return bv.StartsWith(bP,"journal ")&&bv.Replace(bP,"journal ","")!==""?(bQ=bv.Replace(bP,"journal ",""),{$:1,$0:new F({$:0,$0:"journal",$1:{$:1,$0:new C({$:0,$0:"journal",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bw.ofArray([new E({$:0,$0:"journal_entry",$1:"",$2:bQ,$3:{$:1,$0:1}})])}})}):null;};I.QuickJournal=function(bP){var bQ;return bP==="journal"||bP==="diary"?{$:1,$0:new F({$:0,$0:"journal",$1:{$:1,$0:new C({$:0,$0:"journal",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.QuickNumber=function(bP){var bQ,bR,bS,bT,bU,bV;return(bR=I.One(bP),bR!=null&&bR.$==1?(bQ=bR.$0,true):(bS=I.Two(bP),bS!=null&&bS.$==1?(bQ=bS.$0,true):(bT=I.Three(bP),bT!=null&&bT.$==1?(bQ=bT.$0,true):(bU=I.Four(bP),bU!=null&&bU.$==1?(bQ=bU.$0,true):(bV=I.Five(bP),bV!=null&&bV.$==1&&(bQ=bV.$0,true))))))?{$:1,$0:bQ}:null;};I.Five=function(bP){var bQ;return bP==="5"||bP==="five"?{$:1,$0:new F({$:0,$0:"five",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bw.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"five",$3:{$:1,$0:1}})])}})}:null;};I.Four=function(bP){var bQ;return bP==="4"||bP==="four"?{$:1,$0:new F({$:0,$0:"four",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bw.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"four",$3:{$:1,$0:1}})])}})}:null;};I.Three=function(bP){var bQ;return bP==="3"||bP==="three"?{$:1,$0:new F({$:0,$0:"three",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bw.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"three",$3:{$:1,$0:1}})])}})}:null;};I.Two=function(bP){var bQ;return bP==="2"||bP==="two"?{$:1,$0:new F({$:0,$0:"two",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bw.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"two",$3:{$:1,$0:1}})])}})}:null;};I.One=function(bP){var bQ;return bP==="1"||bP==="one"?{$:1,$0:new F({$:0,$0:"one",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bw.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"one",$3:{$:1,$0:1}})])}})}:null;};I.QuickNo=function(bP){var bQ;return bP==="no"||(bP==="nope"||(bP==="no way"||(bP==="nah"||(bP==="don't do it"||bP==="stop"))))?{$:1,$0:new F({$:0,$0:"no",$1:{$:1,$0:new C({$:0,$0:"reject",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.QuickYes=function(bP){var bQ;return bP==="yes"||(bP==="ok"||(bP==="sure"||(bP==="yeah"||(bP==="yep"||(bP==="uh huh"||(bP==="go ahead"||bP==="go"))))))?{$:1,$0:new F({$:0,$0:"yes",$1:{$:1,$0:new C({$:0,$0:"verify",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.QuickHelp=function(bP){var bQ;return bP==="help"||(bP==="help me"||(bP==="what's this?"||bP==="huh"))?{$:1,$0:new F({$:0,$0:"help",$1:{$:1,$0:new C({$:0,$0:"help",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.QuickHello=function(bP){var bQ;return bP==="hello"||(bP==="hey"||(bP==="yo"||bP==="hi"))?{$:1,$0:new F({$:0,$0:"hello",$1:{$:1,$0:new C({$:0,$0:"greet",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.Voices=function(bP){return bP==="voices"?{$:1,$0:null}:null;};I.DebugEmotionalTraits=function(bP){return bv.StartsWith(bP,"debug-et ")?{$:1,$0:bv.Replace(bP,"debug-et ","")}:null;};I.DebugTriples=function(bP){return bv.StartsWith(bP,"debug-triples ")?{$:1,$0:bv.Replace(bP,"debug-triples ","")}:null;};I.DebugEntities=function(bP){return bv.StartsWith(bP,"debug-entities ")?{$:1,$0:bv.Replace(bP,"debug-entities ","")}:null;};I.Debug=function(bP){return bP==="debug"?{$:1,$0:null}:null;};I.Blank=function(bP){return bP===""?{$:1,$0:null}:null;};N.Study=function(bP){return bP.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};B.StrA=function(bP){if(bP!=null&&bP.$==1)try{return{$:1,$0:((bG.DecodeArray(bG.Id()))())(bH.parse(bP.$0))};}catch(bQ){return null;}else return null;};B.PStr=function(bP){var bQ;return bP!=null&&bP.$==1&&(typeof bP.$0=="string"&&(bQ=bP.$0,true))?{$:1,$0:bQ}:null;};B.No=function(bP){var bQ,bR;return(bR=B.Intent$1("reject",bP),bR!=null&&bR.$==1&&(bR.$0[0]==null&&(bR.$0[1]==null&&(bQ=bP,true))))?{$:1,$0:bQ}:null;};B.Yes=function(bP){var bQ,bR;return(bR=B.Intent$1("verify",bP),bR!=null&&bR.$==1&&(bR.$0[0]==null&&(bR.$0[1]==null&&(bQ=bP,true))))?{$:1,$0:bQ}:null;};B.EntityManyofMany=function(bP,bQ){return{$:1,$0:bC.OfArray(bi.ofSeq(bw.map(function(bR){return bw.exists(function(bS){return bS.get_Role()===bR;},bQ)?[bR,{$:1,$0:bw.filter(function(bS){return bS.get_Role()===bR;},bQ)}]:[bR,null];},bP)))};};B.EntityManyOf1=function(bP,bQ){var bR;return bQ!=null&&bQ.$==1&&(bw.exists(function(bS){return bS.get_Role()===bP;},bQ.$0)&&(bR=bQ.$0,true))?{$:1,$0:bw.filter(function(bS){return bS.get_Role()===bP;},bR)}:null;};B.Entity1OfAny=function(bP,bQ){var bR;return bQ!=null&&bQ.$==1&&(bw.exists(function(bS){return bS.get_Role()===bP;},bQ.$0)&&(bR=bQ.$0,true))?{$:1,$0:bw.head(bw.sortBy(function(bS){return bS.get_Role();},bw.filter(function(bS){return bS.get_Role()===bP;},bR)))}:null;};B.Entity1Of1=function(bP,bQ){var bR,bS;return bQ!=null&&bQ.$==1&&(bQ.$0.$==1&&(bQ.$0.$1.$==0&&((bS=bQ.$0.$0,bS.get_Role()===bP||bS.get_Name()===bP)&&(bR=bQ.$0.$0,true))))?{$:1,$0:bR}:null;};B.Intent$1=function(bP,bQ){return bQ.get_Intent()!=null&&bQ.get_Intent().$0.get_Name()===bP?{$:1,$0:[bQ.get_Traits(),bQ.get_Entities()]}:null;};O.$cctor=function(){O.$cctor=a.ignore;O.entity_types=bw.ofArray(["wit$contact:name","wit$datetime:datetime","term:subject","term:object","term:verb"]);O.trait_types=bw.ofArray(["domain","dialogue_act"]);O.intentConfidenceThreshold=0.85;O.entityConfidenceThreshold=0.85;};Q=P.EmotionalTrait=bl.Class({get_Frequence:function(){return this.$2;},get_Hierarchy:function(){return this.$1;},get_Label:function(){return this.$0;}},null,Q);R=P.Relation=bl.Class({toString:function(){return((((bl.Curried(function(bP,bQ,bR,bS){return bP("("+bs.prettyPrint(bQ)+", "+bs.prettyPrint(bR)+", "+bs.prettyPrint(bS)+")");},4))(a.id))(this.get_T1()))(this.get_Name()))(this.get_T2());},get_T2:function(){return this.$2;},get_Name:function(){return this.$1;},get_T1:function(){return this.$0;}},null,R);S=P.Triple=bl.Class({toString:function(){return((((bl.Curried(function(bP,bQ,bR,bS){return bP("("+bf.p$9(bQ)+", "+bf.p$11(bR)+", "+bf.p$17(bS)+")");},4))(a.id))(this.get_Subject()))(this.get_Verb()))(this.get_Object());},get_Object:function(){var bP;bP=this.$1;return bP!=null?{$:1,$0:bP.$0.get_T2()}:null;},get_Verb:function(){return this.$0.get_T2();},get_Subject:function(){return this.$0.get_T1();}},null,S);T=P.Subject=bl.Class({toString:function(){return this.$==1?a.String(this.$0):this.$0;}},null,T);U=P.Verb=bl.Class({toString:function(){return this.$0;}},null,U);V=P.Object=bl.Class({toString:function(){return this.$==1?a.String(this.$0):this.$0;}},null,V);P.SubjectVerbObject1OfAny=function(bP,bQ,bR,bS,bT,bU){return bU==null?null:bx.tryPick(function(bV){var bW,bX,bY,bZ,b0,b1,b2,b3;return(bX=P.TripleSubject(bP,bV.$0.$0),bX!=null&&bX.$==1)&&((bY=P.TripleRelation(bQ,bV.$0.$1),bY!=null&&bY.$==1)&&((bZ=P.TripleVerb(bR,bV.$0.$2),bZ!=null&&bZ.$==1)&&((b0=bV.$1,b0!=null&&b0.$==1)&&((b1=P.TripleVerb(bR,bV.$1.$0.$0),b1!=null&&b1.$==1)&&((b2=P.TripleRelation(bS,bV.$1.$0.$1),b2!=null&&b2.$==1)&&(b3=P.TripleObject(bT,bV.$1.$0.$2),b3!=null&&b3.$==1))))))?{$:1,$0:bV}:null;},bU.$0);};P.SubjectVerb1OfAny=function(bP,bQ,bR,bS){return bS==null?null:bx.tryPick(function(bT){var bU,bV,bW,bX;return(bV=P.TripleSubject(bP,bT.$0.$0),bV!=null&&bV.$==1)&&((bW=P.TripleRelation(bQ,bT.$0.$1),bW!=null&&bW.$==1)&&(bX=P.TripleVerb(bR,bT.$0.$2),bX!=null&&bX.$==1))?{$:1,$0:bT}:null;},bS.$0);};P.TripleObject=function(bP,bQ){var bR;return bQ.$==0&&(bQ.$0.toUpperCase()===bP.toUpperCase()&&(bR=bQ.$0,true))?{$:1,$0:null}:null;};P.TripleVerb=function(bP,bQ){return bQ.$0.toUpperCase()===bP.toUpperCase()?{$:1,$0:null}:null;};P.TripleRelation=function(bP,bQ){return bQ.toUpperCase()===bP.toUpperCase()?{$:1,$0:null}:null;};P.TripleSubject=function(bP,bQ){var bR;return bQ.$==0&&(bQ.$0.toUpperCase()===bP.toUpperCase()&&(bR=bQ.$0,true))?{$:1,$0:null}:null;};X.MicReady={$:5};X.MicAudioEnd={$:4};X.MicAudioStart={$:3};X.MicDisconnected={$:2};X.MicConnecting={$:1};X.MicNotInitialized={$:0};Y.ClientUnderstand={$:2};Y.ClientReady={$:1};Y.ClientNotInitialzed={$:0};Z=W.Interpreter=bl.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,Z);_0=W.CUI=bl.Class({SayVoices:function(){var bP,bQ,bR;bP=this;bQ=a.speechSynthesis.getVoices();!(bQ==null)?(bR=d.toArray(bQ),bP.Say((function(bS){return function(bT){return bS("There are currently "+a.String(bT)+" voices installed on this computer or device.");};}(a.id))(bi.length(bR))),bi.iteri(function(bS,bT){return bP.Say(((((bl.Curried(function(bU,bV,bW,bX){return bU("Voice "+a.String(bV)+". Name: "+bs.toSafe(bW)+", Local: "+bs.prettyPrint(bX)+".");},4))(a.id))(bS))(bT.name))(bT.localService));},bR)):void 0;},Wait:function(bP){this.Wait$1(function(){bz.Start(bP,null);});},Wait$1:function(bP){this["Echo'"]("please wait...");this.Term.pause();bP();this.Term.resume();},sayRandom:function(bP,bQ){this.Say(z.getRandomPhrase(bP,bQ));},SayAngry:function(bP){var bQ,bR;bQ=this;bz.Start((bR=null,bz.Delay(function(){return bz.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bI.chime(),bz.Zero()):bz.Zero(),bz.Delay(function(){a.addMessage(bQ.Avatar,bP,"","");bQ.Avatar.processMessages(0);return bz.Zero();}));})),null);},SayDoc:function(bP){var bQ,bR,bS;bQ=bi.get(bu(".terminal-output").get(),0).childNodes.length;bR=bo.Element("div",[d.cls("terminal-command"),d.dindex(bQ+1)],[bP]);bS=d.terminalOutput();br.LoadLocalTemplates("");bo.RunAppend(bS,bR);},Say:function(bP){var bQ,bR;bQ=this;bz.Start((bR=null,bz.Delay(function(){return bz.Combine(a.speechSynthesis.speaking?(bI.chime(),bz.Zero()):bz.Zero(),bz.Delay(function(){bQ.Avatar.addMessage(bP);bQ.Avatar.processMessages(0);return bz.Zero();}));})),null);},Debug:function(bP,bQ){d.debug(bP,bQ);},"EchoHtml'":function(bP){var bQ,bR;bQ=(bR={},bR.raw=true,bR);this.Term.disable();this.Term.echo(bP,bQ);this.Term.enable();},"Echo'":function(bP){this.Term.disable();this.Term.echo(bP);this.Term.enable();}},null,_0);_0.New=function(bP,bQ,bR,bS,bT,bU,bV){return new _0({Voice:bP,Mic:bQ,Term:bR,Avatar:bS,Caption:bT,AudioHandlers:bU,TypingDNA:bV});};_1=c.Dialogue=bl.Class({get_Utterances:function(){return this.$4;},get_Output:function(){return this.$3;},get_DialogueQuestions:function(){return this.$2;},get_Props:function(){return this.$1;},get_Cui:function(){return this.$0;}},null,_1);_2=c.Question=bl.Class({toString:function(){return((((bl.Curried(function(bP,bQ,bR,bS){return bP("Name: "+bs.toSafe(bQ)+" Module: "+bs.toSafe(bR)+" Type: "+bf.p$18(bS)+" ");},4))(a.id))(this.get_Name()))(this.get_Module()))(this.get_Type());},get_Target:function(){return this.$4;},get_Params:function(){return this.$3;},get_Type:function(){return this.$2;},get_Module:function(){return this.$1;},get_Name:function(){return this.$0;}},null,_2);_3.ConceptCompletion={$:3};_3.Disjunctive={$:2};_3.Verification={$:1};_4["Response'_"]=function(bP,bQ,bR){var bS,bT,bU,bV,bW,bX,bY,bZ;return(bT=_4.PropNotSet_(bP,"user",bR),bT!=null&&bT.$==1?(bU=_4.Form(bP,bQ,bT.$0),bU!=null&&bU.$==1?(bS=bU.$0,true):(bV=_4.PropNotSet_(bP,"user",bR),bV!=null&&bV.$==1&&(bW=_4.NotForm(bP,bQ,bV.$0),bW!=null&&bW.$==1&&(bS=bW.$0,true)))):(bX=_4.PropNotSet_(bP,"user",bR),bX!=null&&bX.$==1&&(bY=_4.NotForm(bP,bQ,bX.$0),bY!=null&&bY.$==1&&(bS=bY.$0,true))))?(bZ=_4.have(bP,bQ)?{$:1,$0:_4.prop(bP,bQ)}:null,bS.get_Text()!==""?{$:1,$0:[bS,{$:1,$0:bS.get_Text()},bZ]}:{$:1,$0:[bS,null,bZ]}):null;};_4.Response_=function(bP,bQ,bR){var bS,bT,bU,bV,bW,bX,bY,bZ;return(bT=_4.PropSet_(bP,"user",bR),bT!=null&&bT.$==1?(bU=_4.Form(bP,bQ,bT.$0),bU!=null&&bU.$==1?(bS=bU.$0,true):(bV=_4.PropSet_(bP,"user",bR),bV!=null&&bV.$==1&&(bW=_4.NotForm(bP,bQ,bV.$0),bW!=null&&bW.$==1&&(bS=bW.$0,true)))):(bX=_4.PropSet_(bP,"user",bR),bX!=null&&bX.$==1&&(bY=_4.NotForm(bP,bQ,bX.$0),bY!=null&&bY.$==1&&(bS=bY.$0,true))))?(bZ=_4.have(bP,bQ)?{$:1,$0:_4.prop(bP,bQ)}:null,bS.get_Text()!==""?{$:1,$0:[bS,{$:1,$0:bS.get_Text()},bZ]}:{$:1,$0:[bS,null,bZ]}):null;};_4.NotForm=function(bP,bQ,bR){return bP.get_DialogueQuestions().length>0&&(bP.get_DialogueQuestions())[0].get_Name()===bQ&&bR.get_Text()!==""?{$:1,$0:bR}:null;};_4.Form=function(bP,bQ,bR){return bP.get_DialogueQuestions().length>0&&(bP.get_DialogueQuestions())[0].get_Name()===bQ&&bR.get_Intent()!=null&&bR.get_Intent().$0.get_Name()===bQ&&bJ.Equals(bR.get_Intent().$0.get_Confidence(),{$:1,$0:1})&&bJ.Equals(bR.get_Traits(),null)&&bJ.Equals(bR.get_Entities(),null)?{$:1,$0:bR}:null;};_4["User'_"]=function(bP,bQ){var bR,bS;return(bS=_4.PropNotSet_(bP,"user",bQ),bS!=null&&bS.$==1&&(bP.get_DialogueQuestions().length===0&&(bR=bS.$0,true)))?{$:1,$0:bR}:null;};_4.User_=function(bP,bQ){var bR,bS;return(bS=_4.PropSet_(bP,"user",bQ),bS!=null&&bS.$==1&&(bP.get_DialogueQuestions().length===0&&(bR=bS.$0,true)))?{$:1,$0:bR}:null;};_4.PropNotSet_=function(bP,bQ,bR){return!_4.have(bP,bQ)?{$:1,$0:bR}:null;};_4.PropSet_=function(bP,bQ,bR){return _4.have(bP,bQ)?{$:1,$0:bR}:null;};_4.Agenda_=function(bP,bQ,bR,bS){return bP.get_DialogueQuestions().length>0&&(bP.get_DialogueQuestions())[0].get_Module()===bR?{$:1,$0:null}:null;};_4.debugInterpreterEnd=function(bP,bQ,bR){bQ(((((bl.Curried(function(bS,bT,bU,bV){return bS(bs.toSafe(bT)+" ending utterances:"+bs.prettyPrint(bU)+", questions: "+bs.prettyPrint(bV)+".");},4))(a.id))(bR))(bP.get_Utterances()))(bP.get_DialogueQuestions()));};_4.debugInterpreterStart=function(bP,bQ,bR){bQ(((((bl.Curried(function(bS,bT,bU,bV){return bS(bs.toSafe(bT)+" starting utterances:"+bs.prettyPrint(bU)+", questions: "+bs.prettyPrint(bV)+".");},4))(a.id))(bR))(bP.get_Utterances()))(bP.get_DialogueQuestions()));};_4.frame=function(bP){return bw.ofSeq(bx.take(bP.length>=5?5:bP.length,bP));};_4.didNotUnderstand=function(bP,bQ,bR){bQ((function(bS){return function(bT){return bS(bs.toSafe(bT)+" interpreter did not understand utterance.");};}(a.id))(bR));_4.popu(bP,bQ);_4.say(bP,"Sorry I didn't understand what you meant.");!_4.have(bP,"user")?_4.say(bP,"You must login to use most functions in Selma."):void 0;};_4.endt=function(bP,bQ,bR,bS){_4.popu(bP,bQ);_4.popq(bP,bQ);_4.have(bP,bR)?_4.remove(bP,bQ,bR):void 0;bQ((function(bT){return function(bU){return bT("End turn "+bs.toSafe(bU)+".");};}(a.id))(bR));bS();};_4.cancel=function(bP,bQ,bR){var bS;bS=(bP.get_DialogueQuestions())[0];bS.get_Name()!==bR?(((bl.Curried3(function(bT,bU,bV){return bT(bf.p$19(bU)+" at the top of the stack does not have the name "+bs.toSafe(bV)+".");}))(bm.FailWith))(bS))(bR):void 0;_4.popq(bP,bQ);bQ((function(bT){return function(bU){return bT("Cancel "+bf.p$19(bU)+".");};}(a.id))(bS));};_4.trigger=function(bP,bQ,bR,bS,bT){_4.pushu(bP,bQ,new F({$:0,$0:bH.stringify(bT),$1:{$:1,$0:new C({$:0,$0:bS,$1:{$:1,$0:1}})},$2:null,$3:null}));bR(bP);};_4.handle=function(bP,bQ,bR,bS){_4.popu(bP,bQ);bQ((function(bT){return function(bU){return bT("Handle utterance "+bs.toSafe(bU)+".");};}(a.id))(bR));bS();};_4.dispatch=function(bP,bQ,bR,bS){bQ(((((bl.Curried(function(bT,bU,bV,bW){return bT("Dispatch to module "+bs.toSafe(bU)+" utterances: "+bs.prettyPrint(bV)+" questions: "+bs.prettyPrint(bW)+".");},4))(a.id))(bR))(bP.get_Utterances()))(bP.get_DialogueQuestions()));bS(bP);};_4.popq=function(bP,bQ){var bR;bR=bP.get_DialogueQuestions().shift();bQ((function(bS){return function(bT){return bS("Pop "+bf.p$19(bT)+".");};}(a.id))(bR));};_4.pushq=function(bP,bQ,bR){bP.get_DialogueQuestions().unshift(bR);bQ((function(bS){return function(bT){return bS("Push "+bf.p$19(bT)+".");};}(a.id))(bR));};_4.popu=function(bP,bQ){var bR;bR=bP.get_Utterances().shift();bQ((function(bS){return function(bT){return bS("Pop "+bf.p$16(bT)+".");};}(a.id))(bR));};_4.pushu=function(bP,bQ,bR){bQ((function(bS){return function(bT){return bS("Push "+bf.p$16(bT)+".");};}(a.id))(bR));bP.get_Utterances().unshift(bR);};_4.remove=function(bP,bQ,bR){bQ((function(bS){return function(bT){return bS("Remove property "+bs.toSafe(bT)+".");};}(a.id))(bR));bP.get_Props().Remove(bR);};_4.add=function(bP,bQ,bR,bS){bP.get_Props().Add(bR,bS);bQ((((bl.Curried3(function(bT,bU,bV){return bT("Add property "+bs.toSafe(bU)+":"+bs.prettyPrint(bV)+".");}))(a.id))(bR))(bS));};_4.prop=function(bP,bQ){return bP.get_Props().ContainsKey(bQ)?bP.get_Props().get_Item(bQ):(function(bR){return function(bS){return bR("The "+bs.toSafe(bS)+" dialogue property does not exist.");};}(bm.FailWith))(bQ);};_4.have=function(bP,bQ){return bP.get_Props().ContainsKey(bQ);};_4["sayRandom'"]=function(bP,bQ){_4.sayRandom(bP,bQ,"");};_4.sayRandom=function(bP,bQ,bR){var bS;bS=z.getRandomPhrase(bQ,bR);bP.get_Output().unshift(bS);bP.get_Cui().Say(bS);};_4.say=function(bP,bQ){bP.get_Output().unshift(bQ);_4["say'"](bP,bQ);};_4["say'"]=function(bP,bQ){bP.get_Cui().Say(bQ);};_4.echo=function(bP,bQ){(bP.get_Cui())["EchoHtml'"](bQ);};_5.userAuthenticationDialogue=function(bP,bQ,bR,bS){var bT,bU,bV;function bW(b1){_4.say(bP,b1);}function bX(b1){b1.input="text";b1.showCancelButton=true;b1.confirmButtonText="Ok";}function bY(b1){b1.confirmButtonClass="invisible";b1.showCancelButton=true;}function bZ(){var b1;b1=d.createDialogueBoxCanvas();d.startCamera(self.document.body,b1);}function b0(b1){var b2,b3;b2=b1[0];b3=b1[1];d.questionBox("Biometric Authentication","",{$:1,$0:d.boxesWithTitles(["2","3"])},{$:1,$0:[640,480]},{$:1,$0:bX},{$:1,$0:bZ},function(b4){var b5,b6,b7,b8;b4.isConfirmed?(b5=bP.get_Cui().TypingDNA.getTypingPattern((b6={},b6.type=1,b6.text=bV,b6.caseSensitive=false,b6)),b7=b4.value,b8=d.getCameraCanvas().toDataURL(),bQ((function(b9){return function(b_){return b9("User image is "+bs.toSafe(b_)+"...");};}(a.id))(bv.Substring(b8,0,10))),d.stopCamera(),bQ((((bl.Curried3(function(b9,b_,b$){return b9("User entered typing pattern "+bs.toSafe(b_)+" for text "+bs.toSafe(b$));}))(a.id))(b5))(b7)),b7.toLowerCase()!==bV.toLowerCase()?(bW("Sorry you did not enter the passphrase correctly. Please try again."),b0([b2,b3])):d.questionBox("Biometric Authentication","",null,null,{$:1,$0:bY},{$:1,$0:function(){d.getDialogueBoxContent().appendChild(d.getMic());bP.get_Cui().AudioHandlers.Add("VoiceAuthentication",function(b9){bH.stringify(((bG.Id())())(b9));d.confirmQuestionBox();});}},function(b9){if(!b9.isConfirmed){bP.get_Cui().AudioHandlers.Remove("VoiceAuthentication");bW("OK but you must login for me to help you.");}})):bW("OK but you must login for me to help you.");});}bT=bR.get_Target();bU=bR.get_Name();bV=(function(b1){return function(b2){return b1("Hello my name is "+bs.toSafe(b2)+" and I am an administrator");};}(a.id))(bS);bW((function(b1){return function(b2){return b1("Enter the phrase "+bs.toSafe(b2)+".");};}(a.id))(bV));b0([0,[]]);};_6.ask=function(bP,bQ,bR){var bS;_4.pushq(bP,bQ,bR);(bR.get_Target())(bP);bS=bR.get_Type();bS.$==0?_5.userAuthenticationDialogue(bP,bQ,bR,bS.$0):void 0;};_7.update=function(bP){var bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co;function cp(cB){_4.say(bP,cB);}function cq(cB,cC){return _4.sayRandom(bP,cB,cC);}function cr(cB,cC){return _4.add(bP,function(cD){_7.debug(cD);},cB,cC);}function cs(cB){_7.debug(cB);}function ct(cB){_7.debug(cB);}function cu(cB){_7.debug(cB);}function cv(cB){return _4["User'_"](bP,cB);}function cw(cB,cC){return _4.Response_(bP,cB,cC);}function cx(cB,cC){return _4["Response'_"](bP,cB,cC);}function cy(cB){var cC;cq(z.waitRetrievePhrases(),"user name");bz.Start((cC=null,bz.Delay(function(){return bz.Bind((new bL.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-476535038",[cB]),function(cD){var cE;return cD==null?(cp((function(cF){return function(cG){return cF("I did not find a user with the name "+bs.toSafe(cG)+".");};}(a.id))(cB)),bT(new _2({$:0,$0:"addUser",$1:_7.name(),$2:_3.Verification,$3:null,$4:function(){cr("addUser",cB);cp((function(cF){return function(cG){return cF("Do you want me to add the user "+bs.toSafe(cG)+"?");};}(a.id))(cB));}})),bz.Zero()):(cE=cD.$0,(cr("user",cB),bz.Bind((new bL.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:-544214959",[cE.Name]),function(){cq(z.helloUserPhrases(),cE.Name);return cE.LastLoggedIn!=null?bz.Bind((new bL.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:990175070",[cE.LastLoggedIn.$0]),function(cF){cp((function(cG){return function(cH){return cG("You last logged in "+bs.toSafe(cH)+".");};}(a.id))(cF));return bz.Zero();}):bz.Zero();})));});})),null);}function cz(cB){var cC;bz.Start((cC=null,bz.Delay(function(){cq(z.waitAddPhrases(),"user");return bz.Bind((new bL.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:1365094546",[cB]),function(cD){return cD.$==1?(d.error((((bl.Curried3(function(cE,cF,cG){return cE("Error adding user "+bs.toSafe(cF)+":"+bs.toSafe(cG)+".");}))(a.id))(cB))(cD.$0)),cp((function(cE){return function(cF){return cE("Sorry I was not able to add the user "+bs.toSafe(cF)+" to the system.");};}(a.id))(cB)),bz.Zero()):(cr("user",cB),cp((function(cE){return function(cF){return cE("Hello "+bs.prettyPrint(cF)+", nice to meet you.");};}(a.id))(bQ.get_Item("user"))),bz.Zero());});})),null);}function cA(cB){return new _2({$:0,$0:"switchUser",$1:_7.name(),$2:_3.Verification,$3:null,$4:function(){cp((function(cC){return function(cD){return cC("Do you want me to switch to the user "+bs.toSafe(cD));};}(a.id))(cB));}});}_4.debugInterpreterStart(bP,function(cB){_7.debug(cB);},_7.name());bQ=bP.$1;bR=bl.Curried(_4.handle,2,[bP,cs]);bS=bl.Curried(_4.endt,2,[bP,ct]);bT=function(cB){_6.ask(bP,cu,cB);};bU=_4.frame(bP.$4);bU.$==1&&(bW=cv(bU.$0),bW!=null&&bW.$==1&&(bX=B.Intent$1("greet",bW.$0),bX!=null&&bX.$==1&&(bY=B.Entity1Of1("name",bX.$0[1]),bY!=null&&bY.$==1&&(bU.$1.$==0&&(bV=bY.$0,true)))))?(bR("loginUser"))(function(){cy(bV.get_Value());}):bU.$==1&&(b0=cv(bU.$0),b0!=null&&b0.$==1&&(b1=B.Intent$1("hello",b0.$0),b1!=null&&b1.$==1&&(b2=B.Entity1Of1("contact",b1.$0[1]),b2!=null&&b2.$==1&&(bU.$1.$==0&&(bZ=b2.$0,true)))))?(bR("loginUser"))(function(){cy(bZ.get_Value());}):bU.$==1&&(b4=cx("authenticateUser",bU.$0),b4!=null&&b4.$==1&&(b5=B.StrA(b4.$0[1]),b5!=null&&b5.$==1&&(bU.$1.$==0&&(b3=b5.$0,true))))?(bS("authenticateUser"))(function(){var cB;_7.debug(b3);bz.Start((cB=null,bz.Delay(function(){return bz.Bind((new bL.New()).Async("SMApp.Web:SMApp.Web.Server.hasFace:724442589",[bi.get(b3,2)]),function(cC){return cC?(cp("Face detected"),bz.Zero()):(cp(function(cD){return cD("Sorry I did not detect a face in the camera image. Make sure you can see the red square around your face in the camera window when you click the OK button.");}(a.id)),bz.Zero());});})),null);}):bU.$==1&&(b7=B.No(bU.$0),b7!=null&&b7.$==1&&(b8=cx("addUser",b7.$0),b8!=null&&b8.$==1&&(b9=B.PStr(b8.$0[2]),b9!=null&&b9.$==1&&(bU.$1.$==0&&(b6=b9.$0,true)))))?(bS("addUser"))(function(){cp((function(cB){return function(cC){return cB("Ok I did not add the user "+bs.toSafe(cC)+". But you must login for me to help you.");};}(a.id))(b6));}):bU.$==1&&(b$=B.Yes(bU.$0),b$!=null&&b$.$==1&&(ca=cx("addUser",b$.$0),ca!=null&&ca.$==1&&(cb=B.PStr(ca.$0[2]),cb!=null&&cb.$==1&&(bU.$1.$==0&&(b_=cb.$0,true)))))?(bS("addUser"))(function(){cz(b_);}):bU.$==1&&(cd=_4.User_(bP,bU.$0),cd!=null&&cd.$==1&&(ce=B.Intent$1("hello",cd.$0),ce!=null&&ce.$==1&&(ce.$0[0]==null&&(cf=B.Entity1Of1("name",ce.$0[1]),cf!=null&&cf.$==1&&(bU.$1.$==0&&(cc=cf.$0,true))))))?bz.Start((cg=null,bz.Delay(function(){return bz.Bind((new bL.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-476535038",[cc.get_Value()]),function(cB){return cB==null?(cp((function(cC){return function(cD){return cC("Sorry, the user "+bs.toSafe(cD)+" does not exist.");};}(a.id))(cc.get_Value())),bz.Zero()):(bT(cA(cB.$0.Name)),bz.Zero());});})),null):bU.$==1&&(ci=B.Yes(bU.$0),ci!=null&&ci.$==1&&(cj=cw("switchUser",ci.$0),cj!=null&&cj.$==1&&(ck=B.PStr(cj.$0[2]),ck!=null&&ck.$==1&&(bU.$1.$==0&&(ch=ck.$0,true)))))?(bQ.set_Item("user",ch),cp((function(cB){return function(cC){return cB("Ok I switched to user "+bs.prettyPrint(cC)+".");};}(a.id))(ch))):bU.$==1&&(cm=B.No(bU.$0),cm!=null&&cm.$==1&&(cn=cw("switchUser",cm.$0),cn!=null&&cn.$==1&&(co=B.PStr(cn.$0[2]),co!=null&&co.$==1&&(bU.$1.$==0&&(cl=co.$0,true)))))?cp((function(cB){return function(cC){return cB("Ok I did not switch to user "+bs.toSafe(cC)+".");};}(a.id))(cl)):_4.didNotUnderstand(bP,function(cB){_7.debug(cB);},_7.name());_4.debugInterpreterEnd(bP,function(cB){_7.debug(cB);},_7.name());};_7.debug=function(bP){d.debug(_7.name(),bP);};_7.name=function(){_8.$cctor();return _8.name;};_8.$cctor=function(){_8.$cctor=a.ignore;_8.name="User";};_9.update=function(bP){var bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5;function b6(ca){_4.say(bP,ca);}function b7(ca){return _4.prop(bP,ca);}function b8(ca,cb){return _4.add(bP,function(cc){_9.debug(cc);},ca,cb);}function b9(ca){return _4.User_(bP,ca);}function b_(){b7("journal_entry");}function b$(ca){var cb;cb=null;return bz.Delay(function(){return bz.Bind((new bL.New()).Async("SMApp.Web:SMApp.Web.Server.getTriples:-312873000",[ca]),function(cc){var cd;return cc.$==1?(b6((function(ce){return function(cf){return ce("I could not add your journal entry. The following error occurred: "+bs.prettyPrint(cf));};}(a.id))(cc.$0)),bz.Zero()):(cd=cc.$0,cd.get_Length()>0?(_9.debug((function(ce){return function(cf){return ce("Got "+a.String(cf)+" sentences from NLU server");};}(a.id))(cd.get_Length())),b8("journal_entry",[].concat(bi.ofSeq(cd)).reverse()),b_(),bz.Zero()):(b6(function(ce){return ce("Sorry I could not add an entry your journal entry.");}(a.id)),bz.Zero()));});});}_4.debugInterpreterStart(bP,function(ca){_9.debug(ca);},_9.name());bw.ofArray(["What do you feel about your day today and why?","Describe the place that makes you feel the calmest. Is there anything that could be added to make it even better?","What makes you feel like the best version of yourself?","What made you feel uneasy today?","What makes you feel sad and why?","What makes you feel happy and why?","What makes you feel angry and why?","What makes you feel safe and why?","I have trouble sleeping when\u2026"]);bQ=_4.frame(bP.$4);bQ.$==1&&(bS=b9(bQ.$0),bS!=null&&bS.$==1&&(bT=B.Intent$1("journal",bS.$0),bT!=null&&bT.$==1&&(bU=B.Entity1Of1("journal_entry",bT.$0[1]),bU!=null&&bU.$==1&&(bQ.$1.$==0&&(bR=bU.$0,true)))))?bz.Start((bV=null,bz.Delay(function(){b6("Ok I'll add that entry to your symptom journal.");return bz.Bind(b$(bR.get_Value()),function(){return bz.Return(null);});})),null):bQ.$==1&&(bX=B.Yes(bQ.$0),bX!=null&&bX.$==1&&((bY=_4.Response_(bP,"painVideo",bX.$0),bY!=null&&bY.$==1)&&bQ.$1.$==0))?bP.$0["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bQ.$==1&&(b0=b9(bQ.$0),b0!=null&&b0.$==1&&(b1=B.Intent$1("medjournal",b0.$0),b1!=null&&b1.$==1&&((b2=b1.$0[1],b2!=null&&b2.$==1)&&(bQ.$1.$==0&&(bZ=b1.$0[1].$0,true)))))?(b6("ok I added that entry to your medication journal."),b6("You should be careful not to take too many painkillers over a short period of time.")):bQ.$==1&&(b4=b9(bQ.$0),b4!=null&&b4.$==1&&((b5=B.Intent$1("kbquery",b4.$0),b5!=null&&b5.$==1)&&(bQ.$1.$==0&&(b3=b4.$0,true))))?void 0:_4.didNotUnderstand(bP,function(ca){_9.debug(ca);},_9.name());_4.debugInterpreterEnd(bP,function(ca){_9.debug(ca);},_9.name());};_9.debug=function(bP){d.debug(_9.name(),bP);};_9.name=function(){_.$cctor();return _.name;};_.$cctor=function(){_.$cctor=a.ignore;_.name="Journal";};$.update=function(bP){var bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5;function b6(ca){_4.say(bP,ca);}function b7(ca,cb){return _4.sayRandom(bP,ca,cb);}function b8(ca){return _4.prop(bP,ca);}function b9(ca){return _4.User_(bP,ca);}function b_(){return b8("user");}function b$(ca,cb,cc){var cd;return bz.Start((cd=null,bz.Delay(function(){b7(z.waitAddPhrases(),"symptom entry");return bz.Bind((new bL.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:162337456",[b_().Name,ca,cb,cc]),function(ce){return ce.$==1?(b6(function(cf){return cf("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),bz.Zero()):(b6((function(cf){return function(cg){return cf("OK I added that "+bs.toSafe(cg)+" symptom to your journal.");};}(a.id))(ca)),bz.Zero());});})),null);}_4.debugInterpreterStart(bP,function(ca){$.debug(ca);},$.name());bQ=_4.frame(bP.$4);bQ.$==1&&(bS=b9(bQ.$0),bS!=null&&bS.$==1&&(bT=B.Intent$1("symptom",bS.$0),bT!=null&&bT.$==1&&(bU=B.Entity1OfAny("symptom_name",bT.$0[1]),bU!=null&&bU.$==1&&(bQ.$1.$==0&&(bR=bU.$0,true)))))?bz.Start((bV=null,bz.Delay(function(){b6("Ok I'll add that entry to your symptom journal");b$(bR.get_Value(),null,null);return bz.Zero();})),null):bQ.$==1&&(bX=B.Yes(bQ.$0),bX!=null&&bX.$==1&&((bY=_4.Response_(bP,"painVideo",bX.$0),bY!=null&&bY.$==1)&&bQ.$1.$==0))?bP.$0["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bQ.$==1&&(b0=b9(bQ.$0),b0!=null&&b0.$==1&&(b1=B.Intent$1("medjournal",b0.$0),b1!=null&&b1.$==1&&((b2=b1.$0[1],b2!=null&&b2.$==1)&&(bQ.$1.$==0&&(bZ=b1.$0[1].$0,true)))))?(b6("ok I added that entry to your medication journal."),b6("You should be careful not to take too many painkillers over a short period of time.")):bQ.$==1&&(b4=b9(bQ.$0),b4!=null&&b4.$==1&&((b5=B.Intent$1("kbquery",b4.$0),b5!=null&&b5.$==1)&&(bQ.$1.$==0&&(b3=b4.$0,true))))?void 0:_4.didNotUnderstand(bP,function(ca){$.debug(ca);},$.name());_4.debugInterpreterEnd(bP,function(ca){$.debug(ca);},$.name());};$.debug=function(bP){d.debug($.name(),bP);};$.name=function(){ba.$cctor();return ba.name;};ba.$cctor=function(){ba.$cctor=a.ignore;ba.name="Symptoms";};bb.update=function(bP){var bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb;function cc(ch){_4.say(bP,ch);}function cd(ch){_4["sayRandom'"](bP,ch);}function ce(ch){bb.debug(ch);}function cf(ch){bb.debug(ch);}function cg(ch){return _4["User'_"](bP,ch);}bQ=bP.$4;bb.debug(((((bl.Curried(function(ch,ci,cj,ck){return ch("Module "+bs.toSafe(ci)+" starting utterances:"+bs.prettyPrint(cj)+", questions: "+bs.prettyPrint(ck)+".");},4))(a.id))(bb.name()))(bQ))(bP.$2));bR=bl.Curried(_4.dispatch,2,[bP,ce]);bS=bl.Curried(_4.handle,2,[bP,cf]);bT=_4.frame(bQ);bU=_4.Agenda_(bP,function(ch){bb.debug(ch);},_7.name(),bT);bU!=null&&bU.$==1?(bb.debug((function(ch){return function(ci){return ch("Agenda is "+bf.p$19(ci)+".");};}(a.id))((bP.get_DialogueQuestions())[0])),_7.update(bP)):bT.$==1&&(bW=(bX=_4.PropNotSet_(bP,"started",bT.$0),bX!=null&&bX.$==1?{$:1,$0:bX.$0}:null),bW!=null&&bW.$==1&&(bY=cg(bW.$0),bY!=null&&bY.$==1&&(bZ=B.Intent$1("greet",bY.$0),bZ!=null&&bZ.$==1&&(bZ.$0[1]==null&&bT.$1.$==0))))?(_4.add(bP,function(ch){bb.debug(ch);},"started",true),(bS("greet"))(function(){cd(z.helloPhrases());})):bT.$==1&&(b1=cg(bT.$0),b1!=null&&b1.$==1&&(b2=B.Intent$1("greet",b1.$0),b2!=null&&b2.$==1&&(b2.$0[1]==null&&bT.$1.$==0)))?(bS("greet"))(function(){cc("Hello, tell me your name to get started.");}):bT.$==1&&(b4=cg(bT.$0),b4!=null&&b4.$==1&&(b5=B.Intent$1("greet",b4.$0),b5!=null&&b5.$==1&&((b6=B.Entity1Of1("name",b5.$0[1]),b6!=null&&b6.$==1)&&bT.$1.$==0)))?(bR(_7.name()))(function(ch){_7.update(ch);}):bT.$==1&&(b8=cg(bT.$0),b8!=null&&b8.$==1&&(b9=B.Intent$1("hello",b8.$0),b9!=null&&b9.$==1&&((b_=B.Entity1Of1("contact",b9.$0[1]),b_!=null&&b_.$==1)&&bT.$1.$==0)))?(bR(_7.name()))(function(ch){_7.update(ch);}):bT.$==1&&(ca=_4.User_(bP,bT.$0),ca!=null&&ca.$==1&&((cb=B.Intent$1("journal",ca.$0),cb!=null&&cb.$==1)&&bT.$1.$==0))?(bR(_9.name()))(function(ch){_9.update(ch);}):_4.didNotUnderstand(bP,function(ch){bb.debug(ch);},bb.name());_4.debugInterpreterEnd(bP,function(ch){bb.debug(ch);},bb.name());};bb.debug=function(bP){d.debug(bb.name(),bP);};bb.name=function(){bc.$cctor();return bc.name;};bc.$cctor=function(){bc.$cctor=a.ignore;bc.name="Main";};bd.run=function(){var bP,bQ;bP=bl.ThisFunc(function(bR,bS){return((bd.Main().get_Text())(bR))(bS);});bQ=bd.Main().get_Options();a.$("#term").terminal(bP,bQ);return bo.get_Empty();};bd.Main=function(){be.$cctor();return be.Main;};bd.initMic=function(bP){var bQ,bR;bd.set_CUI((bQ={$:1,$0:new bM.Microphone(bN.getElementById("microphone"))},_0.New(bd.CUI().Voice,bQ,bd.CUI().Term,bd.CUI().Avatar,bd.CUI().Caption,bd.CUI().AudioHandlers,bd.CUI().TypingDNA)));bR=bd.CUI().Mic.$0;bR.onconnecting=function(){bd.set_MicState(X.MicConnecting);return bd.debug("Mic connecting...");};bR.ondisconnected=function(){bd.set_MicState(X.MicDisconnected);return bd.debug("Mic disconnected.");};bR.onaudiostart=function(){bd.set_MicState(X.MicAudioStart);return bd.debug("Mic audio start...");};bR.onaudioend=function(){var bS,bT,bU,bV;bd.debug("Mic audio end.");bT=bd.CUI().AudioHandlers;bS=bT.GetEnumerator$1();try{while(bS.MoveNext()){bU=bS.Current();bd.debug((function(bW){return function(bX){return bW("Executing audio handler "+bs.toSafe(bX)+".");};}(a.id))(bU.K));bd.set_MicState({$:7,$0:bU.K});bV=bU.V;bd.CUI().AudioHandlers.Remove(bU.K);bV(d.lastMicData());}return;}finally{bS.Dispose();}};bR.onerror=function(bS){bd.set_MicState({$:6,$0:bS});return bd.debug((function(bT){return function(bU){return bT("Mic error : "+bs.toSafe(bU)+".");};}(a.id))(bS));};bR.onready=function(){bd.set_MicState(X.MicReady);return bd.debug("Mic ready.");};bR.onresult=function(bS,bT){return bd.ClientState().$==2?bd.echo("I'm still trying to understand what you said before."):bd.ClientState().$==0?d.error("Client is not intialized."):bd.MicState().$==7?null:!(bS==null||bT==null)?(bd.set_MicState({$:8,$0:bS,$1:bT}),bd.debug((((bl.Curried3(function(bU,bV,bW){return bU("Mic result: "+bs.prettyPrint(bV)+" "+bs.prettyPrint(bW)+".");}))(a.id))(bS))(bT)),bP(bS,bT)):bd.debug("Mic: No result returned.");};bR.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};bd.sayRandom=function(bP,bQ){bd.say(z.getRandomPhrase(bQ,bP));};bd.say=function(bP){bd.Output().unshift(bP);bd["say'"](bP);};bd["say'"]=function(bP){bd.CUI().Say(bP);};bd.initSpeech=function(){var bP;bP=d.toArray(bd.synth().getVoices());bi.length(bP)>0?(bi.iter(function(bQ){if(bJ.Equals(bd.CUI().Voice,null)&&(bQ.name.indexOf("Microsoft Zira")!=-1||bQ.name.toLowerCase().indexOf("female")!=-1)){bd.set_CUI(_0.New({$:1,$0:bQ},bd.CUI().Mic,bd.CUI().Term,bd.CUI().Avatar,bd.CUI().Caption,bd.CUI().AudioHandlers,bd.CUI().TypingDNA));bd.debug((function(bR){return function(bS){return bR("Using browser speech synthesis voice "+bs.toSafe(bS)+".");};}(a.id))(bd.CUI().Voice.$0.name));}},bP),!bJ.Equals(bd.CUI().Voice,null)?(bd.CUI().Avatar.nativeVoice=true,bd.CUI().Avatar.nativeVoiceName=bd.CUI().Voice.$0.name,bd.debug((function(bQ){return function(bR){return bQ("Using browser speech synthesis voice "+bs.toSafe(bR)+".");};}(a.id))(bd.CUI().Voice.$0.name))):void 0):void 0;bJ.Equals(bd.CUI().Voice,null)?bd.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};bd.synth=function(){be.$cctor();return be.synth;};bd.push=function(bP){bd.Utterances().unshift(bP);return bd.Dialogue();};bd.Dialogue=function(){be.$cctor();return be.Dialogue;};bd.Utterances=function(){be.$cctor();return be.Utterances;};bd.Questions=function(){be.$cctor();return be.Questions;};bd.Output=function(){be.$cctor();return be.Output;};bd.Props=function(){be.$cctor();return be.Props;};bd.wait=function(bP){d["Terminal.Echo'"](bd.CUI().Term,"please wait");bd.CUI().Term.pause();bP();bd.CUI().Term.resume();};bd.debug=function(bP){d.debug("CLIENT",bP);};bd.echo=function(bP){d["Terminal.EchoHtml'"](bd.CUI().Term,(function(bQ){return function(bR){return bQ(bs.prettyPrint(bR));};}(a.id))(bP));};bd.ClientState=function(){be.$cctor();return be.ClientState;};bd.set_ClientState=function(bP){be.$cctor();be.ClientState=bP;};bd.MicState=function(){be.$cctor();return be.MicState;};bd.set_MicState=function(bP){be.$cctor();be.MicState=bP;};bd.CUI=function(){be.$cctor();return be.CUI;};bd.set_CUI=function(bP){be.$cctor();be.CUI=bP;};be.$cctor=function(){var bP,bQ,bR;be.$cctor=a.ignore;function bS(bU,bV){var bW,bX,bY,bZ,b0,b1,b2;bd.debug((((bl.Curried3(function(b3,b4,b5){return b3("Voice: "+bs.prettyPrint(b4)+" "+bs.prettyPrint(b5));}))(a.id))(bU))(bV));bW=(bX=G["Intent'"](bU,bV),bX!=null&&bX.$==1?{$:1,$0:bX.$0}:null);bY=(bZ=G["Trait'"](bV),bZ!=null&&bZ.$==1?{$:1,$0:bw.ofArray([bZ.$0])}:null);b0=(b1=G["Entity'$1"](bV),b1!=null&&b1.$==1?{$:1,$0:bw.ofArray([b1.$0])}:null);bW==null&&(bY==null&&b0==null)?void 0:(bd.debug(((((bl.Curried(function(b3,b4,b5,b6){return b3("Voice: "+bf.p(b4)+" "+bf.p$3(b5)+" "+bf.p$5(b6));},4))(a.id))(bW))(bY))(b0)),bb.update(bd.push(new F({$:0,$0:"",$1:bW,$2:bY,$3:b0}))));}function bT(bU,bV){var bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch;bd.set_CUI(_0.New(bd.CUI().Voice,bd.CUI().Mic,bU,bd.CUI().Avatar,bd.CUI().Caption,bd.CUI().AudioHandlers,bd.CUI().TypingDNA));if(bJ.Equals(bd.CUI().Mic,null))bd.initMic(bS);if(bJ.Equals(bd.CUI().Voice,null))bd.initSpeech();if(bd.ClientState().$===0)bd.set_ClientState(Y.ClientReady);cf=I.Blank(bV);if(cf!=null&&cf.$==1)return bd["say'"]("Tell me what you want me to do or ask me a question.");else{cg=I.Debug(bV);if(cg!=null&&cg.$==1){bd.debug((function(ci){return function(cj){return ci("Utterances: "+bs.prettyPrint(cj));};}(a.id))(bd.Utterances()));bd.debug((function(ci){return function(cj){return ci("Questions: "+bs.prettyPrint(cj));};}(a.id))(bd.Questions()));bW=bd.Props().GetEnumerator$1();try{while(bW.MoveNext()){ch=bW.Current();bd.debug((((bl.Curried3(function(ci,cj,ck){return ci(bs.toSafe(cj)+": "+bs.prettyPrint(ck));}))(a.id))(ch.K))(ch.V));}return;}finally{bW.Dispose();}}else{bX=I.DebugEntities(bV);return bX!=null&&bX.$==1?(bY=bX.$0,bd.CUI().Wait((bZ=null,bz.Delay(function(){return bz.Bind(v.disambiguate(bY),function(ci){return bz.For(ci,function(cj){bd.debug((function(ck){return function(cl){return ck(bg.p(cl));};}(a.id))(cj));return bz.Zero();});});})))):(b0=I.DebugTriples(bV),b0!=null&&b0.$==1?(b1=b0.$0,bd.CUI().Wait((b2=null,bz.Delay(function(){return bz.Bind((new bL.New()).Async("SMApp.Web:SMApp.Web.Server.getTriples:-312873000",[b1]),function(ci){return ci.$==1?(bd.debug(ci.$0),bz.Zero()):bz.For(ci.$0,function(cj){return bz.For(cj,function(ck){bd.debug((function(cl){return function(cm){return cl(bf.p$7(cm));};}(a.id))(ck));return bz.Zero();});});});})))):(b3=I.DebugEmotionalTraits(bV),b3!=null&&b3.$==1?(b4=b3.$0,bd.CUI().Wait((b5=null,bz.Delay(function(){return bz.Bind((new bL.New()).Async("SMApp.Web:SMApp.Web.Server.getEmotionalTraits:-146145254",[b4]),function(ci){return ci.$==1?(bd.debug(ci.$0),bz.Zero()):bz.For(ci.$0,function(cj){bd.debug((function(ck){return function(cl){return ck(bf.p$15(cl));};}(a.id))(cj));return bz.Zero();});});})))):(b6=I.Voices(bV),b6!=null&&b6.$==1?(b7=d.toArray(d.speechSynthesis().getVoices()),bd["say'"]((function(ci){return function(cj){return ci("There are currently "+a.String(cj)+" voices installed on this computer or device.");};}(a.id))(bi.length(b7))),bi.iteri(function(ci,cj){return bd["say'"](((((bl.Curried(function(ck,cl,cm,cn){return ck("Voice "+a.String(cl)+". Name: "+bs.toSafe(cm)+", Local: "+bs.prettyPrint(cn)+".");},4))(a.id))(ci))(cj.name))(cj.localService));},b7)):bd.ClientState().$==1?(b9=I.QuickHello(bV),(b9!=null&&b9.$==1?(b8=b9.$0,true):(b_=I.QuickHelp(bV),b_!=null&&b_.$==1?(b8=b_.$0,true):(b$=I.QuickYes(bV),b$!=null&&b$.$==1?(b8=b$.$0,true):(ca=I.QuickNo(bV),ca!=null&&ca.$==1?(b8=ca.$0,true):(cb=I.QuickNumber(bV),cb!=null&&cb.$==1&&(b8=cb.$0,true))))))?(bd.debug((function(ci){return function(cj){return ci("Quick Text: "+bf.p$16(cj)+".");};}(a.id))(b8)),bb.update(bd.push(b8)),bd.set_ClientState(Y.ClientReady)):(cc=I.JournalEntry(bV),cc!=null&&cc.$==1?(cd=cc.$0,bd.debug((function(ci){return function(cj){return ci("Journal entry: "+bf.p$16(cj)+".");};}(a.id))(cd)),bb.update(bd.push(cd)),bd.set_ClientState(Y.ClientReady)):bd.CUI().Wait((ce=null,bz.Delay(function(){bd.set_ClientState(Y.ClientUnderstand);I.getUtterance(bV,function(ci){var cj,ck;cj=I.HasUtterance(ci);cj!=null&&cj.$==1?(ck=cj.$0,bd.debug(((((bl.Curried(function(cl,cm,cn,co){return cl("Text: Intent: "+bf.p(cm)+", Traits: "+bf.p$3(cn)+", Entities: "+bf.p$5(co)+".");},4))(a.id))(ck.get_Intent()))(ck.get_Traits()))(ck.get_Entities())),bb.update(bd.push(ck))):(bd.debug("Text: Did not receive a meaning from the server."),bd["say'"]("Sorry I did not understand what you said."));});bd.set_ClientState(Y.ClientReady);return bz.Zero();}))))):bd.ClientState().$==0?d.error("Client is not initialized."):bd["say'"]("I'm still trying to understand what you said before."))));}}}be.CUI=_0.New(null,null,null,(bI.applicationId="4277115329081938617",bP=new a.SDKConnection(),bQ=new a.WebAvatar(),bQ.version=8.5,bQ.connection=bP,bQ.avatar="20926186",bQ.voice="cmu-slt",bQ.voiceMod="default",bQ.width=175,bQ.createBox(),bQ.addMessage(""),bQ.processMessages(0),bQ),false,new bO.New$5(),new a.TypingDNA());be.MicState=X.MicNotInitialized;be.ClientState=Y.ClientNotInitialzed;be.Props=new bO.New$5();be.Output=[];be.Questions=[];be.Utterances=[];be.Dialogue=new _1({$:0,$0:bd.CUI(),$1:bd.Props(),$2:bd.Questions(),$3:bd.Output(),$4:bd.Utterances()});be.synth=a.speechSynthesis;be.Main=new Z({$:0,$0:function(bU){return bS(bU[0],bU[1]);},$1:[function(bU){return function(bV){return bT(bU,bV);};},(bR={},bR.name="Main",bR.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bR.prompt=">",bR)]});};bf.p$17=function(bP){return bP==null?"null":"Some "+bf.p$14(bP.$0);};bf.p$18=function(bP){return bP.$==3?"ConceptCompletion":bP.$==2?"Disjunctive":bP.$==1?"Verification":"UserAuthentication "+bs.prettyPrint(bP.$0);};bg.p$3=function(bP){return"{"+("text = "+bs.prettyPrint(bP.text))+"; "+("intents = "+bs.printArray(function(bQ){return bg.p$4(bQ);},bP.intents))+"; "+("entities = "+bs.prettyPrint(bP.entities))+"; "+("traits = "+bs.prettyPrint(bP.traits))+"}";};bg.p$4=function(bP){return"{"+("id = "+bs.prettyPrint(bP.id))+"; "+("name = "+bs.prettyPrint(bP.name))+"; "+("confidence = "+bs.prettyPrint(bP.confidence))+"}";};bf.p$19=function(bP){return"Question ("+bs.prettyPrint(bP.$0)+", "+bs.prettyPrint(bP.$1)+", "+bf.p$18(bP.$2)+", "+bf.p$20(bP.$3)+", "+"<fun>"+")";};bf.p$20=function(bP){return bP==null?"null":"Some "+bs.printArray(bs.prettyPrint,bP.$0);};bf.p$2=function(bP){return bP==null?"null":"Some "+bs.prettyPrint(bP.$0);};bf.p$1=function(bP){return"Intent ("+bs.prettyPrint(bP.$0)+", "+bf.p$2(bP.$1)+")";};bf.p=function(bP){return bP==null?"null":"Some "+bf.p$1(bP.$0);};bf.p$4=function(bP){return"Trait ("+bs.prettyPrint(bP.$0)+", "+bs.prettyPrint(bP.$1)+", "+bf.p$2(bP.$2)+")";};bf.p$3=function(bP){return bP==null?"null":"Some "+bs.printList(function(bQ){return bf.p$4(bQ);},bP.$0);};bf.p$6=function(bP){return"Entity ("+bs.prettyPrint(bP.$0)+", "+bs.prettyPrint(bP.$1)+", "+bs.prettyPrint(bP.$2)+", "+bf.p$2(bP.$3)+")";};bf.p$5=function(bP){return bP==null?"null":"Some "+bs.printList(function(bQ){return bf.p$6(bQ);},bP.$0);};bg.p$1=function(bP){return"{"+("start = "+bs.prettyPrint(bP.start))+"; "+("end = "+bs.prettyPrint(bP.end))+"}";};bg.p$2=function(bP){return"{"+("start = "+bs.prettyPrint(bP.start))+"; "+("end = "+bs.prettyPrint(bP.end))+"}";};bg.p=function(bP){return"{"+("tokenFragment = "+bg.p$1(bP.tokenFragment))+"; "+("charFragment = "+bg.p$2(bP.charFragment))+"; "+("babelSynsetID = "+bs.prettyPrint(bP.babelSynsetID))+"; "+("DBpediaURL = "+bs.prettyPrint(bP.DBpediaURL))+"; "+("BabelNetURL = "+bs.prettyPrint(bP.BabelNetURL))+"; "+("score = "+bs.prettyPrint(bP.score))+"; "+("cohrenceScore = "+bs.prettyPrint(bP.cohrenceScore))+"; "+("globalScore = "+bs.prettyPrint(bP.globalScore))+"; "+("source = "+bs.prettyPrint(bP.source))+"}";};bf.p$10=function(bP){return"Relation ("+bs.prettyPrint(bP.$0)+", "+bs.prettyPrint(bP.$1)+", "+bs.prettyPrint(bP.$2)+")";};bf.p$9=function(bP){return bP.$==1?"Relation "+bf.p$10(bP.$0):"Subject "+bs.prettyPrint(bP.$0);};bf.p$11=function(bP){return"Verb "+bs.prettyPrint(bP.$0);};bf.p$8=function(bP){return"Relation ("+bf.p$9(bP.$0)+", "+bs.prettyPrint(bP.$1)+", "+bf.p$11(bP.$2)+")";};bf.p$14=function(bP){return bP.$==1?"Relation "+bf.p$10(bP.$0):"Object "+bs.prettyPrint(bP.$0);};bf.p$13=function(bP){return"Relation ("+bf.p$11(bP.$0)+", "+bs.prettyPrint(bP.$1)+", "+bf.p$14(bP.$2)+")";};bf.p$12=function(bP){return bP==null?"null":"Some "+bf.p$13(bP.$0);};bf.p$7=function(bP){return"Triple ("+bf.p$8(bP.$0)+", "+bf.p$12(bP.$1)+")";};bf.p$15=function(bP){return"EmotionalTrait ("+bs.prettyPrint(bP.$0)+", "+bs.printList(bs.prettyPrint,bP.$1)+", "+bs.prettyPrint(bP.$2)+")";};bf.p$16=function(bP){return"Utterance ("+bs.prettyPrint(bP.$0)+", "+bf.p(bP.$1)+", "+bf.p$3(bP.$2)+", "+bf.p$5(bP.$3)+")";};}());
