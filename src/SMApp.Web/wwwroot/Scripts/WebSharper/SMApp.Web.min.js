(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=c.TypingDNA=c.TypingDNA||{};i=h.Response=h.Response||{};j=c.Bs=c.Bs||{};k=b.NLU=b.NLU||{};l=k.Babelfy=k.Babelfy||{};m=l.ApiResponse=l.ApiResponse||{};n=l.TokenFragment=l.TokenFragment||{};o=l.CharFragment=l.CharFragment||{};p=k.Witai=k.Witai||{};q=p.Utterance=p.Utterance||{};r=p.Intent=p.Intent||{};s=p.Entity=p.Entity||{};t=p.Trait=p.Trait||{};u=p["Utterance'"]=p["Utterance'"]||{};v=p["Value'"]=p["Value'"]||{};w=k.QnAMaker=k.QnAMaker||{};x=w.ITSQuestion=w.ITSQuestion||{};y=w.ITSAnswerContext=w.ITSAnswerContext||{};z=w.ITSAnswer=w.ITSAnswer||{};A=w.ITSAnswers=w.ITSAnswers||{};B=c.NLG=c.NLG||{};C=a.StartupCode$SMApp_Web$NLG=a.StartupCode$SMApp_Web$NLG||{};D=c.NLU=c.NLU||{};E=D.Intent=D.Intent||{};F=D.Trait=D.Trait||{};G=D.Entity=D.Entity||{};H=D.Utterance=D.Utterance||{};I=D.Question=D.Question||{};J=D.QuestionType=D.QuestionType||{};K=D.Voice=D.Voice||{};L=K["Entity'"]=K["Entity'"]||{};M=D.Text=D.Text||{};N=M["Utterance'"]=M["Utterance'"]||{};O=M["Intent'"]=M["Intent'"]||{};P=M["Entity'"]=M["Entity'"]||{};Q=M["Trait'"]=M["Trait'"]||{};R=D.Domain=D.Domain||{};S=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};T=c.CUI=c.CUI||{};U=T.MicState=T.MicState||{};V=T.ClientState=T.ClientState||{};W=T.Interpreter=T.Interpreter||{};X=T.CUI=T.CUI||{};Y=c.Dialogue=c.Dialogue||{};Z=Y.Dialogue=Y.Dialogue||{};_0=c.User=c.User||{};_1=a.StartupCode$SMApp_Web$User=a.StartupCode$SMApp_Web$User||{};_2=c.Main=c.Main||{};_3=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};_4=c.Client=c.Client||{};_5=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};_6=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};_7=a.GeneratedPrintf=a.GeneratedPrintf||{};_8=a.IntelliFactory;_9=_8&&_8.Runtime;_=a.WebSharper;$=_&&_.Utils;ba=_&&_.UI;bb=ba&&ba.Doc;bc=ba&&ba.AttrProxy;bd=ba&&ba.Client;be=bd&&bd.Templates;bf=_&&_.Arrays;bg=a.console;bh=a.jQuery;bi=_&&_.Strings;bj=_&&_.List;bk=_&&_.Seq;bl=ba&&ba.AttrModule;bm=_&&_.Concurrency;bn=a.JSON;bo=_&&_.Random;bp=_&&_.Collections;bq=bp&&bp.Map;br=_&&_.JavaScript;bs=br&&br.Pervasives;bt=a.SDK;bu=_&&_.Operators;bv=_&&_.Remoting;bw=bv&&bv.AjaxRemotingProvider;bx=a.Wit;by=a.document;bz=_&&_.Unchecked;bA=bp&&bp.Dictionary;d.startCamera=function(bB,bC){return a.startCamera(bB,bC);};d.speechSynthesis=function(){return a.speechSynthesis;};d.lastMicData=function(){return a.lastMicData;};d.questionBox=function(bB,bC,bD,bE,bF){var bG,bH;(bG=a.Sweetalert2((bH={},bH.titleText=bB,bH.text=bC,bH.type="question",bH.html=(((_9.Curried3(function(bI,bJ,bK){return bI("<div style=\"width:"+$.toSafe(bJ)+";height:"+$.toSafe(bK)+"\"></div>");}))(a.id))(bD))(bE),bH.input="text",bH.confirmButtonText="Ok",bH)),bG).then(bF);};d.createCanvas=function(bB,bC,bD,bE){var bF;bF=bb.Element("canvas",[d.eid(bB),bc.Create("width",bC),bc.Create("height",bD)],[]);be.LoadLocalTemplates("");bb.Run(bE,bF);return bE.firstChild;};d.elementHTML=function(bB){return bB.innerHTML;};d.createElement=function(bB){var bC;bC=self.document.createElement("div");self.document.appendChild(bC);be.LoadLocalTemplates("");bb.RunAppend(bC,bB);};d.container=function(bB){return bb.Element("div",[d.cls("container")],bB);};d.dindex=function(bB){return bc.Create("data-index",a.String(bB));};d.cls=function(bB){return bc.Create("class",bB);};d.eid=function(bB){return bc.Create("id",bB);};d.termOutput=function(){return bf.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(bB){return bB.toLowerCase();};d.debug=function(bB,bC){d.info((((_9.Curried3(function(bD,bE,bF){return bD("DEBUG: "+$.toSafe(bE)+": "+$.prettyPrint(bF));}))(a.id))(bB.toUpperCase()))(bC));};d.error=function(bB){bg.error(bB);};d.info=function(bB){bg.info(bB);};d.jserror=function(bB){bh.error(bB);};d.toArray=function(bB){return bf.map(a.id,bh.makeArray(bB));};d["Terminal.EchoHtml'"]=function(bB,bC){bB.pause();bB.echo(bC,d.rawOpt());bB.resume();};d["Terminal.Echo'"]=function(bB,bC){bB.pause();bB.echo(bC);bB.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=_9.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(bB){function bC(bD){return function(bE){var bF,bG,bH,bI,bJ,bK,bL;bG=bi.replicate(bD," ");switch(bE.$==0?bE.$1.$==1?bE.$1.$0.$==2?bE.$1.$1.$==0?(bF=[bE.$1.$0.$0,bE.$0],1):(bF=[bE.$1,bE.$0],2):(bF=[bE.$1,bE.$0],2):(bF=[bE.$1,bE.$0],2):bE.$==2?(bF=bE.$0,3):(bF=[bE.$0,bE.$1],0)){case 0:return bF[0]+"=\""+bF[1]+"\"";case 1:bH=bF[1];return bG+"<"+bH+">"+bF[0]+"</"+bH+">\r\n";case 2:bI=bF[1];bJ=bj.partition(function(bM){return bM.$==1;},bF[0]);bK=bJ[1];bL=bJ[0];return bK.$==0?bG+"<"+bI+(bL.$===0?"":" "+bi.concat(" ",bj.ofSeq(bk.delay(function(){return bk.map(function(bM){return(bC(0))(bM);},bL);}))))+"/>\r\n":bG+"<"+bI+(bL.$===0?"":" "+bi.concat(" ",bj.ofSeq(bk.delay(function(){return bk.map(function(bM){return(bC(0))(bM);},bL);}))))+">\r\n"+bi.concat("",bj.ofSeq(bk.delay(function(){return bk.map(function(bM){return(bC(bD+1))(bM);},bK);})))+bG+"</"+bI+">\r\n";case 3:return bG+bF+"\r\n";}};}return(bC(0))(bB);};f.alt=function(bB){return new e({$:1,$0:"alt",$1:bB});};f.src=function(bB){return new e({$:1,$0:"src",$1:bB});};f.cls=function(bB){return new e({$:1,$0:"class",$1:bB});};f.str=function(bB){return e.toString(bB);};f.op_PercentEquals=function(bB,bC){return new e({$:1,$0:bB,$1:bC});};f.op_Splice=function(bB){var bC;return bj.ofArray([new e({$:2,$0:(bC=bB,a.String(bC))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(bB,bC){return new e({$:0,$0:bB,$1:bC});};g.$cctor=function(){var bB;g.$cctor=a.ignore;g.rawOpt=(bB={},bB.raw=true,bB);g.html=function(bC){return f.elem("html",bC);};g.head=function(bC){return f.elem("head",bC);};g.title=function(bC){return f.elem("title",bC);};g.style=function(bC){return f.elem("style",bC);};g.body=function(bC){return f.elem("body",bC);};g.div=function(bC){return f.elem("div",bC);};g.br=function(bC){return f.elem("br",bC);};g.section=function(bC){return f.elem("section",bC);};g.span=function(bC){return f.elem("span",bC);};g.table=function(bC){return f.elem("table",bC);};g.thead=function(bC){return f.elem("thead",bC);};g.tbody=function(bC){return f.elem("tbody",bC);};g.tfoot=function(bC){return f.elem("tfoot",bC);};g.img=function(bC){return f.elem("img",bC);};g.map=function(bC){return f.elem("map",bC);};g.area=function(bC){return f.elem("area",bC);};g.p=function(bC){return f.elem("p",bC);};g.a=function(bC){return f.elem("a",bC);};g.tr=function(bC){return f.elem("tr",bC);};g.td=function(bC){return f.elem("td",bC);};g.th=function(bC){return f.elem("th",bC);};g.ul=function(bC){return f.elem("ul",bC);};g.li=function(bC){return f.elem("li",bC);};g.h1=function(bC){return f.elem("h1",bC);};g.h2=function(bC){return f.elem("h1",bC);};g.h3=function(bC){return f.elem("h1",bC);};g.h4=function(bC){return f.elem("h1",bC);};g.strong=function(bC){return f.elem("strong",bC);};};i.New=function(bB,bC,bD,bE){return{name:bB,message:bC,message_code:bD,status:bE};};h.getSameTextTypingPattern=function(bB,bC){var bD;return bC.getTypingPattern((bD={type:1},bD.text=bB,bD.caseSensitive=true,bD));};j.Radio=function(bB,bC,bD,bE,bF){return bb.Element("div",new bj.T({$:1,$0:d.cls("radio"),$1:bC}),[bb.Element("label",bE,[bb.Radio(bF,true,bD),bb.TextNode(bB)])]);};j.checkbox=function(bB,bC,bD,bE,bF){return bb.Element("div",new bj.T({$:1,$0:d.cls("checkbox"),$1:bC}),[bb.Element("label",bE,[bb.CheckBox(bF,bD),bb.TextNode(bB)])]);};j.textArea=function(bB,bC,bD,bE,bF){return bb.Element("div",new bj.T({$:1,$0:d.cls("form-group"),$1:bC}),[bb.Element("label",bE,[bb.TextNode(bB)]),bb.InputArea(new bj.T({$:1,$0:d.cls("form-control"),$1:bF}),bD)]);};j.inputPassword=function(bB,bC,bD,bE,bF){return bb.Element("div",new bj.T({$:1,$0:d.cls("form-group"),$1:bC}),[bb.Element("label",bE,[bb.TextNode(bB)]),bb.PasswordBox(new bj.T({$:1,$0:d.cls("form-control"),$1:bF}),bD)]);};j.input=function(bB,bC,bD,bE,bF){return bb.Element("div",new bj.T({$:1,$0:d.cls("form-group"),$1:bC}),[bb.Element("label",bE,[bb.TextNode(bB)]),bb.Input([d.cls("form-control"),bF],bD)]);};j.btnSecondary=function(bB,bC,bD){return bb.Element("button",[d.eid(bB),d.cls("btn btn-secondary"),bl.Handler("click",bD)],[bb.TextNode(bC)]);};j.btnPrimary=function(bB,bC,bD){return bb.Element("button",[d.eid(bB),d.cls("btn btn-primary"),bl.Handler("click",bD)],[bb.TextNode(bC)]);};m.New=function(bB,bC,bD,bE,bF,bG,bH,bI,bJ){return{tokenFragment:bB,charFragment:bC,babelSynsetID:bD,DBpediaURL:bE,BabelNetURL:bF,score:bG,cohrenceScore:bH,globalScore:bI,source:bJ};};n.New=function(bB,bC){return{start:bB,end:bC};};o.New=function(bB,bC){return{start:bB,end:bC};};l.disambiguate=function(bB){function bC(bD,bE){var bF;bh.ajax((bF={},bF.url=(function(bG){return function(bH){return bG("https://babelfy.io/v1/disambiguate?text="+$.toSafe(bH)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bB),bF.type="GET",bF.success=function(bG){return bD(bG);},bF.error=function(bG){return bE(new a.Error(bG.responseText));},bF));}return bm.FromContinuations(function(bD,bE,bF){return bC.apply(null,[bD,bE,bF]);});};q.New=function(bB,bC,bD,bE){return{text:bB,intents:bC,entities:bD,traits:bE};};r.New=function(bB,bC,bD){return{id:bB,name:bC,confidence:bD};};s.New=function(bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL){return{id:bB,name:bC,role:bD,start:bE,end:bF,body:bG,confidence:bH,entities:bI,suggested:bJ,value:bK,type:bL};};t.New=function(bB,bC,bD){return{id:bB,value:bC,confidence:bD};};u.New=function(bB){return{intent:bB};};v.New=function(bB){return{value:bB};};p.getMeaning2=function(bB,bC){function bD(bE,bF){var bG;bh.ajax((bG={},bG.url=(function(bH){return function(bI){return bH("https://api.wit.ai/message?q="+$.toSafe(bI));};}(a.id))(bC),bG.type="GET",bG.beforeSend=function(bH){return bH.setRequestHeader("Authorization","Bearer "+bB);},bG.success=function(bH){return bE(bH);},bG.error=function(bH){return bF(new a.Error(bH.responseText));},bG));}return bm.FromContinuations(function(bE,bF,bG){return bD.apply(null,[bE,bF,bG]);});};p.getMeaning=function(bB,bC,bD,bE){var bF;bh.ajax((bF={},bF.url=(function(bG){return function(bH){return bG("https://api.wit.ai/message?q="+$.toSafe(bH));};}(a.id))(bC),bF.type="GET",bF.beforeSend=function(bG){return bG.setRequestHeader("Authorization","Bearer "+bB);},bF.success=bD,bF.error=bE,bF));};x.New=function(bB){return{question:bB};};y.New=function(bB,bC){return{isContextOnly:bB,prompts:bC};};z.New=function(bB,bC,bD,bE,bF,bG,bH){return{questions:bB,answer:bC,score:bD,id:bE,source:bF,metadata:bG,context:bH};};A.New=function(bB){return{answers:bB};};w.getAnswer=function(bB){function bC(bD,bE){var bF;bh.ajax((bF={},bF.url="https://lerna.azurewebsites.net/qnamaker/knowledgebases/13a6a026-942b-4612-a8cb-654086ec76ee/generateAnswer",bF.type="POST",bF.beforeSend=function(bG){return bG.setRequestHeader("Authorization","EndpointKey e5a55563-b1b0-4343-8796-bda5a0509385");},bF.contentType="application/json",bF.dataType="json",bF.data=bn.stringify(x.New(bB)),bF.success=function(bG){return bD(bG);},bF.error=function(bG){return bE(new a.Error(bG.responseText));},bF));}return bm.FromContinuations(function(bD,bE,bF){return bC.apply(null,[bD,bE,bF]);});};B.waitAddPhrases=function(){C.$cctor();return C.waitAddPhrases;};B.waitRetrievePhrases=function(){C.$cctor();return C.waitRetrievePhrases;};B.helpPhrases=function(){C.$cctor();return C.helpPhrases;};B.helloUserPhrases=function(){C.$cctor();return C.helloUserPhrases;};B.helloPhrases=function(){C.$cctor();return C.helloPhrases;};B["getRandomPhrase'"]=function(bB){return B.replace_tok("$0","",bk.nth(B.rng().Next(0,bB.get_Length()),bB));};B.getRandomPhrase=function(bB,bC){return B.replace_tok("$0",bC,bk.nth(B.rng().Next(0,bB.get_Length()),bB));};B.replace_tok=function(bB,bC,bD){return bi.Replace(bD,bB,bC);};B.rng=function(){C.$cctor();return C.rng;};C.$cctor=function(){C.$cctor=a.ignore;C.rng=new bo.New();C.helloPhrases=bj.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);C.helloUserPhrases=bj.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);C.helpPhrases=bj.ofArray(["What can I help you with $0?"]);C.waitRetrievePhrases=bj.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);C.waitAddPhrases=bj.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};E=D.Intent=_9.Class({toString:function(){return(((_9.Curried3(function(bB,bC,bD){return bB("Intent("+$.toSafe(bC)+", "+_6.p$2(bD)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,E);F=D.Trait=_9.Class({toString:function(){return(((_9.Curried3(function(bB,bC,bD){return bB("Trait("+$.toSafe(bC)+", "+$.prettyPrint(bD)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,F);G=D.Entity=_9.Class({toString:function(){return(((((_9.Curried(function(bB,bC,bD,bE,bF){return bB("Entity("+$.toSafe(bC)+", "+$.toSafe(bD)+", "+$.toSafe(bE)+", "+_6.p$2(bF)+")");},5))(a.id))(this.get_Name()))(this.get_Role()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$3;},get_Value:function(){return this.$2;},get_Role:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);H=D.Utterance=_9.Class({toString:function(){return((((_9.Curried(function(bB,bC,bD,bE){return bB(_6.p(bC)+" "+_6.p$3(bD)+" "+_6.p$5(bE));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bB;bB=this.$3;return bB!=null?{$:1,$0:bj.sortBy(function(bC){return bC.get_Name();},bB.$0)}:null;},get_Traits:function(){var bB;bB=this.$2;return bB!=null?{$:1,$0:bj.sortBy(function(bC){return bC.get_Name();},bB.$0)}:null;},get_Intent:function(){return this.$1;},get_Text:function(){return this.$0;}},null,H);I=D.Question=_9.Class({toString:function(){return(((((_9.Curried(function(bB,bC,bD,bE,bF){return bB("Name: "+$.toSafe(bC)+" Text: "+$.toSafe(bD)+" Type: "+_6.p$8(bE)+" Module: "+$.toSafe(bF));},5))(a.id))(this.get_Name()))(this.get_Text()))(this.get_Type()))(this.get_Module());},get_Module:function(){return this.$3;},get_Type:function(){return this.$2;},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,I);J.ConceptCompletion={$:3};J.Disjunctive={$:2};J.Verification={$:1};J.UserData={$:0};L.New=function(bB,bC,bD,bE,bF){return{body:bB,end:bC,start:bD,suggested:bE,value:bF};};K["Intent'"]=function(bB,bC){return!(bC.intent==null)?{$:1,$0:new E({$:0,$0:d.toLower(bC.intent.value),$1:null})}:null;};K["Trait'"]=function(bB){return!(bB.domain==null)?{$:1,$0:new F({$:0,$0:"domain",$1:d.toLower(bB.domain.value),$2:null})}:!(bB.dialogue_act==null)?{$:1,$0:new F({$:0,$0:"dialogue_act",$1:d.toLower(bB.dialogue_act.value),$2:null})}:null;};K["Entity'$1"]=function(bB){return!(bB.contact==null)?{$:1,$0:new G({$:0,$0:"contact",$1:"",$2:d.toLower(bB.contact.value),$3:null})}:null;};N=M["Utterance'"]=_9.Class({get_TopIntent:function(){return bj.head(bj.sortBy(function(bB){return bB.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$3;},get_Entities:function(){return this.$2;},get_Intents:function(){return this.$1;},get_Text:function(){return this.$0;}},null,N);O=M["Intent'"]=_9.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,O);P=M["Entity'"]=_9.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,P);Q=M["Trait'"]=_9.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,Q);M.HasUtterance=function(bB){var bC,bD,bE,bF,bG,bH;return bB!=null&&bB.$==1&&(bB.$0.$2.get_Length()>0&&(bC=[bB.$0.$2,bB.$0.$1,bB,bB.$0.$0,bB.$0.$3],true))?(bD=bC[0],(bE=bC[2],(bF=bC[4],(bG=bC[1].$==0?null:{$:1,$0:new E({$:0,$0:bE.$0.get_TopIntent().get_Name(),$1:{$:1,$0:bE.$0.get_TopIntent().get_Confidence()}})},(bH=bD.$==0?null:{$:1,$0:bj.map(function(bI){return new G({$:0,$0:bI.get_Name(),$1:d.toLower(bI.get_Role()),$2:bI.get_Value(),$3:{$:1,$0:bI.get_Confidence()}});},bj.filter(function(bI){return bI.get_Confidence()>M.entityConfidenceThreshold();},bD))},{$:1,$0:new H({$:0,$0:bC[3],$1:bG,$2:bF.$==0?null:{$:1,$0:bj.map(function(bI){return new F({$:0,$0:d.toLower(bI.get_Name()),$1:bI.get_Value(),$2:{$:1,$0:bI.get_Confidence()}});},bj.filter(function(bI){return bI.get_Confidence()>M.entityConfidenceThreshold();},bF))},$3:bH})}))))):null;};M.entityConfidenceThreshold=function(){S.$cctor();return S.entityConfidenceThreshold;};M.set_entityConfidenceThreshold=function(bB){S.$cctor();S.entityConfidenceThreshold=bB;};M.intentConfidenceThreshold=function(){S.$cctor();return S.intentConfidenceThreshold;};M.set_intentConfidenceThreshold=function(bB){S.$cctor();S.intentConfidenceThreshold=bB;};M.getUtterance2=function(bB){var bC;bC=null;return bm.Delay(function(){return bm.Bind(p.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bB),function(bD){d.debug("NLU",(function(bE){return function(bF){return bE("Wit.ai returned "+_7.p(bF)+" ");};}(a.id))(bD));return bm.Return(new N({$:0,$0:bB,$1:bj.ofArray(bf.map(function(bE){return new O({$:0,$0:bE.name,$1:bE.confidence});},bD.intents)),$2:bj.map(function(bE){return new P({$:0,$0:bE.name,$1:bE.confidence,$2:bE.role,$3:bE.value});},bj.ofSeq(bk.concat(bk.map(function(bE){return bE[1];},bq.ToSeq(bD.entities))))),$3:bj.ofSeq(bk.map(function(bE){var bF;bF=bE[1];return new Q({$:0,$0:bE[0],$1:bf.get(bF,0).confidence,$2:bf.get(bF,0).value});},bq.ToSeq(bD.traits)))}));});});};M.getUtterance=function(bB,bC){p.getMeaning("OOGDHEQL7JZRQASXN2N2GHFUKGO3SCNV",bB,function(bD){var bE,bF;d.debug("NLU",(function(bG){return function(bH){return bG("Wit.ai returned: "+$.prettyPrint(bH));};}(a.id))(bD));bE=!(bD.intents==null)?bj.ofArray(bf.map(function(bG){return new O({$:0,$0:bG.name,$1:bG.confidence});},bD.intents)):bj.T.Empty;bF=!(bD.traits==null)?bj.ofSeq(bk.concat(bj.map(function(bG){return bf.map(function(bH){return new Q({$:0,$0:bG,$1:bH.confidence,$2:bH.value});},bs.GetJS(bD.traits,[bG]));},bj.filter(function(bG){return!(bs.GetJS(bD.traits,[bG])==null);},M.trait_types())))):bj.T.Empty;return bC({$:1,$0:new N({$:0,$0:bB,$1:bE,$2:!(bD.entities==null)?bj.ofSeq(bk.concat(bj.map(function(bG){return bf.map(function(bH){return new P({$:0,$0:bH.name,$1:bH.confidence,$2:bH.role,$3:bH.value});},bs.GetJS(bD.entities,[bG]));},bj.filter(function(bG){return!(bs.GetJS(bD.entities,[bG])==null);},M.entity_types())))):bj.T.Empty,$3:bF})});},function(bD,bE,bF){d.error((((_9.Curried3(function(bG,bH,bI){return bG("Wit.ai returned: "+$.prettyPrint(bH)+" "+$.prettyPrint(bI));}))(a.id))(bE))(bF));return bC(null);});};M.trait_types=function(){S.$cctor();return S.trait_types;};M.entity_types=function(){S.$cctor();return S.entity_types;};M.QuickNumber=function(bB){var bC,bD,bE;return(bD=M.One(bB),bD!=null&&bD.$==1?(bC=bD.$0,true):(bE=M.Two(bB),bE!=null&&bE.$==1&&(bC=bE.$0,true)))?{$:1,$0:bC}:null;};M.Three=function(bB){var bC;return bB==="3"||bB==="three"?{$:1,$0:new H({$:0,$0:"three",$1:{$:1,$0:new E({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bj.ofArray([new G({$:0,$0:"wit/ordinal",$1:"",$2:"three",$3:{$:1,$0:1}})])}})}:null;};M.Two=function(bB){var bC;return bB==="2"||bB==="two"?{$:1,$0:new H({$:0,$0:"two",$1:{$:1,$0:new E({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bj.ofArray([new G({$:0,$0:"wit/ordinal",$1:"",$2:"two",$3:{$:1,$0:1}})])}})}:null;};M.One=function(bB){var bC;return bB==="1"||bB==="one"?{$:1,$0:new H({$:0,$0:"one",$1:{$:1,$0:new E({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bj.ofArray([new G({$:0,$0:"wit/ordinal",$1:"",$2:"one",$3:{$:1,$0:1}})])}})}:null;};M.QuickNo=function(bB){var bC;return bB==="no"||(bB==="nope"||(bB==="no way"||(bB==="nah"||(bB==="don't do it"||bB==="stop"))))?{$:1,$0:new H({$:0,$0:"no",$1:{$:1,$0:new E({$:0,$0:"reject",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};M.QuickYes=function(bB){var bC;return bB==="yes"||(bB==="ok"||(bB==="sure"||(bB==="yeah"||(bB==="yep"||(bB==="uh huh"||(bB==="go ahead"||bB==="go"))))))?{$:1,$0:new H({$:0,$0:"yes",$1:{$:1,$0:new E({$:0,$0:"verify",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};M.QuickHelp=function(bB){var bC;return bB==="help"||(bB==="help me"||(bB==="what's this?"||bB==="huh"))?{$:1,$0:new H({$:0,$0:"help",$1:{$:1,$0:new E({$:0,$0:"help",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};M.QuickHello=function(bB){var bC;return bB==="hello"||(bB==="hey"||(bB==="yo"||bB==="hi"))?{$:1,$0:new H({$:0,$0:"hello",$1:{$:1,$0:new E({$:0,$0:"greet",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};M.Voices=function(bB){return bB==="voices"?{$:1,$0:null}:null;};M.Debug=function(bB){return bB==="debug"?{$:1,$0:null}:null;};M.Blank=function(bB){return bB===""?{$:1,$0:null}:null;};R.Study=function(bB){return bB.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};D.Str=function(bB){var bC;return bB!=null&&bB.$==1&&(typeof bB.$0=="string"&&(bC=bB.$0,true))?{$:1,$0:bC}:null;};D.No=function(bB){var bC,bD;return(bD=D.Intent$1("reject",bB),bD!=null&&bD.$==1&&(bD.$0[0]==null&&(bD.$0[1]==null&&(bC=bB,true))))?{$:1,$0:bC}:null;};D.Yes=function(bB){var bC,bD;return(bD=D.Intent$1("verify",bB),bD!=null&&bD.$==1&&(bD.$0[0]==null&&(bD.$0[1]==null&&(bC=bB,true))))?{$:1,$0:bC}:null;};D.EntityManyofMany=function(bB,bC){return{$:1,$0:bq.OfArray(bf.ofSeq(bj.map(function(bD){return bj.exists(function(bE){return bE.get_Role()===bD;},bC)?[bD,{$:1,$0:bj.filter(function(bE){return bE.get_Role()===bD;},bC)}]:[bD,null];},bB)))};};D.EntityManyOf1=function(bB,bC){var bD;return bC!=null&&bC.$==1&&(bj.exists(function(bE){return bE.get_Role()===bB;},bC.$0)&&(bD=bC.$0,true))?{$:1,$0:bj.filter(function(bE){return bE.get_Role()===bB;},bD)}:null;};D.Entity1OfAny=function(bB,bC){var bD;return bC!=null&&bC.$==1&&(bj.exists(function(bE){return bE.get_Role()===bB;},bC.$0)&&(bD=bC.$0,true))?{$:1,$0:bj.head(bj.sortBy(function(bE){return bE.get_Role();},bj.filter(function(bE){return bE.get_Role()===bB;},bD)))}:null;};D.Entity1Of1=function(bB,bC){var bD;return bC!=null&&bC.$==1&&(bC.$0.$==1&&(bC.$0.$1.$==0&&(bC.$0.$0.get_Role()===bB&&(bD=bC.$0.$0,true))))?{$:1,$0:bD}:null;};D.Intent$1=function(bB,bC){return bC.get_Intent()!=null&&bC.get_Intent().$0.get_Name()===bB?{$:1,$0:[bC.get_Traits(),bC.get_Entities()]}:null;};S.$cctor=function(){S.$cctor=a.ignore;S.entity_types=bj.ofArray(["wit$contact:name","wit$datetime:datetime","term:subject","term:object","term:verb"]);S.trait_types=bj.ofArray(["domain","dialogue_act"]);S.intentConfidenceThreshold=0.85;S.entityConfidenceThreshold=0.85;};U.MicReady={$:5};U.MicAudioEnd={$:4};U.MicAudioStart={$:3};U.MicDisconnected={$:2};U.MicConnecting={$:1};U.MicNotInitialized={$:0};V.ClientUnderstand={$:2};V.ClientReady={$:1};V.ClientNotInitialzed={$:0};W=T.Interpreter=_9.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,W);X=T.CUI=_9.Class({GetSameTextTypingPattern:function(bB){return h.getSameTextTypingPattern(bB,this.TypingDNA);},SayVoices:function(){var bB,bC,bD;bB=this;bC=a.speechSynthesis.getVoices();!(bC==null)?(bD=d.toArray(bC),bB.Say((function(bE){return function(bF){return bE("There are currently "+a.String(bF)+" voices installed on this computer or device.");};}(a.id))(bf.length(bD))),bf.iteri(function(bE,bF){return bB.Say(((((_9.Curried(function(bG,bH,bI,bJ){return bG("Voice "+a.String(bH)+". Name: "+$.toSafe(bI)+", Local: "+$.prettyPrint(bJ)+".");},4))(a.id))(bE))(bF.name))(bF.localService));},bD)):void 0;},Wait:function(bB){this.Wait$1(function(){bm.Start(bB,null);});},Wait$1:function(bB){this["Echo'"]("please wait...");this.Term.pause();bB();this.Term.resume();},sayRandom:function(bB,bC){this.Say(B.getRandomPhrase(bB,bC));},SayAngry:function(bB){var bC,bD;bC=this;bm.Start((bD=null,bm.Delay(function(){return bm.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bt.chime(),bm.Zero()):bm.Zero(),bm.Delay(function(){a.addMessage(bC.Avatar,bB,"","");bC.Avatar.processMessages(0);return bm.Zero();}));})),null);},SayDoc:function(bB){var bC,bD,bE;bC=bf.get(bh(".terminal-output").get(),0).childNodes.length;bD=bb.Element("div",[d.cls("terminal-command"),d.dindex(bC+1)],[bB]);bE=d.termOutput();be.LoadLocalTemplates("");bb.RunAppend(bE,bD);},Say:function(bB){var bC,bD;bC=this;bm.Start((bD=null,bm.Delay(function(){return bm.Combine(a.speechSynthesis.speaking?(bt.chime(),bm.Zero()):bm.Zero(),bm.Delay(function(){bC.Avatar.addMessage(bB);bC.Avatar.processMessages(0);return bm.Zero();}));})),null);},Debug:function(bB,bC){d.debug(bB,bC);},"EchoHtml'":function(bB){var bC,bD;bC=(bD={},bD.raw=true,bD);this.Term.disable();this.Term.echo(bB,bC);this.Term.enable();},"Echo'":function(bB){this.Term.disable();this.Term.echo(bB);this.Term.enable();}},null,X);X.New=function(bB,bC,bD,bE,bF,bG,bH){return new X({Voice:bB,Mic:bC,Term:bD,Avatar:bE,Caption:bF,TypingDNA:bG,AudioEnd:bH});};Z=Y.Dialogue=_9.Class({get_Utterances:function(){return this.$4;},get_Output:function(){return this.$3;},get_DialogueQuestions:function(){return this.$2;},get_Props:function(){return this.$1;},get_Cui:function(){return this.$0;}},null,Z);Y["Response'_"]=function(bB,bC,bD,bE){var bF,bG,bH;return(bG=Y.PropNotSet_(bB,"user",bE),bG!=null&&bG.$==1&&(Y.haveQuestion(bC,bD)&&bB.get_DialogueQuestions().length>0&&(bB.get_DialogueQuestions())[0].get_Name()===bD&&(bF=bG.$0,true)))?Y.have(bB,bD)?(bH=bB.get_Props().get_Item(bD),(Y["delete"](bB,bD),{$:1,$0:[bF,{$:1,$0:bH}]})):{$:1,$0:[bF,null]}:null;};Y.Response_=function(bB,bC,bD,bE){var bF,bG,bH;return(bG=Y.PropSet_(bB,"user",bE),bG!=null&&bG.$==1&&(Y.haveQuestion(bC,bD)&&bB.get_DialogueQuestions().length>0&&(bB.get_DialogueQuestions())[0].get_Name()===bD&&(bF=bG.$0,true)))?Y.have(bB,bD)?(bH=bB.get_Props().get_Item(bD),(Y["delete"](bB,bD),{$:1,$0:[bF,{$:1,$0:bH}]})):{$:1,$0:[bF,null]}:null;};Y["User'_"]=function(bB,bC){var bD,bE;return(bE=Y.PropNotSet_(bB,"user",bC),bE!=null&&bE.$==1&&(bB.get_DialogueQuestions().length===0&&(bD=bE.$0,true)))?{$:1,$0:bD}:null;};Y.User_=function(bB,bC){var bD,bE;return(bE=Y.PropSet_(bB,"user",bC),bE!=null&&bE.$==1&&(bB.get_DialogueQuestions().length===0&&(bD=bE.$0,true)))?{$:1,$0:bD}:null;};Y.PropNotSet_=function(bB,bC,bD){return!Y.have(bB,bC)?{$:1,$0:bD}:null;};Y.PropSet_=function(bB,bC,bD){return Y.have(bB,bC)?{$:1,$0:bD}:null;};Y.Agenda_=function(bB,bC,bD){return bB.get_DialogueQuestions().length>0&&(bB.get_DialogueQuestions())[0].get_Module()===bC?{$:1,$0:null}:null;};Y.didNotUnderstand=function(bB,bC,bD){var bE;bC((function(bF){return function(bG){return bF($.toSafe(bG)+" interpreter did not understand utterance.");};}(a.id))(bD));Y.say(bB,"Sorry I didn't understand what you meant.");bB.get_DialogueQuestions().length>0?(bE=bk.nth(0,bB.get_DialogueQuestions()),Y.have(bB,bE.get_Name())?Y.say(bB,B.replace_tok("$0",bB.get_Props().get_Item(bE.get_Name()),bE.get_Text())):Y.say(bB,bE.get_Text())):void 0;};Y.dispatch=function(bB,bC,bD,bE){bC(((((_9.Curried(function(bF,bG,bH,bI){return bF("Dispatch to module "+$.toSafe(bG)+" utterances: "+$.prettyPrint(bH)+" questions: "+$.prettyPrint(bI)+".");},4))(a.id))(bD))(bB.get_Utterances()))(bB.get_DialogueQuestions()));bE(bB);};Y["handle'"]=function(bB,bC,bD,bE){Y.popt(bB);bC((function(bF){return function(bG){return bF("Turn end: "+$.toSafe(bG)+".");};}(a.id))(bD));bE();};Y.handle=function(bB,bC,bD,bE){Y.popu(bB);bC((function(bF){return function(bG){return bF("Handle: "+$.toSafe(bG)+".");};}(a.id))(bD));bE();};Y.ask=function(bB,bC,bD,bE,bF){var bG,bH;bG=Y.getQuestion(bC,bD).$0;Y.add(bB,bD,bE);Y.pushq(bB,bC,bD);bH=B.replace_tok("$0",bE,bG.get_Text());Y.say(bB,bH);bG.get_Type().$==0?d.questionBox("User Input","320px","240px",bH,function(bI){Y.pushu(bB,new H({$:0,$0:bI,$1:null,$2:null,$3:null}));bF(bB);}):void 0;};Y.popt=function(bB){Y.popu(bB);Y.popq(bB);};Y.pushq=function(bB,bC,bD){var bE;bE=Y.getQuestion(bC,bD);bE==null?(function(bF){return function(bG){return bF("No such question: "+$.toSafe(bG));};}(bu.FailWith))(bD):bB.get_DialogueQuestions().unshift(bE.$0);};Y.popq=function(bB){bB.get_DialogueQuestions().shift();};Y.popu=function(bB){bB.get_Utterances().shift();};Y.pushu=function(bB,bC){bB.get_Utterances().unshift(bC);};Y.haveQuestion=function(bB,bC){return bj.exists(function(bD){return bD.get_Name()===bC;},bB);};Y.getQuestion=function(bB,bC){return bk.tryFind(function(bD){return bD.get_Name()===bC;},bB);};Y.prop=function(bB,bC){return bB.get_Props().get_Item(bC);};Y["delete"]=function(bB,bC){bB.get_Props().Remove(bC);};Y.add=function(bB,bC,bD){bB.get_Props().Add(bC,bD);};Y.have=function(bB,bC){return bB.get_Props().ContainsKey(bC);};Y.question=function(bB,bC,bD,bE){return new I({$:0,$0:bC,$1:bD,$2:bE,$3:bB});};Y["sayRandom'"]=function(bB,bC){Y.sayRandom(bB,bC,"");};Y.sayRandom=function(bB,bC,bD){var bE;bE=B.getRandomPhrase(bC,bD);bB.get_Output().unshift(bE);bB.get_Cui().Say(bE);};Y.say=function(bB,bC){bB.get_Output().unshift(bC);Y["say'"](bB,bC);};Y["say'"]=function(bB,bC){bB.get_Cui().Say(bC);};Y.echo=function(bB,bC){(bB.get_Cui())["EchoHtml'"](bC);};_0.update=function(bB){var bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct;function cu(cK){Y.echo(bB,cK);}function cv(cK){Y.say(bB,cK);}function cw(cK,cL){return Y.sayRandom(bB,cK,cL);}function cx(cK,cL){return Y.add(bB,cK,cL);}function cy(cK){return Y.prop(bB,cK);}function cz(){return cy("user");}function cA(cK,cL,cM){return Y.ask(bB,_0.moduleQuestions(),cK,cL,cM);}function cB(cK){_0.debug(cK);}function cC(cK){return Y.User_(bB,cK);}function cD(cK){return Y["User'_"](bB,cK);}function cE(cK,cL){return Y.Response_(bB,_0.moduleQuestions(),cK,cL);}function cF(cK,cL){return Y["Response'_"](bB,_0.moduleQuestions(),cK,cL);}function cG(cK){var cL;cw(B.waitRetrievePhrases(),"user name");bm.Start((cL=null,bm.Delay(function(){return bm.Bind((new bw.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:1868958283",[cK]),function(cM){var cN;return cM==null?(cv((function(cO){return function(cP){return cO("I did not find a user with the name "+$.toSafe(cP)+".");};}(a.id))(cK)),cA("addUser",cK,function(cO){_0.update(cO);}),bm.Zero()):(cN=cM.$0,bm.Bind((new bw.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:1425723001",[cN.Name]),function(){cx("user",cN);cw(B.helloUserPhrases(),(function(cO){return function(cP){return cO($.prettyPrint(cP));};}(a.id))(bD.get_Item("user")));return cN.LastLoggedIn!=null?bm.Bind((new bw.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:148239048",[cN.LastLoggedIn.$0]),function(cO){cv((function(cP){return function(cQ){return cP("You last logged in "+$.toSafe(cQ)+".");};}(a.id))(cO));return bm.Zero();}):bm.Zero();}));});})),null);}function cH(cK,cL){var cM;return bm.Start((cM=null,bm.Delay(function(){cw(B.waitAddPhrases(),"user");return bm.Bind((new bw.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:1425723001",[cK]),function(cN){return cN.$==1?(cv((function(cO){return function(cP){return cO("Sorry I was not able to add the user "+$.toSafe(cP)+" to the system.");};}(a.id))(cK)),bm.Zero()):bm.Bind((new bw.New()).Async("SMApp.Web:SMApp.Web.Server.addUserTypingPattern:-56249556",[cK,cL]),function(cO){return cO.$==1?(cv((function(cP){return function(cQ){return cP("Sorry I was not able to add the user "+$.toSafe(cQ)+" to the system.");};}(a.id))(cK)),bm.Zero()):(cx("user",cK),cv((function(cP){return function(cQ){return cP("Hello "+$.prettyPrint(cQ)+", nice to meet you.");};}(a.id))(bD.get_Item("user"))),bm.Zero());});});})),null);}function cI(cK,cL,cM){var cN;return bm.Start((cN=null,bm.Delay(function(){cw(B.waitAddPhrases(),"symptom entry");return bm.Bind((new bw.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:-1944634735",[cz().Name,cK,cL,cM]),function(cO){return cO.$==1?(cv(function(cP){return cP("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),bm.Zero()):(cv((function(cP){return function(cQ){return cP("OK I added that "+$.toSafe(cQ)+" symptom to your journal.");};}(a.id))(cK)),bm.Zero());});})),null);}function cJ(cK){_0.debug(cK);}bC=bB.$4;bD=bB.$1;bE=bB.$2;bF=bB.$0;_0.debug((((_9.Curried3(function(cK,cL,cM){return cK("Starting utterances:"+$.prettyPrint(cL)+". Starting questions: "+$.prettyPrint(cM)+".");}))(a.id))(bC))(bE));bG=_9.Curried(Y["handle'"],2,[bB,cB]);bH=bj.ofSeq(bk.take(bC.length>=5?5:bC.length,bC));bH.$==1&&(bJ=cD(bH.$0),bJ!=null&&bJ.$==1&&(bK=D.Intent$1("greet",bJ.$0),bK!=null&&bK.$==1&&(bL=D.Entity1Of1("name",bK.$0[1]),bL!=null&&bL.$==1&&(bH.$1.$==0&&(bI=bL.$0,true)))))?((_9.Curried(Y.handle,2,[bB,cJ]))("loginUser"))(function(){cG(bI.get_Value());}):bH.$==1&&(bN=cF("inputPassPhrase",bH.$0),bN!=null&&bN.$==1&&(bO=D.Str(bN.$0[1]),bO!=null&&bO.$==1&&(bH.$1.$==0&&(bM=[bH.$0,bO.$0],true))))?(bP=bM[0],bQ=bM[1],(bG("addUser"))(function(){bF.TypingDNA.stop();cH(bQ,bF.GetSameTextTypingPattern(bP.get_Text()));})):bH.$==1&&(bS=D.Yes(bH.$0),bS!=null&&bS.$==1&&(bT=cF("addUser",bS.$0),bT!=null&&bT.$==1&&(bU=D.Str(bT.$0[1]),bU!=null&&bU.$==1&&(bH.$1.$==0&&(bR=bU.$0,true)))))?(bG("inputPassPhrase"))(function(){bF.TypingDNA.start();cA("inputPassPhrase",bR,function(cK){_0.update(cK);});}):bH.$==1&&(bW=D.No(bH.$0),bW!=null&&bW.$==1&&(bX=cF("addUser",bW.$0),bX!=null&&bX.$==1&&(bY=D.Str(bX.$0[1]),bY!=null&&bY.$==1&&(bH.$1.$==0&&(bV=bY.$0,true)))))?(bG("no"))(function(){cv((function(cK){return function(cL){return cK("Ok I did not add the user "+$.toSafe(cL)+". But you must login for me to help you.");};}(a.id))(bV));}):bH.$==1&&(b0=cC(bH.$0),b0!=null&&b0.$==1&&(b1=D.Intent$1("hello",b0.$0),b1!=null&&b1.$==1&&(b1.$0[0]==null&&(b2=D.Entity1Of1("name",b1.$0[1]),b2!=null&&b2.$==1&&(bH.$1.$==0&&(bZ=b2.$0,true))))))?bm.Start((b3=null,bm.Delay(function(){return bm.Bind((new bw.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:1868958283",[bZ.get_Value()]),function(cK){return cK==null?(cv((function(cL){return function(cM){return cL("Sorry, the user "+$.toSafe(cM)+" does not exist.");};}(a.id))(bZ.get_Value())),bm.Zero()):(cA("switchUser",cK.$0.Name,function(cL){_0.update(cL);}),bm.Zero());});})),null):bH.$==1&&(b5=D.Yes(bH.$0),b5!=null&&b5.$==1&&(b6=cE("switchUser",b5.$0),b6!=null&&b6.$==1&&(b7=D.Str(b6.$0[1]),b7!=null&&b7.$==1&&(bH.$1.$==0&&(b4=b7.$0,true)))))?(bD.set_Item("user",b4),cv((function(cK){return function(cL){return cK("Ok I switched to user "+$.prettyPrint(cL)+".");};}(a.id))(b4))):bH.$==1&&(b9=D.No(bH.$0),b9!=null&&b9.$==1&&(b_=cE("switchUser",b9.$0),b_!=null&&b_.$==1&&(b$=D.Str(b_.$0[1]),b$!=null&&b$.$==1&&(bH.$1.$==0&&(b8=b$.$0,true)))))?cv((function(cK){return function(cL){return cK("Ok I did not switch to user "+$.toSafe(cL)+".");};}(a.id))(b8)):bH.$==1&&(cb=cD(bH.$0),cb!=null&&cb.$==1?(cc=D.Intent$1("kbquery",cb.$0),cc!=null&&cc.$==1)?bH.$1.$==0&&(ca=cb.$0,true):(cd=cC(bH.$0),cd!=null&&cd.$==1&&((ce=D.Intent$1("kbquery",cd.$0),ce!=null&&ce.$==1)&&(bH.$1.$==0&&(ca=cd.$0,true)))):(cf=cC(bH.$0),cf!=null&&cf.$==1&&((cg=D.Intent$1("kbquery",cf.$0),cg!=null&&cg.$==1)&&(bH.$1.$==0&&(ca=cf.$0,true)))))?bm.Start((ch=null,bm.Delay(function(){return bm.Bind(w.getAnswer(ca.get_Text()),function(cK){var cL;return bm.Bind((cL=bf.get(cK.answers,0).answer,(new bw.New()).Async("SMApp.Web:SMApp.Web.Server.mdtohtml:-971011443",[cL])),function(cM){var cN;return bm.Bind((cN=bf.get(cK.answers,0).answer,(new bw.New()).Async("SMApp.Web:SMApp.Web.Server.mdtotext:-971011443",[cN])),function(cO){cu(cM);cv(cO);return bm.Zero();});});});})),null):bH.$==1&&(cj=cC(bH.$0),cj!=null&&cj.$==1&&(ck=D.Intent$1("symptom",cj.$0),ck!=null&&ck.$==1&&(cl=D.Entity1OfAny("symptom_name",ck.$0[1]),cl!=null&&cl.$==1&&(bH.$1.$==0&&(ci=cl.$0,true)))))?bm.Start((cm=null,bm.Delay(function(){cv("Ok I'll add that entry to your symptom journal");cI(ci.get_Value(),null,null);return bm.Zero();})),null):bH.$==1&&(co=D.Yes(bH.$0),co!=null&&co.$==1&&((cp=cE("painVideo",co.$0),cp!=null&&cp.$==1)&&bH.$1.$==0))?bF["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bH.$==1&&(cr=cC(bH.$0),cr!=null&&cr.$==1&&(cs=D.Intent$1("medjournal",cr.$0),cs!=null&&cs.$==1&&((ct=cs.$0[1],ct!=null&&ct.$==1)&&(bH.$1.$==0&&(cq=cs.$0[1].$0,true)))))?(cv("ok I added that entry to your medication journal."),cv("You should be careful not to take too many painkillers over a short period of time.")):Y.didNotUnderstand(bB,function(cK){_0.debug(cK);},_0.name());_0.debug((((_9.Curried3(function(cK,cL,cM){return cK("Ending utterances: "+$.prettyPrint(cL)+". Ending questions:"+$.prettyPrint(cM)+".");}))(a.id))(bC))(bE));};_0.haveQuestion=function(bB){return function(bC){return Y.haveQuestion(_0.moduleQuestions(),bC);};};_0.getQuestion=function(bB){return function(bC){return Y.getQuestion(_0.moduleQuestions(),bC);};};_0.moduleQuestions=function(){_1.$cctor();return _1.moduleQuestions;};_0.debug=function(bB){d.debug(_0.name(),bB);};_0.name=function(){_1.$cctor();return _1.name;};_1.$cctor=function(){_1.$cctor=a.ignore;_1.name="User";_1.moduleQuestions=bj.ofArray([new I({$:0,$0:"inputPassPhrase",$1:"Please type the phrase My name is {firstname} {lastname}",$2:J.UserData,$3:_0.name()}),new I({$:0,$0:"addUser",$1:"Do you want me to add the user $0?",$2:J.Verification,$3:_0.name()}),new I({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?",$2:J.Verification,$3:_0.name()})]);};_2.update=function(bB){var bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS;function bT(bY){Y.say(bB,bY);}function bU(bY){Y["sayRandom'"](bB,bY);}function bV(bY){_2.debug(bY);}function bW(bY){return Y["User'_"](bB,bY);}function bX(bY){_2.debug(bY);}bC=bB.$4;bD=bB.$2;_2.debug((((_9.Curried3(function(bY,bZ,b0){return bY("Starting utterances:"+$.prettyPrint(bZ)+". Starting questions: "+$.prettyPrint(b0)+".");}))(a.id))(bC))(bD));bE=_9.Curried(Y.handle,2,[bB,bV]);bF=bj.ofSeq(bk.take(bC.length>=5?5:bC.length,bC));bG=Y.Agenda_(bB,_0.name(),bF);bG!=null&&bG.$==1?_0.update(bB):bF.$==1&&(bI=(bJ=Y.PropNotSet_(bB,"started",bF.$0),bJ!=null&&bJ.$==1?{$:1,$0:bJ.$0}:null),bI!=null&&bI.$==1&&(bK=bW(bI.$0),bK!=null&&bK.$==1&&(bL=D.Intent$1("greet",bK.$0),bL!=null&&bL.$==1&&(bL.$0[1]==null&&bF.$1.$==0))))?(Y.add(bB,"started",true),(bE("Hello"))(function(){bU(B.helloPhrases());})):bF.$==1&&(bN=bW(bF.$0),bN!=null&&bN.$==1&&(bO=D.Intent$1("greet",bN.$0),bO!=null&&bO.$==1&&(bO.$0[1]==null&&bF.$1.$==0)))?(bE("Hello"))(function(){bT("Hello, tell me your name to get started.");}):bF.$==1&&(bQ=bW(bF.$0),bQ!=null&&bQ.$==1&&(bR=D.Intent$1("greet",bQ.$0),bR!=null&&bR.$==1&&((bS=D.Entity1Of1("name",bR.$0[1]),bS!=null&&bS.$==1)&&bF.$1.$==0)))?((_9.Curried(Y.dispatch,2,[bB,bX]))(_0.name()))(function(bY){_0.update(bY);}):Y.didNotUnderstand(bB,function(bY){_2.debug(bY);},_2.name());_2.debug((((_9.Curried3(function(bY,bZ,b0){return bY("Ending utterances: "+$.prettyPrint(bZ)+". Ending questions:"+$.prettyPrint(b0)+".");}))(a.id))(bC))(bD));};_2.haveQuestion=function(bB){return bj.exists(function(bC){return bC.get_Name()===bB;},_2.moduleQuestions());};_2.getQuestion=function(bB){return bk.tryFind(function(bC){return bC.get_Name()===bB;},_2.moduleQuestions());};_2.moduleQuestions=function(){_3.$cctor();return _3.moduleQuestions;};_2.debug=function(bB){d.debug(_2.name(),bB);};_2.name=function(){_3.$cctor();return _3.name;};_3.$cctor=function(){_3.$cctor=a.ignore;_3.name="Main";_3.moduleQuestions=bj.T.Empty;};_4.run=function(){var bB,bC;bB=_9.ThisFunc(function(bD,bE){return((_4.Main().get_Text())(bD))(bE);});bC=_4.Main().get_Options();a.$("#term").terminal(bB,bC);return bb.get_Empty();};_4.Main=function(){_5.$cctor();return _5.Main;};_4.initMic=function(bB){var bC,bD;_4.set_CUI((bC={$:1,$0:new bx.Microphone(by.getElementById("microphone"))},X.New(_4.CUI().Voice,bC,_4.CUI().Term,_4.CUI().Avatar,_4.CUI().Caption,_4.CUI().TypingDNA,_4.CUI().AudioEnd)));bD=_4.CUI().Mic.$0;bD.onconnecting=function(){_4.set_MicState(U.MicConnecting);return _4.debug("Mic connecting...");};bD.ondisconnected=function(){_4.set_MicState(U.MicDisconnected);return _4.debug("Mic disconnected.");};bD.onaudiostart=function(){_4.set_MicState(U.MicAudioStart);return _4.debug("Mic audio start...");};bD.onaudioend=function(){_4.set_MicState(U.MicAudioEnd);_4.debug("Mic audio end.");return _4.debug(self.lastMicData);};bD.onerror=function(bE){_4.set_MicState({$:6,$0:bE});return _4.debug((function(bF){return function(bG){return bF("Mic error : "+$.toSafe(bG)+".");};}(a.id))(bE));};bD.onready=function(){_4.set_MicState(U.MicReady);return _4.debug("Mic ready.");};bD.onresult=function(bE,bF){return _4.ClientState().$==2?_4.echo("I'm still trying to understand what you said before."):_4.ClientState().$==0?d.error("Client is not intialized."):!(bE==null||bF==null)?(_4.set_MicState({$:7,$0:bE,$1:bF}),_4.debug((((_9.Curried3(function(bG,bH,bI){return bG("Mic result: "+$.prettyPrint(bH)+" "+$.prettyPrint(bI)+".");}))(a.id))(bE))(bF)),bB(bE,bF)):_4.debug("Mic: No result returned.");};bD.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};_4.sayRandom=function(bB,bC){_4.say(B.getRandomPhrase(bC,bB));};_4.say=function(bB){_4.Output().unshift(bB);_4["say'"](bB);};_4["say'"]=function(bB){_4.CUI().Say(bB);};_4.initSpeech=function(){var bB;bB=d.toArray(_4.synth().getVoices());bf.length(bB)>0?(bf.iter(function(bC){if(bz.Equals(_4.CUI().Voice,null)&&(bC.name.indexOf("Microsoft Zira")!=-1||bC.name.toLowerCase().indexOf("female")!=-1)){_4.set_CUI(X.New({$:1,$0:bC},_4.CUI().Mic,_4.CUI().Term,_4.CUI().Avatar,_4.CUI().Caption,_4.CUI().TypingDNA,_4.CUI().AudioEnd));_4.debug((function(bD){return function(bE){return bD("Using browser speech synthesis voice "+$.toSafe(bE)+".");};}(a.id))(_4.CUI().Voice.$0.name));}},bB),!bz.Equals(_4.CUI().Voice,null)?(_4.CUI().Avatar.nativeVoice=true,_4.CUI().Avatar.nativeVoiceName=_4.CUI().Voice.$0.name,_4.debug((function(bC){return function(bD){return bC("Using browser speech synthesis voice "+$.toSafe(bD)+".");};}(a.id))(_4.CUI().Voice.$0.name))):void 0):void 0;bz.Equals(_4.CUI().Voice,null)?_4.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};_4.synth=function(){_5.$cctor();return _5.synth;};_4.push=function(bB){_4.Utterances().unshift(bB);return _4.Dialogue();};_4.Dialogue=function(){_5.$cctor();return _5.Dialogue;};_4.Utterances=function(){_5.$cctor();return _5.Utterances;};_4.Questions=function(){_5.$cctor();return _5.Questions;};_4.Output=function(){_5.$cctor();return _5.Output;};_4.Props=function(){_5.$cctor();return _5.Props;};_4.wait=function(bB){d["Terminal.Echo'"](_4.CUI().Term,"please wait");_4.CUI().Term.pause();bB();_4.CUI().Term.resume();};_4.debug=function(bB){d.debug("CLIENT",bB);};_4.echo=function(bB){d["Terminal.EchoHtml'"](_4.CUI().Term,(function(bC){return function(bD){return bC($.prettyPrint(bD));};}(a.id))(bB));};_4.ClientState=function(){_5.$cctor();return _5.ClientState;};_4.set_ClientState=function(bB){_5.$cctor();_5.ClientState=bB;};_4.MicState=function(){_5.$cctor();return _5.MicState;};_4.set_MicState=function(bB){_5.$cctor();_5.MicState=bB;};_4.CUI=function(){_5.$cctor();return _5.CUI;};_4.set_CUI=function(bB){_5.$cctor();_5.CUI=bB;};_5.$cctor=function(){var bB,bC,bD,bE;_5.$cctor=a.ignore;function bF(bH,bI){var bJ,bK,bL,bM,bN,bO,bP;_4.debug((((_9.Curried3(function(bQ,bR,bS){return bQ("Voice: "+$.prettyPrint(bR)+" "+$.prettyPrint(bS));}))(a.id))(bH))(bI));bJ=(bK=K["Intent'"](bH,bI),bK!=null&&bK.$==1?{$:1,$0:bK.$0}:null);bL=(bM=K["Trait'"](bI),bM!=null&&bM.$==1?{$:1,$0:bj.ofArray([bM.$0])}:null);bN=(bO=K["Entity'$1"](bI),bO!=null&&bO.$==1?{$:1,$0:bj.ofArray([bO.$0])}:null);bJ==null&&(bL==null&&bN==null)?void 0:(_4.debug(((((_9.Curried(function(bQ,bR,bS,bT){return bQ("Voice: "+_6.p(bR)+" "+_6.p$3(bS)+" "+_6.p$5(bT));},4))(a.id))(bJ))(bL))(bN)),_2.update(_4.push(new H({$:0,$0:"",$1:bJ,$2:bL,$3:bN}))));}function bG(bH,bI){var bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU;_4.set_CUI(X.New(_4.CUI().Voice,_4.CUI().Mic,bH,_4.CUI().Avatar,_4.CUI().Caption,_4.CUI().TypingDNA,_4.CUI().AudioEnd));bz.Equals(_4.CUI().Mic,null)?_4.initMic(bF):void 0;bz.Equals(_4.CUI().Voice,null)?_4.initSpeech():void 0;_4.ClientState().$===0?_4.set_ClientState(V.ClientReady):void 0;return(bJ=M.Blank(bI),bJ!=null&&bJ.$==1)?_4["say'"]("Tell me what you want me to do or ask me a question."):(bK=M.Debug(bI),bK!=null&&bK.$==1)?(_4.debug((function(bV){return function(bW){return bV("Utterances: "+$.prettyPrint(bW));};}(a.id))(_4.Utterances())),_4.debug((function(bV){return function(bW){return bV("Questions: "+$.prettyPrint(bW));};}(a.id))(_4.Questions())),_4.debug(d.lastMicData()),d.questionBox("resr","rest","640px","480px",a.ignore),bL=d.createCanvas("c1","640","480",bf.get(bh(".swal2-content").get(),0).firstChild),d.startCamera(self.document.body,bL)):(bM=M.Voices(bI),bM!=null&&bM.$==1)?(bN=d.toArray(d.speechSynthesis().getVoices()),(_4["say'"]((function(bV){return function(bW){return bV("There are currently "+a.String(bW)+" voices installed on this computer or device.");};}(a.id))(bf.length(bN))),bf.iteri(function(bV,bW){return _4["say'"](((((_9.Curried(function(bX,bY,bZ,b0){return bX("Voice "+a.String(bY)+". Name: "+$.toSafe(bZ)+", Local: "+$.prettyPrint(b0)+".");},4))(a.id))(bV))(bW.name))(bW.localService));},bN))):_4.ClientState().$==1?(bP=M.QuickHello(bI),bP!=null&&bP.$==1?(bO=bP.$0,true):(bQ=M.QuickHelp(bI),bQ!=null&&bQ.$==1?(bO=bQ.$0,true):(bR=M.QuickYes(bI),bR!=null&&bR.$==1?(bO=bR.$0,true):(bS=M.QuickNo(bI),bS!=null&&bS.$==1?(bO=bS.$0,true):(bT=M.QuickNumber(bI),bT!=null&&bT.$==1&&(bO=bT.$0,true))))))?(_4.debug((function(bV){return function(bW){return bV("Quick Text: "+_6.p$7(bW)+".");};}(a.id))(bO)),_2.update(_4.push(bO)),_4.set_ClientState(V.ClientReady)):_4.CUI().Wait((bU=null,bm.Delay(function(){_4.set_ClientState(V.ClientUnderstand);M.getUtterance(bI,function(bV){var bW,bX;bW=M.HasUtterance(bV);bW!=null&&bW.$==1?(bX=bW.$0,_4.debug(((((_9.Curried(function(bY,bZ,b0,b1){return bY("Text: Intent: "+_6.p(bZ)+", Traits: "+_6.p$3(b0)+", Entities: "+_6.p$5(b1)+".");},4))(a.id))(bX.get_Intent()))(bX.get_Traits()))(bX.get_Entities())),_2.update(_4.push(bX))):(_4.debug("Text: Did not receive a meaning from the server."),_4["say'"]("Sorry I did not understand what you said."));});_4.set_ClientState(V.ClientReady);return bm.Zero();}))):_4.ClientState().$==0?d.error("Client is not initialized."):_4["say'"]("I'm still trying to understand what you said before.");}_5.CUI=X.New(null,null,null,(bt.applicationId="4277115329081938617",bB=new a.SDKConnection(),bC=new a.WebAvatar(),bC.version=8.5,bC.connection=bB,bC.avatar="20926186",bC.voice="cmu-slt",bC.voiceMod="default",bC.width=175,bC.createBox(),bC.addMessage(""),bC.processMessages(0),bC),false,(bD=new a.TypingDNA(),(bD.stop(),bD)),[]);_5.MicState=U.MicNotInitialized;_5.ClientState=V.ClientNotInitialzed;_5.Props=new bA.New$5();_5.Output=[];_5.Questions=[];_5.Utterances=[];_5.Dialogue=new Z({$:0,$0:_4.CUI(),$1:_4.Props(),$2:_4.Questions(),$3:_4.Output(),$4:_4.Utterances()});_5.synth=a.speechSynthesis;_5.Main=new W({$:0,$0:function(bH){return bF(bH[0],bH[1]);},$1:[function(bH){return function(bI){return bG(bH,bI);};},(bE={},bE.name="Main",bE.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bE.prompt=">",bE)]});};_6.p$8=function(bB){return bB.$==3?"ConceptCompletion":bB.$==2?"Disjunctive":bB.$==1?"Verification":"UserData";};_7.p=function(bB){return"{"+("text = "+$.prettyPrint(bB.text))+"; "+("intents = "+$.printArray(function(bC){return _7.p$1(bC);},bB.intents))+"; "+("entities = "+$.prettyPrint(bB.entities))+"; "+("traits = "+$.prettyPrint(bB.traits))+"}";};_7.p$1=function(bB){return"{"+("id = "+$.prettyPrint(bB.id))+"; "+("name = "+$.prettyPrint(bB.name))+"; "+("confidence = "+$.prettyPrint(bB.confidence))+"}";};_6.p$2=function(bB){return bB==null?"null":"Some "+$.prettyPrint(bB.$0);};_6.p$1=function(bB){return"Intent ("+$.prettyPrint(bB.$0)+", "+_6.p$2(bB.$1)+")";};_6.p=function(bB){return bB==null?"null":"Some "+_6.p$1(bB.$0);};_6.p$4=function(bB){return"Trait ("+$.prettyPrint(bB.$0)+", "+$.prettyPrint(bB.$1)+", "+_6.p$2(bB.$2)+")";};_6.p$3=function(bB){return bB==null?"null":"Some "+$.printList(function(bC){return _6.p$4(bC);},bB.$0);};_6.p$6=function(bB){return"Entity ("+$.prettyPrint(bB.$0)+", "+$.prettyPrint(bB.$1)+", "+$.prettyPrint(bB.$2)+", "+_6.p$2(bB.$3)+")";};_6.p$5=function(bB){return bB==null?"null":"Some "+$.printList(function(bC){return _6.p$6(bC);},bB.$0);};_6.p$7=function(bB){return"Utterance ("+$.prettyPrint(bB.$0)+", "+_6.p(bB.$1)+", "+_6.p$3(bB.$2)+", "+_6.p$5(bB.$3)+")";};}());
