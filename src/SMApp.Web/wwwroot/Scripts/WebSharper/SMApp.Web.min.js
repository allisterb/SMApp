(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=b.Bootstrap=b.Bootstrap||{};i=h.Controls=h.Controls||{};j=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};k=c.NLU=c.NLU||{};l=k.Intent=k.Intent||{};m=k.Trait=k.Trait||{};n=k.Entity=k.Entity||{};o=k.Meaning=k.Meaning||{};p=k.Voice=k.Voice||{};q=p["Entity'"]=p["Entity'"]||{};r=k.Text=k.Text||{};s=r["Meaning'"]=r["Meaning'"]||{};t=r["Intent'"]=r["Intent'"]||{};u=r["Entity'"]=r["Entity'"]||{};v=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};w=c.CUI=c.CUI||{};x=w.User=w.User||{};y=w.Interpreter=w.Interpreter||{};z=w.CUI=w.CUI||{};A=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};B=c.Main=c.Main||{};C=c.Client=c.Client||{};D=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};E=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};F=a.WebSharper;G=F&&F.Strings;H=F&&F.Arrays;I=a.jQuery;J=F&&F.Utils;K=a.console;L=a.IntelliFactory;M=L&&L.Runtime;N=F&&F.List;O=F&&F.Seq;P=F&&F.UI;Q=P&&P.Doc;R=P&&P.AttrModule;S=F&&F.Concurrency;T=F&&F.Random;U=F&&F.Remoting;V=U&&U.AjaxRemotingProvider;W=a.Wit;X=a.document;Y=F&&F.Unchecked;d.replace_tok=function(Z,_0,_1){return G.Replace(_1,Z,_0);};d.toLower=function(Z){return Z.toLowerCase();};d.toArray=function(Z){return H.map(a.id,I.makeArray(Z));};d.debug=function(Z){var _0;d.info((function(_1){return function(_2){return _1("DEBUG: "+J.toSafe(_2));};}(a.id))((_0=Z,a.String(_0))));};d.error=function(Z){K.error(Z);};d.info=function(Z){K.info(Z);};d.jserror=function(Z){I.error(Z);};d["Terminal.EchoHtml'"]=function(Z,_0){Z.disable();Z.echo(_0,d.rawOpt());Z.enable();};d["Terminal.Echo'"]=function(Z,_0){Z.disable();Z.echo(_0);Z.enable();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=M.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(Z){function _0(_1){return function(_2){var _3,_4,_5,_6,_7,_8,_9;_4=G.replicate(_1," ");switch(_2.$==0?_2.$1.$==1?_2.$1.$0.$==2?_2.$1.$1.$==0?(_3=[_2.$1.$0.$0,_2.$0],1):(_3=[_2.$1,_2.$0],2):(_3=[_2.$1,_2.$0],2):(_3=[_2.$1,_2.$0],2):_2.$==2?(_3=_2.$0,3):(_3=[_2.$0,_2.$1],0)){case 0:return _3[0]+"=\""+_3[1]+"\"";case 1:_5=_3[1];return _4+"<"+_5+">"+_3[0]+"</"+_5+">\r\n";case 2:_6=_3[1];_7=N.partition(function(_){return _.$==1;},_3[0]);_8=_7[1];_9=_7[0];return _8.$==0?_4+"<"+_6+(_9.$===0?"":" "+G.concat(" ",N.ofSeq(O.delay(function(){return O.map(function(_){return(_0(0))(_);},_9);}))))+"/>\r\n":_4+"<"+_6+(_9.$===0?"":" "+G.concat(" ",N.ofSeq(O.delay(function(){return O.map(function(_){return(_0(0))(_);},_9);}))))+">\r\n"+G.concat("",N.ofSeq(O.delay(function(){return O.map(function(_){return(_0(_1+1))(_);},_8);})))+_4+"</"+_6+">\r\n";case 3:return _4+_3+"\r\n";}};}return(_0(0))(Z);};f.alt=function(Z){return new e({$:1,$0:"alt",$1:Z});};f.src=function(Z){return new e({$:1,$0:"src",$1:Z});};f.cls=function(Z){return new e({$:1,$0:"class",$1:Z});};f.str=function(Z){return e.toString(Z);};f.op_PercentEquals=function(Z,_0){return new e({$:1,$0:Z,$1:_0});};f.op_Splice=function(Z){var _0;return N.ofArray([new e({$:2,$0:(_0=Z,a.String(_0))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(Z,_0){return new e({$:0,$0:Z,$1:_0});};g.$cctor=function(){var Z;g.$cctor=a.ignore;g.rawOpt=(Z={},Z.raw=true,Z);g.html=function(_0){return f.elem("html",_0);};g.head=function(_0){return f.elem("head",_0);};g.title=function(_0){return f.elem("title",_0);};g.style=function(_0){return f.elem("style",_0);};g.body=function(_0){return f.elem("body",_0);};g.div=function(_0){return f.elem("div",_0);};g.br=function(_0){return f.elem("br",_0);};g.section=function(_0){return f.elem("section",_0);};g.span=function(_0){return f.elem("span",_0);};g.table=function(_0){return f.elem("table",_0);};g.thead=function(_0){return f.elem("thead",_0);};g.tbody=function(_0){return f.elem("tbody",_0);};g.tfoot=function(_0){return f.elem("tfoot",_0);};g.img=function(_0){return f.elem("img",_0);};g.map=function(_0){return f.elem("map",_0);};g.area=function(_0){return f.elem("area",_0);};g.p=function(_0){return f.elem("p",_0);};g.a=function(_0){return f.elem("a",_0);};g.tr=function(_0){return f.elem("tr",_0);};g.td=function(_0){return f.elem("td",_0);};g.th=function(_0){return f.elem("th",_0);};g.ul=function(_0){return f.elem("ul",_0);};g.li=function(_0){return f.elem("li",_0);};g.h1=function(_0){return f.elem("h1",_0);};g.h2=function(_0){return f.elem("h1",_0);};g.h3=function(_0){return f.elem("h1",_0);};g.h4=function(_0){return f.elem("h1",_0);};g.strong=function(_0){return f.elem("strong",_0);};};i.Radio=function(Z,_0,_1,_2,_3){return Q.Element("div",new N.T({$:1,$0:(i.cls())("radio"),$1:_0}),[Q.Element("label",_2,[Q.Radio(_3,true,_1),Q.TextNode(Z)])]);};i.Checkbox=function(Z,_0,_1,_2,_3){return Q.Element("div",new N.T({$:1,$0:(i.cls())("checkbox"),$1:_0}),[Q.Element("label",_2,[Q.CheckBox(_3,_1),Q.TextNode(Z)])]);};i.TextArea=function(Z,_0,_1,_2,_3){return Q.Element("div",new N.T({$:1,$0:(i.cls())("form-group"),$1:_0}),[Q.Element("label",_2,[Q.TextNode(Z)]),Q.InputArea(new N.T({$:1,$0:(i.cls())("form-control"),$1:_3}),_1)]);};i.InputPassword=function(Z,_0,_1,_2,_3){return Q.Element("div",new N.T({$:1,$0:(i.cls())("form-group"),$1:_0}),[Q.Element("label",_2,[Q.TextNode(Z)]),Q.PasswordBox(new N.T({$:1,$0:(i.cls())("form-control"),$1:_3}),_1)]);};i.Input=function(Z,_0,_1,_2,_3){return Q.Element("div",new N.T({$:1,$0:(i.cls())("form-group"),$1:_0}),[Q.Element("label",_2,[Q.TextNode(Z)]),Q.Input(new N.T({$:1,$0:(i.cls())("form-control"),$1:_3}),_1)]);};i.Container=function(Z){return Q.Element("div",[(i.cls())("container")],Z);};i.Class=function(){j.$cctor();return j.Class;};i.cls=function(){j.$cctor();return j.cls;};j.$cctor=function(){j.$cctor=a.ignore;j.cls=R.Class;j.Class=R.Class;};l=k.Intent=M.Class({toString:function(){return(((M.Curried3(function(Z,_0,_1){return Z("Intent("+J.toSafe(_0)+", "+E.p$2(_1)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,l);m=k.Trait=M.Class({toString:function(){return(((M.Curried3(function(Z,_0,_1){return Z("Trait("+J.toSafe(_0)+", "+J.prettyPrint(_1)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,m);n=k.Entity=M.Class({toString:function(){return((((M.Curried(function(Z,_0,_1,_2){return Z("Entity("+J.toSafe(_0)+", "+J.toSafe(_1)+", "+E.p$2(_2)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[2];},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,n);o=k.Meaning=M.Class({toString:function(){return((((M.Curried(function(Z,_0,_1,_2){return Z(E.p(_0)+" "+E.p$3(_1)+". "+E.p$5(_2));},4))(a.id))(this.get_Intent()))(this.get_Trait()))(this.get_Entities());},get_Entities:function(){return(this.Unwrap())[2];},get_Trait:function(){return(this.Unwrap())[1];},get_Intent:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,o);q.New=function(Z,_0,_1,_2,_3){return{body:Z,end:_0,start:_1,suggested:_2,value:_3};};p["Intent'"]=function(Z,_0){return!(_0.intent==null)?{$:1,$0:new l({$:0,$0:d.toLower(_0.intent.value),$1:null})}:null;};p["Trait'"]=function(Z){return!(Z.greetings==null)?{$:1,$0:new m({$:0,$0:"greetings",$1:d.toLower(Z.contact.value)})}:null;};p["Entity'$1"]=function(Z){return!(Z.contact==null)?{$:1,$0:new n({$:0,$0:"contact",$1:d.toLower(Z.contact.value),$2:null})}:null;};s=r["Meaning'"]=M.Class({get_TopIntent:function(){return N.head(N.sortBy(function(Z){return Z.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,s);t=r["Intent'"]=M.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,t);u=r["Entity'"]=M.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,u);r.HasMeaning=function(Z){var _0,_1,_2,_3,_4,_5;return Z!=null&&Z.$==1&&(Z.$0.$0.$==0&&(Z.$0.$1.get_Length()>0&&(_0=Z.$0.$1,true)))?{$:1,$0:new o({$:0,$0:null,$1:null,$2:{$:1,$0:N.map(function(_6){return new n({$:0,$0:d.toLower(_6.get_Role()),$1:_6.get_Value(),$2:{$:1,$0:_6.get_Confidence()}});},N.filter(function(_6){return _6.get_Confidence()>r.entityConfidenceThreshold();},_0))}})}:Z!=null&&Z.$==1&&(Z.$0.$1.$==0&&(Z.$0.get_TopIntent().get_Confidence()>r.intentConfidenceThreshold()&&(_1=[Z.$0.$0,Z],true)))?(_2=_1[1],{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(_2.$0.get_TopIntent().get_Name()),$1:{$:1,$0:_2.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):Z!=null&&Z.$==1&&(Z.$0.get_TopIntent().get_Confidence()>r.intentConfidenceThreshold()&&(_3=[Z.$0.$1,Z.$0.$0,Z],true))?(_4=_3[2],(_5=N.map(function(_6){return new n({$:0,$0:d.toLower(_6.get_Role()),$1:_6.get_Value(),$2:{$:1,$0:_6.get_Confidence()}});},N.filter(function(_6){return _6.get_Confidence()>r.entityConfidenceThreshold();},_4.$0.get_Entities())),{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(_4.$0.get_TopIntent().get_Name()),$1:{$:1,$0:_4.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:_5}})})):null;};r.entityConfidenceThreshold=function(){v.$cctor();return v.entityConfidenceThreshold;};r.set_entityConfidenceThreshold=function(Z){v.$cctor();v.entityConfidenceThreshold=Z;};r.intentConfidenceThreshold=function(){v.$cctor();return v.intentConfidenceThreshold;};r.set_intentConfidenceThreshold=function(Z){v.$cctor();v.intentConfidenceThreshold=Z;};r.QuickPrograms=function(Z){return Z==="programs"?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};r.QuickHelp=function(Z){var _0;return Z==="help"||(Z==="help me"||(Z==="what's this?"||Z==="huh"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"help",$1:null})},$1:null,$2:null})}:null;};r.QuickHello=function(Z){var _0;return Z==="hello"||(Z==="hey"||(Z==="yo"||Z==="hi"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"hello",$1:null})},$1:null,$2:null})}:null;};r.DebugOff=function(Z){return Z==="debug off"?{$:1,$0:null}:null;};r.DebugOn=function(Z){return Z==="debug on"?{$:1,$0:null}:null;};r.Blank=function(Z){return Z===""?{$:1,$0:null}:null;};v.$cctor=function(){v.$cctor=a.ignore;v.intentConfidenceThreshold=0.85;v.entityConfidenceThreshold=0.85;};x.New=function(Z){return{Name:Z};};y=w.Interpreter=M.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,y);z=w.CUI=M.Class({get_StopSpeaking:function(){if(a.speechSynthesis.speaking||a.speechSynthesis.pending)a.speechSynthesis.cancel();},SayVoices:function(){var Z,_0,_1;Z=this;_0=a.speechSynthesis.getVoices();!(_0==null)?(_1=d.toArray(_0),Z.Say((function(_2){return function(_3){return _2("There are currently "+a.String(_3)+" voices installed on this computer or device.");};}(a.id))(H.length(_1))),H.iteri(function(_2,_3){return Z.Say(((((M.Curried(function(_4,_5,_6,_7){return _4("Voice "+a.String(_5)+". Name: "+J.toSafe(_6)+", Local: "+J.prettyPrint(_7)+".");},4))(a.id))(_2))(_3.name))(_3.localService));},_1)):void 0;},Wait:function(Z){this.Wait$1(function(){S.Start(Z,null);});},Wait$1:function(Z){this["Echo'"]("please wait...");this.Term.pause();Z();this.Term.resume();},sayRandom:function(Z,_0){this.Say(w.getRandomPhrase(Z,_0));},Say:function(Z){var _0,_1,_2;_0=this.Voice;_0!=null&&_0.$==1?(_1=_0.$0,S.Start((_2=null,S.Delay(function(){var _3;_3=new a.SpeechSynthesisUtterance(Z);_3.voice=_1;a.speechSynthesis.speak(_3);return S.Zero();})),null),this.Caption?this["Echo'"](Z):void 0):this["Echo'"](Z);},Debug:function(Z){d.debug(Z);this.DebugMode?this["EchoHtml'"](Z):void 0;},"EchoHtml'":function(Z){var _0,_1;_0=(_1={},_1.raw=true,_1);this.Term.disable();this.Term.echo(Z,_0);this.Term.enable();},"Echo'":function(Z){this.Term.disable();this.Term.echo(Z);this.Term.enable();}},null,z);z.New=function(Z,_0,_1,_2,_3){return new z({Voice:Z,Mic:_0,Term:_1,DebugMode:_2,Caption:_3});};w.helloUserPhrases=function(){A.$cctor();return A.helloUserPhrases;};w.helloPhrases=function(){A.$cctor();return A.helloPhrases;};w.waitRetrievePhrases=function(){A.$cctor();return A.waitRetrievePhrases;};w.getRandomPhrase=function(Z,_0){return d.replace_tok("$0",_0,O.nth(w.rng().Next(0,Z.get_Length()),Z));};w.rng=function(){A.$cctor();return A.rng;};A.$cctor=function(){A.$cctor=a.ignore;A.rng=new T.New();A.waitRetrievePhrases=N.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);A.helloPhrases=N.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);A.helloUserPhrases=N.ofArray(["Hi $0, welcome back.","Welcome $0, nice to see you again..","Hello $0","Good to see you $0."]);};B.update=function(Z,_0){var _1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bh,bi,bj,bk;function bg(bl){Z.Say(bl);}bh=_0.length>=5?5:_0.length;B.debug((function(bl){return function(bm){return bl("Current context: "+J.prettyPrint(bm)+".");};}(a.id))(_0));bi=N.ofSeq(O.take(bh,_0));if(bi.$==1&&((_2=B.Intent("hello",bi.$0.$0),_2!=null&&_2.$==1)&&(bi.$0.$1==null&&(bi.$0.$2==null&&bi.$1.$==0))))Z.Say(function(bl){return bl("Hello. My name is Selma. What's yours?");}(a.id));else if(bi.$==1&&((_4=B.Intent("hello",bi.$0.$0),_4!=null&&_4.$==1)?bi.$0.$1==null?(_5=bi.$0.$2,_5!=null&&_5.$==1)&&(bi.$0.$2.$0.$==1&&(_6=B.Entity("contact",bi.$0.$2.$0.$0),_6!=null&&_6.$==1?bi.$0.$2.$0.$1.$==0&&(bi.$1.$==1?(_7=B.Intent("hello",bi.$1.$0.$0),_7!=null&&_7.$==1)&&(bi.$1.$0.$1==null&&(bi.$1.$0.$2==null&&(bi.$1.$1.$==0&&(_8=B.Entity("contact",bi.$0.$2.$0.$0),_8!=null&&_8.$==1&&(_3=_8.$0,true))))):(_3=_6.$0,true)):(_9=B.Entity("contact",bi.$0.$2.$0.$0),_9!=null&&_9.$==1&&(bi.$0.$2.$0.$1.$==0&&(bi.$1.$==1&&((_=B.Intent("hello",bi.$1.$0.$0),_!=null&&_.$==1)&&(bi.$1.$0.$1==null&&(bi.$1.$0.$2==null&&(bi.$1.$1.$==0&&(_3=_9.$0,true)))))))))):($=bi.$0.$2,$!=null&&$.$==1)&&(bi.$0.$2.$0.$==1&&(ba=B.Entity("contact",bi.$0.$2.$0.$0),ba!=null&&ba.$==1&&(bi.$0.$2.$0.$1.$==0&&(bi.$1.$==1&&((bb=B.Intent("hello",bi.$1.$0.$0),bb!=null&&bb.$==1)&&(bi.$1.$0.$1==null&&(bi.$1.$0.$2==null&&(bi.$1.$1.$==0&&(_3=ba.$0,true))))))))):(bc=bi.$0.$2,bc!=null&&bc.$==1)&&(bi.$0.$2.$0.$==1&&(bd=B.Entity("contact",bi.$0.$2.$0.$0),bd!=null&&bd.$==1&&(bi.$0.$2.$0.$1.$==0&&(bi.$1.$==1&&((be=B.Intent("hello",bi.$1.$0.$0),be!=null&&be.$==1)&&(bi.$1.$0.$1==null&&(bi.$1.$0.$2==null&&(bi.$1.$1.$==0&&(_3=bd.$0,true))))))))))){for(bj=1,bk=2;bj<=bk;bj++)_0.shift();S.Start((bf=null,S.Delay(function(){Z.sayRandom(w.waitRetrievePhrases(),"user name");return S.Bind((new V.New()).Async("SMApp.Web:SMApp.Web.Server.GetUser2:1208830310",[_3]),function(bl){return bl==null?(bg("Sorry I did not find that user."),S.Zero()):(bg((function(bm){return function(bn){return bm("Hello "+J.toSafe(bn));};}(a.id))(bl.$0.Name)),S.Zero());});})),null);}else void 0;};B.Entity=function(Z,_0){return _0.get_Name()===Z?{$:1,$0:_0.get_Value()}:null;};B.Intent=function(Z,_0){var _1;return _0!=null&&_0.$==1&&(_0.$0.$0===Z&&(_1=_0.$0.$0,true))?{$:1,$0:null}:null;};B.debug=function(Z){d.debug((function(_0){return function(_1){return _0("Main: "+J.prettyPrint(_1));};}(a.id))(Z));};C.run=function(){var Z,_0;Z=M.ThisFunc(function(_1,_2){return((C.Main().get_Text())(_1))(_2);});_0=C.Main().get_Options();a.$("#main").terminal(Z,_0);return Q.get_Empty();};C.Main=function(){D.$cctor();return D.Main;};C.container=function(){D.$cctor();return D.container;};C.wait=function(Z){d["Terminal.Echo'"](C.CUI().Term,"please wait");C.CUI().Term.disable();Z();C.CUI().Term.enable();};C.stopSpeaking=function(){D.$cctor();return D.stopSpeaking;};C.sayRandom=function(Z,_0){C.say(w.getRandomPhrase(_0,Z));};C.sayVoices=function(){var Z,_0;Z=a.speechSynthesis.getVoices();!(Z==null)?(_0=d.toArray(Z),C.say((function(_1){return function(_2){return _1("There are currently "+a.String(_2)+" voices installed on this computer or device.");};}(a.id))(H.length(_0))),H.iteri(function(_1,_2){return C.say(((((M.Curried(function(_3,_4,_5,_6){return _3("Voice "+a.String(_4)+". Name: "+J.toSafe(_5)+", Local: "+J.prettyPrint(_6)+".");},4))(a.id))(_1))(_2.name))(_2.localService));},_0)):void 0;};C.say=function(Z){var _0,_1,_2;_0=C.CUI().Voice;_0!=null&&_0.$==1?(_1=_0.$0,S.Start((_2=null,S.Delay(function(){var _3;_3=new a.SpeechSynthesisUtterance(Z);_3.voice=_1;a.speechSynthesis.speak(_3);return S.Zero();})),null),C.CUI().Caption?d["Terminal.Echo'"](C.CUI().Term,Z):void 0):d["Terminal.Echo'"](C.CUI().Term,Z);};C.initMic=function(Z){var _0,_1;C.set_CUI((_0={$:1,$0:new W.Microphone(X.getElementById("microphone"))},z.New(C.CUI().Voice,_0,C.CUI().Term,C.CUI().DebugMode,C.CUI().Caption)));_1=C.CUI().Mic.$0;_1.onconnecting=function(){C.set_MicState({$:1});return C.debug("Mic connecting...");};_1.ondisconnected=function(){C.set_MicState({$:2});return C.debug("Mic disconnected.");};_1.onaudiostart=function(){C.set_MicState({$:3});return C.debug("Mic audio start...");};_1.onaudioend=function(){C.set_MicState({$:4});return C.debug("Mic audio end.");};_1.onerror=function(_2){C.set_MicState({$:6,$0:_2});return C.debug((function(_3){return function(_4){return _3("Mic error : "+J.toSafe(_4)+".");};}(a.id))(_2));};_1.onready=function(){C.set_MicState({$:5});return C.debug("Mic ready.");};_1.onresult=function(_2,_3){return!(_2==null||_3==null)?(C.set_MicState({$:7,$0:_2,$1:_3}),C.debug((((M.Curried3(function(_4,_5,_6){return _4("Mic result: "+J.prettyPrint(_5)+" "+J.prettyPrint(_6)+".");}))(a.id))(_2))(_3)),Z(_1,[_2,_3])):C.debug("Mic: No result returned.");};_1.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};C.initSpeech=function(){var Z,_0;Z=a.speechSynthesis.getVoices();!(Z==null)?(_0=d.toArray(Z),H.iter(function(_1){if(Y.Equals(C.CUI().Voice,null)&&(_1.name.indexOf("Microsoft Zira")!=-1||_1.name.toLowerCase().indexOf("female")!=-1)){C.set_CUI(z.New({$:1,$0:_1},C.CUI().Mic,C.CUI().Term,C.CUI().DebugMode,C.CUI().Caption));C.debug((function(_2){return function(_3){return _2("Using voice "+J.toSafe(_3)+".");};}(a.id))(C.CUI().Voice.$0.name));}},_0),Y.Equals(C.CUI().Voice,null)&&H.length(_0)>0?(C.set_CUI(z.New({$:1,$0:H.find(function(_1){return _1["default"];},_0)},C.CUI().Mic,C.CUI().Term,C.CUI().DebugMode,C.CUI().Caption)),C.debug((function(_1){return function(_2){return _1("Using default voice "+J.toSafe(_2)+".");};}(a.id))(C.CUI().Voice.$0.name))):void 0):void 0;Y.Equals(C.CUI().Voice,null)?(d.error("No speech synthesis voice is available."),d["Terminal.Echo'"](C.CUI().Term,"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma.")):void 0;};C.pushCtx=function(Z){C.Context().unshift(Z);return C.Context();};C.Context=function(){D.$cctor();return D.Context;};C.debug=function(Z){var _0;_0=(function(_1){return function(_2){return _1("Client: "+J.prettyPrint(_2));};}(a.id))(Z);d.debug(_0);C.CUI().DebugMode?(C.echo())(_0):void 0;};C.echo=function(){D.$cctor();return D.echo;};C.OpState=function(){D.$cctor();return D.OpState;};C.set_OpState=function(Z){D.$cctor();D.OpState=Z;};C.MicState=function(){D.$cctor();return D.MicState;};C.set_MicState=function(Z){D.$cctor();D.MicState=Z;};C.CUI=function(){D.$cctor();return D.CUI;};C.set_CUI=function(Z){D.$cctor();D.CUI=Z;};D.$cctor=function(){var Z,_0;D.$cctor=a.ignore;function _1(_3,_4){var _5,_6,_7,_8,_9,_,$,ba,bb,bc,bd;_5=_4[0];_6=_4[1];C.debug((((M.Curried3(function(be,bf,bg){return be("Voice: "+J.prettyPrint(bf)+" "+J.prettyPrint(bg));}))(a.id))(_5))(_6));_7=(_8=p["Intent'"](_5,_6),_8!=null&&_8.$==1?{$:1,$0:_8.$0}:null);_9=(_=p["Trait'"](_6),_!=null&&_.$==1?{$:1,$0:_.$0}:null);$=(ba=p["Entity'$1"](_6),ba!=null&&ba.$==1?{$:1,$0:N.ofArray([ba.$0])}:null);return _7==null&&(_9==null&&$==null)?null:(C.debug(((((M.Curried(function(be,bf,bg,bh){return be("Voice: "+E.p(bf)+" "+E.p$3(bg)+" "+E.p$5(bh));},4))(a.id))(_7))(_9))($)),(C.OpState()==null?false:C.OpState().$0.$==0)?C.say("I'm still working on understanding your last message."):(bd=C.pushCtx(new o({$:0,$0:_7,$1:_9,$2:$})),B.update(C.CUI(),bd)));}function _2(_3,_4){var _5,_6,_7,_8,_9,_,$,ba,bb,bc;C.set_CUI(z.New(C.CUI().Voice,C.CUI().Mic,_3,C.CUI().DebugMode,C.CUI().Caption));Y.Equals(C.CUI().Voice,null)?C.initSpeech():void 0;Y.Equals(C.CUI().Mic,null)?C.initMic(_1):void 0;return(_5=r.Blank(_4),_5!=null&&_5.$==1)?C.say("Tell me what you want me to do or ask me a question."):(_6=r.DebugOn(_4),_6!=null&&_6.$==1)?(C.set_CUI(z.New(C.CUI().Voice,C.CUI().Mic,C.CUI().Term,true,C.CUI().Caption)),C.say("Debug mode is now on.")):(_7=r.DebugOff(_4),_7!=null&&_7.$==1)?(C.set_CUI(z.New(C.CUI().Voice,C.CUI().Mic,C.CUI().Term,false,C.CUI().Caption)),C.say("Debug mode is now off.")):(C.OpState()==null?false:C.OpState().$0.$==0)?C.say("I'm still working on understanding your last message."):(_=r.QuickHello(_4),_!=null&&_.$==1?(_9=_.$0,true):($=r.QuickHelp(_4),$!=null&&$.$==1?(_9=$.$0,true):(ba=r.QuickPrograms(_4),ba!=null&&ba.$==1&&(_9=ba.$0,true))))?(C.debug((function(bd){return function(be){return bd("Quick Text: "+E.p$7(be)+".");};}(a.id))(_9)),bb=C.pushCtx(_9),B.update(C.CUI(),bb)):C.CUI().Wait((bc=null,S.Delay(function(){C.set_OpState({$:1,$0:{$:0}});return S.Combine(S.Bind((new V.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:65282759",[_4]),function(bd){var be,bf,bg;be=r.HasMeaning(bd);return be!=null&&be.$==1?(bf=be.$0,(C.debug(((((M.Curried(function(bh,bi,bj,bk){return bh("Text: "+E.p(bi)+" "+E.p$3(bj)+" "+E.p$5(bk));},4))(a.id))(bf.get_Intent()))(bf.get_Trait()))(bf.get_Entities())),bg=C.pushCtx(bf),B.update(C.CUI(),bg),S.Zero())):(C.debug("Text: Did not receive a response from the server."),d["Terminal.Echo'"](_3,"Sorry I did not understand what you said."),S.Zero());}),S.Delay(function(){C.set_OpState(null);return S.Zero();}));})));}D.CUI=z.New(null,null,null,false,false);D.MicState={$:0};D.OpState=null;D.echo=(Z=C.CUI().Term,function(_3){d["Terminal.EchoHtml'"](Z,_3);});D.Context=[];D.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;D.container=i.Container;D.Main=new y({$:0,$0:function(_3){return function(_4){return _1(_3,_4);};},$1:[function(_3){return function(_4){return _2(_3,_4);};},(_0={},_0.name="Main",_0.greetings="Welcome to Selma. Enter 'hello my name is...(you)' to begin and initialize speech or help for more assistance.",_0.prompt=">",_0)]});};E.p$2=function(Z){return Z==null?"null":"Some "+J.prettyPrint(Z.$0);};E.p$1=function(Z){return"Intent ("+J.prettyPrint(Z.$0)+", "+E.p$2(Z.$1)+")";};E.p=function(Z){return Z==null?"null":"Some "+E.p$1(Z.$0);};E.p$4=function(Z){return"Trait ("+J.prettyPrint(Z.$0)+", "+J.prettyPrint(Z.$1)+")";};E.p$3=function(Z){return Z==null?"null":"Some "+E.p$4(Z.$0);};E.p$6=function(Z){return"Entity ("+J.prettyPrint(Z.$0)+", "+J.prettyPrint(Z.$1)+", "+E.p$2(Z.$2)+")";};E.p$5=function(Z){return Z==null?"null":"Some "+J.printList(function(_0){return E.p$6(_0);},Z.$0);};E.p$7=function(Z){return"Meaning ("+E.p(Z.$0)+", "+E.p$3(Z.$1)+", "+E.p$5(Z.$2)+")";};}());
