(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=b.Bs=b.Bs||{};i=b.NLU=b.NLU||{};j=i.Babelfy=i.Babelfy||{};k=j.ApiResponse=j.ApiResponse||{};l=j.TokenFragment=j.TokenFragment||{};m=j.CharFragment=j.CharFragment||{};n=i.Witai=i.Witai||{};o=n.Utterance=n.Utterance||{};p=n.Intent=n.Intent||{};q=n.Entity=n.Entity||{};r=n.Trait=n.Trait||{};s=n["Utterance'"]=n["Utterance'"]||{};t=n["Value'"]=n["Value'"]||{};u=i.QnAMaker=i.QnAMaker||{};v=u.ITSQuestion=u.ITSQuestion||{};w=u.ITSAnswerContext=u.ITSAnswerContext||{};x=u.ITSAnswer=u.ITSAnswer||{};y=u.ITSAnswers=u.ITSAnswers||{};z=c.NLU=c.NLU||{};A=z.Intent=z.Intent||{};B=z.Trait=z.Trait||{};C=z.Entity=z.Entity||{};D=z.Utterance=z.Utterance||{};E=z.SSML=z.SSML||{};F=z.Response=z.Response||{};G=z.Task=z.Task||{};H=z.Voice=z.Voice||{};I=H["Entity'"]=H["Entity'"]||{};J=z.Text=z.Text||{};K=J["Utterance'"]=J["Utterance'"]||{};L=J["Intent'"]=J["Intent'"]||{};M=J["Entity'"]=J["Entity'"]||{};N=J["Trait'"]=J["Trait'"]||{};O=z.Domain=z.Domain||{};P=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};Q=c.CUI=c.CUI||{};R=Q.MicState=Q.MicState||{};S=Q.ClientState=Q.ClientState||{};T=Q.Interpreter=Q.Interpreter||{};U=Q.CUI=Q.CUI||{};V=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};W=c.Main=c.Main||{};X=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};Y=c.Client=c.Client||{};Z=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};_0=a.GeneratedPrintf=a.GeneratedPrintf||{};_1=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};_2=a.WebSharper;_3=_2&&_2.UI;_4=_3&&_3.Client;_5=_4&&_4.Templates;_6=_3&&_3.Doc;_7=_2&&_2.Strings;_8=_2&&_2.Arrays;_9=a.IntelliFactory;_=_9&&_9.Runtime;$=_2&&_2.Utils;ba=a.console;bb=a.jQuery;bc=_2&&_2.List;bd=_2&&_2.Seq;be=_3&&_3.AttrModule;bf=_3&&_3.AttrProxy;bg=_2&&_2.Concurrency;bh=a.JSON;bi=_2&&_2.Collections;bj=bi&&bi.Map;bk=_2&&_2.JavaScript;bl=bk&&bk.Pervasives;bm=a.SDK;bn=_2&&_2.Random;bo=_2&&_2.Operators;bp=_2&&_2.Remoting;bq=bp&&bp.AjaxRemotingProvider;br=a.Wit;bs=a.document;bt=_2&&_2.Unchecked;bu=bi&&bi.Dictionary;d.speechSynthesis=function(){return a.speechSynthesis;};d.elementHTML=function(bv){return bv.innerHTML;};d.createElement=function(bv){var bw;bw=self.document.createElement("div");_5.LoadLocalTemplates("");_6.RunAppend(bw,bv);};d.replace_tok=function(bv,bw,bx){return _7.Replace(bx,bv,bw);};d.termOutput=function(){return _8.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(bv){return bv.toLowerCase();};d.debug=function(bv,bw){d.info((((_.Curried3(function(bx,by,bz){return bx("DEBUG: "+$.toSafe(by)+": "+$.prettyPrint(bz));}))(a.id))(bv.toUpperCase()))(bw));};d.error=function(bv){ba.error(bv);};d.info=function(bv){ba.info(bv);};d.jserror=function(bv){bb.error(bv);};d.toArray=function(bv){return _8.map(a.id,bb.makeArray(bv));};d["Terminal.EchoHtml'"]=function(bv,bw){bv.pause();bv.echo(bw,d.rawOpt());bv.resume();};d["Terminal.Echo'"]=function(bv,bw){bv.pause();bv.echo(bw);bv.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=_.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(bv){function bw(bx){return function(by){var bz,bA,bB,bC,bD,bE,bF;bA=_7.replicate(bx," ");switch(by.$==0?by.$1.$==1?by.$1.$0.$==2?by.$1.$1.$==0?(bz=[by.$1.$0.$0,by.$0],1):(bz=[by.$1,by.$0],2):(bz=[by.$1,by.$0],2):(bz=[by.$1,by.$0],2):by.$==2?(bz=by.$0,3):(bz=[by.$0,by.$1],0)){case 0:return bz[0]+"=\""+bz[1]+"\"";case 1:bB=bz[1];return bA+"<"+bB+">"+bz[0]+"</"+bB+">\r\n";case 2:bC=bz[1];bD=bc.partition(function(bG){return bG.$==1;},bz[0]);bE=bD[1];bF=bD[0];return bE.$==0?bA+"<"+bC+(bF.$===0?"":" "+_7.concat(" ",bc.ofSeq(bd.delay(function(){return bd.map(function(bG){return(bw(0))(bG);},bF);}))))+"/>\r\n":bA+"<"+bC+(bF.$===0?"":" "+_7.concat(" ",bc.ofSeq(bd.delay(function(){return bd.map(function(bG){return(bw(0))(bG);},bF);}))))+">\r\n"+_7.concat("",bc.ofSeq(bd.delay(function(){return bd.map(function(bG){return(bw(bx+1))(bG);},bE);})))+bA+"</"+bC+">\r\n";case 3:return bA+bz+"\r\n";}};}return(bw(0))(bv);};f.alt=function(bv){return new e({$:1,$0:"alt",$1:bv});};f.src=function(bv){return new e({$:1,$0:"src",$1:bv});};f.cls=function(bv){return new e({$:1,$0:"class",$1:bv});};f.str=function(bv){return e.toString(bv);};f.op_PercentEquals=function(bv,bw){return new e({$:1,$0:bv,$1:bw});};f.op_Splice=function(bv){var bw;return bc.ofArray([new e({$:2,$0:(bw=bv,a.String(bw))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(bv,bw){return new e({$:0,$0:bv,$1:bw});};g.$cctor=function(){var bv;g.$cctor=a.ignore;g.rawOpt=(bv={},bv.raw=true,bv);g.html=function(bw){return f.elem("html",bw);};g.head=function(bw){return f.elem("head",bw);};g.title=function(bw){return f.elem("title",bw);};g.style=function(bw){return f.elem("style",bw);};g.body=function(bw){return f.elem("body",bw);};g.div=function(bw){return f.elem("div",bw);};g.br=function(bw){return f.elem("br",bw);};g.section=function(bw){return f.elem("section",bw);};g.span=function(bw){return f.elem("span",bw);};g.table=function(bw){return f.elem("table",bw);};g.thead=function(bw){return f.elem("thead",bw);};g.tbody=function(bw){return f.elem("tbody",bw);};g.tfoot=function(bw){return f.elem("tfoot",bw);};g.img=function(bw){return f.elem("img",bw);};g.map=function(bw){return f.elem("map",bw);};g.area=function(bw){return f.elem("area",bw);};g.p=function(bw){return f.elem("p",bw);};g.a=function(bw){return f.elem("a",bw);};g.tr=function(bw){return f.elem("tr",bw);};g.td=function(bw){return f.elem("td",bw);};g.th=function(bw){return f.elem("th",bw);};g.ul=function(bw){return f.elem("ul",bw);};g.li=function(bw){return f.elem("li",bw);};g.h1=function(bw){return f.elem("h1",bw);};g.h2=function(bw){return f.elem("h1",bw);};g.h3=function(bw){return f.elem("h1",bw);};g.h4=function(bw){return f.elem("h1",bw);};g.strong=function(bw){return f.elem("strong",bw);};};h.Radio=function(bv,bw,bx,by,bz){return _6.Element("div",new bc.T({$:1,$0:h.cls("radio"),$1:bw}),[_6.Element("label",by,[_6.Radio(bz,true,bx),_6.TextNode(bv)])]);};h.checkbox=function(bv,bw,bx,by,bz){return _6.Element("div",new bc.T({$:1,$0:h.cls("checkbox"),$1:bw}),[_6.Element("label",by,[_6.CheckBox(bz,bx),_6.TextNode(bv)])]);};h.textArea=function(bv,bw,bx,by,bz){return _6.Element("div",new bc.T({$:1,$0:h.cls("form-group"),$1:bw}),[_6.Element("label",by,[_6.TextNode(bv)]),_6.InputArea(new bc.T({$:1,$0:h.cls("form-control"),$1:bz}),bx)]);};h.inputPassword=function(bv,bw,bx,by,bz){return _6.Element("div",new bc.T({$:1,$0:h.cls("form-group"),$1:bw}),[_6.Element("label",by,[_6.TextNode(bv)]),_6.PasswordBox(new bc.T({$:1,$0:h.cls("form-control"),$1:bz}),bx)]);};h.input=function(bv,bw,bx,by,bz){return _6.Element("div",new bc.T({$:1,$0:h.cls("form-group"),$1:bw}),[_6.Element("label",by,[_6.TextNode(bv)]),_6.Input([h.cls("form-control"),bz],bx)]);};h.btnSecondary=function(bv,bw,bx){return _6.Element("button",[h.eid(bv),h.cls("btn btn-secondary"),be.Handler("click",bx)],[_6.TextNode(bw)]);};h.btnPrimary=function(bv,bw,bx){return _6.Element("button",[h.eid(bv),h.cls("btn btn-primary"),be.Handler("click",bx)],[_6.TextNode(bw)]);};h.container=function(bv){return _6.Element("div",[h.cls("container")],bv);};h.dindex=function(bv){return bf.Create("data-index",a.String(bv));};h.cls=function(bv){return bf.Create("class",bv);};h.eid=function(bv){return bf.Create("id",bv);};k.New=function(bv,bw,bx,by,bz,bA,bB,bC,bD){return{tokenFragment:bv,charFragment:bw,babelSynsetID:bx,DBpediaURL:by,BabelNetURL:bz,score:bA,cohrenceScore:bB,globalScore:bC,source:bD};};l.New=function(bv,bw){return{start:bv,end:bw};};m.New=function(bv,bw){return{start:bv,end:bw};};j.disambiguate=function(bv){function bw(bx,by){var bz;bb.ajax((bz={},bz.url=(function(bA){return function(bB){return bA("https://babelfy.io/v1/disambiguate?text="+$.toSafe(bB)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bv),bz.type="GET",bz.success=function(bA){return bx(bA);},bz.error=function(bA){return by(new a.Error(bA.responseText));},bz));}return bg.FromContinuations(function(bx,by,bz){return bw.apply(null,[bx,by,bz]);});};o.New=function(bv,bw,bx,by){return{text:bv,intents:bw,entities:bx,traits:by};};p.New=function(bv,bw,bx){return{id:bv,name:bw,confidence:bx};};q.New=function(bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF){return{id:bv,name:bw,role:bx,start:by,end:bz,body:bA,confidence:bB,entities:bC,suggested:bD,value:bE,type:bF};};r.New=function(bv,bw,bx){return{id:bv,value:bw,confidence:bx};};s.New=function(bv){return{intent:bv};};t.New=function(bv){return{value:bv};};n.getMeaning2=function(bv,bw){function bx(by,bz){var bA;bb.ajax((bA={},bA.url=(function(bB){return function(bC){return bB("https://api.wit.ai/message?q="+$.toSafe(bC));};}(a.id))(bw),bA.type="GET",bA.beforeSend=function(bB){return bB.setRequestHeader("Authorization","Bearer "+bv);},bA.success=function(bB){return by(bB);},bA.error=function(bB){return bz(new a.Error(bB.responseText));},bA));}return bg.FromContinuations(function(by,bz,bA){return bx.apply(null,[by,bz,bA]);});};n.getMeaning=function(bv,bw,bx,by){var bz;bb.ajax((bz={},bz.url=(function(bA){return function(bB){return bA("https://api.wit.ai/message?q="+$.toSafe(bB));};}(a.id))(bw),bz.type="GET",bz.beforeSend=function(bA){return bA.setRequestHeader("Authorization","Bearer "+bv);},bz.success=bx,bz.error=by,bz));};v.New=function(bv){return{question:bv};};w.New=function(bv,bw){return{isContextOnly:bv,prompts:bw};};x.New=function(bv,bw,bx,by,bz,bA,bB){return{questions:bv,answer:bw,score:bx,id:by,source:bz,metadata:bA,context:bB};};y.New=function(bv){return{answers:bv};};u.getAnswer=function(bv){function bw(bx,by){var bz;bb.ajax((bz={},bz.url="https://lerna.azurewebsites.net/qnamaker/knowledgebases/13a6a026-942b-4612-a8cb-654086ec76ee/generateAnswer",bz.type="POST",bz.beforeSend=function(bA){return bA.setRequestHeader("Authorization","EndpointKey e5a55563-b1b0-4343-8796-bda5a0509385");},bz.contentType="application/json",bz.dataType="json",bz.data=bh.stringify(v.New(bv)),bz.success=function(bA){return bx(bA);},bz.error=function(bA){return by(new a.Error(bA.responseText));},bz));}return bg.FromContinuations(function(bx,by,bz){return bw.apply(null,[bx,by,bz]);});};A=z.Intent=_.Class({toString:function(){return(((_.Curried3(function(bv,bw,bx){return bv("Intent("+$.toSafe(bw)+", "+_1.p$2(bx)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,A);B=z.Trait=_.Class({toString:function(){return(((_.Curried3(function(bv,bw,bx){return bv("Trait("+$.toSafe(bw)+", "+$.prettyPrint(bx)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,B);C=z.Entity=_.Class({toString:function(){return((((_.Curried(function(bv,bw,bx,by){return bv("Entity("+$.toSafe(bw)+", "+$.toSafe(bx)+", "+_1.p$2(by)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,C);D=z.Utterance=_.Class({toString:function(){return((((_.Curried(function(bv,bw,bx,by){return bv(_1.p(bw)+" "+_1.p$3(bx)+" "+_1.p$5(by));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bv;bv=this.$3;return bv!=null?{$:1,$0:bc.sortBy(function(bw){return bw.get_Name();},bv.$0)}:null;},get_Traits:function(){var bv;bv=this.$2;return bv!=null?{$:1,$0:bc.sortBy(function(bw){return bw.get_Name();},bv.$0)}:null;},get_Intent:function(){return this.$1;},get_Text:function(){return this.$0;}},null,D);E=z.SSML=_.Class({toString:function(){return this.$0;}},null,E);F=z.Response=_.Class({toString:function(){return this.$==1?this.$1.innerHTML:a.String(this.$0);},get_Text:function(){return this.$==1?a.String(this.$0):a.String(this.$0);}},null,F);G=z.Task=_.Class({toString:function(){return(((_.Curried3(function(bv,bw,bx){return bv("Name: "+$.toSafe(bw)+" Prompt: "+$.toSafe(bx));}))(a.id))(this.get_Name()))(a.String(this.get_Prompt()));},get_Prompt:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);I.New=function(bv,bw,bx,by,bz){return{body:bv,end:bw,start:bx,suggested:by,value:bz};};H["Intent'"]=function(bv,bw){return!(bw.intent==null)?{$:1,$0:new A({$:0,$0:d.toLower(bw.intent.value),$1:null})}:null;};H["Trait'"]=function(bv){return!(bv.domain==null)?{$:1,$0:new B({$:0,$0:"domain",$1:d.toLower(bv.domain.value),$2:null})}:!(bv.dialogue_act==null)?{$:1,$0:new B({$:0,$0:"dialogue_act",$1:d.toLower(bv.dialogue_act.value),$2:null})}:null;};H["Entity'$1"]=function(bv){return!(bv.contact==null)?{$:1,$0:new C({$:0,$0:"contact",$1:d.toLower(bv.contact.value),$2:null})}:null;};K=J["Utterance'"]=_.Class({get_TopIntent:function(){return bc.head(bc.sortBy(function(bv){return bv.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$3;},get_Entities:function(){return this.$2;},get_Intents:function(){return this.$1;},get_Text:function(){return this.$0;}},null,K);L=J["Intent'"]=_.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,L);M=J["Entity'"]=_.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,M);N=J["Trait'"]=_.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,N);J.HasUtterance=function(bv){var bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ;return bv!=null&&bv.$==1&&(bv.$0.$1.$==0&&(bv.$0.$2.get_Length()>0&&(bw=[bv.$0.$2,bv.$0.$0,bv.$0.$3],true)))?(bx=bc.map(function(bK){return new C({$:0,$0:d.toLower(bK.get_Role()),$1:bK.get_Value(),$2:{$:1,$0:bK.get_Confidence()}});},bc.filter(function(bK){return bK.get_Confidence()>J.entityConfidenceThreshold();},bw[0])),{$:1,$0:new D({$:0,$0:bw[1],$1:null,$2:{$:1,$0:bc.map(function(bK){return new B({$:0,$0:d.toLower(bK.get_Name()),$1:bK.get_Value(),$2:{$:1,$0:bK.get_Confidence()}});},bc.filter(function(bK){return bK.get_Confidence()>J.entityConfidenceThreshold();},bw[2]))},$3:{$:1,$0:bx}})}):bv!=null&&bv.$==1&&(bv.$0.$2.$==0&&(bv.$0.$3.$==0&&(bv.$0.$1.get_Length()>0&&bv.$0.get_TopIntent().get_Confidence()>J.intentConfidenceThreshold()&&(by=[bv.$0.$1,bv,bv.$0.$0],true))))?(bz=by[1],{$:1,$0:new D({$:0,$0:by[2],$1:{$:1,$0:new A({$:0,$0:d.toLower(bz.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bz.$0.get_TopIntent().get_Confidence()}})},$2:null,$3:null})}):bv!=null&&bv.$==1&&(bv.$0.$3.$==0&&(bv.$0.$1.get_Length()>0&&bv.$0.get_TopIntent().get_Confidence()>J.intentConfidenceThreshold()&&(bA=[bv.$0.$1,bv,bv.$0.$0],true)))?(bB=bA[1],(bC=bc.map(function(bK){return new C({$:0,$0:d.toLower(bK.get_Role()),$1:bK.get_Value(),$2:{$:1,$0:bK.get_Confidence()}});},bc.filter(function(bK){return bK.get_Confidence()>J.entityConfidenceThreshold();},bB.$0.get_Entities())),{$:1,$0:new D({$:0,$0:bA[2],$1:{$:1,$0:new A({$:0,$0:d.toLower(bB.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bB.$0.get_TopIntent().get_Confidence()}})},$2:null,$3:{$:1,$0:bC}})})):bv!=null&&bv.$==1&&(bv.$0.$2.$==0&&(bv.$0.$1.get_Length()>0&&bv.$0.get_TopIntent().get_Confidence()>J.intentConfidenceThreshold()&&(bD=[bv.$0.$1,bv,bv.$0.$0],true)))?(bE=bD[1],(bF=bc.map(function(bK){return new B({$:0,$0:d.toLower(bK.get_Name()),$1:bK.get_Value(),$2:{$:1,$0:bK.get_Confidence()}});},bc.filter(function(bK){return bK.get_Confidence()>J.entityConfidenceThreshold();},bE.$0.get_Traits())),{$:1,$0:new D({$:0,$0:bD[2],$1:{$:1,$0:new A({$:0,$0:d.toLower(bE.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bE.$0.get_TopIntent().get_Confidence()}})},$2:{$:1,$0:bF},$3:null})})):bv!=null&&bv.$==1&&(bv.$0.$1.get_Length()>0&&bv.$0.get_TopIntent().get_Confidence()>J.intentConfidenceThreshold()&&(bG=[bv.$0.$1,bv,bv.$0.$0],true))?(bH=bG[1],(bI=bc.map(function(bK){return new C({$:0,$0:d.toLower(bK.get_Role()),$1:bK.get_Value(),$2:{$:1,$0:bK.get_Confidence()}});},bc.filter(function(bK){return bK.get_Confidence()>J.entityConfidenceThreshold();},bH.$0.get_Entities())),(bJ=bc.map(function(bK){return new B({$:0,$0:d.toLower(bK.get_Name()),$1:bK.get_Value(),$2:{$:1,$0:bK.get_Confidence()}});},bc.filter(function(bK){return bK.get_Confidence()>J.entityConfidenceThreshold();},bH.$0.get_Traits())),{$:1,$0:new D({$:0,$0:bG[2],$1:{$:1,$0:new A({$:0,$0:d.toLower(bH.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bH.$0.get_TopIntent().get_Confidence()}})},$2:{$:1,$0:bJ},$3:{$:1,$0:bI}})}))):null;};J.entityConfidenceThreshold=function(){P.$cctor();return P.entityConfidenceThreshold;};J.set_entityConfidenceThreshold=function(bv){P.$cctor();P.entityConfidenceThreshold=bv;};J.intentConfidenceThreshold=function(){P.$cctor();return P.intentConfidenceThreshold;};J.set_intentConfidenceThreshold=function(bv){P.$cctor();P.intentConfidenceThreshold=bv;};J.getUtterance2=function(bv){var bw;bw=null;return bg.Delay(function(){return bg.Bind(n.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bv),function(bx){d.debug("NLU",(function(by){return function(bz){return by("Wit.ai returned "+_0.p(bz)+" ");};}(a.id))(bx));return bg.Return(new K({$:0,$0:bv,$1:bc.ofArray(_8.map(function(by){return new L({$:0,$0:by.name,$1:by.confidence});},bx.intents)),$2:bc.map(function(by){return new M({$:0,$0:by.name,$1:by.confidence,$2:by.role,$3:by.value});},bc.ofSeq(bd.concat(bd.map(function(by){return by[1];},bj.ToSeq(bx.entities))))),$3:bc.ofSeq(bd.map(function(by){var bz;bz=by[1];return new N({$:0,$0:by[0],$1:_8.get(bz,0).confidence,$2:_8.get(bz,0).value});},bj.ToSeq(bx.traits)))}));});});};J.getUtterance=function(bv,bw){n.getMeaning("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bv,function(bx){var by,bz;d.debug("NLU",(function(bA){return function(bB){return bA("Wit.ai returned: "+$.prettyPrint(bB));};}(a.id))(bx));by=!(bx.intents==null)?bc.ofArray(_8.map(function(bA){return new L({$:0,$0:bA.name,$1:bA.confidence});},bx.intents)):bc.T.Empty;bz=!(bx.traits==null)?bc.ofSeq(bd.concat(bc.map(function(bA){return _8.map(function(bB){return new N({$:0,$0:bA,$1:bB.confidence,$2:bB.value});},bl.GetJS(bx.traits,[bA]));},bc.filter(function(bA){return!(bl.GetJS(bx.traits,[bA])==null);},J.trait_types())))):bc.T.Empty;return bw({$:1,$0:new K({$:0,$0:bv,$1:by,$2:!(bx.entities==null)?bc.ofSeq(bd.concat(bc.map(function(bA){return _8.map(function(bB){return new M({$:0,$0:bB.name,$1:bB.confidence,$2:bB.role,$3:bB.value});},bl.GetJS(bx.entities,[bA]));},bc.filter(function(bA){return!(bl.GetJS(bx.entities,[bA])==null);},J.entity_types())))):bc.T.Empty,$3:bz})});},function(bx,by,bz){d.error((((_.Curried3(function(bA,bB,bC){return bA("Wit.ai returned: "+$.prettyPrint(bB)+" "+$.prettyPrint(bC));}))(a.id))(by))(bz));return bw(null);});};J.trait_types=function(){P.$cctor();return P.trait_types;};J.entity_types=function(){P.$cctor();return P.entity_types;};J.QuickPrograms=function(bv){return bv==="programs"?{$:1,$0:new D({$:0,$0:"programs",$1:{$:1,$0:new A({$:0,$0:"Program",$1:null})},$2:null,$3:null})}:null;};J.QuickNumber=function(bv){var bw,bx,by;return(bx=J.One(bv),bx!=null&&bx.$==1?(bw=bx.$0,true):(by=J.Two(bv),by!=null&&by.$==1&&(bw=by.$0,true)))?{$:1,$0:bw}:null;};J.Three=function(bv){var bw;return bv==="3"||bv==="three"?{$:1,$0:new D({$:0,$0:"1",$1:{$:1,$0:new A({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bc.ofArray([new C({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};J.Two=function(bv){var bw;return bv==="2"||bv==="two"?{$:1,$0:new D({$:0,$0:"1",$1:{$:1,$0:new A({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bc.ofArray([new C({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};J.One=function(bv){var bw;return bv==="1"||bv==="one"?{$:1,$0:new D({$:0,$0:"1",$1:{$:1,$0:new A({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bc.ofArray([new C({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};J.QuickNo=function(bv){var bw;return bv==="no"||(bv==="nope"||(bv==="no way"||(bv==="nah"||(bv==="don't do it"||bv==="stop"))))?{$:1,$0:new D({$:0,$0:"no",$1:{$:1,$0:new A({$:0,$0:"no",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};J.QuickYes=function(bv){var bw;return bv==="yes"||(bv==="ok"||(bv==="sure"||(bv==="yeah"||(bv==="yep"||(bv==="uh huh"||(bv==="go ahead"||bv==="go"))))))?{$:1,$0:new D({$:0,$0:"yes",$1:{$:1,$0:new A({$:0,$0:"yes",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};J.QuickHelp=function(bv){var bw;return bv==="help"||(bv==="help me"||(bv==="what's this?"||bv==="huh"))?{$:1,$0:new D({$:0,$0:"help",$1:{$:1,$0:new A({$:0,$0:"help",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};J.QuickHello=function(bv){var bw;return bv==="hello"||(bv==="hey"||(bv==="yo"||bv==="hi"))?{$:1,$0:new D({$:0,$0:"hello",$1:{$:1,$0:new A({$:0,$0:"hello",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};J.Voices=function(bv){return bv==="voices"?{$:1,$0:null}:null;};J.Debug=function(bv){return bv==="debug"?{$:1,$0:null}:null;};J.Blank=function(bv){return bv===""?{$:1,$0:null}:null;};O.Study=function(bv){return bv.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};z.No=function(bv){var bw,bx,by,bz,bA,bB;return(bx=z.Intent$1("no",bv),bx!=null&&bx.$==1&&(bx.$0[0]==null&&(bx.$0[1]==null&&(bw=bv,true))))?{$:1,$0:bw}:(bz=z.Intent$1("noresponse",bv),bz!=null&&bz.$==1&&(bz.$0[0]==null&&(bz.$0[1]==null&&(by=bv,true))))?{$:1,$0:by}:(bB=z.Intent$1("NoResponse",bv),bB!=null&&bB.$==1&&(bB.$0[0]==null&&(bB.$0[1]==null&&(bA=bv,true))))?{$:1,$0:bA}:null;};z.Yes=function(bv){var bw,bx,by,bz,bA,bB;return(bx=z.Intent$1("yes",bv),bx!=null&&bx.$==1&&(bx.$0[0]==null&&(bx.$0[1]==null&&(bw=bv,true))))?{$:1,$0:bw}:(bz=z.Intent$1("yesresponse",bv),bz!=null&&bz.$==1&&(bz.$0[0]==null&&(bz.$0[1]==null&&(by=bv,true))))?{$:1,$0:by}:(bB=z.Intent$1("YesResponse",bv),bB!=null&&bB.$==1&&(bB.$0[0]==null&&(bB.$0[1]==null&&(bA=bv,true))))?{$:1,$0:bA}:null;};z.EntityManyofMany=function(bv,bw){return{$:1,$0:bj.OfArray(_8.ofSeq(bc.map(function(bx){return bc.exists(function(by){return by.get_Name()===bx;},bw)?[bx,{$:1,$0:bc.filter(function(by){return by.get_Name()===bx;},bw)}]:[bx,null];},bv)))};};z.EntityManyOf1=function(bv,bw){var bx;return bw!=null&&bw.$==1&&(bc.exists(function(by){return by.get_Name()===bv;},bw.$0)&&(bx=bw.$0,true))?{$:1,$0:bc.filter(function(by){return by.get_Name()===bv;},bx)}:null;};z.Entity1OfAny=function(bv,bw){var bx;return bw!=null&&bw.$==1&&(bc.exists(function(by){return by.get_Name()===bv;},bw.$0)&&(bx=bw.$0,true))?{$:1,$0:bc.head(bc.sortBy(function(by){return by.get_Name();},bc.filter(function(by){return by.get_Name()===bv;},bx)))}:null;};z.Entity1Of1=function(bv,bw){var bx;return bw!=null&&bw.$==1&&(bw.$0.$==1&&(bw.$0.$1.$==0&&(bw.$0.$0.get_Name()===bv&&(bx=bw.$0.$0,true))))?{$:1,$0:bx}:null;};z.Intent$1=function(bv,bw){return bw.get_Intent()!=null&&bw.get_Intent().$0.get_Name()===bv?{$:1,$0:[bw.get_Traits(),bw.get_Entities()]}:null;};P.$cctor=function(){P.$cctor=a.ignore;P.entity_types=bc.ofArray(["wit$contact:contact","wit$datetime:datetime","subject:subject","term:term","symptom_name:symptom_name"]);P.trait_types=bc.ofArray(["domain","dialogue_act","wit$sentiment"]);P.intentConfidenceThreshold=0.5;P.entityConfidenceThreshold=0.5;};R.MicReady={$:5};R.MicAudioEnd={$:4};R.MicAudioStart={$:3};R.MicDisconnected={$:2};R.MicConnecting={$:1};R.MicNotInitialized={$:0};S.ClientUnderstand={$:2};S.ClientReady={$:1};S.ClientNotInitialzed={$:0};T=Q.Interpreter=_.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,T);U=Q.CUI=_.Class({SayVoices:function(){var bv,bw,bx;bv=this;bw=a.speechSynthesis.getVoices();!(bw==null)?(bx=d.toArray(bw),bv.Say((function(by){return function(bz){return by("There are currently "+a.String(bz)+" voices installed on this computer or device.");};}(a.id))(_8.length(bx))),_8.iteri(function(by,bz){return bv.Say(((((_.Curried(function(bA,bB,bC,bD){return bA("Voice "+a.String(bB)+". Name: "+$.toSafe(bC)+", Local: "+$.prettyPrint(bD)+".");},4))(a.id))(by))(bz.name))(bz.localService));},bx)):void 0;},Wait:function(bv){this.Wait$1(function(){bg.Start(bv,null);});},Wait$1:function(bv){this["Echo'"]("please wait...");this.Term.pause();bv();this.Term.resume();},sayRandom:function(bv,bw){this.Say(Q.getRandomPhrase(bv,bw));},SayAngry:function(bv){var bw,bx;bw=this;bg.Start((bx=null,bg.Delay(function(){return bg.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bm.chime(),bg.Zero()):bg.Zero(),bg.Delay(function(){a.addMessage(bw.Avatar,bv,"","");bw.Avatar.processMessages(0);return bg.Zero();}));})),null);},Say:function(bv){var bw,bx;bw=this;bg.Start((bx=null,bg.Delay(function(){return bg.Combine(a.speechSynthesis.speaking?(bm.chime(),bg.Zero()):bg.Zero(),bg.Delay(function(){bw.Avatar.addMessage(bv);bw.Avatar.processMessages(0);return bg.Zero();}));})),null);},Debug:function(bv,bw){d.debug(bv,bw);},"EchoHtml'":function(bv){var bw,bx;bw=(bx={},bx.raw=true,bx);this.Term.disable();this.Term.echo(bv,bw);this.Term.enable();},"Echo'":function(bv){this.Term.disable();this.Term.echo(bv);this.Term.enable();}},null,U);U.New=function(bv,bw,bx,by,bz){return new U({Voice:bv,Mic:bw,Term:bx,Avatar:by,Caption:bz});};Q.waitAddPhrases=function(){V.$cctor();return V.waitAddPhrases;};Q.waitRetrievePhrases=function(){V.$cctor();return V.waitRetrievePhrases;};Q.helpPhrases=function(){V.$cctor();return V.helpPhrases;};Q.helloUserPhrases=function(){V.$cctor();return V.helloUserPhrases;};Q.helloPhrases=function(){V.$cctor();return V.helloPhrases;};Q["getRandomPhrase'"]=function(bv){return d.replace_tok("$0","",bd.nth(Q.rng().Next(0,bv.get_Length()),bv));};Q.getRandomPhrase=function(bv,bw){return d.replace_tok("$0",bw,bd.nth(Q.rng().Next(0,bv.get_Length()),bv));};Q.rng=function(){V.$cctor();return V.rng;};V.$cctor=function(){V.$cctor=a.ignore;V.rng=new bn.New();V.helloPhrases=bc.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);V.helloUserPhrases=bc.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);V.helpPhrases=bc.ofArray(["What can I help you with $0?"]);V.waitRetrievePhrases=bc.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);V.waitAddPhrases=bc.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};W.update=function(bv,bw,bx,by,bz){var bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct;function cu(cP){bv.Say(cP);}function cv(cP){by.unshift(cP);cu(cP);}function cw(cP,cQ){var cR;cR=Q.getRandomPhrase(cP,cQ);by.unshift(cR);return bv.Say(cR);}function cx(cP){bv["EchoHtml'"](cP);}function cy(cP){return bw.ContainsKey(cP);}function cz(cP){return bw.get_Item(cP);}function cA(cP,cQ){return bw.Add(cP,cQ);}function cB(cP){bw.Remove(cP);}function cC(){return cz("user");}function cD(){bz.shift();}function cE(){bx.shift();}function cF(cP){var cQ;cQ=W.getTask(cP);cQ==null?(function(cR){return function(cS){return cR("No such task "+$.toSafe(cS));};}(bo.FailWith))(cP):bx.unshift(cQ.$0);}function cG(cP,cQ){cA(cP,cQ);cF(cP);W.debug((function(cR){return function(cS){return cR("Added question: "+_1.p$8(cS)+".");};}(a.id))(bx[0]));return cv(d.replace_tok("$0",cQ,W.getTask(cP).$0.get_Prompt().get_Text()));}function cH(cP,cQ){return cy(cP)?{$:1,$0:cQ}:null;}function cI(cP,cQ){return!cy(cP)?{$:1,$0:cQ}:null;}function cJ(cP){var cQ,cR;return(cR=cH("user",cP),cR!=null&&cR.$==1&&(bx.length===0&&(cQ=cR.$0,true)))?(cD(),{$:1,$0:cQ}):null;}function cK(cP,cQ){var cR,cS,cT;return(cS=cH("user",cQ),cS!=null&&cS.$==1&&(W.haveTask(cP)&&bx.length>0&&bx[0].get_Name()===cP&&(cR=cS.$0,true)))?(cD(),cE(),cy(cP)?(cT=bw.get_Item(cP),(cB(cP),{$:1,$0:[cR,{$:1,$0:cT}]})):{$:1,$0:[cR,null]}):null;}function cL(cP,cQ){var cR,cS,cT;return(cS=cI("user",cQ),cS!=null&&cS.$==1&&(W.haveTask(cP)&&bx.length>0&&bx[0].get_Name()===cP&&(cR=cS.$0,true)))?(cD(),cE(),cy(cP)?(cT=bw.get_Item(cP),(cB(cP),{$:1,$0:[cR,{$:1,$0:cT}]})):{$:1,$0:[cR,null]}):null;}function cM(cP){var cQ,cR;return(cR=cI("user",cP),cR!=null&&cR.$==1&&(bx.length===0&&(cQ=cR.$0,true)))?(cD(),{$:1,$0:cQ}):null;}function cN(cP){var cQ;return cP!=null&&cP.$==1&&(typeof cP.$0=="string"&&(cQ=cP.$0,true))?{$:1,$0:cQ}:null;}function cO(cP,cQ,cR){var cS;return bg.Start((cS=null,bg.Delay(function(){cw(Q.waitAddPhrases(),"symptom entry");return bg.Bind((new bq.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:1383687048",[cC().Name,cP,cQ,cR]),function(cT){return cT==null?(cv(function(cU){return cU("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),bg.Zero()):(cv((function(cU){return function(cV){return cU("OK I added that "+$.toSafe(cV)+" symptom to your journal.");};}(a.id))(cP)),bg.Zero());});})),null);}W.debug((((_.Curried3(function(cP,cQ,cR){return cP("Starting utterances:"+$.prettyPrint(cQ)+". Starting tasks: "+$.prettyPrint(cR)+".");}))(a.id))(bz))(bx));bA=bc.ofSeq(bd.take(bz.length>=5?5:bz.length,bz));bA.$==1&&(bC=(bD=cI("started",bA.$0),bD!=null&&bD.$==1?{$:1,$0:bD.$0}:null),bC!=null&&bC.$==1&&(bE=cM(bC.$0),bE!=null&&bE.$==1&&(bF=z.Intent$1("hello",bE.$0),bF!=null&&bF.$==1&&(bF.$0[1]==null&&bA.$1.$==0))))?(bw.Add("started",true),cw(Q.helloPhrases(),"")):bA.$==1&&(bH=cM(bA.$0),bH!=null&&bH.$==1&&(bI=z.Intent$1("hello",bH.$0),bI!=null&&bI.$==1&&(bI.$0[1]==null&&bA.$1.$==0)))?cv("Hello, tell me your name to get started."):bA.$==1&&(bK=cM(bA.$0),bK!=null&&bK.$==1&&(bL=z.Intent$1("hello",bK.$0),bL!=null&&bL.$==1&&(bM=z.Entity1Of1("contact",bL.$0[1]),bM!=null&&bM.$==1&&(bA.$1.$==0&&(bJ=bM.$0,true)))))?(bN=bJ.get_Value(),cw(Q.waitRetrievePhrases(),"user name"),bg.Start((bO=null,bg.Delay(function(){return bg.Bind((new bq.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:1049621054",[bN]),function(cP){var cQ;return cP==null?(cv((function(cR){return function(cS){return cR("I did not find a user with the name "+$.toSafe(cS)+".");};}(a.id))(bN)),cG("addUser",bN),bg.Zero()):(cQ=cP.$0,bg.Bind((new bq.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:-1462779492",[cQ.Name]),function(){bw.Add("user",cQ);cw(Q.helloUserPhrases(),(function(cR){return function(cS){return cR($.prettyPrint(cS));};}(a.id))(bw.get_Item("user")));return cQ.LastLoggedIn!=null?bg.Bind((new bq.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:-394340710",[cQ.LastLoggedIn.$0]),function(cR){cv((function(cS){return function(cT){return cS("You last logged in "+$.toSafe(cT)+".");};}(a.id))(cR));return bg.Zero();}):bg.Zero();}));});})),null)):bA.$==1&&(bQ=z.Yes(bA.$0),bQ!=null&&bQ.$==1&&(bR=cL("addUser",bQ.$0),bR!=null&&bR.$==1&&(bS=cN(bR.$0[1]),bS!=null&&bS.$==1&&(bA.$1.$==0&&(bP=bS.$0,true)))))?bg.Start((bT=null,bg.Delay(function(){cw(Q.waitAddPhrases(),"user");return bg.Bind((new bq.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:-1462779492",[bP]),function(cP){return cP==null?(cv((function(cQ){return function(cR){return cQ("Sorry I was not able to add the user "+$.toSafe(cR)+" to the system.");};}(a.id))(bP)),bg.Zero()):(cA("user",bP),cv((function(cQ){return function(cR){return cQ("Hello "+$.prettyPrint(cR)+", nice to meet you.");};}(a.id))(bw.get_Item("user"))),bg.Zero());});})),null):bA.$==1&&(bV=z.No(bA.$0),bV!=null&&bV.$==1&&(bW=cL("addUser",bV.$0),bW!=null&&bW.$==1&&(bX=cN(bW.$0[1]),bX!=null&&bX.$==1&&(bA.$1.$==0&&(bU=bX.$0,true)))))?cv((function(cP){return function(cQ){return cP("Ok I did not add the user "+$.toSafe(cQ)+". But you must login for me to help you.");};}(a.id))(bU)):bA.$==1&&(bZ=cJ(bA.$0),bZ!=null&&bZ.$==1&&(b0=z.Intent$1("hello",bZ.$0),b0!=null&&b0.$==1&&(b0.$0[0]==null&&(b1=z.Entity1Of1("contact",b0.$0[1]),b1!=null&&b1.$==1&&(bA.$1.$==0&&(bY=b1.$0,true))))))?bg.Start((b2=null,bg.Delay(function(){return bg.Bind((new bq.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:1049621054",[bY.get_Value()]),function(cP){return cP==null?(cv((function(cQ){return function(cR){return cQ("Sorry, the user "+$.toSafe(cR)+" does not exist.");};}(a.id))(bY.get_Value())),bg.Zero()):(cG("switchUser",cP.$0.Name),bg.Zero());});})),null):bA.$==1&&(b4=z.Yes(bA.$0),b4!=null&&b4.$==1&&(b5=cK("switchUser",b4.$0),b5!=null&&b5.$==1&&(b6=cN(b5.$0[1]),b6!=null&&b6.$==1&&(bA.$1.$==0&&(b3=b6.$0,true)))))?(bw.set_Item("user",b3),cv((function(cP){return function(cQ){return cP("Ok I switched to user "+$.prettyPrint(cQ)+".");};}(a.id))(b3))):bA.$==1&&(b8=z.No(bA.$0),b8!=null&&b8.$==1&&(b9=cK("switchUser",b8.$0),b9!=null&&b9.$==1&&(b_=cN(b9.$0[1]),b_!=null&&b_.$==1&&(bA.$1.$==0&&(b7=b_.$0,true)))))?cv((function(cP){return function(cQ){return cP("Ok I did not switch to user "+$.toSafe(cQ)+".");};}(a.id))(b7)):bA.$==1&&(ca=cM(bA.$0),ca!=null&&ca.$==1?(cb=z.Intent$1("kbquery",ca.$0),cb!=null&&cb.$==1)?bA.$1.$==0&&(b$=ca.$0,true):(cc=cJ(bA.$0),cc!=null&&cc.$==1&&((cd=z.Intent$1("kbquery",cc.$0),cd!=null&&cd.$==1)&&(bA.$1.$==0&&(b$=cc.$0,true)))):(ce=cJ(bA.$0),ce!=null&&ce.$==1&&((cf=z.Intent$1("kbquery",ce.$0),cf!=null&&cf.$==1)&&(bA.$1.$==0&&(b$=ce.$0,true)))))?bg.Start((cg=null,bg.Delay(function(){return bg.Bind(u.getAnswer(b$.get_Text()),function(cP){var cQ;return bg.Bind((cQ=_8.get(cP.answers,0).answer,(new bq.New()).Async("SMApp.Web:SMApp.Web.Server.mdtohtml:-907057203",[cQ])),function(cR){var cS;return bg.Bind((cS=_8.get(cP.answers,0).answer,(new bq.New()).Async("SMApp.Web:SMApp.Web.Server.mdtotext:-907057203",[cS])),function(cT){cx(cR);cv(cT);return bg.Zero();});});});})),null):bA.$==1&&(ci=cJ(bA.$0),ci!=null&&ci.$==1&&(cj=z.Intent$1("symptom",ci.$0),cj!=null&&cj.$==1&&(ck=z.Entity1OfAny("symptom_name",cj.$0[1]),ck!=null&&ck.$==1&&(bA.$1.$==0&&(ch=ck.$0,true)))))?bg.Start((cl=null,bg.Delay(function(){cv("Ok I'll add that entry to your symptom journal");cO(ch.get_Value(),null,null);return bg.Zero();})),null):bA.$==1&&(cn=z.Yes(bA.$0),cn!=null&&cn.$==1&&((co=cK("painVideo",cn.$0),co!=null&&co.$==1)&&bA.$1.$==0))?bv["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bA.$==1&&(cq=cJ(bA.$0),cq!=null&&cq.$==1&&(cr=z.Intent$1("medjournal",cq.$0),cr!=null&&cr.$==1&&((cs=cr.$0[1],cs!=null&&cs.$==1)&&(bA.$1.$==0&&(cp=cr.$0[1].$0,true)))))?(cv("ok I added that entry to your medication journal."),cv("You should be careful not to take too many painkillers over a short period of time.")):(cD(),W.debug("Main interpreter did not understand utterance."),cv("Sorry I didn't understand what you meant."),bx.length>0?(ct=bd.nth(0,bx),cy(ct.get_Name())?cv(d.replace_tok("$0",bw.get_Item(ct.get_Name()),a.String(ct))):cv(a.String(ct))):void 0);W.debug((((_.Curried3(function(cP,cQ,cR){return cP("Ending utterances: "+$.prettyPrint(cQ)+". Ending questions:"+$.prettyPrint(cR)+".");}))(a.id))(bz))(bx));};W.haveTask=function(bv){return bc.exists(function(bw){return bw.get_Name()===bv;},W.tasks());};W.getTask=function(bv){return bd.tryFind(function(bw){return bw.get_Name()===bv;},W.tasks());};W.tasks=function(){X.$cctor();return X.tasks;};W.debug=function(bv){d.debug("Main",bv);};X.$cctor=function(){X.$cctor=a.ignore;X.tasks=bc.ofArray([new G({$:0,$0:"addUser",$1:new F({$:0,$0:new E({$:0,$0:"Do you want me to add the user $0?"})})}),new G({$:0,$0:"switchUser",$1:new F({$:0,$0:new E({$:0,$0:"Do you want me to switch to the user $0?"})})})]);};Y.run=function(){var bv,bw;bv=_.ThisFunc(function(bx,by){return((Y.Main().get_Text())(bx))(by);});bw=Y.Main().get_Options();a.$("#term").terminal(bv,bw);return _6.get_Empty();};Y.Main=function(){Z.$cctor();return Z.Main;};Y.initMic=function(bv){var bw,bx;Y.set_CUI((bw={$:1,$0:new br.Microphone(bs.getElementById("microphone"))},U.New(Y.CUI().Voice,bw,Y.CUI().Term,Y.CUI().Avatar,Y.CUI().Caption)));bx=Y.CUI().Mic.$0;bx.onconnecting=function(){Y.set_MicState(R.MicConnecting);return Y.debug("Mic connecting...");};bx.ondisconnected=function(){Y.set_MicState(R.MicDisconnected);return Y.debug("Mic disconnected.");};bx.onaudiostart=function(){Y.set_MicState(R.MicAudioStart);return Y.debug("Mic audio start...");};bx.onaudioend=function(){Y.set_MicState(R.MicAudioEnd);return Y.debug("Mic audio end.");};bx.onerror=function(by){Y.set_MicState({$:6,$0:by});return Y.debug((function(bz){return function(bA){return bz("Mic error : "+$.toSafe(bA)+".");};}(a.id))(by));};bx.onready=function(){Y.set_MicState(R.MicReady);return Y.debug("Mic ready.");};bx.onresult=function(by,bz){return Y.ClientState().$==2?Y.echo("I'm still trying to understand what you said before."):Y.ClientState().$==0?d.error("Client is not intialized."):!(by==null||bz==null)?(Y.set_MicState({$:7,$0:by,$1:bz}),Y.debug((((_.Curried3(function(bA,bB,bC){return bA("Mic result: "+$.prettyPrint(bB)+" "+$.prettyPrint(bC)+".");}))(a.id))(by))(bz)),bv(by,bz)):Y.debug("Mic: No result returned.");};bx.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};Y.sayRandom=function(bv,bw){Y.say(Q.getRandomPhrase(bw,bv));};Y.say=function(bv){Y.Responses().unshift(bv);Y["say'"](bv);};Y["say'"]=function(bv){Y.CUI().Say(bv);};Y.initSpeech=function(){var bv;bv=d.toArray(Y.synth().getVoices());_8.length(bv)>0?(_8.iter(function(bw){if(bt.Equals(Y.CUI().Voice,null)&&(bw.name.indexOf("Microsoft Zira")!=-1||bw.name.toLowerCase().indexOf("female")!=-1)){Y.set_CUI(U.New({$:1,$0:bw},Y.CUI().Mic,Y.CUI().Term,Y.CUI().Avatar,Y.CUI().Caption));Y.debug((function(bx){return function(by){return bx("Using browser speech synthesis voice "+$.toSafe(by)+".");};}(a.id))(Y.CUI().Voice.$0.name));}},bv),!bt.Equals(Y.CUI().Voice,null)?(Y.CUI().Avatar.nativeVoice=true,Y.CUI().Avatar.nativeVoiceName=Y.CUI().Voice.$0.name,Y.debug((function(bw){return function(bx){return bw("Using browser speech synthesis voice "+$.toSafe(bx)+".");};}(a.id))(Y.CUI().Voice.$0.name))):void 0):void 0;bt.Equals(Y.CUI().Voice,null)?Y.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};Y.synth=function(){Z.$cctor();return Z.synth;};Y.push=function(bv){Y.Utterances().unshift(bv);return Y.Utterances();};Y.Props=function(){Z.$cctor();return Z.Props;};Y.Responses=function(){Z.$cctor();return Z.Responses;};Y.Tasks=function(){Z.$cctor();return Z.Tasks;};Y.Utterances=function(){Z.$cctor();return Z.Utterances;};Y.wait=function(bv){d["Terminal.Echo'"](Y.CUI().Term,"please wait");Y.CUI().Term.pause();bv();Y.CUI().Term.resume();};Y.debug=function(bv){d.debug("CLIENT",bv);};Y.echo=function(bv){d["Terminal.EchoHtml'"](Y.CUI().Term,(function(bw){return function(bx){return bw($.prettyPrint(bx));};}(a.id))(bv));};Y.ClientState=function(){Z.$cctor();return Z.ClientState;};Y.set_ClientState=function(bv){Z.$cctor();Z.ClientState=bv;};Y.MicState=function(){Z.$cctor();return Z.MicState;};Y.set_MicState=function(bv){Z.$cctor();Z.MicState=bv;};Y.CUI=function(){Z.$cctor();return Z.CUI;};Y.set_CUI=function(bv){Z.$cctor();Z.CUI=bv;};Z.$cctor=function(){var bv,bw,bx;Z.$cctor=a.ignore;function by(bA,bB){var bC,bD,bE,bF,bG,bH,bI,bJ;Y.debug((((_.Curried3(function(bK,bL,bM){return bK("Voice: "+$.prettyPrint(bL)+" "+$.prettyPrint(bM));}))(a.id))(bA))(bB));bC=(bD=H["Intent'"](bA,bB),bD!=null&&bD.$==1?{$:1,$0:bD.$0}:null);bE=(bF=H["Trait'"](bB),bF!=null&&bF.$==1?{$:1,$0:bc.ofArray([bF.$0])}:null);bG=(bH=H["Entity'$1"](bB),bH!=null&&bH.$==1?{$:1,$0:bc.ofArray([bH.$0])}:null);bC==null&&(bE==null&&bG==null)?void 0:(Y.debug(((((_.Curried(function(bK,bL,bM,bN){return bK("Voice: "+_1.p(bL)+" "+_1.p$3(bM)+" "+_1.p$5(bN));},4))(a.id))(bC))(bE))(bG)),bJ=Y.push(new D({$:0,$0:"",$1:bC,$2:bE,$3:bG})),W.update(Y.CUI(),Y.Props(),Y.Tasks(),Y.Responses(),bJ));}function bz(bA,bB){var bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM;Y.set_CUI(U.New(Y.CUI().Voice,Y.CUI().Mic,bA,Y.CUI().Avatar,Y.CUI().Caption));bt.Equals(Y.CUI().Mic,null)?Y.initMic(by):void 0;bt.Equals(Y.CUI().Voice,null)?Y.initSpeech():void 0;Y.ClientState().$===0?Y.set_ClientState(S.ClientReady):void 0;return(bC=J.Blank(bB),bC!=null&&bC.$==1)?Y["say'"]("Tell me what you want me to do or ask me a question."):(bD=J.Debug(bB),bD!=null&&bD.$==1)?(Y.debug((function(bN){return function(bO){return bN("Utterances: "+$.prettyPrint(bO));};}(a.id))(Y.Utterances())),Y.debug((function(bN){return function(bO){return bN("Tasks: "+$.prettyPrint(bO));};}(a.id))(Y.Tasks()))):(bE=J.Voices(bB),bE!=null&&bE.$==1)?(bF=d.toArray(d.speechSynthesis().getVoices()),(Y["say'"]((function(bN){return function(bO){return bN("There are currently "+a.String(bO)+" voices installed on this computer or device.");};}(a.id))(_8.length(bF))),_8.iteri(function(bN,bO){return Y["say'"](((((_.Curried(function(bP,bQ,bR,bS){return bP("Voice "+a.String(bQ)+". Name: "+$.toSafe(bR)+", Local: "+$.prettyPrint(bS)+".");},4))(a.id))(bN))(bO.name))(bO.localService));},bF))):Y.ClientState().$==1?(bH=J.QuickHello(bB),bH!=null&&bH.$==1?(bG=bH.$0,true):(bI=J.QuickHelp(bB),bI!=null&&bI.$==1?(bG=bI.$0,true):(bJ=J.QuickYes(bB),bJ!=null&&bJ.$==1?(bG=bJ.$0,true):(bK=J.QuickNo(bB),bK!=null&&bK.$==1&&(bG=bK.$0,true)))))?(Y.debug((function(bN){return function(bO){return bN("Quick Text: "+_1.p$7(bO)+".");};}(a.id))(bG)),bL=Y.push(bG),W.update(Y.CUI(),Y.Props(),Y.Tasks(),Y.Responses(),bL),Y.set_ClientState(S.ClientReady)):Y.CUI().Wait((bM=null,bg.Delay(function(){Y.set_ClientState(S.ClientUnderstand);J.getUtterance(bB,function(bN){var bO,bP,bQ;bO=J.HasUtterance(bN);bO!=null&&bO.$==1?(bP=bO.$0,Y.debug(((((_.Curried(function(bR,bS,bT,bU){return bR("Text: Intent: "+_1.p(bS)+", Traits: "+_1.p$3(bT)+", Entities: "+_1.p$5(bU));},4))(a.id))(bP.get_Intent()))(bP.get_Traits()))(bP.get_Entities())),bQ=Y.push(bP),W.update(Y.CUI(),Y.Props(),Y.Tasks(),Y.Responses(),bQ)):(Y.debug("Text: Did not receive a meaning from the server."),Y["say'"]("Sorry I did not understand what you said."));});Y.set_ClientState(S.ClientReady);return bg.Zero();}))):Y.ClientState().$==0?d.error("Client is not initialized."):Y["say'"]("I'm still trying to understand what you said before.");}Z.CUI=U.New(null,null,null,(bm.applicationId="4277115329081938617",bv=new a.SDKConnection(),bw=new a.WebAvatar(),bw.version=8.5,bw.connection=bv,bw.avatar="20926186",bw.voice="cmu-slt",bw.voiceMod="default",bw.width=175,bw.createBox(),bw.addMessage(""),bw.processMessages(0),bw),false);Z.MicState=R.MicNotInitialized;Z.ClientState=S.ClientNotInitialzed;Z.Utterances=[];Z.Tasks=[];Z.Responses=[];Z.Props=new bu.New$5();Z.synth=a.speechSynthesis;Z.Main=new T({$:0,$0:function(bA){return by(bA[0],bA[1]);},$1:[function(bA){return function(bB){return bz(bA,bB);};},(bx={},bx.name="Main",bx.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bx.prompt=">",bx)]});};_0.p=function(bv){return"{"+("text = "+$.prettyPrint(bv.text))+"; "+("intents = "+$.printArray(function(bw){return _0.p$1(bw);},bv.intents))+"; "+("entities = "+$.prettyPrint(bv.entities))+"; "+("traits = "+$.prettyPrint(bv.traits))+"}";};_0.p$1=function(bv){return"{"+("id = "+$.prettyPrint(bv.id))+"; "+("name = "+$.prettyPrint(bv.name))+"; "+("confidence = "+$.prettyPrint(bv.confidence))+"}";};_1.p$8=function(bv){return"Task ("+$.prettyPrint(bv.$0)+", "+_1.p$9(bv.$1)+")";};_1.p$9=function(bv){return bv.$==1?"Html ("+_1.p$10(bv.$0)+", "+$.prettyPrint(bv.$1)+")":"Ssml "+_1.p$10(bv.$0);};_1.p$10=function(bv){return"SSML "+$.prettyPrint(bv.$0);};_1.p$2=function(bv){return bv==null?"null":"Some "+$.prettyPrint(bv.$0);};_1.p$1=function(bv){return"Intent ("+$.prettyPrint(bv.$0)+", "+_1.p$2(bv.$1)+")";};_1.p=function(bv){return bv==null?"null":"Some "+_1.p$1(bv.$0);};_1.p$4=function(bv){return"Trait ("+$.prettyPrint(bv.$0)+", "+$.prettyPrint(bv.$1)+", "+_1.p$2(bv.$2)+")";};_1.p$3=function(bv){return bv==null?"null":"Some "+$.printList(function(bw){return _1.p$4(bw);},bv.$0);};_1.p$6=function(bv){return"Entity ("+$.prettyPrint(bv.$0)+", "+$.prettyPrint(bv.$1)+", "+_1.p$2(bv.$2)+")";};_1.p$5=function(bv){return bv==null?"null":"Some "+$.printList(function(bw){return _1.p$6(bw);},bv.$0);};_1.p$7=function(bv){return"Utterance ("+$.prettyPrint(bv.$0)+", "+_1.p(bv.$1)+", "+_1.p$3(bv.$2)+", "+_1.p$5(bv.$3)+")";};}());
