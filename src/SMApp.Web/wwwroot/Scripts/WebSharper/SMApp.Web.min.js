(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.User=c.User||{};e=c.Meaning=c.Meaning||{};f=c.Intent=c.Intent||{};g=c.Entity=c.Entity||{};h=c.Interpreter=c.Interpreter||{};i=c.Resource=c.Resource||{};j=c.NLU=c.NLU||{};k=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};l=c.CUI=c.CUI||{};m=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};n=c.ClientExtensions=c.ClientExtensions||{};o=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};p=c.Client=c.Client||{};q=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};r=a.IntelliFactory;s=r&&r.Runtime;t=a.WebSharper;u=t&&t.List;v=t&&t.Seq;w=t&&t.Random;x=t&&t.Arrays;y=a.jQuery;z=a.console;A=t&&t.UI;B=A&&A.Doc;C=t&&t.Concurrency;D=t&&t.Utils;E=t&&t.Unchecked;F=t&&t.Remoting;G=F&&F.AjaxRemotingProvider;d.New=function(H){return{UserName:H};};e=c.Meaning=s.Class({get_TopIntent:function(){return u.head(u.sortBy(function(H){return H.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,e);f=c.Intent=s.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,f);g=c.Entity=s.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,g);h=c.Interpreter=s.Class({get_Options:function(){return(this.get_Unwrap())[1];},get_Func:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0[0],this.$0[1]];}},null,h);i.New=function(H,I,J){return{Name:H,Description:I,Url:J};};j.HelloUser=function(H){var I,J;return(J=j.Hello(H),J!=null&&J.$==1&&(J.$0.$==1&&(J.$0.$1.$==0&&(J.$0.$0.get_Role()==="contact"&&(I=J.$0.$0,true)))))?{$:1,$0:I}:null;};j.Hello=function(H){var I,J;return H!=null&&H.$==1&&(J=j.Intent("Hello",H.$0),J!=null&&J.$==1&&(I=J.$0,true))?{$:1,$0:I}:null;};j.QuickHello=function(H){var I;switch(H==="hello"?0:H==="hey"?0:H==="yo"?0:H==="hi"?0:H==="help"?1:H==="debug on"?2:H==="debug off"?3:H.toLowerCase()==="programs"?4:5){case 0:return{$:0,$0:null};case 1:return{$:1,$0:null};case 2:return{$:2,$0:null};case 3:return{$:3,$0:null};case 4:return{$:4,$0:null};case 5:return{$:5,$0:null};}};j.Intent=function(H,I){return I.get_TopIntent().get_Name()===H&&I.get_TopIntent().get_Confidence()>j.intentConfidenceThreshold()?{$:1,$0:u.filter(function(J){return J.get_Confidence()>j.entityConfidenceThreshold();},I.get_Entities())}:null;};j.availablePrograms=function(){k.$cctor();return k.availablePrograms;};j.entityConfidenceThreshold=function(){k.$cctor();return k.entityConfidenceThreshold;};j.set_entityConfidenceThreshold=function(H){k.$cctor();k.entityConfidenceThreshold=H;};j.intentConfidenceThreshold=function(){k.$cctor();return k.intentConfidenceThreshold;};j.set_intentConfidenceThreshold=function(H){k.$cctor();k.intentConfidenceThreshold=H;};k.$cctor=function(){k.$cctor=a.ignore;k.intentConfidenceThreshold=0.85;k.entityConfidenceThreshold=0.85;k.availablePrograms=u.ofArray(["Depression","Arthritis"]);};l.helloUserPhrases=function(){m.$cctor();return m.helloUserPhrases;};l.helloPhrases=function(){m.$cctor();return m.helloPhrases;};l.getRandomPhrase=function(H){return v.nth(l.rng().Next(0,H.get_Length()),H);};l.rng=function(){m.$cctor();return m.rng;};m.$cctor=function(){m.$cctor=a.ignore;m.rng=new w.New();m.helloPhrases=u.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);m.helloUserPhrases=u.ofArray(["Hi $user, welcome back.","Welcome $user, nice to see you again..","Hello $user","Good to see you $user."]);};n.toArray=function(H){return x.map(a.id,y.makeArray(H));};n.info=function(H){z.info(H);};n.error=function(H){y.error(H);};n["Terminal.Push"]=function(H,I){var J,K;J=I.get_Func();K=I.get_Options();H.push(s.CreateFuncWithThis(J),K);};n["Terminal.EchoHtml'"]=function(H,I){H.disable();H.echo(I,n.rawOpt());H.enable();};n["Terminal.Echo'"]=function(H,I){H.disable();H.echo(I);H.enable();};n.rawOpt=function(){o.$cctor();return o.rawOpt;};o.$cctor=function(){var H;o.$cctor=a.ignore;o.rawOpt=(H={},H.raw=true,H);};p.Term=function(){var H,I;H=s.ThisFunc(function(J,K){return((p.Main().get_Func())(J))(K);});I=p.Main().get_Options();a.$("#main").terminal(H,I);p.context().unshift({$:0,$0:p.Main()});return B.get_Empty();};p.Main=function(){q.$cctor();return q.Main;};p.d=function(){q.$cctor();return q.d;};p.wait=function(H){var I;C.Start((I=null,C.Delay(function(){H();return C.Zero();})),null);n["Terminal.Echo'"](p.currentTerm(),"please wait");p.currentTerm().disable();H();p.currentTerm().enable();};p.stopSpeaking=function(){q.$cctor();return q.stopSpeaking;};p.sayRandom=function(H){p.say(l.getRandomPhrase(H));};p.sayVoices=function(){var H,I,J,K;H=n.toArray(a.speechSynthesis.getVoices());p.say((function(L){return function(M){return L("There are currently "+a.String(M)+" voices installed on this computer or device.");};}(a.id))(x.length(H)));for(I=0,J=x.length(H)-1;I<=J;I++){K=x.get(H,I);p.say(((((s.Curried(function(L,M,N,O){return L("Voice "+a.String(M)+". Name: "+D.toSafe(N)+", Local: "+D.prettyPrint(O)+".");},4))(a.id))(I))(K.name))(K.localService));}};p.say=function(H){var I;C.Start((I=null,C.Delay(function(){var J;J=new a.SpeechSynthesisUtterance(H);J.voice=p.currentVoice();a.speechSynthesis.speak(J);return C.Zero();})),null);p.transcribe()?p.currentTerm().echo(H):void 0;};p.initSpeech=function(){var H,I,J;H=n.toArray(a.speechSynthesis.getVoices());x.iter(function(K){if(E.Equals(p.currentVoice(),null)&&(K.name.indexOf("Microsoft Zira")!=-1||K.name.toLowerCase().indexOf("female")!=-1)){p.set_currentVoice(K);n.info((function(L){return function(M){return L("Using voice "+D.toSafe(M)+".");};}(a.id))(p.currentVoice().name));}},H);E.Equals(p.currentVoice(),null)&&x.length(H)>0?(p.set_currentVoice(x.find(function(K){return K["default"];},H)),n.info((function(K){return function(L){return K("Using voice "+D.toSafe(L)+".");};}(a.id))(p.currentVoice().name)),I=new a.SpeechSynthesisUtterance(function(K){return K("Using the default speech synthesis voice.");}(a.id)),C.Start((J=null,C.Delay(function(){a.speechSynthesis.speak(I);return C.Zero();})),null)):E.Equals(p.currentVoice(),null)?n.error("No speech synthesis voice is available. In order to use Selma you must install a speech synthesis voice on this device or computer."):void 0;};p.transcribe=function(){q.$cctor();return q.transcribe;};p.set_transcribe=function(H){q.$cctor();q.transcribe=H;};p.debugMode=function(){q.$cctor();return q.debugMode;};p.set_debugMode=function(H){q.$cctor();q.debugMode=H;};p.currentTerm=function(){q.$cctor();return q.currentTerm;};p.set_currentTerm=function(H){q.$cctor();q.currentTerm=H;};p.currentVoice=function(){q.$cctor();return q.currentVoice;};p.set_currentVoice=function(H){q.$cctor();q.currentVoice=H;};p.context=function(){q.$cctor();return q.context;};q.$cctor=function(){var H;q.$cctor=a.ignore;function I(J,K){var L,M;p.set_currentTerm(J);E.Equals(p.currentVoice(),null)?p.initSpeech():void 0;L=j.QuickHello(K);return L.$==1?n["Terminal.EchoHtml'"](J,p.d()):L.$==2?(p.set_debugMode(true),p.say("Debug mode is now on.")):L.$==3?(p.set_debugMode(false),p.say("Debug mode is now off.")):L.$==4?(p.say("The following programs are available:"),u.iteri(function(N,O){return p.say((((s.Curried3(function(P,Q,R){return P(a.String(Q)+". "+D.toSafe(R));}))(a.id))(N))(O));},j.availablePrograms())):L.$==5?(n["Terminal.Echo'"](p.currentTerm(),"please wait"),J.disable(),C.Start((M=null,C.Delay(function(){return C.Combine(C.Bind((new G.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:-691373952",[K]),function(N){var O;O=j.HelloUser(N);return O!=null&&O.$==1?(p.say((function(P){return function(Q){return P("This is the hello intent. The user name is "+D.toSafe(Q)+".");};}(a.id))(O.$0.get_Value())),C.Zero()):(n["Terminal.Echo'"](J,"This is the whatever intent"),C.Zero());}),C.Delay(function(){J.enable();return C.Zero();}));})),null)):p.sayRandom(l.helloPhrases());}q.context=[];q.currentVoice=null;q.currentTerm=null;q.debugMode=false;q.transcribe=false;q.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;q.d="\n        <div class=\"card\" style=\"width: 18rem;\">\n        <img class=\"card-img-top\" src=\"...\" alt=\"Card image cap\">\n        <div class=\"card-body\">\n          <h5 class=\"card-title\">Card title</h5>\n          <p class=\"card-text\">Some quick example text to build on the card title and make up the bulk of the card's content.</p>\n          <a href=\"#\" class=\"btn btn-primary\">Go somewhere</a>\n        </div>\n</div>\n    ";q.Main=new h({$:0,$0:[function(J){return function(K){return I(J,K);};},(H={},H.name="Main",H.greetings="Welcome to Selma. Type hello to begin or help for more assistance.",H.prompt=">",H)]});};}());
