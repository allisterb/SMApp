(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P;a=self;b=a.SMApp=a.SMApp||{};c=b.Bootstrap=b.Bootstrap||{};d=c.Controls=c.Controls||{};e=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};f=b.Web=b.Web||{};g=f.User=f.User||{};h=f.Meaning=f.Meaning||{};i=f.Intent=f.Intent||{};j=f.Entity=f.Entity||{};k=f.Interpreter=f.Interpreter||{};l=f.Resource=f.Resource||{};m=f.NLU=f.NLU||{};n=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};o=f.CUI=f.CUI||{};p=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};q=f.ClientExtensions=f.ClientExtensions||{};r=f._Html=f._Html||{};s=f.htmModule=f.htmModule||{};t=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};u=f.Client=f.Client||{};v=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};w=a.WebSharper;x=w&&w.UI;y=x&&x.Doc;z=w&&w.List;A=x&&x.AttrModule;B=a.IntelliFactory;C=B&&B.Runtime;D=w&&w.Seq;E=w&&w.Random;F=w&&w.Arrays;G=a.jQuery;H=a.console;I=w&&w.Strings;J=w&&w.Utils;K=w&&w.Concurrency;L=w&&w.Unchecked;M=a.Wit;N=a.document;O=w&&w.Remoting;P=O&&O.AjaxRemotingProvider;d.Radio=function(Q,R,S,T,U){return y.Element("div",new z.T({$:1,$0:(d.cls())("radio"),$1:R}),[y.Element("label",T,[y.Radio(U,true,S),y.TextNode(Q)])]);};d.Checkbox=function(Q,R,S,T,U){return y.Element("div",new z.T({$:1,$0:(d.cls())("checkbox"),$1:R}),[y.Element("label",T,[y.CheckBox(U,S),y.TextNode(Q)])]);};d.TextArea=function(Q,R,S,T,U){return y.Element("div",new z.T({$:1,$0:(d.cls())("form-group"),$1:R}),[y.Element("label",T,[y.TextNode(Q)]),y.InputArea(new z.T({$:1,$0:(d.cls())("form-control"),$1:U}),S)]);};d.InputPassword=function(Q,R,S,T,U){return y.Element("div",new z.T({$:1,$0:(d.cls())("form-group"),$1:R}),[y.Element("label",T,[y.TextNode(Q)]),y.PasswordBox(new z.T({$:1,$0:(d.cls())("form-control"),$1:U}),S)]);};d.Input=function(Q,R,S,T,U){return y.Element("div",new z.T({$:1,$0:(d.cls())("form-group"),$1:R}),[y.Element("label",T,[y.TextNode(Q)]),y.Input(new z.T({$:1,$0:(d.cls())("form-control"),$1:U}),S)]);};d.Container=function(Q){return y.Element("div",[(d.cls())("container")],Q);};d.Class=function(){e.$cctor();return e.Class;};d.cls=function(){e.$cctor();return e.cls;};e.$cctor=function(){e.$cctor=a.ignore;e.cls=A.Class;e.Class=A.Class;};g.New=function(Q){return{UserName:Q};};h=f.Meaning=C.Class({get_TopIntent:function(){return z.head(z.sortBy(function(Q){return Q.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,h);i=f.Intent=C.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,i);j=f.Entity=C.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,j);k=f.Interpreter=C.Class({get_Options:function(){return(this.get_Unwrap())[1];},get_Func:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0[0],this.$0[1]];}},null,k);l.New=function(Q,R,S){return{Name:Q,Description:R,Url:S};};m.HelloUser=function(Q){var R,S;return(S=m.Hello(Q),S!=null&&S.$==1&&(S.$0.$==1&&(S.$0.$1.$==0&&(S.$0.$0.get_Role()==="contact"&&(R=S.$0.$0,true)))))?{$:1,$0:R}:null;};m.Hello=function(Q){var R,S;return Q!=null&&Q.$==1&&(S=m.Intent("Hello",Q.$0),S!=null&&S.$==1&&(R=S.$0,true))?{$:1,$0:R}:null;};m.QuickHello=function(Q){var R;switch(Q==="hello"?0:Q==="hey"?0:Q==="yo"?0:Q==="hi"?0:Q==="help"?1:Q==="debug on"?2:Q==="debug off"?3:Q.toLowerCase()==="programs"?4:5){case 0:return{$:0,$0:null};case 1:return{$:1,$0:null};case 2:return{$:2,$0:null};case 3:return{$:3,$0:null};case 4:return{$:4,$0:null};case 5:return{$:5,$0:null};}};m.Intent=function(Q,R){return R.get_TopIntent().get_Name()===Q&&R.get_TopIntent().get_Confidence()>m.intentConfidenceThreshold()?{$:1,$0:z.filter(function(S){return S.get_Confidence()>m.entityConfidenceThreshold();},R.get_Entities())}:null;};m.availablePrograms=function(){n.$cctor();return n.availablePrograms;};m.entityConfidenceThreshold=function(){n.$cctor();return n.entityConfidenceThreshold;};m.set_entityConfidenceThreshold=function(Q){n.$cctor();n.entityConfidenceThreshold=Q;};m.intentConfidenceThreshold=function(){n.$cctor();return n.intentConfidenceThreshold;};m.set_intentConfidenceThreshold=function(Q){n.$cctor();n.intentConfidenceThreshold=Q;};n.$cctor=function(){n.$cctor=a.ignore;n.intentConfidenceThreshold=0.85;n.entityConfidenceThreshold=0.85;n.availablePrograms=z.ofArray(["Depression","Arthritis"]);};o.helloUserPhrases=function(){p.$cctor();return p.helloUserPhrases;};o.helloPhrases=function(){p.$cctor();return p.helloPhrases;};o.getRandomPhrase=function(Q){return D.nth(o.rng().Next(0,Q.get_Length()),Q);};o.rng=function(){p.$cctor();return p.rng;};p.$cctor=function(){p.$cctor=a.ignore;p.rng=new E.New();p.helloPhrases=z.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);p.helloUserPhrases=z.ofArray(["Hi $user, welcome back.","Welcome $user, nice to see you again..","Hello $user","Good to see you $user."]);};q.toArray=function(Q){return F.map(a.id,G.makeArray(Q));};q.error=function(Q){H.error(Q);};q.info=function(Q){H.info(Q);};q.jserror=function(Q){G.error(Q);};q["Terminal.Push"]=function(Q,R){var S,T;S=R.get_Func();T=R.get_Options();Q.push(C.CreateFuncWithThis(S),T);};q["Terminal.EchoHtml'"]=function(Q,R){Q.disable();Q.echo(R,q.rawOpt());Q.enable();};q["Terminal.Echo'"]=function(Q,R){Q.disable();Q.echo(R);Q.enable();};q.rawOpt=function(){t.$cctor();return t.rawOpt;};r=f._Html=C.Class({toString:function(){return r.toString(this);}},null,r);r.toString=function(Q){function R(S){return function(T){var U,V,W,X,Y,Z,_0;V=I.replicate(S," ");switch(T.$==0?T.$1.$==1?T.$1.$0.$==2?T.$1.$1.$==0?(U=[T.$1.$0.$0,T.$0],1):(U=[T.$1,T.$0],2):(U=[T.$1,T.$0],2):(U=[T.$1,T.$0],2):T.$==2?(U=T.$0,3):(U=[T.$0,T.$1],0)){case 0:return U[0]+"=\""+U[1]+"\"";case 1:W=U[1];return V+"<"+W+">"+U[0]+"</"+W+">\r\n";case 2:X=U[1];Y=z.partition(function(_1){return _1.$==1;},U[0]);Z=Y[1];_0=Y[0];return Z.$==0?V+"<"+X+(_0.$===0?"":" "+I.concat(" ",z.ofSeq(D.delay(function(){return D.map(function(_1){return(R(0))(_1);},_0);}))))+"/>\r\n":V+"<"+X+(_0.$===0?"":" "+I.concat(" ",z.ofSeq(D.delay(function(){return D.map(function(_1){return(R(0))(_1);},_0);}))))+">\r\n"+I.concat("",z.ofSeq(D.delay(function(){return D.map(function(_1){return(R(S+1))(_1);},Z);})))+V+"</"+X+">\r\n";case 3:return V+U+"\r\n";}};}return(R(0))(Q);};s.alt=function(Q){return new r({$:1,$0:"alt",$1:Q});};s.src=function(Q){return new r({$:1,$0:"src",$1:Q});};s.cls=function(Q){return new r({$:1,$0:"class",$1:Q});};s.str=function(Q){return r.toString(Q);};s.op_PercentEquals=function(Q,R){return new r({$:1,$0:Q,$1:R});};s.op_Splice=function(Q){var R;return z.ofArray([new r({$:2,$0:(R=Q,a.String(R))})]);};s.strong=function(){t.$cctor();return t.strong;};s.h4=function(){t.$cctor();return t.h4;};s.h3=function(){t.$cctor();return t.h3;};s.h2=function(){t.$cctor();return t.h2;};s.h1=function(){t.$cctor();return t.h1;};s.li=function(){t.$cctor();return t.li;};s.ul=function(){t.$cctor();return t.ul;};s.th=function(){t.$cctor();return t.th;};s.td=function(){t.$cctor();return t.td;};s.tr=function(){t.$cctor();return t.tr;};s.a=function(){t.$cctor();return t.a;};s.p=function(){t.$cctor();return t.p;};s.area=function(){t.$cctor();return t.area;};s.map=function(){t.$cctor();return t.map;};s.img=function(){t.$cctor();return t.img;};s.tfoot=function(){t.$cctor();return t.tfoot;};s.tbody=function(){t.$cctor();return t.tbody;};s.thead=function(){t.$cctor();return t.thead;};s.table=function(){t.$cctor();return t.table;};s.span=function(){t.$cctor();return t.span;};s.section=function(){t.$cctor();return t.section;};s.br=function(){t.$cctor();return t.br;};s.div=function(){t.$cctor();return t.div;};s.body=function(){t.$cctor();return t.body;};s.style=function(){t.$cctor();return t.style;};s.title=function(){t.$cctor();return t.title;};s.head=function(){t.$cctor();return t.head;};s.html=function(){t.$cctor();return t.html;};s.elem=function(Q,R){return new r({$:0,$0:Q,$1:R});};t.$cctor=function(){var Q;t.$cctor=a.ignore;t.rawOpt=(Q={},Q.raw=true,Q);t.html=function(R){return s.elem("html",R);};t.head=function(R){return s.elem("head",R);};t.title=function(R){return s.elem("title",R);};t.style=function(R){return s.elem("style",R);};t.body=function(R){return s.elem("body",R);};t.div=function(R){return s.elem("div",R);};t.br=function(R){return s.elem("br",R);};t.section=function(R){return s.elem("section",R);};t.span=function(R){return s.elem("span",R);};t.table=function(R){return s.elem("table",R);};t.thead=function(R){return s.elem("thead",R);};t.tbody=function(R){return s.elem("tbody",R);};t.tfoot=function(R){return s.elem("tfoot",R);};t.img=function(R){return s.elem("img",R);};t.map=function(R){return s.elem("map",R);};t.area=function(R){return s.elem("area",R);};t.p=function(R){return s.elem("p",R);};t.a=function(R){return s.elem("a",R);};t.tr=function(R){return s.elem("tr",R);};t.td=function(R){return s.elem("td",R);};t.th=function(R){return s.elem("th",R);};t.ul=function(R){return s.elem("ul",R);};t.li=function(R){return s.elem("li",R);};t.h1=function(R){return s.elem("h1",R);};t.h2=function(R){return s.elem("h1",R);};t.h3=function(R){return s.elem("h1",R);};t.h4=function(R){return s.elem("h1",R);};t.strong=function(R){return s.elem("strong",R);};};u.Term=function(){var Q,R;Q=C.ThisFunc(function(S,T){return((u.Main().get_Func())(S))(T);});R=u.Main().get_Options();a.$("#main").terminal(Q,R);u.context().unshift({$:0,$0:u.Main()});return y.get_Empty();};u.Main=function(){v.$cctor();return v.Main;};u.container=function(){v.$cctor();return v.container;};u.wait=function(Q){q["Terminal.Echo'"](u.currentTerm(),"please wait");u.currentTerm().disable();Q();u.currentTerm().enable();};u.stopSpeaking=function(){v.$cctor();return v.stopSpeaking;};u.sayRandom=function(Q){u.say(o.getRandomPhrase(Q));};u.sayVoices=function(){var Q,R,S,T;Q=a.speechSynthesis.getVoices();if(!(Q==null)){u.say((function(U){return function(V){return U("There are currently "+a.String(V)+" voices installed on this computer or device.");};}(a.id))(Q.length));for(R=0,S=Q.length-1;R<=S;R++){T=Q.item(R);u.say(((((C.Curried(function(U,V,W,X){return U("Voice "+a.String(V)+". Name: "+J.toSafe(W)+", Local: "+J.prettyPrint(X)+".");},4))(a.id))(R))(T.name))(T.localService));}}else void 0;};u.say=function(Q){var R,S,T;if(R=u.currentVoice(),R!=null&&R.$==1){S=u.currentVoice().$0;K.Start((T=null,K.Delay(function(){var U;U=new a.SpeechSynthesisUtterance(Q);U.voice=S;a.speechSynthesis.speak(U);return K.Zero();})),null);u.echo()?q["Terminal.Echo'"](u.currentTerm(),Q):void 0;}else q["Terminal.Echo'"](u.currentTerm(),Q);};u.initSpeech=function(){var Q;Q=q.toArray(a.speechSynthesis.getVoices());F.iter(function(R){if(L.Equals(u.currentVoice(),null)&&(R.name.indexOf("Microsoft Zira")!=-1||R.name.toLowerCase().indexOf("female")!=-1)){u.set_currentVoice({$:1,$0:R});q.info((function(S){return function(T){return S("Using voice "+J.toSafe(T)+".");};}(a.id))(u.currentVoice().$0.name));}},Q);L.Equals(u.currentVoice(),null)&&F.length(Q)>0?(u.set_currentVoice({$:1,$0:F.find(function(R){return R["default"];},Q)}),q.info((function(R){return function(S){return R("Using default voice "+J.toSafe(S)+".");};}(a.id))(u.currentVoice().$0.name))):L.Equals(u.currentVoice(),null)?(q.error("No speech synthesis voice is available."),q["Terminal.Echo'"](u.currentTerm(),"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma.")):void 0;};u.echo=function(){v.$cctor();return v.echo;};u.set_echo=function(Q){v.$cctor();v.echo=Q;};u.debugMode=function(){v.$cctor();return v.debugMode;};u.set_debugMode=function(Q){v.$cctor();v.debugMode=Q;};u.currentTerm=function(){v.$cctor();return v.currentTerm;};u.set_currentTerm=function(Q){v.$cctor();v.currentTerm=Q;};u.currentVoice=function(){v.$cctor();return v.currentVoice;};u.set_currentVoice=function(Q){v.$cctor();v.currentVoice=Q;};u.context=function(){v.$cctor();return v.context;};v.$cctor=function(){var Q;v.$cctor=a.ignore;function R(S,T){var U,V,W;u.set_currentTerm(S);L.Equals(u.currentVoice(),null)?u.initSpeech():void 0;U=m.QuickHello(T);return U.$==1?(V=new M.Microphone(N.getElementById("microphone")),(V.onready=function(){return q["Terminal.Echo'"](S,"Ready.");},V.onconnecting=function(){return q["Terminal.Echo'"](S,"Connecting...");},V.ondisconnected=function(){return q["Terminal.Echo'"](S,"Disconnected.");},V.onaudiostart=function(){return q["Terminal.Echo'"](S,"Audio start...");},V.onaudioend=function(){return q["Terminal.Echo'"](S,"Audio end.");},V.onerror=function(X){return q["Terminal.Echo'"](S,(function(Y){return function(Z){return Y("Error : "+J.toSafe(Z)+".");};}(a.id))(X));},V.onresult=function(X,Y){q.info(Y.intent);q.info(X);q.info(Y);return q.info(Y.foo);},V.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT"))):U.$==2?(u.set_debugMode(true),u.say("Debug mode is now on.")):U.$==3?(u.set_debugMode(false),u.say("Debug mode is now off.")):U.$==4?(u.say("The following programs are available:"),z.iteri(function(X,Y){return u.say((((C.Curried3(function(Z,_0,_1){return Z(a.String(_0)+". "+J.toSafe(_1));}))(a.id))(X))(Y));},m.availablePrograms())):U.$==5?(q["Terminal.Echo'"](u.currentTerm(),"please wait"),S.disable(),K.Start((W=null,K.Delay(function(){return K.Combine(K.Bind((new P.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:668485347",[T]),function(X){var Y;Y=m.HelloUser(X);return Y!=null&&Y.$==1?(u.say((function(Z){return function(_0){return Z("This is the hello intent. The user name is "+J.toSafe(_0)+".");};}(a.id))(Y.$0.get_Value())),K.Zero()):(q["Terminal.Echo'"](S,"This is the whatever intent"),K.Zero());}),K.Delay(function(){S.enable();return K.Zero();}));})),null)):u.sayRandom(o.helloPhrases());}v.context=[];v.currentVoice=null;v.currentTerm=null;v.debugMode=false;v.echo=false;v.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;v.container=d.Container;v.Main=new k({$:0,$0:[function(S){return function(T){return R(S,T);};},(Q={},Q.name="Main",Q.greetings="Welcome to Selma. Type hello to begin or help for more assistance.",Q.prompt=">",Q)]});};}());
