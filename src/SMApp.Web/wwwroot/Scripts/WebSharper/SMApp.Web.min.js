(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=b.Bootstrap=b.Bootstrap||{};i=h.Controls=h.Controls||{};j=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};k=c.NLU=c.NLU||{};l=k.Intent=k.Intent||{};m=k.Trait=k.Trait||{};n=k.Entity=k.Entity||{};o=k.Meaning=k.Meaning||{};p=k.Question=k.Question||{};q=k.Voice=k.Voice||{};r=q["Entity'"]=q["Entity'"]||{};s=k.Text=k.Text||{};t=s["Meaning'"]=s["Meaning'"]||{};u=s["Intent'"]=s["Intent'"]||{};v=s["Entity'"]=s["Entity'"]||{};w=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};x=c.CUI=c.CUI||{};y=x.User=x.User||{};z=x.MicState=x.MicState||{};A=x.OpState=x.OpState||{};B=x.Interpreter=x.Interpreter||{};C=x.CUI=x.CUI||{};D=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};E=c.Main=c.Main||{};F=c.Client=c.Client||{};G=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};H=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};I=a.WebSharper;J=I&&I.Strings;K=I&&I.Arrays;L=a.jQuery;M=I&&I.Utils;N=a.console;O=a.IntelliFactory;P=O&&O.Runtime;Q=I&&I.List;R=I&&I.Seq;S=I&&I.UI;T=S&&S.Doc;U=S&&S.AttrModule;V=I&&I.Concurrency;W=I&&I.Random;X=I&&I.Unchecked;Y=I&&I.Remoting;Z=Y&&Y.AjaxRemotingProvider;_0=a.Wit;_1=a.document;_2=I&&I.Collections;_3=_2&&_2.Dictionary;d.replace_tok=function(_4,_5,_6){return J.Replace(_6,_4,_5);};d.toLower=function(_4){return _4.toLowerCase();};d.toArray=function(_4){return K.map(a.id,L.makeArray(_4));};d.debug=function(_4){var _5;d.info((function(_6){return function(_7){return _6("DEBUG: "+M.toSafe(_7));};}(a.id))((_5=_4,a.String(_5))));};d.error=function(_4){N.error(_4);};d.info=function(_4){N.info(_4);};d.jserror=function(_4){L.error(_4);};d["Terminal.EchoHtml'"]=function(_4,_5){_4.disable();_4.echo(_5,d.rawOpt());_4.enable();};d["Terminal.Echo'"]=function(_4,_5){_4.disable();_4.echo(_5);_4.enable();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=P.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(_4){function _5(_6){return function(_7){var _8,_9,_,$,ba,bb,bc;_9=J.replicate(_6," ");switch(_7.$==0?_7.$1.$==1?_7.$1.$0.$==2?_7.$1.$1.$==0?(_8=[_7.$1.$0.$0,_7.$0],1):(_8=[_7.$1,_7.$0],2):(_8=[_7.$1,_7.$0],2):(_8=[_7.$1,_7.$0],2):_7.$==2?(_8=_7.$0,3):(_8=[_7.$0,_7.$1],0)){case 0:return _8[0]+"=\""+_8[1]+"\"";case 1:_=_8[1];return _9+"<"+_+">"+_8[0]+"</"+_+">\r\n";case 2:$=_8[1];ba=Q.partition(function(bd){return bd.$==1;},_8[0]);bb=ba[1];bc=ba[0];return bb.$==0?_9+"<"+$+(bc.$===0?"":" "+J.concat(" ",Q.ofSeq(R.delay(function(){return R.map(function(bd){return(_5(0))(bd);},bc);}))))+"/>\r\n":_9+"<"+$+(bc.$===0?"":" "+J.concat(" ",Q.ofSeq(R.delay(function(){return R.map(function(bd){return(_5(0))(bd);},bc);}))))+">\r\n"+J.concat("",Q.ofSeq(R.delay(function(){return R.map(function(bd){return(_5(_6+1))(bd);},bb);})))+_9+"</"+$+">\r\n";case 3:return _9+_8+"\r\n";}};}return(_5(0))(_4);};f.alt=function(_4){return new e({$:1,$0:"alt",$1:_4});};f.src=function(_4){return new e({$:1,$0:"src",$1:_4});};f.cls=function(_4){return new e({$:1,$0:"class",$1:_4});};f.str=function(_4){return e.toString(_4);};f.op_PercentEquals=function(_4,_5){return new e({$:1,$0:_4,$1:_5});};f.op_Splice=function(_4){var _5;return Q.ofArray([new e({$:2,$0:(_5=_4,a.String(_5))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(_4,_5){return new e({$:0,$0:_4,$1:_5});};g.$cctor=function(){var _4;g.$cctor=a.ignore;g.rawOpt=(_4={},_4.raw=true,_4);g.html=function(_5){return f.elem("html",_5);};g.head=function(_5){return f.elem("head",_5);};g.title=function(_5){return f.elem("title",_5);};g.style=function(_5){return f.elem("style",_5);};g.body=function(_5){return f.elem("body",_5);};g.div=function(_5){return f.elem("div",_5);};g.br=function(_5){return f.elem("br",_5);};g.section=function(_5){return f.elem("section",_5);};g.span=function(_5){return f.elem("span",_5);};g.table=function(_5){return f.elem("table",_5);};g.thead=function(_5){return f.elem("thead",_5);};g.tbody=function(_5){return f.elem("tbody",_5);};g.tfoot=function(_5){return f.elem("tfoot",_5);};g.img=function(_5){return f.elem("img",_5);};g.map=function(_5){return f.elem("map",_5);};g.area=function(_5){return f.elem("area",_5);};g.p=function(_5){return f.elem("p",_5);};g.a=function(_5){return f.elem("a",_5);};g.tr=function(_5){return f.elem("tr",_5);};g.td=function(_5){return f.elem("td",_5);};g.th=function(_5){return f.elem("th",_5);};g.ul=function(_5){return f.elem("ul",_5);};g.li=function(_5){return f.elem("li",_5);};g.h1=function(_5){return f.elem("h1",_5);};g.h2=function(_5){return f.elem("h1",_5);};g.h3=function(_5){return f.elem("h1",_5);};g.h4=function(_5){return f.elem("h1",_5);};g.strong=function(_5){return f.elem("strong",_5);};};i.Radio=function(_4,_5,_6,_7,_8){return T.Element("div",new Q.T({$:1,$0:(i.cls())("radio"),$1:_5}),[T.Element("label",_7,[T.Radio(_8,true,_6),T.TextNode(_4)])]);};i.Checkbox=function(_4,_5,_6,_7,_8){return T.Element("div",new Q.T({$:1,$0:(i.cls())("checkbox"),$1:_5}),[T.Element("label",_7,[T.CheckBox(_8,_6),T.TextNode(_4)])]);};i.TextArea=function(_4,_5,_6,_7,_8){return T.Element("div",new Q.T({$:1,$0:(i.cls())("form-group"),$1:_5}),[T.Element("label",_7,[T.TextNode(_4)]),T.InputArea(new Q.T({$:1,$0:(i.cls())("form-control"),$1:_8}),_6)]);};i.InputPassword=function(_4,_5,_6,_7,_8){return T.Element("div",new Q.T({$:1,$0:(i.cls())("form-group"),$1:_5}),[T.Element("label",_7,[T.TextNode(_4)]),T.PasswordBox(new Q.T({$:1,$0:(i.cls())("form-control"),$1:_8}),_6)]);};i.Input=function(_4,_5,_6,_7,_8){return T.Element("div",new Q.T({$:1,$0:(i.cls())("form-group"),$1:_5}),[T.Element("label",_7,[T.TextNode(_4)]),T.Input(new Q.T({$:1,$0:(i.cls())("form-control"),$1:_8}),_6)]);};i.Container=function(_4){return T.Element("div",[(i.cls())("container")],_4);};i.Class=function(){j.$cctor();return j.Class;};i.cls=function(){j.$cctor();return j.cls;};j.$cctor=function(){j.$cctor=a.ignore;j.cls=U.Class;j.Class=U.Class;};l=k.Intent=P.Class({toString:function(){return(((P.Curried3(function(_4,_5,_6){return _4("Intent("+M.toSafe(_5)+", "+H.p$2(_6)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,l);m=k.Trait=P.Class({toString:function(){return(((P.Curried3(function(_4,_5,_6){return _4("Trait("+M.toSafe(_5)+", "+M.prettyPrint(_6)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,m);n=k.Entity=P.Class({toString:function(){return((((P.Curried(function(_4,_5,_6,_7){return _4("Entity("+M.toSafe(_5)+", "+M.toSafe(_6)+", "+H.p$2(_7)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[2];},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,n);o=k.Meaning=P.Class({toString:function(){return((((P.Curried(function(_4,_5,_6,_7){return _4(H.p(_5)+" "+H.p$3(_6)+". "+H.p$5(_7));},4))(a.id))(this.get_Intent()))(this.get_Trait()))(this.get_Entities());},get_Entities:function(){return(this.Unwrap())[2];},get_Trait:function(){return(this.Unwrap())[1];},get_Intent:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,o);p=k.Question=P.Class({toString:function(){return(((P.Curried3(function(_4,_5,_6){return _4("("+H.p$7(_5)+","+M.prettyPrint(_6)+")");}))(a.id))(this.get_Meaning()))(this.get_Response());},get_Response:function(){return(this.Unwrap())[1];},get_Meaning:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1];}},null,p);r.New=function(_4,_5,_6,_7,_8){return{body:_4,end:_5,start:_6,suggested:_7,value:_8};};q["Intent'"]=function(_4,_5){return!(_5.intent==null)?{$:1,$0:new l({$:0,$0:d.toLower(_5.intent.value),$1:null})}:null;};q["Trait'"]=function(_4){return!(_4.greetings==null)?{$:1,$0:new m({$:0,$0:"greetings",$1:d.toLower(_4.contact.value)})}:null;};q["Entity'$1"]=function(_4){return!(_4.contact==null)?{$:1,$0:new n({$:0,$0:"contact",$1:d.toLower(_4.contact.value),$2:null})}:null;};t=s["Meaning'"]=P.Class({get_TopIntent:function(){return Q.head(Q.sortBy(function(_4){return _4.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,t);u=s["Intent'"]=P.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,u);v=s["Entity'"]=P.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,v);s.HasMeaning=function(_4){var _5,_6,_7,_8,_9,_;return _4!=null&&_4.$==1&&(_4.$0.$0.$==0&&(_4.$0.$1.get_Length()>0&&(_5=_4.$0.$1,true)))?{$:1,$0:new o({$:0,$0:null,$1:null,$2:{$:1,$0:Q.map(function($){return new n({$:0,$0:d.toLower($.get_Role()),$1:$.get_Value(),$2:{$:1,$0:$.get_Confidence()}});},Q.filter(function($){return $.get_Confidence()>s.entityConfidenceThreshold();},_5))}})}:_4!=null&&_4.$==1&&(_4.$0.$1.$==0&&(_4.$0.get_TopIntent().get_Confidence()>s.intentConfidenceThreshold()&&(_6=[_4.$0.$0,_4],true)))?(_7=_6[1],{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(_7.$0.get_TopIntent().get_Name()),$1:{$:1,$0:_7.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):_4!=null&&_4.$==1&&(_4.$0.get_TopIntent().get_Confidence()>s.intentConfidenceThreshold()&&(_8=[_4.$0.$1,_4.$0.$0,_4],true))?(_9=_8[2],(_=Q.map(function($){return new n({$:0,$0:d.toLower($.get_Role()),$1:$.get_Value(),$2:{$:1,$0:$.get_Confidence()}});},Q.filter(function($){return $.get_Confidence()>s.entityConfidenceThreshold();},_9.$0.get_Entities())),{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(_9.$0.get_TopIntent().get_Name()),$1:{$:1,$0:_9.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:_}})})):null;};s.entityConfidenceThreshold=function(){w.$cctor();return w.entityConfidenceThreshold;};s.set_entityConfidenceThreshold=function(_4){w.$cctor();w.entityConfidenceThreshold=_4;};s.intentConfidenceThreshold=function(){w.$cctor();return w.intentConfidenceThreshold;};s.set_intentConfidenceThreshold=function(_4){w.$cctor();w.intentConfidenceThreshold=_4;};s.QuickPrograms=function(_4){return _4==="programs"?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};s.QuickNo=function(_4){var _5;return _4==="no"||(_4==="NO"||(_4==="No"||(_4==="nope"||(_4==="no way"||(_4==="nah"||(_4==="don't do it"||_4==="stop"))))))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"no",$1:null})},$1:null,$2:null})}:null;};s.QuickYes=function(_4){var _5;return _4==="yes"||(_4==="YES"||(_4==="Yes"||(_4==="YEs"||(_4==="ok"||(_4==="sure"||(_4==="yeah"||(_4==="yep"||(_4==="uh huh"||(_4==="go ahead"||_4==="go")))))))))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"yes",$1:null})},$1:null,$2:null})}:null;};s.QuickHelp=function(_4){var _5;return _4==="help"||(_4==="help me"||(_4==="what's this?"||_4==="huh"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"help",$1:null})},$1:null,$2:null})}:null;};s.QuickHello=function(_4){var _5;return _4==="hello"||(_4==="hey"||(_4==="yo"||_4==="hi"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"hello",$1:null})},$1:null,$2:null})}:null;};s.DebugOff=function(_4){return _4==="debug off"?{$:1,$0:null}:null;};s.DebugOn=function(_4){return _4==="debug on"?{$:1,$0:null}:null;};s.Blank=function(_4){return _4===""?{$:1,$0:null}:null;};k.Yes=function(_4){var _5,_6;return(_6=k.Intent$1("yes",_4.$0),_6!=null&&_6.$==1)&&(_4.$1==null&&_4.$2==null)?{$:1,$0:null}:null;};k.Entity$1=function(_4,_5){return _5.get_Name()===_4?{$:1,$0:_5.get_Value()}:null;};k.Intent$1=function(_4,_5){var _6;return _5!=null&&_5.$==1&&(_5.$0.$0===_4&&(_6=_5.$0.$0,true))?{$:1,$0:null}:null;};w.$cctor=function(){w.$cctor=a.ignore;w.intentConfidenceThreshold=0.85;w.entityConfidenceThreshold=0.85;};y=x.User=P.Class({toString:function(){return this.Name;}},null,y);y.New=function(_4){return new y({Name:_4});};z.MicReady={$:5};z.MicAudioEnd={$:4};z.MicAudioStart={$:3};z.MicDisconnected={$:2};z.MicConnecting={$:1};z.MicNotInitialized={$:0};A.User={$:1};A.Lang={$:0};B=x.Interpreter=P.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,B);C=x.CUI=P.Class({get_StopSpeaking:function(){if(a.speechSynthesis.speaking||a.speechSynthesis.pending)a.speechSynthesis.cancel();},SayVoices:function(){var _4,_5,_6;_4=this;_5=a.speechSynthesis.getVoices();!(_5==null)?(_6=d.toArray(_5),_4.Say((function(_7){return function(_8){return _7("There are currently "+a.String(_8)+" voices installed on this computer or device.");};}(a.id))(K.length(_6))),K.iteri(function(_7,_8){return _4.Say(((((P.Curried(function(_9,_,$,ba){return _9("Voice "+a.String(_)+". Name: "+M.toSafe($)+", Local: "+M.prettyPrint(ba)+".");},4))(a.id))(_7))(_8.name))(_8.localService));},_6)):void 0;},Wait:function(_4){this.Wait$1(function(){V.Start(_4,null);});},Wait$1:function(_4){this["Echo'"]("please wait...");this.Term.pause();_4();this.Term.resume();},sayRandom:function(_4,_5){this.Say(x.getRandomPhrase(_4,_5));},Say:function(_4){var _5,_6,_7;_5=this.Voice;_5!=null&&_5.$==1?(_6=_5.$0,V.Start((_7=null,V.Delay(function(){var _8;_8=new a.SpeechSynthesisUtterance(_4);_8.voice=_6;a.speechSynthesis.speak(_8);return V.Zero();})),null),this.Caption?this["Echo'"](_4):void 0):this["Echo'"](_4);},Debug:function(_4){d.debug(_4);this.DebugMode?this["EchoHtml'"](_4):void 0;},"EchoHtml'":function(_4){var _5,_6;_5=(_6={},_6.raw=true,_6);this.Term.disable();this.Term.echo(_4,_5);this.Term.enable();},"Echo'":function(_4){this.Term.disable();this.Term.echo(_4);this.Term.enable();}},null,C);C.New=function(_4,_5,_6,_7,_8){return new C({Voice:_4,Mic:_5,Term:_6,DebugMode:_7,Caption:_8});};x.helpPhrases=function(){D.$cctor();return D.helpPhrases;};x.helloUserPhrases=function(){D.$cctor();return D.helloUserPhrases;};x.helloPhrases=function(){D.$cctor();return D.helloPhrases;};x.waitRetrievePhrases=function(){D.$cctor();return D.waitRetrievePhrases;};x["getRandomPhrase'"]=function(_4){return d.replace_tok("$0","",R.nth(x.rng().Next(0,_4.get_Length()),_4));};x.getRandomPhrase=function(_4,_5){return d.replace_tok("$0",_5,R.nth(x.rng().Next(0,_4.get_Length()),_4));};x.rng=function(){D.$cctor();return D.rng;};D.$cctor=function(){D.$cctor=a.ignore;D.rng=new W.New();D.waitRetrievePhrases=Q.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);D.helloPhrases=Q.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);D.helloUserPhrases=Q.ofArray(["Hi $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0."]);D.helpPhrases=Q.ofArray(["What can I help you with $0?"]);};E.update=function(_4,_5,_6,_7,_8){var _9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS;function bT(b3){return _5.ContainsKey(b3);}function bU(b3){return!bT("user")?{$:1,$0:b3.Unwrap()}:null;}function bV(b3){return bT("user")?{$:1,$0:b3.Unwrap()}:null;}function bW(b3){return X.Equals(b3,_6[0].$0);}function bX(b3){_4.Say(b3);}function bY(b3){_7.unshift(b3);bX(b3);}function bZ(b3,b4){var b5;b5=x.getRandomPhrase(b3,b4);_7.unshift(b5);return _4.Say(b5);}function b0(b3){var b4;V.Start((b4=null,V.Delay(function(){bZ(x.waitRetrievePhrases(),"user name");return V.Bind((new Z.New()).Async("SMApp.Web:SMApp.Web.Server.GetUser2:-2119606811",[b3]),function(b5){var b6;return b5==null?(bY((function(b7){return function(b8){return b7("Sorry I did not find the user name "+M.toSafe(b8)+".");};}(a.id))(b3)),V.Zero()):(b6=b5.$0,V.Combine(bT("user")?(_5.set_Item("user",b6),V.Zero()):(_5.Add("user",b6),V.Zero()),V.Delay(function(){bZ(x.helloUserPhrases(),(function(b7){return function(b8){return b7(M.prettyPrint(b8));};}(a.id))(_5.get_Item("user")));return V.Zero();})));});})),null);}function b1(b3){var b4,b5;for(b4=1,b5=b3;b4<=b5;b4++)_8.shift();}function b2(){_6.shift();}_9=function(b3){return _6.length>0&&bW(new o({$:0,$0:b3[0],$1:b3[1],$2:b3[2]}))?{$:1,$0:b3}:null;};_=_8.length>=5?5:_8.length;E.debug((function(b3){return function(b4){return b3("Current context: "+M.prettyPrint(b4)+".");};}(a.id))(_8));E.debug((function(b3){return function(b4){return b3("Previous questions: "+M.prettyPrint(b4)+".");};}(a.id))(_6));$=Q.ofSeq(R.take(_,_8));$.$==1&&(bb=bU($.$0),bb!=null&&bb.$==1&&((bc=k.Intent$1("hello",bb.$0[0]),bc!=null&&bc.$==1)&&(bb.$0[1]==null&&(bb.$0[2]==null&&$.$1.$==0))))?bZ(x.helloPhrases(),""):$.$==1&&(be=bV($.$0),be!=null&&be.$==1&&((bf=k.Intent$1("hello",be.$0[0]),bf!=null&&bf.$==1)&&(be.$0[1]==null&&(be.$0[2]==null&&$.$1.$==0))))?(bZ(x.helloUserPhrases(),(function(b3){return function(b4){return b3(M.prettyPrint(b4));};}(a.id))(_5.get_Item("user"))),b1(1)):$.$==1&&(bh=bU($.$0),bh!=null&&bh.$==1&&((bi=k.Intent$1("hello",bh.$0[0]),bi!=null&&bi.$==1)&&(bh.$0[1]==null&&((bj=bh.$0[2],bj!=null&&bj.$==1)&&(bh.$0[2].$0.$==1&&(bk=k.Entity$1("contact",bh.$0[2].$0.$0),bk!=null&&bk.$==1&&(bh.$0[2].$0.$1.$==0&&($.$1.$==0&&(bg=bk.$0,true)))))))))?(b0(bg),b1(1)):$.$==1&&(bm=bU($.$0),bm!=null&&bm.$==1&&(bm.$0[0]==null&&(bm.$0[1]==null&&((bn=bm.$0[2],bn!=null&&bn.$==1)&&(bm.$0[2].$0.$==1&&(bo=k.Entity$1("contact",bm.$0[2].$0.$0),bo!=null&&bo.$==1&&(bm.$0[2].$0.$1.$==0&&($.$1.$==1&&(bp=bU($.$1.$0),bp!=null&&bp.$==1&&((bq=k.Intent$1("hello",bp.$0[0]),bq!=null&&bq.$==1)&&(bp.$0[1]==null&&(bp.$0[2]==null&&($.$1.$1.$==0&&(bl=bo.$0,true))))))))))))))?(b0(bl),b1(2)):$.$==1&&(bs=bU($.$0),bs!=null&&bs.$==1&&((bt=k.Intent$1("hello",bs.$0[0]),bt!=null&&bt.$==1)&&(bs.$0[1]==null&&((bu=bs.$0[2],bu!=null&&bu.$==1)&&(bs.$0[2].$0.$==1&&(bv=k.Entity$1("contact",bs.$0[2].$0.$0),bv!=null&&bv.$==1&&(bs.$0[2].$0.$1.$==0&&($.$1.$==1&&(bw=bU($.$1.$0),bw!=null&&bw.$==1&&((bx=k.Intent$1("hello",bw.$0[0]),bx!=null&&bx.$==1)&&(bw.$0[1]==null&&(bw.$0[2]==null&&($.$1.$1.$==0&&(br=bv.$0,true))))))))))))))?(b0(br),b1(2)):$.$==1&&(bz=bV($.$0),bz!=null&&bz.$==1&&((bA=k.Intent$1("hello",bz.$0[0]),bA!=null&&bA.$==1)&&(bz.$0[1]==null&&((bB=bz.$0[2],bB!=null&&bB.$==1)&&(bz.$0[2].$0.$==1&&(bC=k.Entity$1("contact",bz.$0[2].$0.$0),bC!=null&&bC.$==1&&(bz.$0[2].$0.$1.$==0&&($.$1.$==0&&(by=[$,bC.$0],true)))))))))?(bY("Are you sure you want to switch users?"),_6.unshift(new p({$:0,$0:Q.head(by[0]),$1:"Are you sure you want to switch users?"})),E.debug((function(b3){return function(b4){return b3("Add question: "+H.p$8(b4)+".");};}(a.id))(_6[0]))):$.$==1&&(bE=bV($.$0),bE!=null&&bE.$==1&&((bF=k.Intent$1("yes",bE.$0[0]),bF!=null&&bF.$==1)&&(bE.$0[1]==null&&(bE.$0[2]==null&&($.$1.$==1&&(bG=bV($.$1.$0),bG!=null&&bG.$==1&&(bH=_9(bG.$0),bH!=null&&bH.$==1&&((bI=k.Intent$1("hello",bH.$0[0]),bI!=null&&bI.$==1)&&(bH.$0[1]==null&&((bJ=bH.$0[2],bJ!=null&&bJ.$==1)&&(bH.$0[2].$0.$==1&&(bK=k.Entity$1("contact",bH.$0[2].$0.$0),bK!=null&&bK.$==1&&(bH.$0[2].$0.$1.$==0&&($.$1.$1.$==0&&(bD=bK.$0,true)))))))))))))))?(b0(bD),b1(2),b2()):$.$==1&&(bM=bV($.$0),bM!=null&&bM.$==1&&((bN=k.Intent$1("no",bM.$0[0]),bN!=null&&bN.$==1)&&(bM.$0[1]==null&&(bM.$0[2]==null&&($.$1.$==1&&(bO=bV($.$1.$0),bO!=null&&bO.$==1&&(bP=_9(bO.$0),bP!=null&&bP.$==1&&((bQ=k.Intent$1("hello",bP.$0[0]),bQ!=null&&bQ.$==1)&&(bP.$0[1]==null&&((bR=bP.$0[2],bR!=null&&bR.$==1)&&(bP.$0[2].$0.$==1&&((bS=k.Entity$1("contact",bP.$0[2].$0.$0),bS!=null&&bS.$==1)&&(bP.$0[2].$0.$1.$==0&&$.$1.$1.$==0)))))))))))))?(b1(2),b2()):(b1(1),bY("Sorry I didn't understand what you meant."),_6.length>0?bY(_6[0].get_Response()):void 0);};E.debug=function(_4){d.debug((function(_5){return function(_6){return _5("Main: "+M.prettyPrint(_6));};}(a.id))(_4));};F.run=function(){var _4,_5;_4=P.ThisFunc(function(_6,_7){return((F.Main().get_Text())(_6))(_7);});_5=F.Main().get_Options();a.$("#main").terminal(_4,_5);return T.get_Empty();};F.Main=function(){G.$cctor();return G.Main;};F.container=function(){G.$cctor();return G.container;};F.wait=function(_4){d["Terminal.Echo'"](F.CUI().Term,"please wait");F.CUI().Term.disable();_4();F.CUI().Term.enable();};F.sayRandom=function(_4,_5){F.say(x.getRandomPhrase(_5,_4));};F.sayVoices=function(){var _4,_5;_4=a.speechSynthesis.getVoices();!(_4==null)?(_5=d.toArray(_4),F["say'"]((function(_6){return function(_7){return _6("There are currently "+a.String(_7)+" voices installed on this computer or device.");};}(a.id))(K.length(_5))),K.iteri(function(_6,_7){return F["say'"](((((P.Curried(function(_8,_9,_,$){return _8("Voice "+a.String(_9)+". Name: "+M.toSafe(_)+", Local: "+M.prettyPrint($)+".");},4))(a.id))(_6))(_7.name))(_7.localService));},_5)):void 0;};F.say=function(_4){F.Responses().unshift(_4);F["say'"](_4);};F["say'"]=function(_4){var _5,_6,_7;_5=F.CUI().Voice;_5!=null&&_5.$==1?(_6=_5.$0,V.Start((_7=null,V.Delay(function(){var _8;_8=new a.SpeechSynthesisUtterance(_4);_8.voice=_6;a.speechSynthesis.speak(_8);F.CUI().Caption?d["Terminal.Echo'"](F.CUI().Term,_4):void 0;return V.Zero();})),null)):d["Terminal.Echo'"](F.CUI().Term,_4);};F.initMic=function(_4){var _5,_6;F.set_CUI((_5={$:1,$0:new _0.Microphone(_1.getElementById("microphone"))},C.New(F.CUI().Voice,_5,F.CUI().Term,F.CUI().DebugMode,F.CUI().Caption)));_6=F.CUI().Mic.$0;_6.onconnecting=function(){F.set_MicState(z.MicConnecting);return F.debug("Mic connecting...");};_6.ondisconnected=function(){F.set_MicState(z.MicDisconnected);return F.debug("Mic disconnected.");};_6.onaudiostart=function(){F.set_MicState(z.MicAudioStart);return F.debug("Mic audio start...");};_6.onaudioend=function(){F.set_MicState(z.MicAudioEnd);return F.debug("Mic audio end.");};_6.onerror=function(_7){F.set_MicState({$:6,$0:_7});return F.debug((function(_8){return function(_9){return _8("Mic error : "+M.toSafe(_9)+".");};}(a.id))(_7));};_6.onready=function(){F.set_MicState(z.MicReady);return F.debug("Mic ready.");};_6.onresult=function(_7,_8){return!(_7==null||_8==null)?(F.set_MicState({$:7,$0:_7,$1:_8}),F.debug((((P.Curried3(function(_9,_,$){return _9("Mic result: "+M.prettyPrint(_)+" "+M.prettyPrint($)+".");}))(a.id))(_7))(_8)),_4(_6,[_7,_8])):F.debug("Mic: No result returned.");};_6.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};F.initSpeech=function(){var _4,_5;_4=a.speechSynthesis.getVoices();!(_4==null)?(_5=d.toArray(_4),K.iter(function(_6){if(X.Equals(F.CUI().Voice,null)&&(_6.name.indexOf("Microsoft Zira")!=-1||_6.name.toLowerCase().indexOf("female")!=-1)){F.set_CUI(C.New({$:1,$0:_6},F.CUI().Mic,F.CUI().Term,F.CUI().DebugMode,F.CUI().Caption));F.debug((function(_7){return function(_8){return _7("Using voice "+M.toSafe(_8)+".");};}(a.id))(F.CUI().Voice.$0.name));}},_5),X.Equals(F.CUI().Voice,null)&&K.length(_5)>0?(F.set_CUI(C.New({$:1,$0:K.find(function(_6){return _6["default"];},_5)},F.CUI().Mic,F.CUI().Term,F.CUI().DebugMode,F.CUI().Caption)),F.debug((function(_6){return function(_7){return _6("Using default voice "+M.toSafe(_7)+".");};}(a.id))(F.CUI().Voice.$0.name))):void 0):void 0;X.Equals(F.CUI().Voice,null)?(d.error("No speech synthesis voice is available."),d["Terminal.Echo'"](F.CUI().Term,"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma.")):void 0;};F.pushCtx=function(_4){F.Context().unshift(_4);return F.Context();};F.Responses=function(){G.$cctor();return G.Responses;};F.Questions=function(){G.$cctor();return G.Questions;};F.Context=function(){G.$cctor();return G.Context;};F.debug=function(_4){var _5;_5=(function(_6){return function(_7){return _6("Client: "+M.prettyPrint(_7));};}(a.id))(_4);d.debug(_5);F.CUI().DebugMode?d["Terminal.EchoHtml'"](F.CUI().Term,_5):void 0;};F.Props=function(){G.$cctor();return G.Props;};F.OpState=function(){G.$cctor();return G.OpState;};F.set_OpState=function(_4){G.$cctor();G.OpState=_4;};F.MicState=function(){G.$cctor();return G.MicState;};F.set_MicState=function(_4){G.$cctor();G.MicState=_4;};F.CUI=function(){G.$cctor();return G.CUI;};F.set_CUI=function(_4){G.$cctor();G.CUI=_4;};G.$cctor=function(){var _4;G.$cctor=a.ignore;function _5(_7,_8){var _9,_,$,ba,bb,bc,bd,be,bf,bg,bh;_9=_8[0];_=_8[1];F.debug((((P.Curried3(function(bi,bj,bk){return bi("Voice: "+M.prettyPrint(bj)+" "+M.prettyPrint(bk));}))(a.id))(_9))(_));$=(ba=q["Intent'"](_9,_),ba!=null&&ba.$==1?{$:1,$0:ba.$0}:null);bb=(bc=q["Trait'"](_),bc!=null&&bc.$==1?{$:1,$0:bc.$0}:null);bd=(be=q["Entity'$1"](_),be!=null&&be.$==1?{$:1,$0:Q.ofArray([be.$0])}:null);return $==null&&(bb==null&&bd==null)?null:(F.debug(((((P.Curried(function(bi,bj,bk,bl){return bi("Voice: "+H.p(bj)+" "+H.p$3(bk)+" "+H.p$5(bl));},4))(a.id))($))(bb))(bd)),(F.OpState()==null?false:F.OpState().$0.$==0)?F["say'"]("I'm still working on understanding your last message."):(bh=F.pushCtx(new o({$:0,$0:$,$1:bb,$2:bd})),E.update(F.CUI(),F.Props(),F.Questions(),F.Responses(),bh)));}function _6(_7,_8){var _9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi;F.set_CUI(C.New(F.CUI().Voice,F.CUI().Mic,_7,F.CUI().DebugMode,F.CUI().Caption));X.Equals(F.CUI().Voice,null)?F.initSpeech():void 0;X.Equals(F.CUI().Mic,null)?F.initMic(_5):void 0;return(_9=s.Blank(_8),_9!=null&&_9.$==1)?F["say'"]("Tell me what you want me to do or ask me a question."):(_=s.DebugOn(_8),_!=null&&_.$==1)?(F.set_CUI(C.New(F.CUI().Voice,F.CUI().Mic,F.CUI().Term,true,F.CUI().Caption)),F["say'"]("Debug mode is now on.")):($=s.DebugOff(_8),$!=null&&$.$==1)?(F.set_CUI(C.New(F.CUI().Voice,F.CUI().Mic,F.CUI().Term,false,F.CUI().Caption)),F["say'"]("Debug mode is now off.")):(F.OpState()==null?false:F.OpState().$0.$==0)?F["say'"]("I'm still working on understanding your last message."):(bc=s.QuickHello(_8),bc!=null&&bc.$==1?(bb=bc.$0,true):(bd=s.QuickHelp(_8),bd!=null&&bd.$==1?(bb=bd.$0,true):(be=s.QuickYes(_8),be!=null&&be.$==1?(bb=be.$0,true):(bf=s.QuickNo(_8),bf!=null&&bf.$==1?(bb=bf.$0,true):(bg=s.QuickPrograms(_8),bg!=null&&bg.$==1&&(bb=bg.$0,true))))))?(F.debug((function(bj){return function(bk){return bj("Quick Text: "+H.p$7(bk)+".");};}(a.id))(bb)),bh=F.pushCtx(bb),E.update(F.CUI(),F.Props(),F.Questions(),F.Responses(),bh)):F.CUI().Wait((bi=null,V.Delay(function(){F.set_OpState({$:1,$0:A.Lang});return V.Combine(V.Bind((new Z.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:-1765228222",[_8]),function(bj){var bk,bl,bm;bk=s.HasMeaning(bj);return bk!=null&&bk.$==1?(bl=bk.$0,(F.debug(((((P.Curried(function(bn,bo,bp,bq){return bn("Text: "+H.p(bo)+" "+H.p$3(bp)+" "+H.p$5(bq));},4))(a.id))(bl.get_Intent()))(bl.get_Trait()))(bl.get_Entities())),bm=F.pushCtx(bl),E.update(F.CUI(),F.Props(),F.Questions(),F.Responses(),bm),V.Zero())):(F.debug("Text: Did not receive a response from the server."),F["say'"]("Sorry I did not understand what you said."),V.Zero());}),V.Delay(function(){F.set_OpState(null);return V.Zero();}));})));}G.CUI=C.New(null,null,null,false,false);G.MicState=z.MicNotInitialized;G.OpState=null;G.Props=new _3.New$5();G.Context=[];G.Questions=[];G.Responses=[];G.container=i.Container;G.Main=new B({$:0,$0:function(_7){return function(_8){return _5(_7,_8);};},$1:[function(_7){return function(_8){return _6(_7,_8);};},(_4={},_4.name="Main",_4.greetings="Welcome to Selma. Enter 'hello my name is...(you)' to begin and initialize speech or help for more assistance.",_4.prompt=">",_4)]});};H.p$8=function(_4){return"Question ("+H.p$7(_4.$0)+", "+M.prettyPrint(_4.$1)+")";};H.p$2=function(_4){return _4==null?"null":"Some "+M.prettyPrint(_4.$0);};H.p$1=function(_4){return"Intent ("+M.prettyPrint(_4.$0)+", "+H.p$2(_4.$1)+")";};H.p=function(_4){return _4==null?"null":"Some "+H.p$1(_4.$0);};H.p$4=function(_4){return"Trait ("+M.prettyPrint(_4.$0)+", "+M.prettyPrint(_4.$1)+")";};H.p$3=function(_4){return _4==null?"null":"Some "+H.p$4(_4.$0);};H.p$6=function(_4){return"Entity ("+M.prettyPrint(_4.$0)+", "+M.prettyPrint(_4.$1)+", "+H.p$2(_4.$2)+")";};H.p$5=function(_4){return _4==null?"null":"Some "+M.printList(function(_5){return H.p$6(_5);},_4.$0);};H.p$7=function(_4){return"Meaning ("+H.p(_4.$0)+", "+H.p$3(_4.$1)+", "+H.p$5(_4.$2)+")";};}());
