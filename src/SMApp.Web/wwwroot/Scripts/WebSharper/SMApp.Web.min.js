(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.User=c.User||{};e=c.Meaning=c.Meaning||{};f=c.Intent=c.Intent||{};g=c.Entity=c.Entity||{};h=c.Resource=c.Resource||{};i=c.NLU=c.NLU||{};j=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};k=c.Client=c.Client||{};l=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};m=a.IntelliFactory;n=m&&m.Runtime;o=a.WebSharper;p=o&&o.List;q=o&&o.UI;r=q&&q.Doc;s=o&&o.Concurrency;t=o&&o.Remoting;u=t&&t.AjaxRemotingProvider;v=o&&o.Utils;d.New=function(w){return{UserName:w};};e=c.Meaning=n.Class({get_TopIntent:function(){return p.head(p.sortBy(function(w){return w.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,e);f=c.Intent=n.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,f);g=c.Entity=n.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,g);h.New=function(w,x,y){return{Name:w,Description:x,Url:y};};i.Intent=function(w,x){return x.get_TopIntent().get_Name()===w&&x.get_TopIntent().get_Confidence()>i.intentConfidenceThreshold()?{$:1,$0:p.filter(function(y){return y.get_Confidence()>i.entityConfidenceThreshold();},x.get_Entities())}:null;};i.entityConfidenceThreshold=function(){j.$cctor();return j.entityConfidenceThreshold;};i.set_entityConfidenceThreshold=function(w){j.$cctor();j.entityConfidenceThreshold=w;};i.intentConfidenceThreshold=function(){j.$cctor();return j.intentConfidenceThreshold;};i.set_intentConfidenceThreshold=function(w){j.$cctor();j.intentConfidenceThreshold=w;};j.$cctor=function(){j.$cctor=a.ignore;j.intentConfidenceThreshold=0.8;j.entityConfidenceThreshold=0.8;};k.Term=function(){var w,x;w=n.ThisFunc(function(){return null;});x=k.baseOpt();a.$("#main").terminal(w,x);return r.get_Empty();};k.baseOpt=function(){l.$cctor();return l.baseOpt;};k.Main=function(w,x){var y,z;function A(B){var C,D;return B!=null&&B.$==1&&(D=i.Intent("Hello",B.$0),D!=null&&D.$==1&&(C=D.$0,true))?{$:1,$0:C}:null;}y=x==="help"?{$:0,$0:null}:x==="debug on"?{$:1,$0:null}:{$:2,$0:null};y.$==1?(w.echo("Debug mode set."),k.set_debugMode(true)):y.$==2?(w.disable(),s.Start((z=null,s.Delay(function(){return s.Combine(s.Bind((new u.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:-1952518609",[x]),function(B){var C,D,E;return(D=A(B),D!=null&&D.$==1&&(D.$0.$==1&&(D.$0.$1.$==0&&(D.$0.$0.get_Role()==="contact"&&(C=D.$0.$0,true)))))?(w.echo((function(F){return function(G){return F("This is the hello intent. The user name is "+v.toSafe(G)+".");};}(a.id))(C.get_Role())),s.Zero()):(E=A(B),E!=null&&E.$==1)?(w.echo("This is the hello intent but I don't know who the user is."),s.Zero()):(w.echo("This is the whatever intent"),s.Zero());}),s.Delay(function(){w.enable();return s.Zero();}));})),null)):w.echo("This is the help commnd");};k.debugMode=function(){l.$cctor();return l.debugMode;};k.set_debugMode=function(w){l.$cctor();l.debugMode=w;};l.$cctor=function(){var w;l.$cctor=a.ignore;l.debugMode=false;l.baseOpt=(w={},w.name="_",w.greetings="Welcome to Selma",w.onInit=function(x){var y;return x.push(function(z){return k.Main(this,z);},(y={},y.name="Main",y.prompt=">",y));},w);};}());
