(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=d.SweetAlert=d.SweetAlert||{};f=c._Html=c._Html||{};g=c.htmModule=c.htmModule||{};h=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};i=c.TypingDNA=c.TypingDNA||{};j=i.SaveResponse=i.SaveResponse||{};k=i.UserResponse=i.UserResponse||{};l=i.VerifyResponse=i.VerifyResponse||{};m=c.Bs=c.Bs||{};n=b.NLU=b.NLU||{};o=n.Witai=n.Witai||{};p=o.Utterance=o.Utterance||{};q=o.Intent=o.Intent||{};r=o.Entity=o.Entity||{};s=o.Trait=o.Trait||{};t=o["Utterance'"]=o["Utterance'"]||{};u=o["Value'"]=o["Value'"]||{};v=c.NLG=c.NLG||{};w=a.StartupCode$SMApp_Web$NLG=a.StartupCode$SMApp_Web$NLG||{};x=c.NLU=c.NLU||{};y=x.Intent=x.Intent||{};z=x.Trait=x.Trait||{};A=x.Entity=x.Entity||{};B=x.Utterance=x.Utterance||{};C=x.Voice=x.Voice||{};D=C["Entity'"]=C["Entity'"]||{};E=x.Text=x.Text||{};F=E["Utterance'"]=E["Utterance'"]||{};G=E["Intent'"]=E["Intent'"]||{};H=E["Entity'"]=E["Entity'"]||{};I=E["Trait'"]=E["Trait'"]||{};J=x.Domain=x.Domain||{};K=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};L=c.Knowledge=c.Knowledge||{};M=L.EmotionalTrait=L.EmotionalTrait||{};N=L.Relation=L.Relation||{};O=L.Triple=L.Triple||{};P=L.Subject=L.Subject||{};Q=L.Verb=L.Verb||{};R=L.Object=L.Object||{};S=c.CUI=c.CUI||{};T=S.MicState=S.MicState||{};U=S.ClientState=S.ClientState||{};V=S.Interpreter=S.Interpreter||{};W=S.CUI=S.CUI||{};X=c.Dialogue=c.Dialogue||{};Y=c.Question=c.Question||{};Z=c.QuestionType=c.QuestionType||{};_0=c.DialogueModule=c.DialogueModule||{};_1=c.Questions=c.Questions||{};_2=c.User=c.User||{};_3=a.StartupCode$SMApp_Web$User=a.StartupCode$SMApp_Web$User||{};_4=c.Symptoms=c.Symptoms||{};_5=a.StartupCode$SMApp_Web$Symptoms=a.StartupCode$SMApp_Web$Symptoms||{};_6=c.Main=c.Main||{};_7=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};_8=c.Client=c.Client||{};_9=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};_=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};$=a.GeneratedPrintf=a.GeneratedPrintf||{};ba=a.WebSharper;bb=ba&&ba.Arrays;bc=a.SweetAlert;bd=a.IntelliFactory;be=bd&&bd.Runtime;bf=ba&&ba.Operators;bg=ba&&ba.UI;bh=bg&&bg.Doc;bi=bg&&bg.AttrProxy;bj=bg&&bg.Client;bk=bj&&bj.Templates;bl=ba&&ba.Utils;bm=a.console;bn=a.jQuery;bo=ba&&ba.Strings;bp=ba&&ba.List;bq=ba&&ba.Seq;br=bg&&bg.AttrModule;bs=ba&&ba.Concurrency;bt=ba&&ba.Random;bu=ba&&ba.Collections;bv=bu&&bu.Map;bw=ba&&ba.JavaScript;bx=bw&&bw.Pervasives;by=ba&&ba.ClientSideJson;bz=by&&by.Provider;bA=a.JSON;bB=a.SDK;bC=ba&&ba.Unchecked;bD=ba&&ba.Remoting;bE=bD&&bD.AjaxRemotingProvider;bF=a.Wit;bG=a.document;bH=bu&&bu.Dictionary;d.getCameraCanvas=function(){return a.getCameraCanvas();};d.stopCamera=function(){return a.stopCamera();};d.startCamera=function(bI,bJ){return a.startCamera(bI,bJ);};d.speechSynthesis=function(){return a.speechSynthesis;};d.lastMicData=function(){return a.lastMicData;};d.Terminal=function(){return a.$("#term").terminal();};d.enableTerminal=function(){return a.$("#term").terminal().enable();};d.disableTerminal=function(){return a.$("#term").terminal().disable();};d.boxesWithTitles=function(bI){return bb.map(function(bJ){var bK;bK={};bK.titleText=bJ;return bK;},bI);};d.confirmQuestionBox=function(){bc.clickConfirm();};d.questionBox=function(bI,bJ,bK,bL,bM,bN,bO){var bP,bQ,bR,bS,bT,bU;bP=(bQ=bL==null?(bR={},bR.titleText=bI,bR.text=bJ,bR.icon="question",bR.html="<div></div>",bR.allowOutsideClick=false,bR):(bS=bL.$0[0],(bT={},bT.titleText=bI,bT.text=bJ,bT.icon="question",bT.width=a.String(bS),bT.html=(((be.Curried3(function(bV,bW,bX){return bV("<div class=\"swal2-content-custom\" style=\"width:"+a.String(bW)+"px;height:"+a.String(bX)+"px\"></div>");}))(a.id))(bS))(bL.$0[1]),bT.allowOutsideClick=false,bT)),(bM!=null?bM.$0(bQ):void 0,bK!=null&&bK.$==1?(bU=bK.$0,(bQ.progressSteps=bb.ofSeq(bf.range(1,bb.length(bU))),bc.mixin(bQ).queue(bb.create(bb.length(bU),bQ)))):bc.fire(bQ)));bN!=null?bN.$0():void 0;bP.then(bO);};e.get_QueueBoxes=function(){var bI;bI=bc.mixin({});return function(bJ){return bI.queue(bJ);};};d.getDialogueBoxInput=function(){return bb.get(a.jQuery(".swal2-input").get(),0);};d.getDialogueBoxCanvas=function(){return bb.get(a.jQuery("canvas.swal2-content").get(),0);};d.getDialogueBoxContent=function(){return bb.get(a.jQuery("#swal2-content").get(),0).firstChild;};d.createDialogueBoxCanvas=function(){return d.createCanvas("camera","640","480",bb.get(a.jQuery("#swal2-content").get(),0).firstChild);};d.createCanvas=function(bI,bJ,bK,bL){var bM;bM=bh.Element("canvas",[d.eid(bI),bi.Create("width",bJ),bi.Create("height",bK)],[]);bk.LoadLocalTemplates("");bh.Run(bL,bM);return bL.firstChild;};d.elementHTML=function(bI){return bI.innerHTML;};d.createElement=function(bI){var bJ;bJ=self.document.createElement("div");self.document.appendChild(bJ);bk.LoadLocalTemplates("");bh.RunAppend(bJ,bI);};d.getContainer=function(){return bb.get(a.jQuery("#container").get(),0).firstChild;};d.container=function(bI){return bh.Element("div",[d.cls("container")],bI);};d.dindex=function(bI){return bi.Create("data-index",a.String(bI));};d.cls=function(bI){return bi.Create("class",bI);};d.eid=function(bI){return bi.Create("id",bI);};d.getMic=function(){return bb.get(a.jQuery("#microphone").get(),0);};d.terminalOutput=function(){return bb.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(bI){return bI.toLowerCase();};d.debug=function(bI,bJ){d.info((((be.Curried3(function(bK,bL,bM){return bK("DEBUG: "+bl.toSafe(bL)+": "+bl.prettyPrint(bM));}))(a.id))(bI.toUpperCase()))(bJ));};d.error=function(bI){bm.error(bI);};d.info=function(bI){bm.info(bI);};d.jserror=function(bI){bn.error(bI);};d.toArray=function(bI){return bb.map(a.id,bn.makeArray(bI));};d["Terminal.EchoHtml'"]=function(bI,bJ){bI.pause();bI.echo(bJ,d.rawOpt());bI.resume();};d["Terminal.Echo'"]=function(bI,bJ){bI.pause();bI.echo(bJ);bI.resume();};d.rawOpt=function(){h.$cctor();return h.rawOpt;};f=c._Html=be.Class({toString:function(){return f.toString(this);}},null,f);f.toString=function(bI){function bJ(bK){return function(bL){var bM,bN,bO,bP,bQ,bR,bS;bN=bo.replicate(bK," ");switch(bL.$==0?bL.$1.$==1?bL.$1.$0.$==2?bL.$1.$1.$==0?(bM=[bL.$1.$0.$0,bL.$0],1):(bM=[bL.$1,bL.$0],2):(bM=[bL.$1,bL.$0],2):(bM=[bL.$1,bL.$0],2):bL.$==2?(bM=bL.$0,3):(bM=[bL.$0,bL.$1],0)){case 0:return bM[0]+"=\""+bM[1]+"\"";case 1:bO=bM[1];return bN+"<"+bO+">"+bM[0]+"</"+bO+">\r\n";case 2:bP=bM[1];bQ=bp.partition(function(bT){return bT.$==1;},bM[0]);bR=bQ[1];bS=bQ[0];return bR.$==0?bN+"<"+bP+(bS.$===0?"":" "+bo.concat(" ",bp.ofSeq(bq.delay(function(){return bq.map(function(bT){return(bJ(0))(bT);},bS);}))))+"/>\r\n":bN+"<"+bP+(bS.$===0?"":" "+bo.concat(" ",bp.ofSeq(bq.delay(function(){return bq.map(function(bT){return(bJ(0))(bT);},bS);}))))+">\r\n"+bo.concat("",bp.ofSeq(bq.delay(function(){return bq.map(function(bT){return(bJ(bK+1))(bT);},bR);})))+bN+"</"+bP+">\r\n";case 3:return bN+bM+"\r\n";}};}return(bJ(0))(bI);};g.alt=function(bI){return new f({$:1,$0:"alt",$1:bI});};g.src=function(bI){return new f({$:1,$0:"src",$1:bI});};g.cls=function(bI){return new f({$:1,$0:"class",$1:bI});};g.str=function(bI){return f.toString(bI);};g.op_PercentEquals=function(bI,bJ){return new f({$:1,$0:bI,$1:bJ});};g.op_Splice=function(bI){var bJ;return bp.ofArray([new f({$:2,$0:(bJ=bI,a.String(bJ))})]);};g.strong=function(){h.$cctor();return h.strong;};g.h4=function(){h.$cctor();return h.h4;};g.h3=function(){h.$cctor();return h.h3;};g.h2=function(){h.$cctor();return h.h2;};g.h1=function(){h.$cctor();return h.h1;};g.li=function(){h.$cctor();return h.li;};g.ul=function(){h.$cctor();return h.ul;};g.th=function(){h.$cctor();return h.th;};g.td=function(){h.$cctor();return h.td;};g.tr=function(){h.$cctor();return h.tr;};g.a=function(){h.$cctor();return h.a;};g.p=function(){h.$cctor();return h.p;};g.area=function(){h.$cctor();return h.area;};g.map=function(){h.$cctor();return h.map;};g.img=function(){h.$cctor();return h.img;};g.tfoot=function(){h.$cctor();return h.tfoot;};g.tbody=function(){h.$cctor();return h.tbody;};g.thead=function(){h.$cctor();return h.thead;};g.table=function(){h.$cctor();return h.table;};g.span=function(){h.$cctor();return h.span;};g.section=function(){h.$cctor();return h.section;};g.br=function(){h.$cctor();return h.br;};g.div=function(){h.$cctor();return h.div;};g.body=function(){h.$cctor();return h.body;};g.style=function(){h.$cctor();return h.style;};g.title=function(){h.$cctor();return h.title;};g.head=function(){h.$cctor();return h.head;};g.html=function(){h.$cctor();return h.html;};g.elem=function(bI,bJ){return new f({$:0,$0:bI,$1:bJ});};h.$cctor=function(){var bI;h.$cctor=a.ignore;h.rawOpt=(bI={},bI.raw=true,bI);h.html=function(bJ){return g.elem("html",bJ);};h.head=function(bJ){return g.elem("head",bJ);};h.title=function(bJ){return g.elem("title",bJ);};h.style=function(bJ){return g.elem("style",bJ);};h.body=function(bJ){return g.elem("body",bJ);};h.div=function(bJ){return g.elem("div",bJ);};h.br=function(bJ){return g.elem("br",bJ);};h.section=function(bJ){return g.elem("section",bJ);};h.span=function(bJ){return g.elem("span",bJ);};h.table=function(bJ){return g.elem("table",bJ);};h.thead=function(bJ){return g.elem("thead",bJ);};h.tbody=function(bJ){return g.elem("tbody",bJ);};h.tfoot=function(bJ){return g.elem("tfoot",bJ);};h.img=function(bJ){return g.elem("img",bJ);};h.map=function(bJ){return g.elem("map",bJ);};h.area=function(bJ){return g.elem("area",bJ);};h.p=function(bJ){return g.elem("p",bJ);};h.a=function(bJ){return g.elem("a",bJ);};h.tr=function(bJ){return g.elem("tr",bJ);};h.td=function(bJ){return g.elem("td",bJ);};h.th=function(bJ){return g.elem("th",bJ);};h.ul=function(bJ){return g.elem("ul",bJ);};h.li=function(bJ){return g.elem("li",bJ);};h.h1=function(bJ){return g.elem("h1",bJ);};h.h2=function(bJ){return g.elem("h1",bJ);};h.h3=function(bJ){return g.elem("h1",bJ);};h.h4=function(bJ){return g.elem("h1",bJ);};h.strong=function(bJ){return g.elem("strong",bJ);};};j.New=function(bI,bJ,bK,bL){return{name:bI,message:bJ,message_code:bK,status:bL};};k.New=function(bI,bJ,bK,bL,bM){return{message:bI,message_code:bJ,success:bK,count:bL,status:bM};};l.New=function(bI,bJ,bK,bL,bM,bN){return{message:bI,message_code:bJ,success:bK,result:bL,score:bM,confidence:bN};};m.Radio=function(bI,bJ,bK,bL,bM){return bh.Element("div",new bp.T({$:1,$0:d.cls("radio"),$1:bJ}),[bh.Element("label",bL,[bh.Radio(bM,true,bK),bh.TextNode(bI)])]);};m.checkbox=function(bI,bJ,bK,bL,bM){return bh.Element("div",new bp.T({$:1,$0:d.cls("checkbox"),$1:bJ}),[bh.Element("label",bL,[bh.CheckBox(bM,bK),bh.TextNode(bI)])]);};m.textArea=function(bI,bJ,bK,bL,bM){return bh.Element("div",new bp.T({$:1,$0:d.cls("form-group"),$1:bJ}),[bh.Element("label",bL,[bh.TextNode(bI)]),bh.InputArea(new bp.T({$:1,$0:d.cls("form-control"),$1:bM}),bK)]);};m.inputPassword=function(bI,bJ,bK,bL,bM){return bh.Element("div",new bp.T({$:1,$0:d.cls("form-group"),$1:bJ}),[bh.Element("label",bL,[bh.TextNode(bI)]),bh.PasswordBox(new bp.T({$:1,$0:d.cls("form-control"),$1:bM}),bK)]);};m.input=function(bI,bJ,bK,bL,bM){return bh.Element("div",new bp.T({$:1,$0:d.cls("form-group"),$1:bJ}),[bh.Element("label",bL,[bh.TextNode(bI)]),bh.Input([d.cls("form-control"),bM],bK)]);};m.btnSecondary=function(bI,bJ,bK){return bh.Element("button",[d.eid(bI),d.cls("btn btn-secondary"),br.Handler("click",bK)],[bh.TextNode(bJ)]);};m.btnPrimary=function(bI,bJ,bK){return bh.Element("button",[d.eid(bI),d.cls("btn btn-primary"),br.Handler("click",bK)],[bh.TextNode(bJ)]);};p.New=function(bI,bJ,bK,bL){return{text:bI,intents:bJ,entities:bK,traits:bL};};q.New=function(bI,bJ,bK){return{id:bI,name:bJ,confidence:bK};};r.New=function(bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS){return{id:bI,name:bJ,role:bK,start:bL,end:bM,body:bN,confidence:bO,entities:bP,suggested:bQ,value:bR,type:bS};};s.New=function(bI,bJ,bK){return{id:bI,value:bJ,confidence:bK};};t.New=function(bI){return{intent:bI};};u.New=function(bI){return{value:bI};};o.getMeaning2=function(bI,bJ){function bK(bL,bM){var bN;bn.ajax((bN={},bN.url=(function(bO){return function(bP){return bO("https://api.wit.ai/message?q="+bl.toSafe(bP));};}(a.id))(bJ),bN.type="GET",bN.beforeSend=function(bO){return bO.setRequestHeader("Authorization","Bearer "+bI);},bN.success=function(bO){return bL(bO);},bN.error=function(bO){return bM(new a.Error(bO.responseText));},bN));}return bs.FromContinuations(function(bL,bM,bN){return bK.apply(null,[bL,bM,bN]);});};o.getMeaning=function(bI,bJ,bK,bL){var bM;bn.ajax((bM={},bM.url=(function(bN){return function(bO){return bN("https://api.wit.ai/message?q="+bl.toSafe(bO));};}(a.id))(bJ),bM.type="GET",bM.beforeSend=function(bN){return bN.setRequestHeader("Authorization","Bearer "+bI);},bM.success=bK,bM.error=bL,bM));};v.waitAddPhrases=function(){w.$cctor();return w.waitAddPhrases;};v.waitRetrievePhrases=function(){w.$cctor();return w.waitRetrievePhrases;};v.helpPhrases=function(){w.$cctor();return w.helpPhrases;};v.helloUserPhrases=function(){w.$cctor();return w.helloUserPhrases;};v.helloPhrases=function(){w.$cctor();return w.helloPhrases;};v["getRandomPhrase'"]=function(bI){return v.replace_tok("$0","",bq.nth(v.rng().Next(0,bI.get_Length()),bI));};v.getRandomPhrase=function(bI,bJ){return v.replace_tok("$0",bJ,bq.nth(v.rng().Next(0,bI.get_Length()),bI));};v.replace_tok=function(bI,bJ,bK){return bo.Replace(bK,bI,bJ);};v.rng=function(){w.$cctor();return w.rng;};w.$cctor=function(){w.$cctor=a.ignore;w.rng=new bt.New();w.helloPhrases=bp.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);w.helloUserPhrases=bp.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);w.helpPhrases=bp.ofArray(["What can I help you with $0?"]);w.waitRetrievePhrases=bp.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);w.waitAddPhrases=bp.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};y=x.Intent=be.Class({toString:function(){return(((be.Curried3(function(bI,bJ,bK){return bI("Intent("+bl.toSafe(bJ)+", "+_.p$2(bK)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,y);z=x.Trait=be.Class({toString:function(){return(((be.Curried3(function(bI,bJ,bK){return bI("Trait("+bl.toSafe(bJ)+", "+bl.prettyPrint(bK)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,z);A=x.Entity=be.Class({toString:function(){return(((((be.Curried(function(bI,bJ,bK,bL,bM){return bI("Entity("+bl.toSafe(bJ)+", "+bl.toSafe(bK)+", "+bl.toSafe(bL)+", "+_.p$2(bM)+")");},5))(a.id))(this.get_Name()))(this.get_Role()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$3;},get_Value:function(){return this.$2;},get_Role:function(){return this.$1;},get_Name:function(){return this.$0;}},null,A);B=x.Utterance=be.Class({toString:function(){return((((be.Curried(function(bI,bJ,bK,bL){return bI(_.p(bJ)+" "+_.p$3(bK)+" "+_.p$5(bL));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bI;bI=this.$3;return bI!=null?{$:1,$0:bp.sortBy(function(bJ){return bJ.get_Name();},bI.$0)}:null;},get_Traits:function(){var bI;bI=this.$2;return bI!=null?{$:1,$0:bp.sortBy(function(bJ){return bJ.get_Name();},bI.$0)}:null;},get_Intent:function(){return this.$1;},get_Text:function(){return this.$0;}},null,B);D.New=function(bI,bJ,bK,bL,bM){return{body:bI,end:bJ,start:bK,suggested:bL,value:bM};};C["Intent'"]=function(bI,bJ){return!(bJ.intent==null)?{$:1,$0:new y({$:0,$0:d.toLower(bJ.intent.value),$1:null})}:null;};C["Trait'"]=function(bI){return!(bI.domain==null)?{$:1,$0:new z({$:0,$0:"domain",$1:d.toLower(bI.domain.value),$2:null})}:!(bI.dialogue_act==null)?{$:1,$0:new z({$:0,$0:"dialogue_act",$1:d.toLower(bI.dialogue_act.value),$2:null})}:null;};C["Entity'$1"]=function(bI){return!(bI.contact==null)?{$:1,$0:new A({$:0,$0:"contact",$1:"",$2:d.toLower(bI.contact.value),$3:null})}:null;};F=E["Utterance'"]=be.Class({get_TopIntent:function(){return bp.head(bp.sortBy(function(bI){return bI.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$3;},get_Entities:function(){return this.$2;},get_Intents:function(){return this.$1;},get_Text:function(){return this.$0;}},null,F);G=E["Intent'"]=be.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);H=E["Entity'"]=be.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,H);I=E["Trait'"]=be.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,I);E.HasUtterance=function(bI){var bJ,bK,bL,bM,bN,bO;return bI!=null&&bI.$==1&&(bI.$0.$2.get_Length()>0&&(bJ=[bI.$0.$2,bI.$0.$1,bI,bI.$0.$0,bI.$0.$3],true))?(bK=bJ[0],(bL=bJ[2],(bM=bJ[4],(bN=bJ[1].$==0?null:{$:1,$0:new y({$:0,$0:bL.$0.get_TopIntent().get_Name(),$1:{$:1,$0:bL.$0.get_TopIntent().get_Confidence()}})},(bO=bK.$==0?null:{$:1,$0:bp.map(function(bP){return new A({$:0,$0:bP.get_Name(),$1:d.toLower(bP.get_Role()),$2:bP.get_Value(),$3:{$:1,$0:bP.get_Confidence()}});},bp.filter(function(bP){return bP.get_Confidence()>E.entityConfidenceThreshold();},bK))},{$:1,$0:new B({$:0,$0:bJ[3],$1:bN,$2:bM.$==0?null:{$:1,$0:bp.map(function(bP){return new z({$:0,$0:d.toLower(bP.get_Name()),$1:bP.get_Value(),$2:{$:1,$0:bP.get_Confidence()}});},bp.filter(function(bP){return bP.get_Confidence()>E.entityConfidenceThreshold();},bM))},$3:bO})}))))):null;};E.entityConfidenceThreshold=function(){K.$cctor();return K.entityConfidenceThreshold;};E.set_entityConfidenceThreshold=function(bI){K.$cctor();K.entityConfidenceThreshold=bI;};E.intentConfidenceThreshold=function(){K.$cctor();return K.intentConfidenceThreshold;};E.set_intentConfidenceThreshold=function(bI){K.$cctor();K.intentConfidenceThreshold=bI;};E.getUtterance2=function(bI){var bJ;bJ=null;return bs.Delay(function(){return bs.Bind(o.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bI),function(bK){d.debug("NLU",(function(bL){return function(bM){return bL("Wit.ai returned "+$.p(bM)+" ");};}(a.id))(bK));return bs.Return(new F({$:0,$0:bI,$1:bp.ofArray(bb.map(function(bL){return new G({$:0,$0:bL.name,$1:bL.confidence});},bK.intents)),$2:bp.map(function(bL){return new H({$:0,$0:bL.name,$1:bL.confidence,$2:bL.role,$3:bL.value});},bp.ofSeq(bq.concat(bq.map(function(bL){return bL[1];},bv.ToSeq(bK.entities))))),$3:bp.ofSeq(bq.map(function(bL){var bM;bM=bL[1];return new I({$:0,$0:bL[0],$1:bb.get(bM,0).confidence,$2:bb.get(bM,0).value});},bv.ToSeq(bK.traits)))}));});});};E.getUtterance=function(bI,bJ){o.getMeaning("OOGDHEQL7JZRQASXN2N2GHFUKGO3SCNV",bI,function(bK){var bL,bM;d.debug("NLU",(function(bN){return function(bO){return bN("Wit.ai returned: "+bl.prettyPrint(bO));};}(a.id))(bK));bL=!(bK.intents==null)?bp.ofArray(bb.map(function(bN){return new G({$:0,$0:bN.name,$1:bN.confidence});},bK.intents)):bp.T.Empty;bM=!(bK.traits==null)?bp.ofSeq(bq.concat(bp.map(function(bN){return bb.map(function(bO){return new I({$:0,$0:bN,$1:bO.confidence,$2:bO.value});},bx.GetJS(bK.traits,[bN]));},bp.filter(function(bN){return!(bx.GetJS(bK.traits,[bN])==null);},E.trait_types())))):bp.T.Empty;return bJ({$:1,$0:new F({$:0,$0:bI,$1:bL,$2:!(bK.entities==null)?bp.ofSeq(bq.concat(bp.map(function(bN){return bb.map(function(bO){return new H({$:0,$0:bO.name,$1:bO.confidence,$2:bO.role,$3:bO.value});},bx.GetJS(bK.entities,[bN]));},bp.filter(function(bN){return!(bx.GetJS(bK.entities,[bN])==null);},E.entity_types())))):bp.T.Empty,$3:bM})});},function(bK,bL,bM){d.error((((be.Curried3(function(bN,bO,bP){return bN("Wit.ai returned: "+bl.prettyPrint(bO)+" "+bl.prettyPrint(bP));}))(a.id))(bL))(bM));return bJ(null);});};E.trait_types=function(){K.$cctor();return K.trait_types;};E.entity_types=function(){K.$cctor();return K.entity_types;};E.QuickJournal=function(bI){var bJ;return bI==="journal"||bI==="diary"?{$:1,$0:new B({$:0,$0:"journal",$1:{$:1,$0:new y({$:0,$0:"journal",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};E.QuickNumber=function(bI){var bJ,bK,bL,bM,bN,bO;return(bK=E.One(bI),bK!=null&&bK.$==1?(bJ=bK.$0,true):(bL=E.Two(bI),bL!=null&&bL.$==1?(bJ=bL.$0,true):(bM=E.Three(bI),bM!=null&&bM.$==1?(bJ=bM.$0,true):(bN=E.Four(bI),bN!=null&&bN.$==1?(bJ=bN.$0,true):(bO=E.Five(bI),bO!=null&&bO.$==1&&(bJ=bO.$0,true))))))?{$:1,$0:bJ}:null;};E.Five=function(bI){var bJ;return bI==="5"||bI==="five"?{$:1,$0:new B({$:0,$0:"five",$1:{$:1,$0:new y({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bp.ofArray([new A({$:0,$0:"wit/ordinal",$1:"",$2:"five",$3:{$:1,$0:1}})])}})}:null;};E.Four=function(bI){var bJ;return bI==="4"||bI==="four"?{$:1,$0:new B({$:0,$0:"four",$1:{$:1,$0:new y({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bp.ofArray([new A({$:0,$0:"wit/ordinal",$1:"",$2:"four",$3:{$:1,$0:1}})])}})}:null;};E.Three=function(bI){var bJ;return bI==="3"||bI==="three"?{$:1,$0:new B({$:0,$0:"three",$1:{$:1,$0:new y({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bp.ofArray([new A({$:0,$0:"wit/ordinal",$1:"",$2:"three",$3:{$:1,$0:1}})])}})}:null;};E.Two=function(bI){var bJ;return bI==="2"||bI==="two"?{$:1,$0:new B({$:0,$0:"two",$1:{$:1,$0:new y({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bp.ofArray([new A({$:0,$0:"wit/ordinal",$1:"",$2:"two",$3:{$:1,$0:1}})])}})}:null;};E.One=function(bI){var bJ;return bI==="1"||bI==="one"?{$:1,$0:new B({$:0,$0:"one",$1:{$:1,$0:new y({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bp.ofArray([new A({$:0,$0:"wit/ordinal",$1:"",$2:"one",$3:{$:1,$0:1}})])}})}:null;};E.QuickNo=function(bI){var bJ;return bI==="no"||(bI==="nope"||(bI==="no way"||(bI==="nah"||(bI==="don't do it"||bI==="stop"))))?{$:1,$0:new B({$:0,$0:"no",$1:{$:1,$0:new y({$:0,$0:"reject",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};E.QuickYes=function(bI){var bJ;return bI==="yes"||(bI==="ok"||(bI==="sure"||(bI==="yeah"||(bI==="yep"||(bI==="uh huh"||(bI==="go ahead"||bI==="go"))))))?{$:1,$0:new B({$:0,$0:"yes",$1:{$:1,$0:new y({$:0,$0:"verify",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};E.QuickHelp=function(bI){var bJ;return bI==="help"||(bI==="help me"||(bI==="what's this?"||bI==="huh"))?{$:1,$0:new B({$:0,$0:"help",$1:{$:1,$0:new y({$:0,$0:"help",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};E.QuickHello=function(bI){var bJ;return bI==="hello"||(bI==="hey"||(bI==="yo"||bI==="hi"))?{$:1,$0:new B({$:0,$0:"hello",$1:{$:1,$0:new y({$:0,$0:"greet",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};E.Voices=function(bI){return bI==="voices"?{$:1,$0:null}:null;};E.DebugTriples=function(bI){return bo.StartsWith(bI,"debug-triples ")?{$:1,$0:bo.Replace(bI,"debug-triples ","")}:null;};E.Debug=function(bI){return bI==="debug"?{$:1,$0:null}:null;};E.Blank=function(bI){return bI===""?{$:1,$0:null}:null;};J.Study=function(bI){return bI.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};x.StrA=function(bI){if(bI!=null&&bI.$==1)try{return{$:1,$0:((bz.DecodeArray(bz.Id()))())(bA.parse(bI.$0))};}catch(bJ){return null;}else return null;};x.PStr=function(bI){var bJ;return bI!=null&&bI.$==1&&(typeof bI.$0=="string"&&(bJ=bI.$0,true))?{$:1,$0:bJ}:null;};x.No=function(bI){var bJ,bK;return(bK=x.Intent$1("reject",bI),bK!=null&&bK.$==1&&(bK.$0[0]==null&&(bK.$0[1]==null&&(bJ=bI,true))))?{$:1,$0:bJ}:null;};x.Yes=function(bI){var bJ,bK;return(bK=x.Intent$1("verify",bI),bK!=null&&bK.$==1&&(bK.$0[0]==null&&(bK.$0[1]==null&&(bJ=bI,true))))?{$:1,$0:bJ}:null;};x.EntityManyofMany=function(bI,bJ){return{$:1,$0:bv.OfArray(bb.ofSeq(bp.map(function(bK){return bp.exists(function(bL){return bL.get_Role()===bK;},bJ)?[bK,{$:1,$0:bp.filter(function(bL){return bL.get_Role()===bK;},bJ)}]:[bK,null];},bI)))};};x.EntityManyOf1=function(bI,bJ){var bK;return bJ!=null&&bJ.$==1&&(bp.exists(function(bL){return bL.get_Role()===bI;},bJ.$0)&&(bK=bJ.$0,true))?{$:1,$0:bp.filter(function(bL){return bL.get_Role()===bI;},bK)}:null;};x.Entity1OfAny=function(bI,bJ){var bK;return bJ!=null&&bJ.$==1&&(bp.exists(function(bL){return bL.get_Role()===bI;},bJ.$0)&&(bK=bJ.$0,true))?{$:1,$0:bp.head(bp.sortBy(function(bL){return bL.get_Role();},bp.filter(function(bL){return bL.get_Role()===bI;},bK)))}:null;};x.Entity1Of1=function(bI,bJ){var bK,bL;return bJ!=null&&bJ.$==1&&(bJ.$0.$==1&&(bJ.$0.$1.$==0&&((bL=bJ.$0.$0,bL.get_Role()===bI||bL.get_Name()===bI)&&(bK=bJ.$0.$0,true))))?{$:1,$0:bK}:null;};x.Intent$1=function(bI,bJ){return bJ.get_Intent()!=null&&bJ.get_Intent().$0.get_Name()===bI?{$:1,$0:[bJ.get_Traits(),bJ.get_Entities()]}:null;};K.$cctor=function(){K.$cctor=a.ignore;K.entity_types=bp.ofArray(["wit$contact:name","wit$datetime:datetime","term:subject","term:object","term:verb"]);K.trait_types=bp.ofArray(["domain","dialogue_act"]);K.intentConfidenceThreshold=0.85;K.entityConfidenceThreshold=0.85;};M=L.EmotionalTrait=be.Class({get_Frequence:function(){return this.$2;},get_Hierarchy:function(){return this.$1;},get_Label:function(){return this.$0;}},null,M);N=L.Relation=be.Class({toString:function(){return((((be.Curried(function(bI,bJ,bK,bL){return bI("("+bl.prettyPrint(bJ)+", "+bl.prettyPrint(bK)+", "+bl.prettyPrint(bL)+")");},4))(a.id))(this.get_T1()))(this.get_Name()))(this.get_T2());},get_T2:function(){return this.$2;},get_Name:function(){return this.$1;},get_T1:function(){return this.$0;}},null,N);O=L.Triple=be.Class({toString:function(){return((((be.Curried(function(bI,bJ,bK,bL){return bI("("+_.p$9(bJ)+", "+_.p$11(bK)+", "+_.p$16(bL)+")");},4))(a.id))(this.get_Subject()))(this.get_Verb()))(this.get_Object());},get_Object:function(){var bI;bI=this.$1;return bI!=null?{$:1,$0:bI.$0.get_T2()}:null;},get_Verb:function(){return this.$0.get_T2();},get_Subject:function(){return this.$0.get_T1();}},null,O);P=L.Subject=be.Class({toString:function(){return this.$==1?a.String(this.$0):this.$0;}},null,P);Q=L.Verb=be.Class({toString:function(){return this.$0;}},null,Q);R=L.Object=be.Class({toString:function(){return this.$==1?a.String(this.$0):this.$0;}},null,R);T.MicReady={$:5};T.MicAudioEnd={$:4};T.MicAudioStart={$:3};T.MicDisconnected={$:2};T.MicConnecting={$:1};T.MicNotInitialized={$:0};U.ClientUnderstand={$:2};U.ClientReady={$:1};U.ClientNotInitialzed={$:0};V=S.Interpreter=be.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,V);W=S.CUI=be.Class({SayVoices:function(){var bI,bJ,bK;bI=this;bJ=a.speechSynthesis.getVoices();!(bJ==null)?(bK=d.toArray(bJ),bI.Say((function(bL){return function(bM){return bL("There are currently "+a.String(bM)+" voices installed on this computer or device.");};}(a.id))(bb.length(bK))),bb.iteri(function(bL,bM){return bI.Say(((((be.Curried(function(bN,bO,bP,bQ){return bN("Voice "+a.String(bO)+". Name: "+bl.toSafe(bP)+", Local: "+bl.prettyPrint(bQ)+".");},4))(a.id))(bL))(bM.name))(bM.localService));},bK)):void 0;},Wait:function(bI){this.Wait$1(function(){bs.Start(bI,null);});},Wait$1:function(bI){this["Echo'"]("please wait...");this.Term.pause();bI();this.Term.resume();},sayRandom:function(bI,bJ){this.Say(v.getRandomPhrase(bI,bJ));},SayAngry:function(bI){var bJ,bK;bJ=this;bs.Start((bK=null,bs.Delay(function(){return bs.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bB.chime(),bs.Zero()):bs.Zero(),bs.Delay(function(){a.addMessage(bJ.Avatar,bI,"","");bJ.Avatar.processMessages(0);return bs.Zero();}));})),null);},SayDoc:function(bI){var bJ,bK,bL;bJ=bb.get(bn(".terminal-output").get(),0).childNodes.length;bK=bh.Element("div",[d.cls("terminal-command"),d.dindex(bJ+1)],[bI]);bL=d.terminalOutput();bk.LoadLocalTemplates("");bh.RunAppend(bL,bK);},Say:function(bI){var bJ,bK;bJ=this;bs.Start((bK=null,bs.Delay(function(){return bs.Combine(a.speechSynthesis.speaking?(bB.chime(),bs.Zero()):bs.Zero(),bs.Delay(function(){bJ.Avatar.addMessage(bI);bJ.Avatar.processMessages(0);return bs.Zero();}));})),null);},Debug:function(bI,bJ){d.debug(bI,bJ);},"EchoHtml'":function(bI){var bJ,bK;bJ=(bK={},bK.raw=true,bK);this.Term.disable();this.Term.echo(bI,bJ);this.Term.enable();},"Echo'":function(bI){this.Term.disable();this.Term.echo(bI);this.Term.enable();}},null,W);W.New=function(bI,bJ,bK,bL,bM,bN,bO){return new W({Voice:bI,Mic:bJ,Term:bK,Avatar:bL,Caption:bM,AudioHandlers:bN,TypingDNA:bO});};X=c.Dialogue=be.Class({get_Utterances:function(){return this.$4;},get_Output:function(){return this.$3;},get_DialogueQuestions:function(){return this.$2;},get_Props:function(){return this.$1;},get_Cui:function(){return this.$0;}},null,X);Y=c.Question=be.Class({toString:function(){return((((be.Curried(function(bI,bJ,bK,bL){return bI("Name: "+bl.toSafe(bJ)+" Module: "+bl.toSafe(bK)+" Type: "+_.p$17(bL)+" ");},4))(a.id))(this.get_Name()))(this.get_Module()))(this.get_Type());},get_Target:function(){return this.$4;},get_Params:function(){return this.$3;},get_Type:function(){return this.$2;},get_Module:function(){return this.$1;},get_Name:function(){return this.$0;}},null,Y);Z.ConceptCompletion={$:3};Z.Disjunctive={$:2};Z.Verification={$:1};_0["Response'_"]=function(bI,bJ,bK){var bL,bM,bN,bO,bP,bQ,bR,bS;return(bM=_0.PropNotSet_(bI,"user",bK),bM!=null&&bM.$==1?(bN=_0.Form(bI,bJ,bM.$0),bN!=null&&bN.$==1?(bL=bN.$0,true):(bO=_0.PropNotSet_(bI,"user",bK),bO!=null&&bO.$==1&&(bP=_0.NotForm(bI,bJ,bO.$0),bP!=null&&bP.$==1&&(bL=bP.$0,true)))):(bQ=_0.PropNotSet_(bI,"user",bK),bQ!=null&&bQ.$==1&&(bR=_0.NotForm(bI,bJ,bQ.$0),bR!=null&&bR.$==1&&(bL=bR.$0,true))))?(bS=_0.have(bI,bJ)?{$:1,$0:_0.prop(bI,bJ)}:null,bL.get_Text()!==""?{$:1,$0:[bL,{$:1,$0:bL.get_Text()},bS]}:{$:1,$0:[bL,null,bS]}):null;};_0.Response_=function(bI,bJ,bK){var bL,bM,bN,bO,bP,bQ,bR,bS;return(bM=_0.PropSet_(bI,"user",bK),bM!=null&&bM.$==1?(bN=_0.Form(bI,bJ,bM.$0),bN!=null&&bN.$==1?(bL=bN.$0,true):(bO=_0.PropSet_(bI,"user",bK),bO!=null&&bO.$==1&&(bP=_0.NotForm(bI,bJ,bO.$0),bP!=null&&bP.$==1&&(bL=bP.$0,true)))):(bQ=_0.PropSet_(bI,"user",bK),bQ!=null&&bQ.$==1&&(bR=_0.NotForm(bI,bJ,bQ.$0),bR!=null&&bR.$==1&&(bL=bR.$0,true))))?(bS=_0.have(bI,bJ)?{$:1,$0:_0.prop(bI,bJ)}:null,bL.get_Text()!==""?{$:1,$0:[bL,{$:1,$0:bL.get_Text()},bS]}:{$:1,$0:[bL,null,bS]}):null;};_0.NotForm=function(bI,bJ,bK){return bI.get_DialogueQuestions().length>0&&(bI.get_DialogueQuestions())[0].get_Name()===bJ&&bK.get_Text()!==""?{$:1,$0:bK}:null;};_0.Form=function(bI,bJ,bK){return bI.get_DialogueQuestions().length>0&&(bI.get_DialogueQuestions())[0].get_Name()===bJ&&bK.get_Intent()!=null&&bK.get_Intent().$0.get_Name()===bJ&&bC.Equals(bK.get_Intent().$0.get_Confidence(),{$:1,$0:1})&&bC.Equals(bK.get_Traits(),null)&&bC.Equals(bK.get_Entities(),null)?{$:1,$0:bK}:null;};_0["User'_"]=function(bI,bJ){var bK,bL;return(bL=_0.PropNotSet_(bI,"user",bJ),bL!=null&&bL.$==1&&(bI.get_DialogueQuestions().length===0&&(bK=bL.$0,true)))?{$:1,$0:bK}:null;};_0.User_=function(bI,bJ){var bK,bL;return(bL=_0.PropSet_(bI,"user",bJ),bL!=null&&bL.$==1&&(bI.get_DialogueQuestions().length===0&&(bK=bL.$0,true)))?{$:1,$0:bK}:null;};_0.PropNotSet_=function(bI,bJ,bK){return!_0.have(bI,bJ)?{$:1,$0:bK}:null;};_0.PropSet_=function(bI,bJ,bK){return _0.have(bI,bJ)?{$:1,$0:bK}:null;};_0.Agenda_=function(bI,bJ,bK,bL){return bI.get_DialogueQuestions().length>0&&(bI.get_DialogueQuestions())[0].get_Module()===bK?{$:1,$0:null}:null;};_0.debugInterpreterEnd=function(bI,bJ,bK){bJ(((((be.Curried(function(bL,bM,bN,bO){return bL(bl.toSafe(bM)+" ending utterances:"+bl.prettyPrint(bN)+", questions: "+bl.prettyPrint(bO)+".");},4))(a.id))(bK))(bI.get_Utterances()))(bI.get_DialogueQuestions()));};_0.debugInterpreterStart=function(bI,bJ,bK){bJ(((((be.Curried(function(bL,bM,bN,bO){return bL(bl.toSafe(bM)+" starting utterances:"+bl.prettyPrint(bN)+", questions: "+bl.prettyPrint(bO)+".");},4))(a.id))(bK))(bI.get_Utterances()))(bI.get_DialogueQuestions()));};_0.frame=function(bI){return bp.ofSeq(bq.take(bI.length>=5?5:bI.length,bI));};_0.didNotUnderstand=function(bI,bJ,bK){bJ((function(bL){return function(bM){return bL(bl.toSafe(bM)+" interpreter did not understand utterance.");};}(a.id))(bK));_0.popu(bI,bJ);_0.say(bI,"Sorry I didn't understand what you meant.");};_0.endt=function(bI,bJ,bK,bL){_0.popu(bI,bJ);_0.popq(bI,bJ);_0.have(bI,bK)?_0.remove(bI,bJ,bK):void 0;bJ((function(bM){return function(bN){return bM("End turn "+bl.toSafe(bN)+".");};}(a.id))(bK));bL();};_0.cancel=function(bI,bJ,bK){var bL;bL=(bI.get_DialogueQuestions())[0];bL.get_Name()!==bK?(((be.Curried3(function(bM,bN,bO){return bM(_.p$18(bN)+" at the top of the stack does not have the name "+bl.toSafe(bO)+".");}))(bf.FailWith))(bL))(bK):void 0;_0.popq(bI,bJ);bJ((function(bM){return function(bN){return bM("Cancel "+_.p$18(bN)+".");};}(a.id))(bL));};_0.trigger=function(bI,bJ,bK,bL,bM){_0.pushu(bI,bJ,new B({$:0,$0:bA.stringify(bM),$1:{$:1,$0:new y({$:0,$0:bL,$1:{$:1,$0:1}})},$2:null,$3:null}));bK(bI);};_0.handle=function(bI,bJ,bK,bL){_0.popu(bI,bJ);bJ((function(bM){return function(bN){return bM("Handle utterance "+bl.toSafe(bN)+".");};}(a.id))(bK));bL();};_0.dispatch=function(bI,bJ,bK,bL){bJ(((((be.Curried(function(bM,bN,bO,bP){return bM("Dispatch to module "+bl.toSafe(bN)+" utterances: "+bl.prettyPrint(bO)+" questions: "+bl.prettyPrint(bP)+".");},4))(a.id))(bK))(bI.get_Utterances()))(bI.get_DialogueQuestions()));bL(bI);};_0.popq=function(bI,bJ){var bK;bK=bI.get_DialogueQuestions().shift();bJ((function(bL){return function(bM){return bL("Pop "+_.p$18(bM)+".");};}(a.id))(bK));};_0.pushq=function(bI,bJ,bK){bI.get_DialogueQuestions().unshift(bK);bJ((function(bL){return function(bM){return bL("Push "+_.p$18(bM)+".");};}(a.id))(bK));};_0.popu=function(bI,bJ){var bK;bK=bI.get_Utterances().shift();bJ((function(bL){return function(bM){return bL("Pop "+_.p$15(bM)+".");};}(a.id))(bK));};_0.pushu=function(bI,bJ,bK){bJ((function(bL){return function(bM){return bL("Push "+_.p$15(bM)+".");};}(a.id))(bK));bI.get_Utterances().unshift(bK);};_0.remove=function(bI,bJ,bK){bJ((function(bL){return function(bM){return bL("Remove property "+bl.toSafe(bM)+".");};}(a.id))(bK));bI.get_Props().Remove(bK);};_0.add=function(bI,bJ,bK,bL){bI.get_Props().Add(bK,bL);bJ((((be.Curried3(function(bM,bN,bO){return bM("Add property "+bl.toSafe(bN)+":"+bl.prettyPrint(bO)+".");}))(a.id))(bK))(bL));};_0.prop=function(bI,bJ){return bI.get_Props().ContainsKey(bJ)?bI.get_Props().get_Item(bJ):(function(bK){return function(bL){return bK("The "+bl.toSafe(bL)+" dialogue property does not exist.");};}(bf.FailWith))(bJ);};_0.have=function(bI,bJ){return bI.get_Props().ContainsKey(bJ);};_0["sayRandom'"]=function(bI,bJ){_0.sayRandom(bI,bJ,"");};_0.sayRandom=function(bI,bJ,bK){var bL;bL=v.getRandomPhrase(bJ,bK);bI.get_Output().unshift(bL);bI.get_Cui().Say(bL);};_0.say=function(bI,bJ){bI.get_Output().unshift(bJ);_0["say'"](bI,bJ);};_0["say'"]=function(bI,bJ){bI.get_Cui().Say(bJ);};_0.echo=function(bI,bJ){(bI.get_Cui())["EchoHtml'"](bJ);};_1.ask=function(bI,bJ,bK){var bL,bM,bN,bO;function bP(bU){_0.say(bI,bU);}function bQ(bU){bU.input="text";bU.showCancelButton=true;bU.confirmButtonText="Ok";}function bR(bU){bU.confirmButtonClass="invisible";bU.showCancelButton=true;}function bS(){var bU;bU=d.createDialogueBoxCanvas();d.startCamera(self.document.body,bU);}function bT(bU){var bV,bW;bV=bU[0];bW=bU[1];d.questionBox("Biometric Authentication","",{$:1,$0:d.boxesWithTitles(["2","3"])},{$:1,$0:[640,480]},{$:1,$0:bQ},{$:1,$0:bS},function(bX){var bY,bZ,b0,b1;bX.isConfirmed?(bY=bI.get_Cui().TypingDNA.getTypingPattern((bZ={},bZ.type=1,bZ.text=bO,bZ.caseSensitive=false,bZ)),b0=bX.value,b1=d.getCameraCanvas().toDataURL(),bJ((function(b2){return function(b3){return b2("User image is "+bl.toSafe(b3)+"...");};}(a.id))(bo.Substring(b1,0,10))),d.stopCamera(),bJ((((be.Curried3(function(b2,b3,b4){return b2("User entered typing pattern "+bl.toSafe(b3)+" for text "+bl.toSafe(b4));}))(a.id))(bY))(b0)),b0.toLowerCase()!==bO.toLowerCase()?(bP("Sorry you did not enter the passphrase correctly. Please try again."),bT([bV,bW])):d.questionBox("Biometric Authentication","",null,null,{$:1,$0:bR},{$:1,$0:function(){d.getDialogueBoxContent().appendChild(d.getMic());bI.get_Cui().AudioHandlers.Add("VoiceAuthentication",function(b2){bA.stringify(((bz.Id())())(b2));d.confirmQuestionBox();});}},function(b2){if(!b2.isConfirmed){bI.get_Cui().AudioHandlers.Remove("VoiceAuthentication");bP("OK but you must login for me to help you.");}})):bP("OK but you must login for me to help you.");});}_0.pushq(bI,bJ,bK);bL=bK.get_Type();bL.$==0?(bM=bK.get_Target(),bN=bK.get_Name(),bO=(function(bU){return function(bV){return bU("Hello my name is "+bl.toSafe(bV)+" and I am an administrator");};}(a.id))(bL.$0),bP((function(bU){return function(bV){return bU("Enter the phrase "+bl.toSafe(bV)+".");};}(a.id))(bO)),bT([0,[]])):bf.FailWith("Not implemented");};_2.update=function(bI){var bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj;function ck(cv){_0.say(bI,cv);}function cl(cv,cw){return _0.sayRandom(bI,cv,cw);}function cm(cv,cw){return _0.add(bI,function(cx){_2.debug(cx);},cv,cw);}function cn(cv){_2.debug(cv);}function co(cv){_2.debug(cv);}function cp(cv){_2.debug(cv);}function cq(cv){return _0["User'_"](bI,cv);}function cr(cv,cw){return _0.Response_(bI,cv,cw);}function cs(cv,cw){return _0["Response'_"](bI,cv,cw);}function ct(cv){var cw;cl(v.waitRetrievePhrases(),"user name");bs.Start((cw=null,bs.Delay(function(){return bs.Bind((new bE.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-796169108",[cv]),function(cx){var cy;return cx==null?(ck((function(cz){return function(cA){return cz("I did not find a user with the name "+bl.toSafe(cA)+".");};}(a.id))(cv)),bL(new Y({$:0,$0:"addUser",$1:_2.name(),$2:Z.Verification,$3:null,$4:function(){cm("addUser",cv);ck((function(cz){return function(cA){return cz("Do you want me to add the user "+bl.toSafe(cA)+"?");};}(a.id))(cv));}})),bs.Zero()):(cy=cx.$0,bs.Bind((new bE.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:1901099988",[cy.Name]),function(){cl(v.helloUserPhrases(),cy.Name);return cy.LastLoggedIn!=null?bs.Bind((new bE.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:987812025",[cy.LastLoggedIn.$0]),function(cz){ck((function(cA){return function(cB){return cA("You last logged in "+bl.toSafe(cB)+".");};}(a.id))(cz));return bs.Zero();}):bs.Zero();}));});})),null);}function cu(cv){return new Y({$:0,$0:"switchUser",$1:_2.name(),$2:Z.Verification,$3:null,$4:function(){ck((function(cw){return function(cx){return cw("Do you want me to switch to the user "+bl.toSafe(cx));};}(a.id))(cv));}});}_0.debugInterpreterStart(bI,function(cv){_2.debug(cv);},_2.name());bJ=be.Curried(_0.handle,2,[bI,cn]);bK=be.Curried(_0.endt,2,[bI,co]);bL=function(cv){_1.ask(bI,cp,cv);};bM=_0.frame(bI.$4);bM.$==1&&(bO=cq(bM.$0),bO!=null&&bO.$==1&&(bP=x.Intent$1("greet",bO.$0),bP!=null&&bP.$==1&&(bQ=x.Entity1Of1("name",bP.$0[1]),bQ!=null&&bQ.$==1&&(bM.$1.$==0&&(bN=bQ.$0,true)))))?(bJ("loginUser"))(function(){ct(bN.get_Value());}):bM.$==1&&(bS=cq(bM.$0),bS!=null&&bS.$==1&&(bT=x.Intent$1("hello",bS.$0),bT!=null&&bT.$==1&&(bU=x.Entity1Of1("contact",bT.$0[1]),bU!=null&&bU.$==1&&(bM.$1.$==0&&(bR=bU.$0,true)))))?(bJ("loginUser"))(function(){ct(bR.get_Value());}):bM.$==1&&(bW=cs("authenticateUser",bM.$0),bW!=null&&bW.$==1&&(bX=x.StrA(bW.$0[1]),bX!=null&&bX.$==1&&(bM.$1.$==0&&(bV=bX.$0,true))))?(bK("authenticateUser"))(function(){var cv;_2.debug(bV);bs.Start((cv=null,bs.Delay(function(){return bs.Bind((new bE.New()).Async("SMApp.Web:SMApp.Web.Server.hasFace:-1025880667",[bb.get(bV,2)]),function(cw){return cw?(ck("Face detected"),bs.Zero()):(ck(function(cx){return cx("Sorry I did not detect a face in the camera image. Make sure you can see the red square around your face in the camera window when you click the OK button.");}(a.id)),bs.Zero());});})),null);}):bM.$==1&&(bZ=x.No(bM.$0),bZ!=null&&bZ.$==1&&(b0=cs("addUser",bZ.$0),b0!=null&&b0.$==1&&(b1=x.PStr(b0.$0[2]),b1!=null&&b1.$==1&&(bM.$1.$==0&&(bY=b1.$0,true)))))?(bK("addUser"))(function(){ck((function(cv){return function(cw){return cv("Ok I did not add the user "+bl.toSafe(cw)+". But you must login for me to help you.");};}(a.id))(bY));}):bM.$==1&&(b3=x.Yes(bM.$0),b3!=null&&b3.$==1&&(b4=cs("addUser",b3.$0),b4!=null&&b4.$==1&&(b5=x.PStr(b4.$0[2]),b5!=null&&b5.$==1&&(bM.$1.$==0&&(b2=b5.$0,true)))))?(bK("addUser"))(function(){bL(new Y({$:0,$0:"authenticateNewUser1",$1:_2.name(),$2:{$:0,$0:b2},$3:null,$4:function(cv){_2.update(cv);}}));}):bM.$==1&&(b7=cs("authenticateNewUser1",bM.$0),b7!=null&&b7.$==1&&(b8=x.StrA(b7.$0[1]),b8!=null&&b8.$==1&&(bM.$1.$==0&&(b6=b8.$0,true))))?(bK("authenticateNewUser1"))(function(){ck((function(cv){return function(cw){return cv("Authenticate new user "+bl.toSafe(cw)+".");};}(a.id))(bb.get(b6,0)));}):bM.$==1&&(b_=_0.User_(bI,bM.$0),b_!=null&&b_.$==1&&(b$=x.Intent$1("hello",b_.$0),b$!=null&&b$.$==1&&(b$.$0[0]==null&&(ca=x.Entity1Of1("name",b$.$0[1]),ca!=null&&ca.$==1&&(bM.$1.$==0&&(b9=ca.$0,true))))))?bs.Start((cb=null,bs.Delay(function(){return bs.Bind((new bE.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-796169108",[b9.get_Value()]),function(cv){return cv==null?(ck((function(cw){return function(cx){return cw("Sorry, the user "+bl.toSafe(cx)+" does not exist.");};}(a.id))(b9.get_Value())),bs.Zero()):(bL(cu(cv.$0.Name)),bs.Zero());});})),null):bM.$==1&&(cd=x.Yes(bM.$0),cd!=null&&cd.$==1&&(ce=cr("switchUser",cd.$0),ce!=null&&ce.$==1&&(cf=x.PStr(ce.$0[2]),cf!=null&&cf.$==1&&(bM.$1.$==0&&(cc=cf.$0,true)))))?(bI.$1.set_Item("user",cc),ck((function(cv){return function(cw){return cv("Ok I switched to user "+bl.prettyPrint(cw)+".");};}(a.id))(cc))):bM.$==1&&(ch=x.No(bM.$0),ch!=null&&ch.$==1&&(ci=cr("switchUser",ch.$0),ci!=null&&ci.$==1&&(cj=x.PStr(ci.$0[2]),cj!=null&&cj.$==1&&(bM.$1.$==0&&(cg=cj.$0,true)))))?ck((function(cv){return function(cw){return cv("Ok I did not switch to user "+bl.toSafe(cw)+".");};}(a.id))(cg)):_0.didNotUnderstand(bI,function(cv){_2.debug(cv);},_2.name());_0.debugInterpreterEnd(bI,function(cv){_2.debug(cv);},_2.name());};_2.debug=function(bI){d.debug(_2.name(),bI);};_2.name=function(){_3.$cctor();return _3.name;};_3.$cctor=function(){_3.$cctor=a.ignore;_3.name="User";};_4.update=function(bI){var bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY;function bZ(b5){_0.say(bI,b5);}function b0(b5,b6){return _0.sayRandom(bI,b5,b6);}function b1(b5){return _0.prop(bI,b5);}function b2(b5){return _0.User_(bI,b5);}function b3(){return b1("user");}function b4(b5,b6,b7){var b8;return bs.Start((b8=null,bs.Delay(function(){b0(v.waitAddPhrases(),"symptom entry");return bs.Bind((new bE.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:-1678372324",[b3().Name,b5,b6,b7]),function(b9){return b9.$==1?(bZ(function(b_){return b_("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),bs.Zero()):(bZ((function(b_){return function(b$){return b_("OK I added that "+bl.toSafe(b$)+" symptom to your journal.");};}(a.id))(b5)),bs.Zero());});})),null);}_0.debugInterpreterStart(bI,function(b5){_4.debug(b5);},_4.name());bJ=_0.frame(bI.$4);bJ.$==1&&(bL=b2(bJ.$0),bL!=null&&bL.$==1&&(bM=x.Intent$1("symptom",bL.$0),bM!=null&&bM.$==1&&(bN=x.Entity1OfAny("symptom_name",bM.$0[1]),bN!=null&&bN.$==1&&(bJ.$1.$==0&&(bK=bN.$0,true)))))?bs.Start((bO=null,bs.Delay(function(){bZ("Ok I'll add that entry to your symptom journal");b4(bK.get_Value(),null,null);return bs.Zero();})),null):bJ.$==1&&(bQ=x.Yes(bJ.$0),bQ!=null&&bQ.$==1&&((bR=_0.Response_(bI,"painVideo",bQ.$0),bR!=null&&bR.$==1)&&bJ.$1.$==0))?bI.$0["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bJ.$==1&&(bT=b2(bJ.$0),bT!=null&&bT.$==1&&(bU=x.Intent$1("medjournal",bT.$0),bU!=null&&bU.$==1&&((bV=bU.$0[1],bV!=null&&bV.$==1)&&(bJ.$1.$==0&&(bS=bU.$0[1].$0,true)))))?(bZ("ok I added that entry to your medication journal."),bZ("You should be careful not to take too many painkillers over a short period of time.")):bJ.$==1&&(bX=b2(bJ.$0),bX!=null&&bX.$==1&&((bY=x.Intent$1("kbquery",bX.$0),bY!=null&&bY.$==1)&&(bJ.$1.$==0&&(bW=bX.$0,true))))?void 0:_0.didNotUnderstand(bI,function(b5){_4.debug(b5);},_4.name());_0.debugInterpreterEnd(bI,function(b5){_4.debug(b5);},_4.name());};_4.debug=function(bI){d.debug(_4.name(),bI);};_4.name=function(){_5.$cctor();return _5.name;};_5.$cctor=function(){_5.$cctor=a.ignore;_5.name="Symptoms";};_6.update=function(bI){var bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3;function b4(b9){_0.say(bI,b9);}function b5(b9){_0["sayRandom'"](bI,b9);}function b6(b9){_6.debug(b9);}function b7(b9){_6.debug(b9);}function b8(b9){return _0["User'_"](bI,b9);}bJ=bI.$4;_6.debug(((((be.Curried(function(b9,b_,b$,ca){return b9("Module "+bl.toSafe(b_)+" starting utterances:"+bl.prettyPrint(b$)+", questions: "+bl.prettyPrint(ca)+".");},4))(a.id))(_6.name()))(bJ))(bI.$2));bK=be.Curried(_0.dispatch,2,[bI,b6]);bL=be.Curried(_0.handle,2,[bI,b7]);bM=_0.frame(bJ);bN=_0.Agenda_(bI,function(b9){_6.debug(b9);},_2.name(),bM);bN!=null&&bN.$==1?(_6.debug((function(b9){return function(b_){return b9("Agenda is "+_.p$18(b_)+".");};}(a.id))((bI.get_DialogueQuestions())[0])),_2.update(bI)):bM.$==1&&(bP=(bQ=_0.PropNotSet_(bI,"started",bM.$0),bQ!=null&&bQ.$==1?{$:1,$0:bQ.$0}:null),bP!=null&&bP.$==1&&(bR=b8(bP.$0),bR!=null&&bR.$==1&&(bS=x.Intent$1("greet",bR.$0),bS!=null&&bS.$==1&&(bS.$0[1]==null&&bM.$1.$==0))))?(_0.add(bI,function(b9){_6.debug(b9);},"started",true),(bL("greet"))(function(){b5(v.helloPhrases());})):bM.$==1&&(bU=b8(bM.$0),bU!=null&&bU.$==1&&(bV=x.Intent$1("greet",bU.$0),bV!=null&&bV.$==1&&(bV.$0[1]==null&&bM.$1.$==0)))?(bL("greet"))(function(){b4("Hello, tell me your name to get started.");}):bM.$==1&&(bX=b8(bM.$0),bX!=null&&bX.$==1&&(bY=x.Intent$1("greet",bX.$0),bY!=null&&bY.$==1&&((bZ=x.Entity1Of1("name",bY.$0[1]),bZ!=null&&bZ.$==1)&&bM.$1.$==0)))?(bK(_2.name()))(function(b9){_2.update(b9);}):bM.$==1&&(b1=b8(bM.$0),b1!=null&&b1.$==1&&(b2=x.Intent$1("hello",b1.$0),b2!=null&&b2.$==1&&((b3=x.Entity1Of1("contact",b2.$0[1]),b3!=null&&b3.$==1)&&bM.$1.$==0)))?(bK(_2.name()))(function(b9){_2.update(b9);}):_0.didNotUnderstand(bI,function(b9){_6.debug(b9);},_6.name());_0.debugInterpreterEnd(bI,function(b9){_6.debug(b9);},_6.name());};_6.debug=function(bI){d.debug(_6.name(),bI);};_6.name=function(){_7.$cctor();return _7.name;};_7.$cctor=function(){_7.$cctor=a.ignore;_7.name="Main";};_8.run=function(){var bI,bJ;bI=be.ThisFunc(function(bK,bL){return((_8.Main().get_Text())(bK))(bL);});bJ=_8.Main().get_Options();a.$("#term").terminal(bI,bJ);return bh.get_Empty();};_8.Main=function(){_9.$cctor();return _9.Main;};_8.initMic=function(bI){var bJ,bK;_8.set_CUI((bJ={$:1,$0:new bF.Microphone(bG.getElementById("microphone"))},W.New(_8.CUI().Voice,bJ,_8.CUI().Term,_8.CUI().Avatar,_8.CUI().Caption,_8.CUI().AudioHandlers,_8.CUI().TypingDNA)));bK=_8.CUI().Mic.$0;bK.onconnecting=function(){_8.set_MicState(T.MicConnecting);return _8.debug("Mic connecting...");};bK.ondisconnected=function(){_8.set_MicState(T.MicDisconnected);return _8.debug("Mic disconnected.");};bK.onaudiostart=function(){_8.set_MicState(T.MicAudioStart);return _8.debug("Mic audio start...");};bK.onaudioend=function(){var bL,bM,bN,bO;_8.debug("Mic audio end.");bM=_8.CUI().AudioHandlers;bL=bM.GetEnumerator$1();try{while(bL.MoveNext()){bN=bL.Current();_8.debug((function(bP){return function(bQ){return bP("Executing audio handler "+bl.toSafe(bQ)+".");};}(a.id))(bN.K));_8.set_MicState({$:7,$0:bN.K});bO=bN.V;_8.CUI().AudioHandlers.Remove(bN.K);bO(d.lastMicData());}return;}finally{bL.Dispose();}};bK.onerror=function(bL){_8.set_MicState({$:6,$0:bL});return _8.debug((function(bM){return function(bN){return bM("Mic error : "+bl.toSafe(bN)+".");};}(a.id))(bL));};bK.onready=function(){_8.set_MicState(T.MicReady);return _8.debug("Mic ready.");};bK.onresult=function(bL,bM){return _8.ClientState().$==2?_8.echo("I'm still trying to understand what you said before."):_8.ClientState().$==0?d.error("Client is not intialized."):_8.MicState().$==7?null:!(bL==null||bM==null)?(_8.set_MicState({$:8,$0:bL,$1:bM}),_8.debug((((be.Curried3(function(bN,bO,bP){return bN("Mic result: "+bl.prettyPrint(bO)+" "+bl.prettyPrint(bP)+".");}))(a.id))(bL))(bM)),bI(bL,bM)):_8.debug("Mic: No result returned.");};bK.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};_8.sayRandom=function(bI,bJ){_8.say(v.getRandomPhrase(bJ,bI));};_8.say=function(bI){_8.Output().unshift(bI);_8["say'"](bI);};_8["say'"]=function(bI){_8.CUI().Say(bI);};_8.initSpeech=function(){var bI;bI=d.toArray(_8.synth().getVoices());bb.length(bI)>0?(bb.iter(function(bJ){if(bC.Equals(_8.CUI().Voice,null)&&(bJ.name.indexOf("Microsoft Zira")!=-1||bJ.name.toLowerCase().indexOf("female")!=-1)){_8.set_CUI(W.New({$:1,$0:bJ},_8.CUI().Mic,_8.CUI().Term,_8.CUI().Avatar,_8.CUI().Caption,_8.CUI().AudioHandlers,_8.CUI().TypingDNA));_8.debug((function(bK){return function(bL){return bK("Using browser speech synthesis voice "+bl.toSafe(bL)+".");};}(a.id))(_8.CUI().Voice.$0.name));}},bI),!bC.Equals(_8.CUI().Voice,null)?(_8.CUI().Avatar.nativeVoice=true,_8.CUI().Avatar.nativeVoiceName=_8.CUI().Voice.$0.name,_8.debug((function(bJ){return function(bK){return bJ("Using browser speech synthesis voice "+bl.toSafe(bK)+".");};}(a.id))(_8.CUI().Voice.$0.name))):void 0):void 0;bC.Equals(_8.CUI().Voice,null)?_8.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};_8.synth=function(){_9.$cctor();return _9.synth;};_8.push=function(bI){_8.Utterances().unshift(bI);return _8.Dialogue();};_8.Dialogue=function(){_9.$cctor();return _9.Dialogue;};_8.Utterances=function(){_9.$cctor();return _9.Utterances;};_8.Questions=function(){_9.$cctor();return _9.Questions;};_8.Output=function(){_9.$cctor();return _9.Output;};_8.Props=function(){_9.$cctor();return _9.Props;};_8.wait=function(bI){d["Terminal.Echo'"](_8.CUI().Term,"please wait");_8.CUI().Term.pause();bI();_8.CUI().Term.resume();};_8.debug=function(bI){d.debug("CLIENT",bI);};_8.echo=function(bI){d["Terminal.EchoHtml'"](_8.CUI().Term,(function(bJ){return function(bK){return bJ(bl.prettyPrint(bK));};}(a.id))(bI));};_8.ClientState=function(){_9.$cctor();return _9.ClientState;};_8.set_ClientState=function(bI){_9.$cctor();_9.ClientState=bI;};_8.MicState=function(){_9.$cctor();return _9.MicState;};_8.set_MicState=function(bI){_9.$cctor();_9.MicState=bI;};_8.CUI=function(){_9.$cctor();return _9.CUI;};_8.set_CUI=function(bI){_9.$cctor();_9.CUI=bI;};_9.$cctor=function(){var bI,bJ,bK;_9.$cctor=a.ignore;function bL(bN,bO){var bP,bQ,bR,bS,bT,bU,bV;_8.debug((((be.Curried3(function(bW,bX,bY){return bW("Voice: "+bl.prettyPrint(bX)+" "+bl.prettyPrint(bY));}))(a.id))(bN))(bO));bP=(bQ=C["Intent'"](bN,bO),bQ!=null&&bQ.$==1?{$:1,$0:bQ.$0}:null);bR=(bS=C["Trait'"](bO),bS!=null&&bS.$==1?{$:1,$0:bp.ofArray([bS.$0])}:null);bT=(bU=C["Entity'$1"](bO),bU!=null&&bU.$==1?{$:1,$0:bp.ofArray([bU.$0])}:null);bP==null&&(bR==null&&bT==null)?void 0:(_8.debug(((((be.Curried(function(bW,bX,bY,bZ){return bW("Voice: "+_.p(bX)+" "+_.p$3(bY)+" "+_.p$5(bZ));},4))(a.id))(bP))(bR))(bT)),_6.update(_8.push(new B({$:0,$0:"",$1:bP,$2:bR,$3:bT}))));}function bM(bN,bO){var bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4;_8.set_CUI(W.New(_8.CUI().Voice,_8.CUI().Mic,bN,_8.CUI().Avatar,_8.CUI().Caption,_8.CUI().AudioHandlers,_8.CUI().TypingDNA));if(bC.Equals(_8.CUI().Mic,null))_8.initMic(bL);if(bC.Equals(_8.CUI().Voice,null))_8.initSpeech();if(_8.ClientState().$===0)_8.set_ClientState(U.ClientReady);b2=E.Blank(bO);if(b2!=null&&b2.$==1)return _8["say'"]("Tell me what you want me to do or ask me a question.");else{b3=E.Debug(bO);if(b3!=null&&b3.$==1){_8.debug((function(b5){return function(b6){return b5("Utterances: "+bl.prettyPrint(b6));};}(a.id))(_8.Utterances()));_8.debug((function(b5){return function(b6){return b5("Questions: "+bl.prettyPrint(b6));};}(a.id))(_8.Questions()));bP=_8.Props().GetEnumerator$1();try{while(bP.MoveNext()){b4=bP.Current();_8.debug((((be.Curried3(function(b5,b6,b7){return b5(bl.toSafe(b6)+": "+bl.prettyPrint(b7));}))(a.id))(b4.K))(b4.V));}return;}finally{bP.Dispose();}}else{bQ=E.DebugTriples(bO);return bQ!=null&&bQ.$==1?(bR=bQ.$0,_8.CUI().Wait((bS=null,bs.Delay(function(){return bs.Bind((new bE.New()).Async("SMApp.Web:SMApp.Web.Server.getTriples:-677734872",[bR]),function(b5){return b5.$==1?(_8.debug(b5.$0),bs.Zero()):bs.For(b5.$0,function(b6){return bs.For(b6,function(b7){_8.debug((function(b8){return function(b9){return b8(_.p$7(b9));};}(a.id))(b7));return bs.Zero();});});});})))):(bT=E.Voices(bO),bT!=null&&bT.$==1?(bU=d.toArray(d.speechSynthesis().getVoices()),_8["say'"]((function(b5){return function(b6){return b5("There are currently "+a.String(b6)+" voices installed on this computer or device.");};}(a.id))(bb.length(bU))),bb.iteri(function(b5,b6){return _8["say'"](((((be.Curried(function(b7,b8,b9,b_){return b7("Voice "+a.String(b8)+". Name: "+bl.toSafe(b9)+", Local: "+bl.prettyPrint(b_)+".");},4))(a.id))(b5))(b6.name))(b6.localService));},bU)):_8.ClientState().$==1?(bW=E.QuickHello(bO),(bW!=null&&bW.$==1?(bV=bW.$0,true):(bX=E.QuickHelp(bO),bX!=null&&bX.$==1?(bV=bX.$0,true):(bY=E.QuickYes(bO),bY!=null&&bY.$==1?(bV=bY.$0,true):(bZ=E.QuickNo(bO),bZ!=null&&bZ.$==1?(bV=bZ.$0,true):(b0=E.QuickNumber(bO),b0!=null&&b0.$==1&&(bV=b0.$0,true))))))?(_8.debug((function(b5){return function(b6){return b5("Quick Text: "+_.p$15(b6)+".");};}(a.id))(bV)),_6.update(_8.push(bV)),_8.set_ClientState(U.ClientReady)):_8.CUI().Wait((b1=null,bs.Delay(function(){_8.set_ClientState(U.ClientUnderstand);E.getUtterance(bO,function(b5){var b6,b7;b6=E.HasUtterance(b5);b6!=null&&b6.$==1?(b7=b6.$0,_8.debug(((((be.Curried(function(b8,b9,b_,b$){return b8("Text: Intent: "+_.p(b9)+", Traits: "+_.p$3(b_)+", Entities: "+_.p$5(b$)+".");},4))(a.id))(b7.get_Intent()))(b7.get_Traits()))(b7.get_Entities())),_6.update(_8.push(b7))):(_8.debug("Text: Did not receive a meaning from the server."),_8["say'"]("Sorry I did not understand what you said."));});_8.set_ClientState(U.ClientReady);return bs.Zero();})))):_8.ClientState().$==0?d.error("Client is not initialized."):_8["say'"]("I'm still trying to understand what you said before."));}}}_9.CUI=W.New(null,null,null,(bB.applicationId="4277115329081938617",bI=new a.SDKConnection(),bJ=new a.WebAvatar(),bJ.version=8.5,bJ.connection=bI,bJ.avatar="20926186",bJ.voice="cmu-slt",bJ.voiceMod="default",bJ.width=175,bJ.createBox(),bJ.addMessage(""),bJ.processMessages(0),bJ),false,new bH.New$5(),new a.TypingDNA());_9.MicState=T.MicNotInitialized;_9.ClientState=U.ClientNotInitialzed;_9.Props=new bH.New$5();_9.Output=[];_9.Questions=[];_9.Utterances=[];_9.Dialogue=new X({$:0,$0:_8.CUI(),$1:_8.Props(),$2:_8.Questions(),$3:_8.Output(),$4:_8.Utterances()});_9.synth=a.speechSynthesis;_9.Main=new V({$:0,$0:function(bN){return bL(bN[0],bN[1]);},$1:[function(bN){return function(bO){return bM(bN,bO);};},(bK={},bK.name="Main",bK.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bK.prompt=">",bK)]});};_.p$16=function(bI){return bI==null?"null":"Some "+_.p$14(bI.$0);};_.p$17=function(bI){return bI.$==3?"ConceptCompletion":bI.$==2?"Disjunctive":bI.$==1?"Verification":"UserAuthentication "+bl.prettyPrint(bI.$0);};$.p=function(bI){return"{"+("text = "+bl.prettyPrint(bI.text))+"; "+("intents = "+bl.printArray(function(bJ){return $.p$1(bJ);},bI.intents))+"; "+("entities = "+bl.prettyPrint(bI.entities))+"; "+("traits = "+bl.prettyPrint(bI.traits))+"}";};$.p$1=function(bI){return"{"+("id = "+bl.prettyPrint(bI.id))+"; "+("name = "+bl.prettyPrint(bI.name))+"; "+("confidence = "+bl.prettyPrint(bI.confidence))+"}";};_.p$18=function(bI){return"Question ("+bl.prettyPrint(bI.$0)+", "+bl.prettyPrint(bI.$1)+", "+_.p$17(bI.$2)+", "+_.p$19(bI.$3)+", "+"<fun>"+")";};_.p$19=function(bI){return bI==null?"null":"Some "+bl.printArray(bl.prettyPrint,bI.$0);};_.p$2=function(bI){return bI==null?"null":"Some "+bl.prettyPrint(bI.$0);};_.p$1=function(bI){return"Intent ("+bl.prettyPrint(bI.$0)+", "+_.p$2(bI.$1)+")";};_.p=function(bI){return bI==null?"null":"Some "+_.p$1(bI.$0);};_.p$4=function(bI){return"Trait ("+bl.prettyPrint(bI.$0)+", "+bl.prettyPrint(bI.$1)+", "+_.p$2(bI.$2)+")";};_.p$3=function(bI){return bI==null?"null":"Some "+bl.printList(function(bJ){return _.p$4(bJ);},bI.$0);};_.p$6=function(bI){return"Entity ("+bl.prettyPrint(bI.$0)+", "+bl.prettyPrint(bI.$1)+", "+bl.prettyPrint(bI.$2)+", "+_.p$2(bI.$3)+")";};_.p$5=function(bI){return bI==null?"null":"Some "+bl.printList(function(bJ){return _.p$6(bJ);},bI.$0);};_.p$10=function(bI){return"Relation ("+bl.prettyPrint(bI.$0)+", "+bl.prettyPrint(bI.$1)+", "+bl.prettyPrint(bI.$2)+")";};_.p$9=function(bI){return bI.$==1?"Relation "+_.p$10(bI.$0):"Subject "+bl.prettyPrint(bI.$0);};_.p$11=function(bI){return"Verb "+bl.prettyPrint(bI.$0);};_.p$8=function(bI){return"Relation ("+_.p$9(bI.$0)+", "+bl.prettyPrint(bI.$1)+", "+_.p$11(bI.$2)+")";};_.p$14=function(bI){return bI.$==1?"Relation "+_.p$10(bI.$0):"Object "+bl.prettyPrint(bI.$0);};_.p$13=function(bI){return"Relation ("+_.p$11(bI.$0)+", "+bl.prettyPrint(bI.$1)+", "+_.p$14(bI.$2)+")";};_.p$12=function(bI){return bI==null?"null":"Some "+_.p$13(bI.$0);};_.p$7=function(bI){return"Triple ("+_.p$8(bI.$0)+", "+_.p$12(bI.$1)+")";};_.p$15=function(bI){return"Utterance ("+bl.prettyPrint(bI.$0)+", "+_.p(bI.$1)+", "+_.p$3(bI.$2)+", "+_.p$5(bI.$3)+")";};}());
