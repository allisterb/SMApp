(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T;a=self;b=a.SMApp=a.SMApp||{};c=b.Bootstrap=b.Bootstrap||{};d=c.Controls=c.Controls||{};e=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};f=b.Web=b.Web||{};g=f.NLU=f.NLU||{};h=g.Intent=g.Intent||{};i=g.Trait=g.Trait||{};j=g.Voice=g.Voice||{};k=j["Entity'"]=j["Entity'"]||{};l=g.Text=g.Text||{};m=l.Meaning=l.Meaning||{};n=l.Intent=l.Intent||{};o=l.Entity=l.Entity||{};p=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};q=f.CUI=f.CUI||{};r=q.User=q.User||{};s=q.Interpreter=q.Interpreter||{};t=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};u=f.ClientExtensions=f.ClientExtensions||{};v=f._Html=f._Html||{};w=f.htmModule=f.htmModule||{};x=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};y=f.Client=f.Client||{};z=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};A=a.WebSharper;B=A&&A.UI;C=B&&B.Doc;D=A&&A.List;E=B&&B.AttrModule;F=a.IntelliFactory;G=F&&F.Runtime;H=A&&A.Seq;I=A&&A.Random;J=A&&A.Arrays;K=a.jQuery;L=a.console;M=A&&A.Strings;N=A&&A.Utils;O=A&&A.Concurrency;P=a.Wit;Q=a.document;R=A&&A.Unchecked;S=A&&A.Remoting;T=S&&S.AjaxRemotingProvider;d.Radio=function(U,V,W,X,Y){return C.Element("div",new D.T({$:1,$0:(d.cls())("radio"),$1:V}),[C.Element("label",X,[C.Radio(Y,true,W),C.TextNode(U)])]);};d.Checkbox=function(U,V,W,X,Y){return C.Element("div",new D.T({$:1,$0:(d.cls())("checkbox"),$1:V}),[C.Element("label",X,[C.CheckBox(Y,W),C.TextNode(U)])]);};d.TextArea=function(U,V,W,X,Y){return C.Element("div",new D.T({$:1,$0:(d.cls())("form-group"),$1:V}),[C.Element("label",X,[C.TextNode(U)]),C.InputArea(new D.T({$:1,$0:(d.cls())("form-control"),$1:Y}),W)]);};d.InputPassword=function(U,V,W,X,Y){return C.Element("div",new D.T({$:1,$0:(d.cls())("form-group"),$1:V}),[C.Element("label",X,[C.TextNode(U)]),C.PasswordBox(new D.T({$:1,$0:(d.cls())("form-control"),$1:Y}),W)]);};d.Input=function(U,V,W,X,Y){return C.Element("div",new D.T({$:1,$0:(d.cls())("form-group"),$1:V}),[C.Element("label",X,[C.TextNode(U)]),C.Input(new D.T({$:1,$0:(d.cls())("form-control"),$1:Y}),W)]);};d.Container=function(U){return C.Element("div",[(d.cls())("container")],U);};d.Class=function(){e.$cctor();return e.Class;};d.cls=function(){e.$cctor();return e.cls;};e.$cctor=function(){e.$cctor=a.ignore;e.cls=E.Class;e.Class=E.Class;};h.Hello={$:0};i.Greetings={$:0};k.New=function(U,V,W,X,Y){return{body:U,end:V,start:W,suggested:X,value:Y};};j.Contact=function(U){return!(U.contact==null)?{$:1,$0:{$:0,$0:k.New(U.body,U.end,U.start,U.ff,U.value).value}}:null;};j.Greetings=function(U){return!(U.greetings==null)&&!(U.greetings.value==null)?{$:1,$0:i.Greetings}:null;};j.Hello=function(U){return typeof U=="string"&&U.toLowerCase()==="default_intent"?{$:1,$0:h.Hello}:null;};m=l.Meaning=G.Class({get_TopIntent:function(){return D.head(D.sortBy(function(U){return U.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,m);n=l.Intent=G.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,n);o=l.Entity=G.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,o);l.HelloUser=function(U){var V,W;return(W=l.Hello(U),W!=null&&W.$==1&&(W.$0.$==1&&(W.$0.$1.$==0&&(W.$0.$0.get_Role()==="contact"&&(V=W.$0.$0,true)))))?{$:1,$0:V}:null;};l.Hello=function(U){var V,W;return U!=null&&U.$==1&&(W=l.Intent$1("Hello",U.$0),W!=null&&W.$==1&&(V=W.$0,true))?{$:1,$0:V}:null;};l.QuickHello=function(U){var V;switch(U==="hello"?0:U==="hey"?0:U==="yo"?0:U==="hi"?0:U==="help"?1:U==="debug on"?2:U==="debug off"?3:U.toLowerCase()==="programs"?4:5){case 0:return{$:0,$0:null};case 1:return{$:1,$0:null};case 2:return{$:2,$0:null};case 3:return{$:3,$0:null};case 4:return{$:4,$0:null};case 5:return{$:5,$0:null};}};l.Intent$1=function(U,V){return V.get_TopIntent().get_Name()===U&&V.get_TopIntent().get_Confidence()>l.intentConfidenceThreshold()?{$:1,$0:D.filter(function(W){return W.get_Confidence()>l.entityConfidenceThreshold();},V.get_Entities())}:null;};l.entityConfidenceThreshold=function(){p.$cctor();return p.entityConfidenceThreshold;};l.set_entityConfidenceThreshold=function(U){p.$cctor();p.entityConfidenceThreshold=U;};l.intentConfidenceThreshold=function(){p.$cctor();return p.intentConfidenceThreshold;};l.set_intentConfidenceThreshold=function(U){p.$cctor();p.intentConfidenceThreshold=U;};p.$cctor=function(){p.$cctor=a.ignore;p.intentConfidenceThreshold=0.85;p.entityConfidenceThreshold=0.85;};r.New=function(U){return{UserName:U};};s=q.Interpreter=G.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,s);q.helloUserPhrases=function(){t.$cctor();return t.helloUserPhrases;};q.helloPhrases=function(){t.$cctor();return t.helloPhrases;};q.getRandomPhrase=function(U){return H.nth(q.rng().Next(0,U.get_Length()),U);};q.rng=function(){t.$cctor();return t.rng;};t.$cctor=function(){t.$cctor=a.ignore;t.rng=new I.New();t.helloPhrases=D.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);t.helloUserPhrases=D.ofArray(["Hi $user, welcome back.","Welcome $user, nice to see you again..","Hello $user","Good to see you $user."]);};u.toArray=function(U){return J.map(a.id,K.makeArray(U));};u.error=function(U){L.error(U);};u.info=function(U){L.info(U);};u.jserror=function(U){K.error(U);};u["Terminal.Push"]=function(U,V){var W,X;W=V.get_Text();X=V.get_Options();U.push(G.CreateFuncWithThis(W),X);};u["Terminal.EchoHtml'"]=function(U,V){U.disable();U.echo(V,u.rawOpt());U.enable();};u["Terminal.Echo'"]=function(U,V){U.disable();U.echo(V);U.enable();};u.rawOpt=function(){x.$cctor();return x.rawOpt;};v=f._Html=G.Class({toString:function(){return v.toString(this);}},null,v);v.toString=function(U){function V(W){return function(X){var Y,Z,_0,_1,_2,_3,_4;Z=M.replicate(W," ");switch(X.$==0?X.$1.$==1?X.$1.$0.$==2?X.$1.$1.$==0?(Y=[X.$1.$0.$0,X.$0],1):(Y=[X.$1,X.$0],2):(Y=[X.$1,X.$0],2):(Y=[X.$1,X.$0],2):X.$==2?(Y=X.$0,3):(Y=[X.$0,X.$1],0)){case 0:return Y[0]+"=\""+Y[1]+"\"";case 1:_0=Y[1];return Z+"<"+_0+">"+Y[0]+"</"+_0+">\r\n";case 2:_1=Y[1];_2=D.partition(function(_5){return _5.$==1;},Y[0]);_3=_2[1];_4=_2[0];return _3.$==0?Z+"<"+_1+(_4.$===0?"":" "+M.concat(" ",D.ofSeq(H.delay(function(){return H.map(function(_5){return(V(0))(_5);},_4);}))))+"/>\r\n":Z+"<"+_1+(_4.$===0?"":" "+M.concat(" ",D.ofSeq(H.delay(function(){return H.map(function(_5){return(V(0))(_5);},_4);}))))+">\r\n"+M.concat("",D.ofSeq(H.delay(function(){return H.map(function(_5){return(V(W+1))(_5);},_3);})))+Z+"</"+_1+">\r\n";case 3:return Z+Y+"\r\n";}};}return(V(0))(U);};w.alt=function(U){return new v({$:1,$0:"alt",$1:U});};w.src=function(U){return new v({$:1,$0:"src",$1:U});};w.cls=function(U){return new v({$:1,$0:"class",$1:U});};w.str=function(U){return v.toString(U);};w.op_PercentEquals=function(U,V){return new v({$:1,$0:U,$1:V});};w.op_Splice=function(U){var V;return D.ofArray([new v({$:2,$0:(V=U,a.String(V))})]);};w.strong=function(){x.$cctor();return x.strong;};w.h4=function(){x.$cctor();return x.h4;};w.h3=function(){x.$cctor();return x.h3;};w.h2=function(){x.$cctor();return x.h2;};w.h1=function(){x.$cctor();return x.h1;};w.li=function(){x.$cctor();return x.li;};w.ul=function(){x.$cctor();return x.ul;};w.th=function(){x.$cctor();return x.th;};w.td=function(){x.$cctor();return x.td;};w.tr=function(){x.$cctor();return x.tr;};w.a=function(){x.$cctor();return x.a;};w.p=function(){x.$cctor();return x.p;};w.area=function(){x.$cctor();return x.area;};w.map=function(){x.$cctor();return x.map;};w.img=function(){x.$cctor();return x.img;};w.tfoot=function(){x.$cctor();return x.tfoot;};w.tbody=function(){x.$cctor();return x.tbody;};w.thead=function(){x.$cctor();return x.thead;};w.table=function(){x.$cctor();return x.table;};w.span=function(){x.$cctor();return x.span;};w.section=function(){x.$cctor();return x.section;};w.br=function(){x.$cctor();return x.br;};w.div=function(){x.$cctor();return x.div;};w.body=function(){x.$cctor();return x.body;};w.style=function(){x.$cctor();return x.style;};w.title=function(){x.$cctor();return x.title;};w.head=function(){x.$cctor();return x.head;};w.html=function(){x.$cctor();return x.html;};w.elem=function(U,V){return new v({$:0,$0:U,$1:V});};x.$cctor=function(){var U;x.$cctor=a.ignore;x.rawOpt=(U={},U.raw=true,U);x.html=function(V){return w.elem("html",V);};x.head=function(V){return w.elem("head",V);};x.title=function(V){return w.elem("title",V);};x.style=function(V){return w.elem("style",V);};x.body=function(V){return w.elem("body",V);};x.div=function(V){return w.elem("div",V);};x.br=function(V){return w.elem("br",V);};x.section=function(V){return w.elem("section",V);};x.span=function(V){return w.elem("span",V);};x.table=function(V){return w.elem("table",V);};x.thead=function(V){return w.elem("thead",V);};x.tbody=function(V){return w.elem("tbody",V);};x.tfoot=function(V){return w.elem("tfoot",V);};x.img=function(V){return w.elem("img",V);};x.map=function(V){return w.elem("map",V);};x.area=function(V){return w.elem("area",V);};x.p=function(V){return w.elem("p",V);};x.a=function(V){return w.elem("a",V);};x.tr=function(V){return w.elem("tr",V);};x.td=function(V){return w.elem("td",V);};x.th=function(V){return w.elem("th",V);};x.ul=function(V){return w.elem("ul",V);};x.li=function(V){return w.elem("li",V);};x.h1=function(V){return w.elem("h1",V);};x.h2=function(V){return w.elem("h1",V);};x.h3=function(V){return w.elem("h1",V);};x.h4=function(V){return w.elem("h1",V);};x.strong=function(V){return w.elem("strong",V);};};y.CUI=function(){var U,V;U=G.ThisFunc(function(W,X){return((y.Main().get_Text())(W))(X);});V=y.Main().get_Options();a.$("#main").terminal(U,V);return C.get_Empty();};y.Main=function(){z.$cctor();return z.Main;};y.container=function(){z.$cctor();return z.container;};y.wait=function(U){u["Terminal.Echo'"](y.currentTerm(),"please wait");y.currentTerm().disable();U();y.currentTerm().enable();};y.stopSpeaking=function(){z.$cctor();return z.stopSpeaking;};y.sayRandom=function(U){y.say(q.getRandomPhrase(U));};y.sayVoices=function(){var U,V;U=a.speechSynthesis.getVoices();!(U==null)?(V=u.toArray(U),y.say((function(W){return function(X){return W("There are currently "+a.String(X)+" voices installed on this computer or device.");};}(a.id))(J.length(V))),J.iteri(function(W,X){return y.say(((((G.Curried(function(Y,Z,_0,_1){return Y("Voice "+a.String(Z)+". Name: "+N.toSafe(_0)+", Local: "+N.prettyPrint(_1)+".");},4))(a.id))(W))(X.name))(X.localService));},V)):void 0;};y.say=function(U){var V,W,X;if(V=y.currentVoice(),V!=null&&V.$==1){W=y.currentVoice().$0;O.Start((X=null,O.Delay(function(){var Y;Y=new a.SpeechSynthesisUtterance(U);Y.voice=W;a.speechSynthesis.speak(Y);return O.Zero();})),null);y.echo()?u["Terminal.Echo'"](y.currentTerm(),U):void 0;}else u["Terminal.Echo'"](y.currentTerm(),U);};y.initMic=function(U){var V,W;y.set_currentMic({$:1,$0:new P.Microphone(Q.getElementById("microphone"))});V=y.currentMic().$0;W=y.currentTerm();V.onconnecting=function(){return u["Terminal.Echo'"](W,"Mic connecting...");};V.ondisconnected=function(){return u["Terminal.Echo'"](W,"Mic disconnected.");};V.onaudiostart=function(){return u["Terminal.Echo'"](W,"Mic audio start...");};V.onaudioend=function(){return u["Terminal.Echo'"](W,"Mic audio end.");};V.onerror=function(X){return u["Terminal.Echo'"](W,(function(Y){return function(Z){return Y("Mic error : "+N.toSafe(Z)+".");};}(a.id))(X));};V.onresult=function(X,Y){return U(V,[X,Y]);};V.onready=function(){return u["Terminal.Echo'"](W,"Mic ready.");};V.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};y.initSpeech=function(){var U,V;U=a.speechSynthesis.getVoices();!(U==null)?(V=u.toArray(U),J.iter(function(W){if(R.Equals(y.currentVoice(),null)&&(W.name.indexOf("Microsoft Zira")!=-1||W.name.toLowerCase().indexOf("female")!=-1)){y.set_currentVoice({$:1,$0:W});u.info((function(X){return function(Y){return X("Using voice "+N.toSafe(Y)+".");};}(a.id))(y.currentVoice().$0.name));}},V),R.Equals(y.currentVoice(),null)&&J.length(V)>0?(y.set_currentVoice({$:1,$0:J.find(function(W){return W["default"];},V)}),u.info((function(W){return function(X){return W("Using default voice "+N.toSafe(X)+".");};}(a.id))(y.currentVoice().$0.name))):void 0):void 0;R.Equals(y.currentVoice(),null)?(u.error("No speech synthesis voice is available."),u["Terminal.Echo'"](y.currentTerm(),"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma.")):void 0;};y.echo=function(){z.$cctor();return z.echo;};y.set_echo=function(U){z.$cctor();z.echo=U;};y.debugMode=function(){z.$cctor();return z.debugMode;};y.set_debugMode=function(U){z.$cctor();z.debugMode=U;};y.currentInterpreter=function(){z.$cctor();return z.currentInterpreter;};y.set_currentInterpreter=function(U){z.$cctor();z.currentInterpreter=U;};y.currentTerm=function(){z.$cctor();return z.currentTerm;};y.set_currentTerm=function(U){z.$cctor();z.currentTerm=U;};y.currentMic=function(){z.$cctor();return z.currentMic;};y.set_currentMic=function(U){z.$cctor();z.currentMic=U;};y.currentVoice=function(){z.$cctor();return z.currentVoice;};y.set_currentVoice=function(U){z.$cctor();z.currentVoice=U;};y.context=function(){z.$cctor();return z.context;};z.$cctor=function(){var U;z.$cctor=a.ignore;function V(X,Y){var Z,_0;Z=Y[1];u.info(Y[0]);u.info(Z);_0=j.Greetings(Z);return _0!=null&&_0.$==1?u.info(_0.$0):u.error(Z);}function W(X,Y){var Z,_0;y.set_currentTerm(X);R.Equals(y.currentVoice(),null)?y.initSpeech():void 0;R.Equals(y.currentMic(),null)?y.initMic(V):void 0;Z=l.QuickHello(Y);return Z.$==1?y.say("Quick help"):Z.$==2?(y.set_debugMode(true),y.say("Debug mode is now on.")):Z.$==3?(y.set_debugMode(false),y.say("Debug mode is now off.")):Z.$==4?y.say("The following programs are available:"):Z.$==5?(u["Terminal.Echo'"](y.currentTerm(),"please wait"),X.disable(),O.Start((_0=null,O.Delay(function(){return O.Combine(O.Bind((new T.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:-1380271437",[Y]),function(_1){var _2;_2=l.HelloUser(_1);return _2!=null&&_2.$==1?(y.say((function(_3){return function(_4){return _3("This is the hello intent. The user name is "+N.toSafe(_4)+".");};}(a.id))(_2.$0.get_Value())),O.Zero()):(u["Terminal.Echo'"](X,"This is the whatever intent"),O.Zero());}),O.Delay(function(){X.enable();return O.Zero();}));})),null)):y.sayRandom(q.helloPhrases());}z.context=[];z.currentVoice=null;z.currentMic=null;z.currentTerm=null;z.currentInterpreter=null;z.debugMode=false;z.echo=false;z.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;z.container=d.Container;z.Main=new s({$:0,$0:function(X){return function(Y){return V(X,Y);};},$1:[function(X){return function(Y){return W(X,Y);};},(U={},U.name="Main",U.greetings="Welcome to Selma. Type hello to begin or help for more assistance.",U.prompt=">",U)]});};}());
