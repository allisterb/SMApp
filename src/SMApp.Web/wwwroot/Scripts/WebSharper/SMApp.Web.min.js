(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=d.SweetAlert=d.SweetAlert||{};f=c._Html=c._Html||{};g=c.htmModule=c.htmModule||{};h=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};i=c.TypingDNA=c.TypingDNA||{};j=i.SaveResponse=i.SaveResponse||{};k=i.UserResponse=i.UserResponse||{};l=i.VerifyResponse=i.VerifyResponse||{};m=c.Bs=c.Bs||{};n=b.NLU=b.NLU||{};o=n.Witai=n.Witai||{};p=o.Utterance=o.Utterance||{};q=o.Intent=o.Intent||{};r=o.Entity=o.Entity||{};s=o.Trait=o.Trait||{};t=o["Utterance'"]=o["Utterance'"]||{};u=o["Value'"]=o["Value'"]||{};v=c.BabelNet=c.BabelNet||{};w=v.DisambiguateApiResponse=v.DisambiguateApiResponse||{};x=v.TokenFragment=v.TokenFragment||{};y=v.CharFragment=v.CharFragment||{};z=c.NLG=c.NLG||{};A=a.StartupCode$SMApp_Web$NLG=a.StartupCode$SMApp_Web$NLG||{};B=c.NLU=c.NLU||{};C=B.Intent=B.Intent||{};D=B.Trait=B.Trait||{};E=B.Entity=B.Entity||{};F=B.Utterance=B.Utterance||{};G=B.Voice=B.Voice||{};H=G["Entity'"]=G["Entity'"]||{};I=B.Text=B.Text||{};J=I["Utterance'"]=I["Utterance'"]||{};K=I["Intent'"]=I["Intent'"]||{};L=I["Entity'"]=I["Entity'"]||{};M=I["Trait'"]=I["Trait'"]||{};N=B.Domain=B.Domain||{};O=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};P=c.Knowledge=c.Knowledge||{};Q=P.EmotionalTrait=P.EmotionalTrait||{};R=P.Relation=P.Relation||{};S=P.Triple=P.Triple||{};T=P.Subject=P.Subject||{};U=P.Verb=P.Verb||{};V=P.Object=P.Object||{};W=P.ExpertAIEntity=P.ExpertAIEntity||{};X=P.ExpertAILemma=P.ExpertAILemma||{};Y=c.CUI=c.CUI||{};Z=Y.MicState=Y.MicState||{};_0=Y.ClientState=Y.ClientState||{};_1=Y.Interpreter=Y.Interpreter||{};_2=Y.CUI=Y.CUI||{};_3=c.Dialogue=c.Dialogue||{};_4=c.Question=c.Question||{};_5=c.QuestionType=c.QuestionType||{};_6=c.DialogueModule=c.DialogueModule||{};_7=c.QuestionDialogs=c.QuestionDialogs||{};_8=c.Questions=c.Questions||{};_9=c.User=c.User||{};_=a.StartupCode$SMApp_Web$User=a.StartupCode$SMApp_Web$User||{};$=c.Journal=c.Journal||{};ba=a.StartupCode$SMApp_Web$Journal=a.StartupCode$SMApp_Web$Journal||{};bb=c.Symptoms=c.Symptoms||{};bc=a.StartupCode$SMApp_Web$Symptoms=a.StartupCode$SMApp_Web$Symptoms||{};bd=c.Main=c.Main||{};be=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};bf=c.Client=c.Client||{};bg=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};bh=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};bi=a.GeneratedPrintf=a.GeneratedPrintf||{};bj=a.WebSharper;bk=bj&&bj.Arrays;bl=a.SweetAlert;bm=a.IntelliFactory;bn=bm&&bm.Runtime;bo=bj&&bj.Operators;bp=bj&&bj.UI;bq=bp&&bp.Doc;br=bp&&bp.AttrProxy;bs=bp&&bp.Client;bt=bs&&bs.Templates;bu=bj&&bj.Utils;bv=a.console;bw=a.jQuery;bx=bj&&bj.Strings;by=bj&&bj.List;bz=bj&&bj.Seq;bA=bp&&bp.AttrModule;bB=bj&&bj.Concurrency;bC=bj&&bj.Random;bD=bj&&bj.Collections;bE=bD&&bD.Map;bF=bj&&bj.JavaScript;bG=bF&&bF.Pervasives;bH=bj&&bj.ClientSideJson;bI=bH&&bH.Provider;bJ=a.JSON;bK=a.SDK;bL=bj&&bj.Unchecked;bM=bj&&bj.Remoting;bN=bM&&bM.AjaxRemotingProvider;bO=a.Wit;bP=a.document;bQ=bD&&bD.Dictionary;d.getCameraCanvas=function(){return a.getCameraCanvas();};d.stopCamera=function(){return a.stopCamera();};d.startCamera=function(bR,bS){return a.startCamera(bR,bS);};d.speechSynthesis=function(){return a.speechSynthesis;};d.lastMicData=function(){return a.lastMicData;};d.Terminal=function(){return a.$("#term").terminal();};d.enableTerminal=function(){return a.$("#term").terminal().enable();};d.disableTerminal=function(){return a.$("#term").terminal().disable();};d.boxesWithTitles=function(bR){return bk.map(function(bS){var bT;bT={};bT.titleText=bS;return bT;},bR);};d.confirmQuestionBox=function(){bl.clickConfirm();};d.questionBox=function(bR,bS,bT,bU,bV,bW,bX){var bY,bZ,b0,b1,b2,b3;bY=(bZ=bU==null?(b0={},b0.titleText=bR,b0.text=bS,b0.icon="question",b0.html="<div></div>",b0.allowOutsideClick=false,b0):(b1=bU.$0[0],(b2={},b2.titleText=bR,b2.text=bS,b2.icon="question",b2.width=a.String(b1),b2.html=(((bn.Curried3(function(b4,b5,b6){return b4("<div class=\"swal2-content-custom\" style=\"width:"+a.String(b5)+"px;height:"+a.String(b6)+"px\"></div>");}))(a.id))(b1))(bU.$0[1]),b2.allowOutsideClick=false,b2)),(bV!=null?bV.$0(bZ):void 0,bT!=null&&bT.$==1?(b3=bT.$0,(bZ.progressSteps=bk.ofSeq(bo.range(1,bk.length(b3))),bl.mixin(bZ).queue(bk.create(bk.length(b3),bZ)))):bl.fire(bZ)));bW!=null?bW.$0():void 0;bY.then(bX);};e.get_QueueBoxes=function(){var bR;bR=bl.mixin({});return function(bS){return bR.queue(bS);};};d.getDialogueBoxInput=function(){return bk.get(a.jQuery(".swal2-input").get(),0);};d.getDialogueBoxCanvas=function(){return bk.get(a.jQuery("canvas.swal2-content").get(),0);};d.getDialogueBoxContent=function(){return bk.get(a.jQuery("#swal2-content").get(),0).firstChild;};d.createDialogueBoxCanvas=function(){return d.createCanvas("camera","640","480",bk.get(a.jQuery("#swal2-content").get(),0).firstChild);};d.createCanvas=function(bR,bS,bT,bU){var bV;bV=bq.Element("canvas",[d.eid(bR),br.Create("width",bS),br.Create("height",bT)],[]);bt.LoadLocalTemplates("");bq.Run(bU,bV);return bU.firstChild;};d.elementHTML=function(bR){return bR.innerHTML;};d.createElement=function(bR){var bS;bS=self.document.createElement("div");self.document.appendChild(bS);bt.LoadLocalTemplates("");bq.RunAppend(bS,bR);};d.getContainer=function(){return bk.get(a.jQuery("#container").get(),0).firstChild;};d.container=function(bR){return bq.Element("div",[d.cls("container")],bR);};d.dindex=function(bR){return br.Create("data-index",a.String(bR));};d.cls=function(bR){return br.Create("class",bR);};d.eid=function(bR){return br.Create("id",bR);};d.getMic=function(){return bk.get(a.jQuery("#microphone").get(),0);};d.terminalOutput=function(){return bk.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(bR){return bR.toLowerCase();};d.debug=function(bR,bS){d.info((((bn.Curried3(function(bT,bU,bV){return bT("DEBUG: "+bu.toSafe(bU)+": "+bu.prettyPrint(bV));}))(a.id))(bR.toUpperCase()))(bS));};d.error=function(bR){bv.error(bR);};d.info=function(bR){bv.info(bR);};d.jserror=function(bR){bw.error(bR);};d.toArray=function(bR){return bk.map(a.id,bw.makeArray(bR));};d["Terminal.EchoHtml'"]=function(bR,bS){bR.pause();bR.echo(bS,d.rawOpt());bR.resume();};d["Terminal.Echo'"]=function(bR,bS){bR.pause();bR.echo(bS);bR.resume();};d.rawOpt=function(){h.$cctor();return h.rawOpt;};f=c._Html=bn.Class({toString:function(){return f.toString(this);}},null,f);f.toString=function(bR){function bS(bT){return function(bU){var bV,bW,bX,bY,bZ,b0,b1;bW=bx.replicate(bT," ");switch(bU.$==0?bU.$1.$==1?bU.$1.$0.$==2?bU.$1.$1.$==0?(bV=[bU.$1.$0.$0,bU.$0],1):(bV=[bU.$1,bU.$0],2):(bV=[bU.$1,bU.$0],2):(bV=[bU.$1,bU.$0],2):bU.$==2?(bV=bU.$0,3):(bV=[bU.$0,bU.$1],0)){case 0:return bV[0]+"=\""+bV[1]+"\"";case 1:bX=bV[1];return bW+"<"+bX+">"+bV[0]+"</"+bX+">\r\n";case 2:bY=bV[1];bZ=by.partition(function(b2){return b2.$==1;},bV[0]);b0=bZ[1];b1=bZ[0];return b0.$==0?bW+"<"+bY+(b1.$===0?"":" "+bx.concat(" ",by.ofSeq(bz.delay(function(){return bz.map(function(b2){return(bS(0))(b2);},b1);}))))+"/>\r\n":bW+"<"+bY+(b1.$===0?"":" "+bx.concat(" ",by.ofSeq(bz.delay(function(){return bz.map(function(b2){return(bS(0))(b2);},b1);}))))+">\r\n"+bx.concat("",by.ofSeq(bz.delay(function(){return bz.map(function(b2){return(bS(bT+1))(b2);},b0);})))+bW+"</"+bY+">\r\n";case 3:return bW+bV+"\r\n";}};}return(bS(0))(bR);};g.alt=function(bR){return new f({$:1,$0:"alt",$1:bR});};g.src=function(bR){return new f({$:1,$0:"src",$1:bR});};g.cls=function(bR){return new f({$:1,$0:"class",$1:bR});};g.str=function(bR){return f.toString(bR);};g.op_PercentEquals=function(bR,bS){return new f({$:1,$0:bR,$1:bS});};g.op_Splice=function(bR){var bS;return by.ofArray([new f({$:2,$0:(bS=bR,a.String(bS))})]);};g.strong=function(){h.$cctor();return h.strong;};g.h4=function(){h.$cctor();return h.h4;};g.h3=function(){h.$cctor();return h.h3;};g.h2=function(){h.$cctor();return h.h2;};g.h1=function(){h.$cctor();return h.h1;};g.li=function(){h.$cctor();return h.li;};g.ul=function(){h.$cctor();return h.ul;};g.th=function(){h.$cctor();return h.th;};g.td=function(){h.$cctor();return h.td;};g.tr=function(){h.$cctor();return h.tr;};g.a=function(){h.$cctor();return h.a;};g.p=function(){h.$cctor();return h.p;};g.area=function(){h.$cctor();return h.area;};g.map=function(){h.$cctor();return h.map;};g.img=function(){h.$cctor();return h.img;};g.tfoot=function(){h.$cctor();return h.tfoot;};g.tbody=function(){h.$cctor();return h.tbody;};g.thead=function(){h.$cctor();return h.thead;};g.table=function(){h.$cctor();return h.table;};g.span=function(){h.$cctor();return h.span;};g.section=function(){h.$cctor();return h.section;};g.br=function(){h.$cctor();return h.br;};g.div=function(){h.$cctor();return h.div;};g.body=function(){h.$cctor();return h.body;};g.style=function(){h.$cctor();return h.style;};g.title=function(){h.$cctor();return h.title;};g.head=function(){h.$cctor();return h.head;};g.html=function(){h.$cctor();return h.html;};g.elem=function(bR,bS){return new f({$:0,$0:bR,$1:bS});};h.$cctor=function(){var bR;h.$cctor=a.ignore;h.rawOpt=(bR={},bR.raw=true,bR);h.html=function(bS){return g.elem("html",bS);};h.head=function(bS){return g.elem("head",bS);};h.title=function(bS){return g.elem("title",bS);};h.style=function(bS){return g.elem("style",bS);};h.body=function(bS){return g.elem("body",bS);};h.div=function(bS){return g.elem("div",bS);};h.br=function(bS){return g.elem("br",bS);};h.section=function(bS){return g.elem("section",bS);};h.span=function(bS){return g.elem("span",bS);};h.table=function(bS){return g.elem("table",bS);};h.thead=function(bS){return g.elem("thead",bS);};h.tbody=function(bS){return g.elem("tbody",bS);};h.tfoot=function(bS){return g.elem("tfoot",bS);};h.img=function(bS){return g.elem("img",bS);};h.map=function(bS){return g.elem("map",bS);};h.area=function(bS){return g.elem("area",bS);};h.p=function(bS){return g.elem("p",bS);};h.a=function(bS){return g.elem("a",bS);};h.tr=function(bS){return g.elem("tr",bS);};h.td=function(bS){return g.elem("td",bS);};h.th=function(bS){return g.elem("th",bS);};h.ul=function(bS){return g.elem("ul",bS);};h.li=function(bS){return g.elem("li",bS);};h.h1=function(bS){return g.elem("h1",bS);};h.h2=function(bS){return g.elem("h1",bS);};h.h3=function(bS){return g.elem("h1",bS);};h.h4=function(bS){return g.elem("h1",bS);};h.strong=function(bS){return g.elem("strong",bS);};};j.New=function(bR,bS,bT,bU){return{name:bR,message:bS,message_code:bT,status:bU};};k.New=function(bR,bS,bT,bU,bV){return{message:bR,message_code:bS,success:bT,count:bU,status:bV};};l.New=function(bR,bS,bT,bU,bV,bW){return{message:bR,message_code:bS,success:bT,result:bU,score:bV,confidence:bW};};m.Radio=function(bR,bS,bT,bU,bV){return bq.Element("div",new by.T({$:1,$0:d.cls("radio"),$1:bS}),[bq.Element("label",bU,[bq.Radio(bV,true,bT),bq.TextNode(bR)])]);};m.checkbox=function(bR,bS,bT,bU,bV){return bq.Element("div",new by.T({$:1,$0:d.cls("checkbox"),$1:bS}),[bq.Element("label",bU,[bq.CheckBox(bV,bT),bq.TextNode(bR)])]);};m.textArea=function(bR,bS,bT,bU,bV){return bq.Element("div",new by.T({$:1,$0:d.cls("form-group"),$1:bS}),[bq.Element("label",bU,[bq.TextNode(bR)]),bq.InputArea(new by.T({$:1,$0:d.cls("form-control"),$1:bV}),bT)]);};m.inputPassword=function(bR,bS,bT,bU,bV){return bq.Element("div",new by.T({$:1,$0:d.cls("form-group"),$1:bS}),[bq.Element("label",bU,[bq.TextNode(bR)]),bq.PasswordBox(new by.T({$:1,$0:d.cls("form-control"),$1:bV}),bT)]);};m.input=function(bR,bS,bT,bU,bV){return bq.Element("div",new by.T({$:1,$0:d.cls("form-group"),$1:bS}),[bq.Element("label",bU,[bq.TextNode(bR)]),bq.Input([d.cls("form-control"),bV],bT)]);};m.btnSecondary=function(bR,bS,bT){return bq.Element("button",[d.eid(bR),d.cls("btn btn-secondary"),bA.Handler("click",bT)],[bq.TextNode(bS)]);};m.btnPrimary=function(bR,bS,bT){return bq.Element("button",[d.eid(bR),d.cls("btn btn-primary"),bA.Handler("click",bT)],[bq.TextNode(bS)]);};p.New=function(bR,bS,bT,bU){return{text:bR,intents:bS,entities:bT,traits:bU};};q.New=function(bR,bS,bT){return{id:bR,name:bS,confidence:bT};};r.New=function(bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1){return{id:bR,name:bS,role:bT,start:bU,end:bV,body:bW,confidence:bX,entities:bY,suggested:bZ,value:b0,type:b1};};s.New=function(bR,bS,bT){return{id:bR,value:bS,confidence:bT};};t.New=function(bR){return{intent:bR};};u.New=function(bR){return{value:bR};};o.getMeaning2=function(bR,bS){function bT(bU,bV){var bW;bw.ajax((bW={},bW.url=(function(bX){return function(bY){return bX("https://api.wit.ai/message?q="+bu.toSafe(bY));};}(a.id))(bS),bW.type="GET",bW.beforeSend=function(bX){return bX.setRequestHeader("Authorization","Bearer "+bR);},bW.success=function(bX){return bU(bX);},bW.error=function(bX){return bV(new a.Error(bX.responseText));},bW));}return bB.FromContinuations(function(bU,bV,bW){return bT.apply(null,[bU,bV,bW]);});};o.getMeaning=function(bR,bS,bT,bU){var bV;bw.ajax((bV={},bV.url=(function(bW){return function(bX){return bW("https://api.wit.ai/message?q="+bu.toSafe(bX));};}(a.id))(bS),bV.type="GET",bV.beforeSend=function(bW){return bW.setRequestHeader("Authorization","Bearer "+bR);},bV.success=bT,bV.error=bU,bV));};w.New=function(bR,bS,bT,bU,bV,bW,bX,bY,bZ){return{tokenFragment:bR,charFragment:bS,babelSynsetID:bT,DBpediaURL:bU,BabelNetURL:bV,score:bW,cohrenceScore:bX,globalScore:bY,source:bZ};};x.New=function(bR,bS){return{start:bR,end:bS};};y.New=function(bR,bS){return{start:bR,end:bS};};v.disambiguate=function(bR){function bS(bT,bU){var bV;bw.ajax((bV={},bV.url=(function(bW){return function(bX){return bW("https://babelfy.io/v1/disambiguate?text="+bu.toSafe(bX)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bR),bV.type="GET",bV.success=function(bW){return bT(bW);},bV.error=function(bW){return bU(new a.Error(bW.responseText));},bV));}return bB.FromContinuations(function(bT,bU,bV){return bS.apply(null,[bT,bU,bV]);});};z.waitAddPhrases=function(){A.$cctor();return A.waitAddPhrases;};z.waitRetrievePhrases=function(){A.$cctor();return A.waitRetrievePhrases;};z.helpPhrases=function(){A.$cctor();return A.helpPhrases;};z.helloUserPhrases=function(){A.$cctor();return A.helloUserPhrases;};z.helloPhrases=function(){A.$cctor();return A.helloPhrases;};z["getRandomPhrase'"]=function(bR){return z.replace_tok("$0","",bz.nth(z.rng().Next(0,bR.get_Length()),bR));};z.getRandomPhrase=function(bR,bS){return z.replace_tok("$0",bS,bz.nth(z.rng().Next(0,bR.get_Length()),bR));};z.replace_tok=function(bR,bS,bT){return bx.Replace(bT,bR,bS);};z.rng=function(){A.$cctor();return A.rng;};A.$cctor=function(){A.$cctor=a.ignore;A.rng=new bC.New();A.helloPhrases=by.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);A.helloUserPhrases=by.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);A.helpPhrases=by.ofArray(["What can I help you with $0?"]);A.waitRetrievePhrases=by.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);A.waitAddPhrases=by.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};C=B.Intent=bn.Class({toString:function(){return(((bn.Curried3(function(bR,bS,bT){return bR("Intent("+bu.toSafe(bS)+", "+bh.p$2(bT)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,C);D=B.Trait=bn.Class({toString:function(){return(((bn.Curried3(function(bR,bS,bT){return bR("Trait("+bu.toSafe(bS)+", "+bu.prettyPrint(bT)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,D);E=B.Entity=bn.Class({toString:function(){return(((((bn.Curried(function(bR,bS,bT,bU,bV){return bR("Entity("+bu.toSafe(bS)+", "+bu.toSafe(bT)+", "+bu.toSafe(bU)+", "+bh.p$2(bV)+")");},5))(a.id))(this.get_Name()))(this.get_Role()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$3;},get_Value:function(){return this.$2;},get_Role:function(){return this.$1;},get_Name:function(){return this.$0;}},null,E);F=B.Utterance=bn.Class({toString:function(){return((((bn.Curried(function(bR,bS,bT,bU){return bR(bh.p(bS)+" "+bh.p$3(bT)+" "+bh.p$5(bU));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bR;bR=this.$3;return bR!=null?{$:1,$0:by.sortBy(function(bS){return bS.get_Name();},bR.$0)}:null;},get_Traits:function(){var bR;bR=this.$2;return bR!=null?{$:1,$0:by.sortBy(function(bS){return bS.get_Name();},bR.$0)}:null;},get_Intent:function(){return this.$1;},get_Text:function(){return this.$0;}},null,F);H.New=function(bR,bS,bT,bU,bV){return{body:bR,end:bS,start:bT,suggested:bU,value:bV};};G["Intent'"]=function(bR,bS){return!(bS.intent==null)?{$:1,$0:new C({$:0,$0:d.toLower(bS.intent.value),$1:null})}:null;};G["Trait'"]=function(bR){return!(bR.domain==null)?{$:1,$0:new D({$:0,$0:"domain",$1:d.toLower(bR.domain.value),$2:null})}:!(bR.dialogue_act==null)?{$:1,$0:new D({$:0,$0:"dialogue_act",$1:d.toLower(bR.dialogue_act.value),$2:null})}:null;};G["Entity'$1"]=function(bR){return!(bR.contact==null)?{$:1,$0:new E({$:0,$0:"contact",$1:"",$2:d.toLower(bR.contact.value),$3:null})}:null;};J=I["Utterance'"]=bn.Class({get_TopIntent:function(){return by.head(by.sortBy(function(bR){return bR.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$3;},get_Entities:function(){return this.$2;},get_Intents:function(){return this.$1;},get_Text:function(){return this.$0;}},null,J);K=I["Intent'"]=bn.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,K);L=I["Entity'"]=bn.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,L);M=I["Trait'"]=bn.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,M);I.HasUtterance=function(bR){var bS,bT,bU,bV,bW,bX;return bR!=null&&bR.$==1&&(bR.$0.$2.get_Length()>0&&(bS=[bR.$0.$2,bR.$0.$1,bR,bR.$0.$0,bR.$0.$3],true))?(bT=bS[0],(bU=bS[2],(bV=bS[4],(bW=bS[1].$==0?null:{$:1,$0:new C({$:0,$0:bU.$0.get_TopIntent().get_Name(),$1:{$:1,$0:bU.$0.get_TopIntent().get_Confidence()}})},(bX=bT.$==0?null:{$:1,$0:by.map(function(bY){return new E({$:0,$0:bY.get_Name(),$1:d.toLower(bY.get_Role()),$2:bY.get_Value(),$3:{$:1,$0:bY.get_Confidence()}});},by.filter(function(bY){return bY.get_Confidence()>I.entityConfidenceThreshold();},bT))},{$:1,$0:new F({$:0,$0:bS[3],$1:bW,$2:bV.$==0?null:{$:1,$0:by.map(function(bY){return new D({$:0,$0:d.toLower(bY.get_Name()),$1:bY.get_Value(),$2:{$:1,$0:bY.get_Confidence()}});},by.filter(function(bY){return bY.get_Confidence()>I.entityConfidenceThreshold();},bV))},$3:bX})}))))):null;};I.entityConfidenceThreshold=function(){O.$cctor();return O.entityConfidenceThreshold;};I.set_entityConfidenceThreshold=function(bR){O.$cctor();O.entityConfidenceThreshold=bR;};I.intentConfidenceThreshold=function(){O.$cctor();return O.intentConfidenceThreshold;};I.set_intentConfidenceThreshold=function(bR){O.$cctor();O.intentConfidenceThreshold=bR;};I.getUtterance2=function(bR){var bS;bS=null;return bB.Delay(function(){return bB.Bind(o.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bR),function(bT){d.debug("NLU",(function(bU){return function(bV){return bU("Wit.ai returned "+bi.p(bV)+" ");};}(a.id))(bT));return bB.Return(new J({$:0,$0:bR,$1:by.ofArray(bk.map(function(bU){return new K({$:0,$0:bU.name,$1:bU.confidence});},bT.intents)),$2:by.map(function(bU){return new L({$:0,$0:bU.name,$1:bU.confidence,$2:bU.role,$3:bU.value});},by.ofSeq(bz.concat(bz.map(function(bU){return bU[1];},bE.ToSeq(bT.entities))))),$3:by.ofSeq(bz.map(function(bU){var bV;bV=bU[1];return new M({$:0,$0:bU[0],$1:bk.get(bV,0).confidence,$2:bk.get(bV,0).value});},bE.ToSeq(bT.traits)))}));});});};I.getUtterance=function(bR,bS){o.getMeaning("OOGDHEQL7JZRQASXN2N2GHFUKGO3SCNV",bR,function(bT){var bU,bV;d.debug("NLU",(function(bW){return function(bX){return bW("Wit.ai returned: "+bu.prettyPrint(bX));};}(a.id))(bT));bU=!(bT.intents==null)?by.ofArray(bk.map(function(bW){return new K({$:0,$0:bW.name,$1:bW.confidence});},bT.intents)):by.T.Empty;bV=!(bT.traits==null)?by.ofSeq(bz.concat(by.map(function(bW){return bk.map(function(bX){return new M({$:0,$0:bW,$1:bX.confidence,$2:bX.value});},bG.GetJS(bT.traits,[bW]));},by.filter(function(bW){return!(bG.GetJS(bT.traits,[bW])==null);},I.trait_types())))):by.T.Empty;return bS({$:1,$0:new J({$:0,$0:bR,$1:bU,$2:!(bT.entities==null)?by.ofSeq(bz.concat(by.map(function(bW){return bk.map(function(bX){return new L({$:0,$0:bX.name,$1:bX.confidence,$2:bX.role,$3:bX.value});},bG.GetJS(bT.entities,[bW]));},by.filter(function(bW){return!(bG.GetJS(bT.entities,[bW])==null);},I.entity_types())))):by.T.Empty,$3:bV})});},function(bT,bU,bV){d.error((((bn.Curried3(function(bW,bX,bY){return bW("Wit.ai returned: "+bu.prettyPrint(bX)+" "+bu.prettyPrint(bY));}))(a.id))(bU))(bV));return bS(null);});};I.trait_types=function(){O.$cctor();return O.trait_types;};I.entity_types=function(){O.$cctor();return O.entity_types;};I.JournalEntry=function(bR){var bS;return bx.StartsWith(bR,"journal ")&&bx.Replace(bR,"journal ","")!==""?(bS=bx.Replace(bR,"journal ",""),{$:1,$0:new F({$:0,$0:"journal",$1:{$:1,$0:new C({$:0,$0:"journal",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:by.ofArray([new E({$:0,$0:"journal_entry",$1:"",$2:bS,$3:{$:1,$0:1}})])}})}):null;};I.QuickJournal=function(bR){var bS;return bR==="journal"||bR==="diary"?{$:1,$0:new F({$:0,$0:"journal",$1:{$:1,$0:new C({$:0,$0:"journal",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.QuickNumber=function(bR){var bS,bT,bU,bV,bW,bX;return(bT=I.One(bR),bT!=null&&bT.$==1?(bS=bT.$0,true):(bU=I.Two(bR),bU!=null&&bU.$==1?(bS=bU.$0,true):(bV=I.Three(bR),bV!=null&&bV.$==1?(bS=bV.$0,true):(bW=I.Four(bR),bW!=null&&bW.$==1?(bS=bW.$0,true):(bX=I.Five(bR),bX!=null&&bX.$==1&&(bS=bX.$0,true))))))?{$:1,$0:bS}:null;};I.Five=function(bR){var bS;return bR==="5"||bR==="five"?{$:1,$0:new F({$:0,$0:"five",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:by.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"five",$3:{$:1,$0:1}})])}})}:null;};I.Four=function(bR){var bS;return bR==="4"||bR==="four"?{$:1,$0:new F({$:0,$0:"four",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:by.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"four",$3:{$:1,$0:1}})])}})}:null;};I.Three=function(bR){var bS;return bR==="3"||bR==="three"?{$:1,$0:new F({$:0,$0:"three",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:by.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"three",$3:{$:1,$0:1}})])}})}:null;};I.Two=function(bR){var bS;return bR==="2"||bR==="two"?{$:1,$0:new F({$:0,$0:"two",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:by.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"two",$3:{$:1,$0:1}})])}})}:null;};I.One=function(bR){var bS;return bR==="1"||bR==="one"?{$:1,$0:new F({$:0,$0:"one",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:by.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"one",$3:{$:1,$0:1}})])}})}:null;};I.QuickNo=function(bR){var bS;return bR==="no"||(bR==="nope"||(bR==="no way"||(bR==="nah"||(bR==="don't do it"||bR==="stop"))))?{$:1,$0:new F({$:0,$0:"no",$1:{$:1,$0:new C({$:0,$0:"reject",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.QuickYes=function(bR){var bS;return bR==="yes"||(bR==="ok"||(bR==="sure"||(bR==="yeah"||(bR==="yep"||(bR==="uh huh"||(bR==="go ahead"||bR==="go"))))))?{$:1,$0:new F({$:0,$0:"yes",$1:{$:1,$0:new C({$:0,$0:"verify",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.QuickHelp=function(bR){var bS;return bR==="help"||(bR==="help me"||(bR==="what's this?"||bR==="huh"))?{$:1,$0:new F({$:0,$0:"help",$1:{$:1,$0:new C({$:0,$0:"help",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.QuickHello=function(bR){var bS;return bR==="hello"||(bR==="hey"||(bR==="yo"||bR==="hi"))?{$:1,$0:new F({$:0,$0:"hello",$1:{$:1,$0:new C({$:0,$0:"greet",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.Voices=function(bR){return bR==="voices"?{$:1,$0:null}:null;};I.DebugEntry=function(bR){return bx.StartsWith(bR,"debug-entry ")?{$:1,$0:bx.Replace(bR,"debug-entry ","")}:null;};I.DebugBehaviouralTraits=function(bR){return bx.StartsWith(bR,"debug-bt ")?{$:1,$0:bx.Replace(bR,"debug-bt ","")}:null;};I.DebugEmotionalTraits=function(bR){return bx.StartsWith(bR,"debug-et ")?{$:1,$0:bx.Replace(bR,"debug-et ","")}:null;};I.DebugTriples=function(bR){return bx.StartsWith(bR,"debug-triples ")?{$:1,$0:bx.Replace(bR,"debug-triples ","")}:null;};I.DebugLemmas=function(bR){return bx.StartsWith(bR,"debug-lemmas ")?{$:1,$0:bx.Replace(bR,"debug-lemmas ","")}:null;};I.DebugEntities=function(bR){return bx.StartsWith(bR,"debug-entities ")?{$:1,$0:bx.Replace(bR,"debug-entities ","")}:null;};I.Debug=function(bR){return bR==="debug"?{$:1,$0:null}:null;};I.Blank=function(bR){return bR===""?{$:1,$0:null}:null;};N.Study=function(bR){return bR.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};B.StrA=function(bR){if(bR!=null&&bR.$==1)try{return{$:1,$0:((bI.DecodeArray(bI.Id()))())(bJ.parse(bR.$0))};}catch(bS){return null;}else return null;};B.PStr=function(bR){var bS;return bR!=null&&bR.$==1&&(typeof bR.$0=="string"&&(bS=bR.$0,true))?{$:1,$0:bS}:null;};B.No=function(bR){var bS,bT;return(bT=B.Intent$1("reject",bR),bT!=null&&bT.$==1&&(bT.$0[0]==null&&(bT.$0[1]==null&&(bS=bR,true))))?{$:1,$0:bS}:null;};B.Yes=function(bR){var bS,bT;return(bT=B.Intent$1("verify",bR),bT!=null&&bT.$==1&&(bT.$0[0]==null&&(bT.$0[1]==null&&(bS=bR,true))))?{$:1,$0:bS}:null;};B.EntityManyofMany=function(bR,bS){return{$:1,$0:bE.OfArray(bk.ofSeq(by.map(function(bT){return by.exists(function(bU){return bU.get_Role()===bT;},bS)?[bT,{$:1,$0:by.filter(function(bU){return bU.get_Role()===bT;},bS)}]:[bT,null];},bR)))};};B.EntityManyOf1=function(bR,bS){var bT;return bS!=null&&bS.$==1&&(by.exists(function(bU){return bU.get_Role()===bR;},bS.$0)&&(bT=bS.$0,true))?{$:1,$0:by.filter(function(bU){return bU.get_Role()===bR;},bT)}:null;};B.Entity1OfAny=function(bR,bS){var bT;return bS!=null&&bS.$==1&&(by.exists(function(bU){return bU.get_Role()===bR;},bS.$0)&&(bT=bS.$0,true))?{$:1,$0:by.head(by.sortBy(function(bU){return bU.get_Role();},by.filter(function(bU){return bU.get_Role()===bR;},bT)))}:null;};B.Entity1Of1=function(bR,bS){var bT,bU;return bS!=null&&bS.$==1&&(bS.$0.$==1&&(bS.$0.$1.$==0&&((bU=bS.$0.$0,bU.get_Role()===bR||bU.get_Name()===bR)&&(bT=bS.$0.$0,true))))?{$:1,$0:bT}:null;};B.Intent$1=function(bR,bS){return bS.get_Intent()!=null&&bS.get_Intent().$0.get_Name()===bR?{$:1,$0:[bS.get_Traits(),bS.get_Entities()]}:null;};O.$cctor=function(){O.$cctor=a.ignore;O.entity_types=by.ofArray(["wit$contact:name","wit$datetime:datetime","term:subject","term:object","term:verb"]);O.trait_types=by.ofArray(["domain","dialogue_act"]);O.intentConfidenceThreshold=0.85;O.entityConfidenceThreshold=0.85;};Q=P.EmotionalTrait=bn.Class({get_Frequence:function(){return this.$2;},get_Hierarchy:function(){return this.$1;},get_Label:function(){return this.$0;}},null,Q);R=P.Relation=bn.Class({toString:function(){return((((bn.Curried(function(bR,bS,bT,bU){return bR("("+bu.prettyPrint(bS)+", "+bu.prettyPrint(bT)+", "+bu.prettyPrint(bU)+")");},4))(a.id))(this.get_T1()))(this.get_Name()))(this.get_T2());},get_T2:function(){return this.$2;},get_Name:function(){return this.$1;},get_T1:function(){return this.$0;}},null,R);S=P.Triple=bn.Class({toString:function(){return((((bn.Curried(function(bR,bS,bT,bU){return bR("("+bh.p$11(bS)+", "+bh.p$13(bT)+", "+bh.p$19(bU)+")");},4))(a.id))(this.get_Subject()))(this.get_Verb()))(this.get_Object());},get_Object:function(){var bR;bR=this.$1;return bR!=null?{$:1,$0:bR.$0.get_T2()}:null;},get_Verb:function(){return this.$0.get_T2();},get_Subject:function(){return this.$0.get_T1();}},null,S);T=P.Subject=bn.Class({toString:function(){return this.$==1?a.String(this.$0):this.$0;}},null,T);U=P.Verb=bn.Class({toString:function(){return this.$0;}},null,U);V=P.Object=bn.Class({toString:function(){return this.$==1?a.String(this.$0):this.$0;}},null,V);W=P.ExpertAIEntity=bn.Class({get_Relevance:function(){return this.$3;},get_Positions:function(){return this.$2;},get_Lemma:function(){return this.$1;},get_Type:function(){return this.$0;}},null,W);X=P.ExpertAILemma=bn.Class({get_Positions:function(){return this.$2;},get_Score:function(){return this.$1;},get_Value:function(){return this.$0;}},null,X);P.SubjectVerbObject1OfAny=function(bR,bS,bT,bU,bV,bW){return bW==null?null:bz.tryPick(function(bX){var bY,bZ,b0,b1,b2,b3,b4,b5;return(bZ=P.TripleSubject(bR,bX.$0.$0),bZ!=null&&bZ.$==1)&&((b0=P.TripleRelation(bS,bX.$0.$1),b0!=null&&b0.$==1)&&((b1=P.TripleVerb(bT,bX.$0.$2),b1!=null&&b1.$==1)&&((b2=bX.$1,b2!=null&&b2.$==1)&&((b3=P.TripleVerb(bT,bX.$1.$0.$0),b3!=null&&b3.$==1)&&((b4=P.TripleRelation(bU,bX.$1.$0.$1),b4!=null&&b4.$==1)&&(b5=P.TripleObject(bV,bX.$1.$0.$2),b5!=null&&b5.$==1))))))?{$:1,$0:bX}:null;},bW.$0);};P.SubjectVerb1OfAny=function(bR,bS,bT,bU){return bU==null?null:bz.tryPick(function(bV){var bW,bX,bY,bZ;return(bX=P.TripleSubject(bR,bV.$0.$0),bX!=null&&bX.$==1)&&((bY=P.TripleRelation(bS,bV.$0.$1),bY!=null&&bY.$==1)&&(bZ=P.TripleVerb(bT,bV.$0.$2),bZ!=null&&bZ.$==1))?{$:1,$0:bV}:null;},bU.$0);};P.TripleObject=function(bR,bS){var bT;return bS.$==0&&(bS.$0.toUpperCase()===bR.toUpperCase()&&(bT=bS.$0,true))?{$:1,$0:null}:null;};P.TripleVerb=function(bR,bS){return bS.$0.toUpperCase()===bR.toUpperCase()?{$:1,$0:null}:null;};P.TripleRelation=function(bR,bS){return bS.toUpperCase()===bR.toUpperCase()?{$:1,$0:null}:null;};P.TripleSubject=function(bR,bS){var bT;return bS.$==0&&(bS.$0.toUpperCase()===bR.toUpperCase()&&(bT=bS.$0,true))?{$:1,$0:null}:null;};Z.MicReady={$:5};Z.MicAudioEnd={$:4};Z.MicAudioStart={$:3};Z.MicDisconnected={$:2};Z.MicConnecting={$:1};Z.MicNotInitialized={$:0};_0.ClientUnderstand={$:2};_0.ClientReady={$:1};_0.ClientNotInitialzed={$:0};_1=Y.Interpreter=bn.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,_1);_2=Y.CUI=bn.Class({SayVoices:function(){var bR,bS,bT;bR=this;bS=a.speechSynthesis.getVoices();!(bS==null)?(bT=d.toArray(bS),bR.Say((function(bU){return function(bV){return bU("There are currently "+a.String(bV)+" voices installed on this computer or device.");};}(a.id))(bk.length(bT))),bk.iteri(function(bU,bV){return bR.Say(((((bn.Curried(function(bW,bX,bY,bZ){return bW("Voice "+a.String(bX)+". Name: "+bu.toSafe(bY)+", Local: "+bu.prettyPrint(bZ)+".");},4))(a.id))(bU))(bV.name))(bV.localService));},bT)):void 0;},Wait:function(bR){this.Wait$1(function(){bB.Start(bR,null);});},Wait$1:function(bR){this["Echo'"]("please wait...");this.Term.pause();bR();this.Term.resume();},sayRandom:function(bR,bS){this.Say(z.getRandomPhrase(bR,bS));},SayAngry:function(bR){var bS,bT;bS=this;bB.Start((bT=null,bB.Delay(function(){return bB.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bK.chime(),bB.Zero()):bB.Zero(),bB.Delay(function(){a.addMessage(bS.Avatar,bR,"","");bS.Avatar.processMessages(0);return bB.Zero();}));})),null);},SayDoc:function(bR){var bS,bT,bU;bS=bk.get(bw(".terminal-output").get(),0).childNodes.length;bT=bq.Element("div",[d.cls("terminal-command"),d.dindex(bS+1)],[bR]);bU=d.terminalOutput();bt.LoadLocalTemplates("");bq.RunAppend(bU,bT);},Say:function(bR){var bS,bT;bS=this;bB.Start((bT=null,bB.Delay(function(){return bB.Combine(a.speechSynthesis.speaking?(bK.chime(),bB.Zero()):bB.Zero(),bB.Delay(function(){bS.Avatar.addMessage(bR);bS.Avatar.processMessages(0);return bB.Zero();}));})),null);},Debug:function(bR,bS){d.debug(bR,bS);},"EchoHtml'":function(bR){var bS,bT;bS=(bT={},bT.raw=true,bT);this.Term.disable();this.Term.echo(bR,bS);this.Term.enable();},"Echo'":function(bR){this.Term.disable();this.Term.echo(bR);this.Term.enable();}},null,_2);_2.New=function(bR,bS,bT,bU,bV,bW,bX){return new _2({Voice:bR,Mic:bS,Term:bT,Avatar:bU,Caption:bV,AudioHandlers:bW,TypingDNA:bX});};_3=c.Dialogue=bn.Class({get_Utterances:function(){return this.$4;},get_Output:function(){return this.$3;},get_DialogueQuestions:function(){return this.$2;},get_Props:function(){return this.$1;},get_Cui:function(){return this.$0;}},null,_3);_4=c.Question=bn.Class({toString:function(){return((((bn.Curried(function(bR,bS,bT,bU){return bR("Name: "+bu.toSafe(bS)+" Module: "+bu.toSafe(bT)+" Type: "+bh.p$20(bU)+" ");},4))(a.id))(this.get_Name()))(this.get_Module()))(this.get_Type());},get_Target:function(){return this.$4;},get_Params:function(){return this.$3;},get_Type:function(){return this.$2;},get_Module:function(){return this.$1;},get_Name:function(){return this.$0;}},null,_4);_5.ConceptCompletion={$:3};_5.Disjunctive={$:2};_5.Verification={$:1};_6["Response'_"]=function(bR,bS,bT){var bU,bV,bW,bX,bY,bZ,b0,b1;return(bV=_6.PropNotSet_(bR,"user",bT),bV!=null&&bV.$==1?(bW=_6.Form(bR,bS,bV.$0),bW!=null&&bW.$==1?(bU=bW.$0,true):(bX=_6.PropNotSet_(bR,"user",bT),bX!=null&&bX.$==1&&(bY=_6.NotForm(bR,bS,bX.$0),bY!=null&&bY.$==1&&(bU=bY.$0,true)))):(bZ=_6.PropNotSet_(bR,"user",bT),bZ!=null&&bZ.$==1&&(b0=_6.NotForm(bR,bS,bZ.$0),b0!=null&&b0.$==1&&(bU=b0.$0,true))))?(b1=_6.have(bR,bS)?{$:1,$0:_6.prop(bR,bS)}:null,bU.get_Text()!==""?{$:1,$0:[bU,{$:1,$0:bU.get_Text()},b1]}:{$:1,$0:[bU,null,b1]}):null;};_6.Response_=function(bR,bS,bT){var bU,bV,bW,bX,bY,bZ,b0,b1;return(bV=_6.PropSet_(bR,"user",bT),bV!=null&&bV.$==1?(bW=_6.Form(bR,bS,bV.$0),bW!=null&&bW.$==1?(bU=bW.$0,true):(bX=_6.PropSet_(bR,"user",bT),bX!=null&&bX.$==1&&(bY=_6.NotForm(bR,bS,bX.$0),bY!=null&&bY.$==1&&(bU=bY.$0,true)))):(bZ=_6.PropSet_(bR,"user",bT),bZ!=null&&bZ.$==1&&(b0=_6.NotForm(bR,bS,bZ.$0),b0!=null&&b0.$==1&&(bU=b0.$0,true))))?(b1=_6.have(bR,bS)?{$:1,$0:_6.prop(bR,bS)}:null,bU.get_Text()!==""?{$:1,$0:[bU,{$:1,$0:bU.get_Text()},b1]}:{$:1,$0:[bU,null,b1]}):null;};_6.NotForm=function(bR,bS,bT){return bR.get_DialogueQuestions().length>0&&(bR.get_DialogueQuestions())[0].get_Name()===bS&&bT.get_Text()!==""?{$:1,$0:bT}:null;};_6.Form=function(bR,bS,bT){return bR.get_DialogueQuestions().length>0&&(bR.get_DialogueQuestions())[0].get_Name()===bS&&bT.get_Intent()!=null&&bT.get_Intent().$0.get_Name()===bS&&bL.Equals(bT.get_Intent().$0.get_Confidence(),{$:1,$0:1})&&bL.Equals(bT.get_Traits(),null)&&bL.Equals(bT.get_Entities(),null)?{$:1,$0:bT}:null;};_6["User'_"]=function(bR,bS){var bT,bU;return(bU=_6.PropNotSet_(bR,"user",bS),bU!=null&&bU.$==1&&(bR.get_DialogueQuestions().length===0&&(bT=bU.$0,true)))?{$:1,$0:bT}:null;};_6.User_=function(bR,bS){var bT,bU;return(bU=_6.PropSet_(bR,"user",bS),bU!=null&&bU.$==1&&(bR.get_DialogueQuestions().length===0&&(bT=bU.$0,true)))?{$:1,$0:bT}:null;};_6.PropNotSet_=function(bR,bS,bT){return!_6.have(bR,bS)?{$:1,$0:bT}:null;};_6.PropSet_=function(bR,bS,bT){return _6.have(bR,bS)?{$:1,$0:bT}:null;};_6.Agenda_=function(bR,bS,bT,bU){return bR.get_DialogueQuestions().length>0&&(bR.get_DialogueQuestions())[0].get_Module()===bT?{$:1,$0:null}:null;};_6.debugInterpreterEnd=function(bR,bS,bT){bS(((((bn.Curried(function(bU,bV,bW,bX){return bU(bu.toSafe(bV)+" ending utterances:"+bu.prettyPrint(bW)+", questions: "+bu.prettyPrint(bX)+".");},4))(a.id))(bT))(bR.get_Utterances()))(bR.get_DialogueQuestions()));};_6.debugInterpreterStart=function(bR,bS,bT){bS(((((bn.Curried(function(bU,bV,bW,bX){return bU(bu.toSafe(bV)+" starting utterances:"+bu.prettyPrint(bW)+", questions: "+bu.prettyPrint(bX)+".");},4))(a.id))(bT))(bR.get_Utterances()))(bR.get_DialogueQuestions()));};_6.frame=function(bR){return by.ofSeq(bz.take(bR.length>=5?5:bR.length,bR));};_6.didNotUnderstand=function(bR,bS,bT){bS((function(bU){return function(bV){return bU(bu.toSafe(bV)+" interpreter did not understand utterance.");};}(a.id))(bT));_6.popu(bR,bS);_6.say(bR,"Sorry I didn't understand what you meant.");!_6.have(bR,"user")?_6.say(bR,"You must login to use most functions in Selma."):void 0;};_6.endt=function(bR,bS,bT,bU){_6.popu(bR,bS);_6.popq(bR,bS);_6.have(bR,bT)?_6.remove(bR,bS,bT):void 0;bS((function(bV){return function(bW){return bV("End turn "+bu.toSafe(bW)+".");};}(a.id))(bT));bU();};_6.cancel=function(bR,bS,bT){var bU;bU=(bR.get_DialogueQuestions())[0];bU.get_Name()!==bT?(((bn.Curried3(function(bV,bW,bX){return bV(bh.p$21(bW)+" at the top of the stack does not have the name "+bu.toSafe(bX)+".");}))(bo.FailWith))(bU))(bT):void 0;_6.popq(bR,bS);bS((function(bV){return function(bW){return bV("Cancel "+bh.p$21(bW)+".");};}(a.id))(bU));};_6.trigger=function(bR,bS,bT,bU,bV){_6.pushu(bR,bS,new F({$:0,$0:bJ.stringify(bV),$1:{$:1,$0:new C({$:0,$0:bU,$1:{$:1,$0:1}})},$2:null,$3:null}));bT(bR);};_6.handle=function(bR,bS,bT,bU){_6.popu(bR,bS);bS((function(bV){return function(bW){return bV("Handle utterance "+bu.toSafe(bW)+".");};}(a.id))(bT));bU();};_6.dispatch=function(bR,bS,bT,bU){bS(((((bn.Curried(function(bV,bW,bX,bY){return bV("Dispatch to module "+bu.toSafe(bW)+" utterances: "+bu.prettyPrint(bX)+" questions: "+bu.prettyPrint(bY)+".");},4))(a.id))(bT))(bR.get_Utterances()))(bR.get_DialogueQuestions()));bU(bR);};_6.popq=function(bR,bS){var bT;bT=bR.get_DialogueQuestions().shift();bS((function(bU){return function(bV){return bU("Pop "+bh.p$21(bV)+".");};}(a.id))(bT));};_6.pushq=function(bR,bS,bT){bR.get_DialogueQuestions().unshift(bT);bS((function(bU){return function(bV){return bU("Push "+bh.p$21(bV)+".");};}(a.id))(bT));};_6.popu=function(bR,bS){var bT;bT=bR.get_Utterances().shift();bS((function(bU){return function(bV){return bU("Pop "+bh.p$18(bV)+".");};}(a.id))(bT));};_6.pushu=function(bR,bS,bT){bS((function(bU){return function(bV){return bU("Push "+bh.p$18(bV)+".");};}(a.id))(bT));bR.get_Utterances().unshift(bT);};_6.remove=function(bR,bS,bT){bS((function(bU){return function(bV){return bU("Remove property "+bu.toSafe(bV)+".");};}(a.id))(bT));bR.get_Props().Remove(bT);};_6.add=function(bR,bS,bT,bU){bR.get_Props().Add(bT,bU);bS((((bn.Curried3(function(bV,bW,bX){return bV("Add property "+bu.toSafe(bW)+":"+bu.prettyPrint(bX)+".");}))(a.id))(bT))(bU));};_6.prop=function(bR,bS){return bR.get_Props().ContainsKey(bS)?bR.get_Props().get_Item(bS):(function(bT){return function(bU){return bT("The "+bu.toSafe(bU)+" dialogue property does not exist.");};}(bo.FailWith))(bS);};_6.have=function(bR,bS){return bR.get_Props().ContainsKey(bS);};_6["sayRandom'"]=function(bR,bS){_6.sayRandom(bR,bS,"");};_6.sayRandom=function(bR,bS,bT){var bU;bU=z.getRandomPhrase(bS,bT);bR.get_Output().unshift(bU);bR.get_Cui().Say(bU);};_6.say=function(bR,bS){bR.get_Output().unshift(bS);_6["say'"](bR,bS);};_6["say'"]=function(bR,bS){bR.get_Cui().Say(bS);};_6.echo=function(bR,bS){(bR.get_Cui())["EchoHtml'"](bS);};_7.userAuthenticationDialog=function(bR,bS,bT,bU){var bV,bW,bX;function bY(b3){_6.say(bR,b3);}function bZ(b3){b3.input="text";b3.showCancelButton=true;b3.confirmButtonText="Ok";}function b0(b3){b3.confirmButtonClass="invisible";b3.showCancelButton=true;}function b1(){var b3;b3=d.createDialogueBoxCanvas();d.startCamera(self.document.body,b3);}function b2(b3){var b4,b5;b4=b3[0];b5=b3[1];d.questionBox("Biometric Authentication","",{$:1,$0:d.boxesWithTitles(["2","3"])},{$:1,$0:[640,480]},{$:1,$0:bZ},{$:1,$0:b1},function(b6){var b7,b8,b9,b_;b6.isConfirmed?(b7=bR.get_Cui().TypingDNA.getTypingPattern((b8={},b8.type=1,b8.text=bX,b8.caseSensitive=false,b8)),b9=b6.value,b_=d.getCameraCanvas().toDataURL(),bS((function(b$){return function(ca){return b$("User image is "+bu.toSafe(ca)+"...");};}(a.id))(bx.Substring(b_,0,10))),d.stopCamera(),bS((((bn.Curried3(function(b$,ca,cb){return b$("User entered typing pattern "+bu.toSafe(ca)+" for text "+bu.toSafe(cb));}))(a.id))(b7))(b9)),b9.toLowerCase()!==bX.toLowerCase()?(bY("Sorry you did not enter the passphrase correctly. Please try again."),b2([b4,b5])):d.questionBox("Biometric Authentication","",null,null,{$:1,$0:b0},{$:1,$0:function(){d.getDialogueBoxContent().appendChild(d.getMic());bR.get_Cui().AudioHandlers.Add("VoiceAuthentication",function(b$){bJ.stringify(((bI.Id())())(b$));d.confirmQuestionBox();});}},function(b$){if(!b$.isConfirmed){bR.get_Cui().AudioHandlers.Remove("VoiceAuthentication");bY("OK but you must login for me to help you.");}})):bY("OK but you must login for me to help you.");});}bV=bT.get_Target();bW=bT.get_Name();bX=(function(b3){return function(b4){return b3("Hello my name is "+bu.toSafe(b4)+" and I am an administrator");};}(a.id))(bU);bY((function(b3){return function(b4){return b3("Enter the phrase "+bu.toSafe(b4)+".");};}(a.id))(bX));b2([0,[]]);};_8.ask=function(bR,bS,bT){var bU;_6.pushq(bR,bS,bT);(bT.get_Target())(bR);bU=bT.get_Type();bU.$==0?_7.userAuthenticationDialog(bR,bS,bT,bU.$0):void 0;};_9.update=function(bR){var bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq;function cr(cD){_6.say(bR,cD);}function cs(cD,cE){return _6.sayRandom(bR,cD,cE);}function ct(cD,cE){return _6.add(bR,function(cF){_9.debug(cF);},cD,cE);}function cu(cD){_9.debug(cD);}function cv(cD){_9.debug(cD);}function cw(cD){_9.debug(cD);}function cx(cD){return _6["User'_"](bR,cD);}function cy(cD,cE){return _6.Response_(bR,cD,cE);}function cz(cD,cE){return _6["Response'_"](bR,cD,cE);}function cA(cD){var cE;cs(z.waitRetrievePhrases(),"user name");bB.Start((cE=null,bB.Delay(function(){return bB.Bind((new bN.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-1606538923",[cD]),function(cF){var cG;return cF==null?(cr((function(cH){return function(cI){return cH("I did not find a user with the name "+bu.toSafe(cI)+".");};}(a.id))(cD)),bV(new _4({$:0,$0:"addUser",$1:_9.name(),$2:_5.Verification,$3:null,$4:function(){ct("addUser",cD);cr((function(cH){return function(cI){return cH("Do you want me to add the user "+bu.toSafe(cI)+"?");};}(a.id))(cD));}})),bB.Zero()):(cG=cF.$0,(ct("user",cD),bB.Bind((new bN.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:656008333",[cG.Name]),function(){cs(z.helloUserPhrases(),cG.Name);return cG.LastLoggedIn!=null?bB.Bind((new bN.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:1657353123",[cG.LastLoggedIn.$0]),function(cH){cr((function(cI){return function(cJ){return cI("You last logged in "+bu.toSafe(cJ)+".");};}(a.id))(cH));return bB.Zero();}):bB.Zero();})));});})),null);}function cB(cD){var cE;bB.Start((cE=null,bB.Delay(function(){cs(z.waitAddPhrases(),"user");return bB.Bind((new bN.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:-891039589",[cD]),function(cF){return cF.$==1?(d.error((((bn.Curried3(function(cG,cH,cI){return cG("Error adding user "+bu.toSafe(cH)+":"+bu.toSafe(cI)+".");}))(a.id))(cD))(cF.$0)),cr((function(cG){return function(cH){return cG("Sorry I was not able to add the user "+bu.toSafe(cH)+" to the system.");};}(a.id))(cD)),bB.Zero()):(ct("user",cD),cr((function(cG){return function(cH){return cG("Hello "+bu.prettyPrint(cH)+", nice to meet you.");};}(a.id))(bS.get_Item("user"))),bB.Zero());});})),null);}function cC(cD){return new _4({$:0,$0:"switchUser",$1:_9.name(),$2:_5.Verification,$3:null,$4:function(){cr((function(cE){return function(cF){return cE("Do you want me to switch to the user "+bu.toSafe(cF));};}(a.id))(cD));}});}_6.debugInterpreterStart(bR,function(cD){_9.debug(cD);},_9.name());bS=bR.$1;bT=bn.Curried(_6.handle,2,[bR,cu]);bU=bn.Curried(_6.endt,2,[bR,cv]);bV=function(cD){_8.ask(bR,cw,cD);};bW=_6.frame(bR.$4);bW.$==1&&(bY=cx(bW.$0),bY!=null&&bY.$==1&&(bZ=B.Intent$1("greet",bY.$0),bZ!=null&&bZ.$==1&&(b0=B.Entity1Of1("name",bZ.$0[1]),b0!=null&&b0.$==1&&(bW.$1.$==0&&(bX=b0.$0,true)))))?(bT("loginUser"))(function(){cA(bX.get_Value());}):bW.$==1&&(b2=cx(bW.$0),b2!=null&&b2.$==1&&(b3=B.Intent$1("hello",b2.$0),b3!=null&&b3.$==1&&(b4=B.Entity1Of1("contact",b3.$0[1]),b4!=null&&b4.$==1&&(bW.$1.$==0&&(b1=b4.$0,true)))))?(bT("loginUser"))(function(){cA(b1.get_Value());}):bW.$==1&&(b6=cz("authenticateUser",bW.$0),b6!=null&&b6.$==1&&(b7=B.StrA(b6.$0[1]),b7!=null&&b7.$==1&&(bW.$1.$==0&&(b5=b7.$0,true))))?(bU("authenticateUser"))(function(){var cD;_9.debug(b5);bB.Start((cD=null,bB.Delay(function(){return bB.Bind((new bN.New()).Async("SMApp.Web:SMApp.Web.Server.hasFace:2028108417",[bk.get(b5,2)]),function(cE){return cE?(cr("Face detected"),bB.Zero()):(cr(function(cF){return cF("Sorry I did not detect a face in the camera image. Make sure you can see the red square around your face in the camera window when you click the OK button.");}(a.id)),bB.Zero());});})),null);}):bW.$==1&&(b9=B.No(bW.$0),b9!=null&&b9.$==1&&(b_=cz("addUser",b9.$0),b_!=null&&b_.$==1&&(b$=B.PStr(b_.$0[2]),b$!=null&&b$.$==1&&(bW.$1.$==0&&(b8=b$.$0,true)))))?(bU("addUser"))(function(){cr((function(cD){return function(cE){return cD("Ok I did not add the user "+bu.toSafe(cE)+". But you must login for me to help you.");};}(a.id))(b8));}):bW.$==1&&(cb=B.Yes(bW.$0),cb!=null&&cb.$==1&&(cc=cz("addUser",cb.$0),cc!=null&&cc.$==1&&(cd=B.PStr(cc.$0[2]),cd!=null&&cd.$==1&&(bW.$1.$==0&&(ca=cd.$0,true)))))?(bU("addUser"))(function(){cB(ca);}):bW.$==1&&(cf=_6.User_(bR,bW.$0),cf!=null&&cf.$==1&&(cg=B.Intent$1("hello",cf.$0),cg!=null&&cg.$==1&&(cg.$0[0]==null&&(ch=B.Entity1Of1("name",cg.$0[1]),ch!=null&&ch.$==1&&(bW.$1.$==0&&(ce=ch.$0,true))))))?bB.Start((ci=null,bB.Delay(function(){return bB.Bind((new bN.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-1606538923",[ce.get_Value()]),function(cD){return cD==null?(cr((function(cE){return function(cF){return cE("Sorry, the user "+bu.toSafe(cF)+" does not exist.");};}(a.id))(ce.get_Value())),bB.Zero()):(bV(cC(cD.$0.Name)),bB.Zero());});})),null):bW.$==1&&(ck=B.Yes(bW.$0),ck!=null&&ck.$==1&&(cl=cy("switchUser",ck.$0),cl!=null&&cl.$==1&&(cm=B.PStr(cl.$0[2]),cm!=null&&cm.$==1&&(bW.$1.$==0&&(cj=cm.$0,true)))))?(bS.set_Item("user",cj),cr((function(cD){return function(cE){return cD("Ok I switched to user "+bu.prettyPrint(cE)+".");};}(a.id))(cj))):bW.$==1&&(co=B.No(bW.$0),co!=null&&co.$==1&&(cp=cy("switchUser",co.$0),cp!=null&&cp.$==1&&(cq=B.PStr(cp.$0[2]),cq!=null&&cq.$==1&&(bW.$1.$==0&&(cn=cq.$0,true)))))?cr((function(cD){return function(cE){return cD("Ok I did not switch to user "+bu.toSafe(cE)+".");};}(a.id))(cn)):_6.didNotUnderstand(bR,function(cD){_9.debug(cD);},_9.name());_6.debugInterpreterEnd(bR,function(cD){_9.debug(cD);},_9.name());};_9.debug=function(bR){d.debug(_9.name(),bR);};_9.name=function(){_.$cctor();return _.name;};_.$cctor=function(){_.$cctor=a.ignore;_.name="User";};$.update=function(bR){var bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7;function b8(cb){_6.echo(bR,cb);}function b9(cb){_6.say(bR,cb);}function b_(cb,cc){return _6.add(bR,function(cd){$.debug(cd);},cb,cc);}function b$(cb){return _6.User_(bR,cb);}function ca(cb){var cc;cc=null;return bB.Delay(function(){return bB.Combine(bB.Bind((new bN.New()).Async("SMApp.Web:SMApp.Web.Server.getTriples:-550747157",[cb]),function(cd){var ce;return cd.$==1?(b9((function(cf){return function(cg){return cf("I could not add your journal entry. The following error occurred: "+bu.prettyPrint(cg));};}(a.id))(cd.$0)),bB.Zero()):(ce=cd.$0,ce.get_Length()>0?($.debug((function(cf){return function(cg){return cf("Got "+a.String(cg)+" sentences from NLU server");};}(a.id))(ce.get_Length())),b_("journal_entry_triples",[].concat(bk.ofSeq(ce)).reverse()),b8("Triples:"),bB.For(ce,function(cf){b8((function(cg){return function(ch){return cg("<span style='color:white;background-color:#00FA9A'>"+bu.toSafe(ch)+"</span>");};}(a.id))(a.String(cf)));return bB.Zero();})):(b9(function(cf){return cf("Sorry I could not add an entry your journal entry.");}(a.id)),bB.Zero()));}),bB.Delay(function(){return bB.Combine(bB.Bind((new bN.New()).Async("SMApp.Web:SMApp.Web.Server.getEmotionalTraits:758374353",[cb]),function(cd){var ce;return cd.$==1?($.debug(cd.$0),bB.Zero()):(ce=cd.$0,bB.Combine(bB.For(ce,function(cf){$.debug((function(cg){return function(ch){return cg(bh.p$17(ch));};}(a.id))(cf));return bB.Zero();}),bB.Delay(function(){b8("Emotional Traits:");return bB.For(ce,function(cf){b8((function(cg){return function(ch){return cg("<span style='color:white;background-color:#FF4500'>"+bh.p$17(ch)+"</span>");};}(a.id))(cf));return bB.Zero();});})));}),bB.Delay(function(){b9("I see that you mentioned these things happened to you in Iraq. Would you tell me more about your time there?");return bB.Zero();}));}));});}_6.debugInterpreterStart(bR,function(cb){$.debug(cb);},$.name());by.ofArray(["What do you feel about your day today and why?","Describe the place that makes you feel the calmest. Is there anything that could be added to make it even better?","What makes you feel like the best version of yourself?","What made you feel uneasy today?","What makes you feel sad and why?","What makes you feel happy and why?","What makes you feel angry and why?","What makes you feel safe and why?","I have trouble sleeping when\u2026"]);bS=_6.frame(bR.$4);bS.$==1&&(bU=b$(bS.$0),bU!=null&&bU.$==1&&(bV=B.Intent$1("journal",bU.$0),bV!=null&&bV.$==1&&(bW=B.Entity1Of1("journal_entry",bV.$0[1]),bW!=null&&bW.$==1&&(bS.$1.$==0&&(bT=bW.$0,true)))))?bB.Start((bX=null,bB.Delay(function(){b9("Ok let me analyze what you've written and add that to your journal.");return bB.Bind(ca(bT.get_Value()),function(){return bB.Return(null);});})),null):bS.$==1&&(bZ=B.Yes(bS.$0),bZ!=null&&bZ.$==1&&((b0=_6.Response_(bR,"painVideo",bZ.$0),b0!=null&&b0.$==1)&&bS.$1.$==0))?bR.$0["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bS.$==1&&(b2=b$(bS.$0),b2!=null&&b2.$==1&&(b3=B.Intent$1("medjournal",b2.$0),b3!=null&&b3.$==1&&((b4=b3.$0[1],b4!=null&&b4.$==1)&&(bS.$1.$==0&&(b1=b3.$0[1].$0,true)))))?(b9("ok I added that entry to your medication journal."),b9("You should be careful not to take too many painkillers over a short period of time.")):bS.$==1&&(b6=b$(bS.$0),b6!=null&&b6.$==1&&((b7=B.Intent$1("kbquery",b6.$0),b7!=null&&b7.$==1)&&(bS.$1.$==0&&(b5=b6.$0,true))))?void 0:_6.didNotUnderstand(bR,function(cb){$.debug(cb);},$.name());_6.debugInterpreterEnd(bR,function(cb){$.debug(cb);},$.name());};$.debug=function(bR){d.debug($.name(),bR);};$.name=function(){ba.$cctor();return ba.name;};ba.$cctor=function(){ba.$cctor=a.ignore;ba.name="Journal";};bb.update=function(bR){var bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7;function b8(cc){_6.say(bR,cc);}function b9(cc,cd){return _6.sayRandom(bR,cc,cd);}function b_(cc){return _6.prop(bR,cc);}function b$(cc){return _6.User_(bR,cc);}function ca(){return b_("user");}function cb(cc,cd,ce){var cf;return bB.Start((cf=null,bB.Delay(function(){b9(z.waitAddPhrases(),"symptom entry");return bB.Bind((new bN.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:-82672594",[ca().Name,cc,cd,ce]),function(cg){return cg.$==1?(b8(function(ch){return ch("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),bB.Zero()):(b8((function(ch){return function(ci){return ch("OK I added that "+bu.toSafe(ci)+" symptom to your journal.");};}(a.id))(cc)),bB.Zero());});})),null);}_6.debugInterpreterStart(bR,function(cc){bb.debug(cc);},bb.name());bS=_6.frame(bR.$4);bS.$==1&&(bU=b$(bS.$0),bU!=null&&bU.$==1&&(bV=B.Intent$1("symptom",bU.$0),bV!=null&&bV.$==1&&(bW=B.Entity1OfAny("symptom_name",bV.$0[1]),bW!=null&&bW.$==1&&(bS.$1.$==0&&(bT=bW.$0,true)))))?bB.Start((bX=null,bB.Delay(function(){b8("Ok I'll add that entry to your symptom journal");cb(bT.get_Value(),null,null);return bB.Zero();})),null):bS.$==1&&(bZ=B.Yes(bS.$0),bZ!=null&&bZ.$==1&&((b0=_6.Response_(bR,"painVideo",bZ.$0),b0!=null&&b0.$==1)&&bS.$1.$==0))?bR.$0["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bS.$==1&&(b2=b$(bS.$0),b2!=null&&b2.$==1&&(b3=B.Intent$1("medjournal",b2.$0),b3!=null&&b3.$==1&&((b4=b3.$0[1],b4!=null&&b4.$==1)&&(bS.$1.$==0&&(b1=b3.$0[1].$0,true)))))?(b8("ok I added that entry to your medication journal."),b8("You should be careful not to take too many painkillers over a short period of time.")):bS.$==1&&(b6=b$(bS.$0),b6!=null&&b6.$==1&&((b7=B.Intent$1("kbquery",b6.$0),b7!=null&&b7.$==1)&&(bS.$1.$==0&&(b5=b6.$0,true))))?void 0:_6.didNotUnderstand(bR,function(cc){bb.debug(cc);},bb.name());_6.debugInterpreterEnd(bR,function(cc){bb.debug(cc);},bb.name());};bb.debug=function(bR){d.debug(bb.name(),bR);};bb.name=function(){bc.$cctor();return bc.name;};bc.$cctor=function(){bc.$cctor=a.ignore;bc.name="Symptoms";};bd.update=function(bR){var bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd;function ce(cj){_6.say(bR,cj);}function cf(cj){_6["sayRandom'"](bR,cj);}function cg(cj){bd.debug(cj);}function ch(cj){bd.debug(cj);}function ci(cj){return _6["User'_"](bR,cj);}bS=bR.$4;bd.debug(((((bn.Curried(function(cj,ck,cl,cm){return cj("Module "+bu.toSafe(ck)+" starting utterances:"+bu.prettyPrint(cl)+", questions: "+bu.prettyPrint(cm)+".");},4))(a.id))(bd.name()))(bS))(bR.$2));bT=bn.Curried(_6.dispatch,2,[bR,cg]);bU=bn.Curried(_6.handle,2,[bR,ch]);bV=_6.frame(bS);bW=_6.Agenda_(bR,function(cj){bd.debug(cj);},_9.name(),bV);bW!=null&&bW.$==1?(bd.debug((function(cj){return function(ck){return cj("Agenda is "+bh.p$21(ck)+".");};}(a.id))((bR.get_DialogueQuestions())[0])),_9.update(bR)):bV.$==1&&(bY=(bZ=_6.PropNotSet_(bR,"started",bV.$0),bZ!=null&&bZ.$==1?{$:1,$0:bZ.$0}:null),bY!=null&&bY.$==1&&(b0=ci(bY.$0),b0!=null&&b0.$==1&&(b1=B.Intent$1("greet",b0.$0),b1!=null&&b1.$==1&&(b1.$0[1]==null&&bV.$1.$==0))))?(_6.add(bR,function(cj){bd.debug(cj);},"started",true),(bU("greet"))(function(){cf(z.helloPhrases());})):bV.$==1&&(b3=ci(bV.$0),b3!=null&&b3.$==1&&(b4=B.Intent$1("greet",b3.$0),b4!=null&&b4.$==1&&(b4.$0[1]==null&&bV.$1.$==0)))?(bU("greet"))(function(){ce("Hello, tell me your name to get started.");}):bV.$==1&&(b6=ci(bV.$0),b6!=null&&b6.$==1&&(b7=B.Intent$1("greet",b6.$0),b7!=null&&b7.$==1&&((b8=B.Entity1Of1("name",b7.$0[1]),b8!=null&&b8.$==1)&&bV.$1.$==0)))?(bT(_9.name()))(function(cj){_9.update(cj);}):bV.$==1&&(b_=ci(bV.$0),b_!=null&&b_.$==1&&(b$=B.Intent$1("hello",b_.$0),b$!=null&&b$.$==1&&((ca=B.Entity1Of1("contact",b$.$0[1]),ca!=null&&ca.$==1)&&bV.$1.$==0)))?(bT(_9.name()))(function(cj){_9.update(cj);}):bV.$==1&&(cc=_6.User_(bR,bV.$0),cc!=null&&cc.$==1&&((cd=B.Intent$1("journal",cc.$0),cd!=null&&cd.$==1)&&bV.$1.$==0))?(bT($.name()))(function(cj){$.update(cj);}):_6.didNotUnderstand(bR,function(cj){bd.debug(cj);},bd.name());_6.debugInterpreterEnd(bR,function(cj){bd.debug(cj);},bd.name());};bd.debug=function(bR){d.debug(bd.name(),bR);};bd.name=function(){be.$cctor();return be.name;};be.$cctor=function(){be.$cctor=a.ignore;be.name="Main";};bf.run=function(){var bR,bS;bR=bn.ThisFunc(function(bT,bU){return((bf.Main().get_Text())(bT))(bU);});bS=bf.Main().get_Options();a.$("#term").terminal(bR,bS);return bq.get_Empty();};bf.Main=function(){bg.$cctor();return bg.Main;};bf.initMic=function(bR){var bS,bT;bf.set_CUI((bS={$:1,$0:new bO.Microphone(bP.getElementById("microphone"))},_2.New(bf.CUI().Voice,bS,bf.CUI().Term,bf.CUI().Avatar,bf.CUI().Caption,bf.CUI().AudioHandlers,bf.CUI().TypingDNA)));bT=bf.CUI().Mic.$0;bT.onconnecting=function(){bf.set_MicState(Z.MicConnecting);return bf.debug("Mic connecting...");};bT.ondisconnected=function(){bf.set_MicState(Z.MicDisconnected);return bf.debug("Mic disconnected.");};bT.onaudiostart=function(){bf.set_MicState(Z.MicAudioStart);return bf.debug("Mic audio start...");};bT.onaudioend=function(){var bU,bV,bW,bX;bf.debug("Mic audio end.");bV=bf.CUI().AudioHandlers;bU=bV.GetEnumerator$1();try{while(bU.MoveNext()){bW=bU.Current();bf.debug((function(bY){return function(bZ){return bY("Executing audio handler "+bu.toSafe(bZ)+".");};}(a.id))(bW.K));bf.set_MicState({$:7,$0:bW.K});bX=bW.V;bf.CUI().AudioHandlers.Remove(bW.K);bX(d.lastMicData());}return;}finally{bU.Dispose();}};bT.onerror=function(bU){bf.set_MicState({$:6,$0:bU});return bf.debug((function(bV){return function(bW){return bV("Mic error : "+bu.toSafe(bW)+".");};}(a.id))(bU));};bT.onready=function(){bf.set_MicState(Z.MicReady);return bf.debug("Mic ready.");};bT.onresult=function(bU,bV){return bf.ClientState().$==2?bf.echo("I'm still trying to understand what you said before."):bf.ClientState().$==0?d.error("Client is not intialized."):bf.MicState().$==7?null:!(bU==null||bV==null)?(bf.set_MicState({$:8,$0:bU,$1:bV}),bf.debug((((bn.Curried3(function(bW,bX,bY){return bW("Mic result: "+bu.prettyPrint(bX)+" "+bu.prettyPrint(bY)+".");}))(a.id))(bU))(bV)),bR(bU,bV)):bf.debug("Mic: No result returned.");};bT.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};bf.sayRandom=function(bR,bS){bf.say(z.getRandomPhrase(bS,bR));};bf.say=function(bR){bf.Output().unshift(bR);bf["say'"](bR);};bf["say'"]=function(bR){bf.CUI().Say(bR);};bf.initSpeech=function(){var bR;bR=d.toArray(bf.synth().getVoices());bk.length(bR)>0?(bk.iter(function(bS){if(bL.Equals(bf.CUI().Voice,null)&&(bS.name.indexOf("Microsoft Zira")!=-1||bS.name.toLowerCase().indexOf("female")!=-1)){bf.set_CUI(_2.New({$:1,$0:bS},bf.CUI().Mic,bf.CUI().Term,bf.CUI().Avatar,bf.CUI().Caption,bf.CUI().AudioHandlers,bf.CUI().TypingDNA));bf.debug((function(bT){return function(bU){return bT("Using browser speech synthesis voice "+bu.toSafe(bU)+".");};}(a.id))(bf.CUI().Voice.$0.name));}},bR),!bL.Equals(bf.CUI().Voice,null)?(bf.CUI().Avatar.nativeVoice=true,bf.CUI().Avatar.nativeVoiceName=bf.CUI().Voice.$0.name,bf.debug((function(bS){return function(bT){return bS("Using browser speech synthesis voice "+bu.toSafe(bT)+".");};}(a.id))(bf.CUI().Voice.$0.name))):void 0):void 0;bL.Equals(bf.CUI().Voice,null)?bf.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};bf.synth=function(){bg.$cctor();return bg.synth;};bf.Utterances=function(){bg.$cctor();return bg.Utterances;};bf.Questions=function(){bg.$cctor();return bg.Questions;};bf.Output=function(){bg.$cctor();return bg.Output;};bf.Props=function(){bg.$cctor();return bg.Props;};bf.wait=function(bR){d["Terminal.Echo'"](bf.CUI().Term,"please wait");bf.CUI().Term.pause();bR();bf.CUI().Term.resume();};bf.debug=function(bR){d.debug("CLIENT",bR);};bf.echo=function(bR){d["Terminal.EchoHtml'"](bf.CUI().Term,(function(bS){return function(bT){return bS(bu.prettyPrint(bT));};}(a.id))(bR));};bf.ClientState=function(){bg.$cctor();return bg.ClientState;};bf.set_ClientState=function(bR){bg.$cctor();bg.ClientState=bR;};bf.MicState=function(){bg.$cctor();return bg.MicState;};bf.set_MicState=function(bR){bg.$cctor();bg.MicState=bR;};bf.CUI=function(){bg.$cctor();return bg.CUI;};bf.set_CUI=function(bR){bg.$cctor();bg.CUI=bR;};bg.$cctor=function(){var bR,bS,bT;bg.$cctor=a.ignore;function bU(bW,bX){var bY,bZ,b0,b1,b2,b3,b4,b5,b6;bY=new _3({$:0,$0:bf.CUI(),$1:bf.Props(),$2:bf.Questions(),$3:bf.Output(),$4:bf.Utterances()});bf.debug((((bn.Curried3(function(b7,b8,b9){return b7("Voice: "+bu.prettyPrint(b8)+" "+bu.prettyPrint(b9));}))(a.id))(bW))(bX));bZ=(b0=G["Intent'"](bW,bX),b0!=null&&b0.$==1?{$:1,$0:b0.$0}:null);b1=(b2=G["Trait'"](bX),b2!=null&&b2.$==1?{$:1,$0:by.ofArray([b2.$0])}:null);b3=(b4=G["Entity'$1"](bX),b4!=null&&b4.$==1?{$:1,$0:by.ofArray([b4.$0])}:null);bZ==null&&(b1==null&&b3==null)?void 0:(bf.debug(((((bn.Curried(function(b7,b8,b9,b_){return b7("Voice: "+bh.p(b8)+" "+bh.p$3(b9)+" "+bh.p$5(b_));},4))(a.id))(bZ))(b1))(b3)),bd.update((b6=new F({$:0,$0:"",$1:bZ,$2:b1,$3:b3}),(bf.Utterances().unshift(b6),bY))));}function bV(bW,bX){var bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,cl,cm,cn,co;function ck(cp){bf.Utterances().unshift(cp);return cl;}bf.set_CUI(_2.New(bf.CUI().Voice,bf.CUI().Mic,bW,bf.CUI().Avatar,bf.CUI().Caption,bf.CUI().AudioHandlers,bf.CUI().TypingDNA));if(bL.Equals(bf.CUI().Mic,null))bf.initMic(bU);if(bL.Equals(bf.CUI().Voice,null))bf.initSpeech();if(bf.ClientState().$===0)bf.set_ClientState(_0.ClientReady);cl=new _3({$:0,$0:bf.CUI(),$1:bf.Props(),$2:bf.Questions(),$3:bf.Output(),$4:bf.Utterances()});cm=I.Blank(bX);if(cm!=null&&cm.$==1)return bf["say'"]("Tell me what you want me to do or ask me a question.");else{cn=I.Debug(bX);if(cn!=null&&cn.$==1){bf.debug((function(cp){return function(cq){return cp("Utterances: "+bu.prettyPrint(cq));};}(a.id))(bf.Utterances()));bf.debug((function(cp){return function(cq){return cp("Questions: "+bu.prettyPrint(cq));};}(a.id))(bf.Questions()));bY=bf.Props().GetEnumerator$1();try{while(bY.MoveNext()){co=bY.Current();bf.debug((((bn.Curried3(function(cp,cq,cr){return cp(bu.toSafe(cq)+": "+bu.prettyPrint(cr));}))(a.id))(co.K))(co.V));}return;}finally{bY.Dispose();}}else{bZ=I.DebugEntities(bX);return bZ!=null&&bZ.$==1?(b0=bZ.$0,bf.CUI().Wait((b1=null,bB.Delay(function(){return bB.Bind((new bN.New()).Async("SMApp.Web:SMApp.Web.Server.getEntities:-1323084710",[b0]),function(cp){var cq;return cp.$==1?(bf.debug(cp.$0),bB.Zero()):(cq=cp.$0,bB.Combine(bB.For(cq,function(cr){bf.debug((function(cs){return function(ct){return cs(bh.p$7(ct));};}(a.id))(cr));return bB.Zero();}),bB.Delay(function(){bf.echo("Entities:");return bB.For(cq,function(cr){bf.echo((function(cs){return function(ct){return cs("<span style='color:white;background-color:#7B68EE'>"+bh.p$7(ct)+"</span>");};}(a.id))(cr));return bB.Zero();});})));});})))):(b2=I.DebugLemmas(bX),b2!=null&&b2.$==1?(b3=b2.$0,bf.CUI().Wait((b4=null,bB.Delay(function(){return bB.Bind((new bN.New()).Async("SMApp.Web:SMApp.Web.Server.getMainLemmas:1300674204",[b3]),function(cp){var cq;return cp.$==1?(bf.debug(cp.$0),bB.Zero()):(cq=cp.$0,bB.Combine(bB.For(cq,function(cr){bf.debug((function(cs){return function(ct){return cs(bh.p$8(ct));};}(a.id))(cr));return bB.Zero();}),bB.Delay(function(){bf.echo("Lemmas:");return bB.For(cq,function(cr){bf.echo((function(cs){return function(ct){return cs("<span style='color:white;background-color:#FFC0CB'>"+bh.p$8(ct)+"</span>");};}(a.id))(cr));return bB.Zero();});})));});})))):(b5=I.DebugTriples(bX),b5!=null&&b5.$==1?(b6=b5.$0,bf.CUI().Wait((b7=null,bB.Delay(function(){return bB.Bind((new bN.New()).Async("SMApp.Web:SMApp.Web.Server.getTriples:-550747157",[b6]),function(cp){var cq;return cp.$==1?(bf.debug(cp.$0),bB.Zero()):(cq=cp.$0,bB.Combine(bB.For(cq,function(cr){return bB.For(cr,function(cs){bf.debug((function(ct){return function(cu){return ct(bh.p$9(cu));};}(a.id))(cs));return bB.Zero();});}),bB.Delay(function(){bf.echo("Triples:");return bB.For(cq,function(cr){bf.echo((function(cs){return function(ct){return cs("<span style='color:white;background-color:#00FA9A'>"+bu.printList(function(cu){return bh.p$9(cu);},ct)+"</span>");};}(a.id))(cr));return bB.Zero();});})));});})))):(b8=I.DebugEmotionalTraits(bX),b8!=null&&b8.$==1?(b9=b8.$0,bf.CUI().Wait((b_=null,bB.Delay(function(){return bB.Bind((new bN.New()).Async("SMApp.Web:SMApp.Web.Server.getEmotionalTraits:758374353",[b9]),function(cp){var cq;return cp.$==1?(bf.debug(cp.$0),bB.Zero()):(cq=cp.$0,bB.Combine(bB.For(cq,function(cr){bf.debug((function(cs){return function(ct){return cs(bh.p$17(ct));};}(a.id))(cr));return bB.Zero();}),bB.Delay(function(){bf.echo("Emotional Traits:");return bB.For(cq,function(cr){bf.echo((function(cs){return function(ct){return cs("<span style='color:white;background-color:#FF4500'>"+bh.p$17(ct)+"</span>");};}(a.id))(cr));return bB.Zero();});})));});})))):(b$=I.Voices(bX),b$!=null&&b$.$==1?(ca=d.toArray(d.speechSynthesis().getVoices()),bf["say'"]((function(cp){return function(cq){return cp("There are currently "+a.String(cq)+" voices installed on this computer or device.");};}(a.id))(bk.length(ca))),bk.iteri(function(cp,cq){return bf["say'"](((((bn.Curried(function(cr,cs,ct,cu){return cr("Voice "+a.String(cs)+". Name: "+bu.toSafe(ct)+", Local: "+bu.prettyPrint(cu)+".");},4))(a.id))(cp))(cq.name))(cq.localService));},ca)):bf.ClientState().$==1?(cc=I.QuickHello(bX),(cc!=null&&cc.$==1?(cb=cc.$0,true):(cd=I.QuickHelp(bX),cd!=null&&cd.$==1?(cb=cd.$0,true):(ce=I.QuickYes(bX),ce!=null&&ce.$==1?(cb=ce.$0,true):(cf=I.QuickNo(bX),cf!=null&&cf.$==1?(cb=cf.$0,true):(cg=I.QuickNumber(bX),cg!=null&&cg.$==1&&(cb=cg.$0,true))))))?(bf.debug((function(cp){return function(cq){return cp("Quick Text: "+bh.p$18(cq)+".");};}(a.id))(cb)),bd.update(ck(cb)),bf.set_ClientState(_0.ClientReady)):(ch=I.JournalEntry(bX),ch!=null&&ch.$==1?(ci=ch.$0,bf.debug((function(cp){return function(cq){return cp("Journal entry: "+bh.p$18(cq)+".");};}(a.id))(ci)),bd.update(ck(ci)),bf.set_ClientState(_0.ClientReady)):bf.CUI().Wait((cj=null,bB.Delay(function(){bf.set_ClientState(_0.ClientUnderstand);I.getUtterance(bX,function(cp){var cq,cr;cq=I.HasUtterance(cp);cq!=null&&cq.$==1?(cr=cq.$0,bf.debug(((((bn.Curried(function(cs,ct,cu,cv){return cs("Text: Intent: "+bh.p(ct)+", Traits: "+bh.p$3(cu)+", Entities: "+bh.p$5(cv)+".");},4))(a.id))(cr.get_Intent()))(cr.get_Traits()))(cr.get_Entities())),bd.update(ck(cr))):(bf.debug("Text: Did not receive a meaning from the server."),bf["say'"]("Sorry I did not understand what you said."));});bf.set_ClientState(_0.ClientReady);return bB.Zero();}))))):bf.ClientState().$==0?d.error("Client is not initialized."):bf["say'"]("I'm still trying to understand what you said before.")))));}}}bg.CUI=_2.New(null,null,null,(bK.applicationId="4277115329081938617",bR=new a.SDKConnection(),bS=new a.WebAvatar(),bS.version=8.5,bS.connection=bR,bS.avatar="20926186",bS.voice="cmu-slt",bS.voiceMod="default",bS.width=175,bS.createBox(),bS.addMessage(""),bS.processMessages(0),bS),false,new bQ.New$5(),new a.TypingDNA());bg.MicState=Z.MicNotInitialized;bg.ClientState=_0.ClientNotInitialzed;bg.Props=new bQ.New$5();bg.Output=[];bg.Questions=[];bg.Utterances=[];bg.synth=a.speechSynthesis;bg.Main=new _1({$:0,$0:function(bW){return bU(bW[0],bW[1]);},$1:[function(bW){return function(bX){return bV(bW,bX);};},(bT={},bT.name="Main",bT.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bT.prompt=">",bT)]});};bh.p$19=function(bR){return bR==null?"null":"Some "+bh.p$16(bR.$0);};bh.p$20=function(bR){return bR.$==3?"ConceptCompletion":bR.$==2?"Disjunctive":bR.$==1?"Verification":"UserAuthentication "+bu.prettyPrint(bR.$0);};bi.p=function(bR){return"{"+("text = "+bu.prettyPrint(bR.text))+"; "+("intents = "+bu.printArray(function(bS){return bi.p$1(bS);},bR.intents))+"; "+("entities = "+bu.prettyPrint(bR.entities))+"; "+("traits = "+bu.prettyPrint(bR.traits))+"}";};bi.p$1=function(bR){return"{"+("id = "+bu.prettyPrint(bR.id))+"; "+("name = "+bu.prettyPrint(bR.name))+"; "+("confidence = "+bu.prettyPrint(bR.confidence))+"}";};bh.p$21=function(bR){return"Question ("+bu.prettyPrint(bR.$0)+", "+bu.prettyPrint(bR.$1)+", "+bh.p$20(bR.$2)+", "+bh.p$22(bR.$3)+", "+"<fun>"+")";};bh.p$22=function(bR){return bR==null?"null":"Some "+bu.printArray(bu.prettyPrint,bR.$0);};bh.p$2=function(bR){return bR==null?"null":"Some "+bu.prettyPrint(bR.$0);};bh.p$1=function(bR){return"Intent ("+bu.prettyPrint(bR.$0)+", "+bh.p$2(bR.$1)+")";};bh.p=function(bR){return bR==null?"null":"Some "+bh.p$1(bR.$0);};bh.p$4=function(bR){return"Trait ("+bu.prettyPrint(bR.$0)+", "+bu.prettyPrint(bR.$1)+", "+bh.p$2(bR.$2)+")";};bh.p$3=function(bR){return bR==null?"null":"Some "+bu.printList(function(bS){return bh.p$4(bS);},bR.$0);};bh.p$6=function(bR){return"Entity ("+bu.prettyPrint(bR.$0)+", "+bu.prettyPrint(bR.$1)+", "+bu.prettyPrint(bR.$2)+", "+bh.p$2(bR.$3)+")";};bh.p$5=function(bR){return bR==null?"null":"Some "+bu.printList(function(bS){return bh.p$6(bS);},bR.$0);};bh.p$7=function(bR){return"ExpertAIEntity ("+bu.prettyPrint(bR.$0)+", "+bu.prettyPrint(bR.$1)+", "+bu.printList(function(bS){return"("+bu.prettyPrint(bS[0])+", "+bu.prettyPrint(bS[1])+")";},bR.$2)+", "+bu.prettyPrint(bR.$3)+")";};bh.p$8=function(bR){return"ExpertAILemma ("+bu.prettyPrint(bR.$0)+", "+bu.prettyPrint(bR.$1)+", "+bu.printList(function(bS){return"("+bu.prettyPrint(bS[0])+", "+bu.prettyPrint(bS[1])+")";},bR.$2)+")";};bh.p$12=function(bR){return"Relation ("+bu.prettyPrint(bR.$0)+", "+bu.prettyPrint(bR.$1)+", "+bu.prettyPrint(bR.$2)+")";};bh.p$11=function(bR){return bR.$==1?"Relation "+bh.p$12(bR.$0):"Subject "+bu.prettyPrint(bR.$0);};bh.p$13=function(bR){return"Verb "+bu.prettyPrint(bR.$0);};bh.p$10=function(bR){return"Relation ("+bh.p$11(bR.$0)+", "+bu.prettyPrint(bR.$1)+", "+bh.p$13(bR.$2)+")";};bh.p$16=function(bR){return bR.$==1?"Relation "+bh.p$12(bR.$0):"Object "+bu.prettyPrint(bR.$0);};bh.p$15=function(bR){return"Relation ("+bh.p$13(bR.$0)+", "+bu.prettyPrint(bR.$1)+", "+bh.p$16(bR.$2)+")";};bh.p$14=function(bR){return bR==null?"null":"Some "+bh.p$15(bR.$0);};bh.p$9=function(bR){return"Triple ("+bh.p$10(bR.$0)+", "+bh.p$14(bR.$1)+")";};bh.p$17=function(bR){return"EmotionalTrait ("+bu.prettyPrint(bR.$0)+", "+bu.printList(bu.prettyPrint,bR.$1)+", "+bu.prettyPrint(bR.$2)+")";};bh.p$18=function(bR){return"Utterance ("+bu.prettyPrint(bR.$0)+", "+bh.p(bR.$1)+", "+bh.p$3(bR.$2)+", "+bh.p$5(bR.$3)+")";};}());
