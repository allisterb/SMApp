(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.User=c.User||{};e=c.Meaning=c.Meaning||{};f=c.Intent=c.Intent||{};g=c.Entity=c.Entity||{};h=c.Interpreter=c.Interpreter||{};i=c.Resource=c.Resource||{};j=c.NLU=c.NLU||{};k=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};l=c.CUI=c.CUI||{};m=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};n=c.ClientExtensions=c.ClientExtensions||{};o=c.Client=c.Client||{};p=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};q=a.IntelliFactory;r=q&&q.Runtime;s=a.WebSharper;t=s&&s.List;u=s&&s.Seq;v=s&&s.Random;w=s&&s.Arrays;x=a.jQuery;y=a.console;z=s&&s.UI;A=z&&z.Doc;B=s&&s.Utils;C=s&&s.Concurrency;D=s&&s.Remoting;E=D&&D.AjaxRemotingProvider;d.New=function(F){return{UserName:F};};e=c.Meaning=r.Class({get_TopIntent:function(){return t.head(t.sortBy(function(F){return F.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,e);f=c.Intent=r.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,f);g=c.Entity=r.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,g);h=c.Interpreter=r.Class({get_Options:function(){return(this.get_Unwrap())[1];},get_Func:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0[0],this.$0[1]];}},null,h);i.New=function(F,G,H){return{Name:F,Description:G,Url:H};};j.HelloUser=function(F){var G,H;return(H=j.Hello(F),H!=null&&H.$==1&&(H.$0.$==1&&(H.$0.$1.$==0&&(H.$0.$0.get_Role()==="contact"&&(G=H.$0.$0,true)))))?{$:1,$0:G}:null;};j.Hello=function(F){var G,H;return F!=null&&F.$==1&&(H=j.Intent("Hello",F.$0),H!=null&&H.$==1&&(G=H.$0,true))?{$:1,$0:G}:null;};j.QuickHelp=function(F){return F==="help"?{$:0,$0:null}:F==="voices"?{$:1,$0:null}:F==="debug on"?{$:2,$0:null}:F==="debug off"?{$:3,$0:null}:F==="voice 1"?{$:4,$0:null}:F==="voice 2"?{$:5,$0:null}:{$:6,$0:null};};j.Intent=function(F,G){return G.get_TopIntent().get_Name()===F&&G.get_TopIntent().get_Confidence()>j.intentConfidenceThreshold()?{$:1,$0:t.filter(function(H){return H.get_Confidence()>j.entityConfidenceThreshold();},G.get_Entities())}:null;};j.entityConfidenceThreshold=function(){k.$cctor();return k.entityConfidenceThreshold;};j.set_entityConfidenceThreshold=function(F){k.$cctor();k.entityConfidenceThreshold=F;};j.intentConfidenceThreshold=function(){k.$cctor();return k.intentConfidenceThreshold;};j.set_intentConfidenceThreshold=function(F){k.$cctor();k.intentConfidenceThreshold=F;};k.$cctor=function(){k.$cctor=a.ignore;k.intentConfidenceThreshold=0.85;k.entityConfidenceThreshold=0.85;};l.helloUserPhrases=function(){m.$cctor();return m.helloUserPhrases;};l.helloPhrases=function(){m.$cctor();return m.helloPhrases;};l.getRandomPhrase=function(F){return u.nth(l.rng().Next(0,F.get_Length()),F);};l.rng=function(){m.$cctor();return m.rng;};m.$cctor=function(){m.$cctor=a.ignore;m.rng=new v.New();m.helloPhrases=t.ofArray(["Welcome!","Welcome to Selma","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello how can I help?"]);m.helloUserPhrases=t.ofArray(["Hi $user, welcome back.","Welcome $user, nice to see you again..","Hello $user","Good to see you $user."]);};n.toArray=function(F){return w.map(a.id,x.makeArray(F));};n.info=function(F){y.info(F);};n.error=function(F){x.error(F);};n["Terminal.Push"]=function(F,G){var H,I;H=G.get_Func();I=G.get_Options();F.push(r.CreateFuncWithThis(H),I);};n["Terminal.Echo'"]=function(F,G){F.disable();F.echo(G);F.enable();};o.Term=function(){var F,G;F=r.ThisFunc(function(H,I){return((o.Main().get_Func())(H))(I);});G=o.Main().get_Options();a.$("#main").terminal(F,G);o.context().unshift({$:0,$0:o.Main()});return A.get_Empty();};o.Main=function(){p.$cctor();return p.Main;};o.stopSpeaking=function(){p.$cctor();return p.stopSpeaking;};o.sayRandom=function(F){o.say(l.getRandomPhrase(F));};o.sayVoices=function(){var F,G,H,I;F=n.toArray(a.speechSynthesis.getVoices());o.say((function(J){return function(K){return J("There are currently "+a.String(K)+" voices installed on this computer or device.");};}(a.id))(w.length(F)));for(G=0,H=w.length(F)-1;G<=H;G++){I=w.get(F,G);o.say(((((r.Curried(function(J,K,L,M){return J("Voice "+a.String(K)+": Name: "+B.toSafe(L)+" Local: "+B.prettyPrint(M)+".");},4))(a.id))(G))(I.name))(I.localService));}};o.say=function(F){var G;C.Start((G=null,C.Delay(function(){var H;H=new a.SpeechSynthesisUtterance(F);H.voice=o["currentVoice'"]();a.speechSynthesis.speak(H);return C.Zero();})),null);};o.initSpeech=function(){var F,G,H,I,J,K;I=n.toArray(a.speechSynthesis.getVoices());for(J=0,K=w.length(I)-1;J<=K;J++)(function(){var L,M,N;L=w.get(I,J);return o.currentVoice()===""&&(L.name.indexOf("Microsoft Zira")!=-1||L.name.indexOf("English Female")!=-1)?(o.set_currentVoice(L.name),o.set_currentVoiceURI(L.voiceURI),o["set_currentVoice'"](L),n.info((function(O){return function(P){return O("Using voice "+B.toSafe(P)+".");};}(a.id))(o.currentVoice())),M=new a.SpeechSynthesisUtterance((function(O){return function(P){return O("Using voice "+B.toSafe(P)+".");};}(a.id))(o.currentVoice())),M.voice=L,C.Start((N=null,C.Delay(function(){a.speechSynthesis.speak(M);return C.Zero();})),null)):null;}());o.currentVoice()===""&&w.length(I)>0?(F=w.get(I,0),o.set_currentVoice(F.name),o.set_currentVoiceURI(F.voiceURI),G=new a.SpeechSynthesisUtterance(function(L){return L("Using the default speech synthesis voice.");}(a.id)),C.Start((H=null,C.Delay(function(){a.speechSynthesis.speak(G);return C.Zero();})),null)):o.currentVoice()===""?n.error("No speech synthesis voice is available. In order to use Selma you must install a speech synthesis voice on this device or computer."):void 0;};o.context=function(){p.$cctor();return p.context;};o.transcribe=function(){p.$cctor();return p.transcribe;};o.set_transcribe=function(F){p.$cctor();p.transcribe=F;};o.debugMode=function(){p.$cctor();return p.debugMode;};o.set_debugMode=function(F){p.$cctor();p.debugMode=F;};o["currentVoice'"]=function(){p.$cctor();return p["currentVoice'"];};o["set_currentVoice'"]=function(F){p.$cctor();p["currentVoice'"]=F;};o.currentVoiceURI=function(){p.$cctor();return p.currentVoiceURI;};o.set_currentVoiceURI=function(F){p.$cctor();p.currentVoiceURI=F;};o.currentVoice=function(){p.$cctor();return p.currentVoice;};o.set_currentVoice=function(F){p.$cctor();p.currentVoice=F;};p.$cctor=function(){var F;p.$cctor=a.ignore;function G(H,I){var J,K;o.currentVoice()===""?o.initSpeech():void 0;J=j.QuickHelp(I);return J.$==1?o.sayVoices():J.$==2?(o.set_debugMode(true),o.say(function(L){return L("Debug mode is now on.");}(a.id))):J.$==3?(o.set_debugMode(false),o.say(function(L){return L("Debug mode is now off.");}(a.id))):J.$==4?o.say("Quick voice 1"):J.$==5?o.say("Quick voice 2"):J.$==6?(H.disable(),C.Start((K=null,C.Delay(function(){return C.Combine(C.Bind((new E.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:-270733379",[I]),function(L){var M,N;M=j.HelloUser(L);return M!=null&&M.$==1?(H.echo((function(O){return function(P){return O("This is the hello intent. The user name is "+B.toSafe(P)+".");};}(a.id))(M.$0.get_Value())),C.Zero()):(N=j.Hello(L),N!=null&&N.$==1)?(o.sayRandom(l.helloPhrases()),C.Zero()):(H.echo("This is the whatever intent"),C.Zero());}),C.Delay(function(){H.enable();return C.Zero();}));})),null)):o.say("This is the quick help command");}p.currentVoice="";p.currentVoiceURI="";p["currentVoice'"]=null;p.debugMode=false;p.transcribe=false;p.context=[];p.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;p.Main=new h({$:0,$0:[function(H){return function(I){return G(H,I);};},(F={},F.name="Main",F.greetings="Welcome to Selma. Type hello to begin or help for more assistance.",F.prompt=">",F)]});};}());
