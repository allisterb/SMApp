(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.User=c.User||{};e=c.Meaning=c.Meaning||{};f=c.Intent=c.Intent||{};g=c.Entity=c.Entity||{};h=c.Resource=c.Resource||{};i=c.NLU=c.NLU||{};j=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};k=c.ClientExtensions=c.ClientExtensions||{};l=c.Client=c.Client||{};m=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};n=a.IntelliFactory;o=n&&n.Runtime;p=a.WebSharper;q=p&&p.List;r=p&&p.UI;s=r&&r.Doc;t=p&&p.Utils;u=p&&p.Concurrency;v=p&&p.Remoting;w=v&&v.AjaxRemotingProvider;d.New=function(x){return{UserName:x};};e=c.Meaning=o.Class({get_TopIntent:function(){return q.head(q.sortBy(function(x){return x.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,e);f=c.Intent=o.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,f);g=c.Entity=o.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,g);h.New=function(x,y,z){return{Name:x,Description:y,Url:z};};i.HelloUser=function(x){var y,z;return(z=i.Hello(x),z!=null&&z.$==1&&(z.$0.$==1&&(z.$0.$1.$==0&&(z.$0.$0.get_Role()==="contact"&&(y=z.$0.$0,true)))))?{$:1,$0:y}:null;};i.Hello=function(x){var y,z;return x!=null&&x.$==1&&(z=i.Intent("Hello",x.$0),z!=null&&z.$==1&&(y=z.$0,true))?{$:1,$0:y}:null;};i.Help=function(x){return x==="help"?{$:0,$0:null}:x==="debug on"?{$:1,$0:null}:x==="debug off"?{$:2,$0:null}:{$:3,$0:null};};i.Intent=function(x,y){return y.get_TopIntent().get_Name()===x&&y.get_TopIntent().get_Confidence()>i.intentConfidenceThreshold()?{$:1,$0:q.filter(function(z){return z.get_Confidence()>i.entityConfidenceThreshold();},y.get_Entities())}:null;};i.entityConfidenceThreshold=function(){j.$cctor();return j.entityConfidenceThreshold;};i.set_entityConfidenceThreshold=function(x){j.$cctor();j.entityConfidenceThreshold=x;};i.intentConfidenceThreshold=function(){j.$cctor();return j.intentConfidenceThreshold;};i.set_intentConfidenceThreshold=function(x){j.$cctor();j.intentConfidenceThreshold=x;};j.$cctor=function(){j.$cctor=a.ignore;j.intentConfidenceThreshold=0.8;j.entityConfidenceThreshold=0.8;};k["Terminal.Red"]=function(x,y){x.echo("red");};l.Term=function(){var x,y;x=o.ThisFunc(function(){return null;});y=l.baseOpt();a.$("#main").terminal(x,y);return s.get_Empty();};l.baseOpt=function(){m.$cctor();return m.baseOpt;};l.Main=function(x,y){var z,A;z=i.Help(y);z.$==1?(l.set_debugMode(true),x.echo((function(B){return function(C){return B("Debug mode is now "+t.prettyPrint(C)+".");};}(a.id))(l.debugMode()))):z.$==2?(l.set_debugMode(false),x.echo((function(B){return function(C){return B("Debug mode is now "+t.prettyPrint(C)+".");};}(a.id))(l.debugMode()))):z.$==3?(x.disable(),u.Start((A=null,u.Delay(function(){return u.Combine(u.Bind((new w.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:14825134",[y]),function(B){var C,D;C=i.HelloUser(B);return C!=null&&C.$==1?(x.echo((function(E){return function(F){return E("This is the hello intent. The user name is "+t.toSafe(F)+".");};}(a.id))(C.$0.get_Value())),u.Zero()):(D=i.Hello(B),D!=null&&D.$==1)?(x.echo("This is the hello intent but I don't know who the user is."),u.Zero()):(x.echo("This is the whatever intent"),u.Zero());}),u.Delay(function(){x.enable();return u.Zero();}));})),null)):k["Terminal.Red"](x,"This is the help commnd");};l.debugMode=function(){m.$cctor();return m.debugMode;};l.set_debugMode=function(x){m.$cctor();m.debugMode=x;};m.$cctor=function(){var x;m.$cctor=a.ignore;m.debugMode=false;m.baseOpt=(x={},x.name="_",x.greetings="Welcome to Selma",x.onInit=function(y){var z;return y.push(function(A){return l.Main(this,A);},(z={},z.name="Main",z.prompt=">",z));},x);};}());
