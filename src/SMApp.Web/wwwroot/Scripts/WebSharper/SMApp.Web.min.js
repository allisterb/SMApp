(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V;a=self;b=a.SMApp=a.SMApp||{};c=b.Bootstrap=b.Bootstrap||{};d=c.Controls=c.Controls||{};e=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};f=b.Web=b.Web||{};g=f.NLU=f.NLU||{};h=g.Intent=g.Intent||{};i=g.Trait=g.Trait||{};j=g.Voice=g.Voice||{};k=j["Entity'"]=j["Entity'"]||{};l=g.Text=g.Text||{};m=l.Meaning=l.Meaning||{};n=l.Intent=l.Intent||{};o=l.Entity=l.Entity||{};p=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};q=f.CUIModule=f.CUIModule||{};r=q.User=q.User||{};s=q.Interpreter=q.Interpreter||{};t=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};u=f.ClientExtensions=f.ClientExtensions||{};v=f._Html=f._Html||{};w=f.htmModule=f.htmModule||{};x=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};y=f.Main=f.Main||{};z=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};A=f.Client=f.Client||{};B=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};C=a.WebSharper;D=C&&C.UI;E=D&&D.Doc;F=C&&C.List;G=D&&D.AttrModule;H=a.IntelliFactory;I=H&&H.Runtime;J=C&&C.Seq;K=C&&C.Random;L=C&&C.Arrays;M=a.jQuery;N=a.console;O=C&&C.Strings;P=C&&C.Utils;Q=C&&C.Concurrency;R=a.Wit;S=a.document;T=C&&C.Unchecked;U=C&&C.Remoting;V=U&&U.AjaxRemotingProvider;d.Radio=function(W,X,Y,Z,_0){return E.Element("div",new F.T({$:1,$0:(d.cls())("radio"),$1:X}),[E.Element("label",Z,[E.Radio(_0,true,Y),E.TextNode(W)])]);};d.Checkbox=function(W,X,Y,Z,_0){return E.Element("div",new F.T({$:1,$0:(d.cls())("checkbox"),$1:X}),[E.Element("label",Z,[E.CheckBox(_0,Y),E.TextNode(W)])]);};d.TextArea=function(W,X,Y,Z,_0){return E.Element("div",new F.T({$:1,$0:(d.cls())("form-group"),$1:X}),[E.Element("label",Z,[E.TextNode(W)]),E.InputArea(new F.T({$:1,$0:(d.cls())("form-control"),$1:_0}),Y)]);};d.InputPassword=function(W,X,Y,Z,_0){return E.Element("div",new F.T({$:1,$0:(d.cls())("form-group"),$1:X}),[E.Element("label",Z,[E.TextNode(W)]),E.PasswordBox(new F.T({$:1,$0:(d.cls())("form-control"),$1:_0}),Y)]);};d.Input=function(W,X,Y,Z,_0){return E.Element("div",new F.T({$:1,$0:(d.cls())("form-group"),$1:X}),[E.Element("label",Z,[E.TextNode(W)]),E.Input(new F.T({$:1,$0:(d.cls())("form-control"),$1:_0}),Y)]);};d.Container=function(W){return E.Element("div",[(d.cls())("container")],W);};d.Class=function(){e.$cctor();return e.Class;};d.cls=function(){e.$cctor();return e.cls;};e.$cctor=function(){e.$cctor=a.ignore;e.cls=G.Class;e.Class=G.Class;};h.Onboard={$:2};h.Help={$:1};h.Hello={$:0};i.Greetings={$:0};k.New=function(W,X,Y,Z,_0){return{body:W,end:X,start:Y,suggested:Z,value:_0};};j.Contact=function(W){return!(W.contact==null)?{$:1,$0:{$:0,$0:k.New(W.body,W.end,W.start,W.ff,W.value).value}}:null;};j.Greetings=function(W){return!(W.greetings==null)&&!(W.greetings.value==null)?{$:1,$0:i.Greetings}:null;};j.Hello=function(W){return typeof W=="string"&&W.toLowerCase()==="default_intent"?{$:1,$0:h.Hello}:null;};m=l.Meaning=I.Class({get_TopIntent:function(){return F.head(F.sortBy(function(W){return W.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,m);n=l.Intent=I.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,n);o=l.Entity=I.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,o);l.HelloUser=function(W){var X,Y;return(Y=l.Hello(W),Y!=null&&Y.$==1&&(Y.$0.$==1&&(Y.$0.$1.$==0&&(Y.$0.$0.get_Role()==="contact"&&(X=Y.$0.$0,true)))))?{$:1,$0:X}:null;};l.Hello=function(W){var X,Y;return W!=null&&W.$==1&&(Y=l.Intent$1("Hello",W.$0),Y!=null&&Y.$==1&&(X=Y.$0,true))?{$:1,$0:X}:null;};l.DebugOff=function(W){return W==="debug off"?{$:1,$0:null}:null;};l.DebugOn=function(W){return W==="debug on"?{$:1,$0:null}:null;};l.QuickHelp=function(W){var X;return W==="help"||(W==="help me"||(W==="what's this?"||W==="hugh"))?{$:1,$0:h.Help}:null;};l.QuickHello=function(W){var X;return W==="hello"||(W==="hey"||(W==="yo"||W==="hi"))?{$:1,$0:h.Hello}:null;};l.Intent$1=function(W,X){return X.get_TopIntent().get_Name()===W&&X.get_TopIntent().get_Confidence()>l.intentConfidenceThreshold()?{$:1,$0:F.filter(function(Y){return Y.get_Confidence()>l.entityConfidenceThreshold();},X.get_Entities())}:null;};l.entityConfidenceThreshold=function(){p.$cctor();return p.entityConfidenceThreshold;};l.set_entityConfidenceThreshold=function(W){p.$cctor();p.entityConfidenceThreshold=W;};l.intentConfidenceThreshold=function(){p.$cctor();return p.intentConfidenceThreshold;};l.set_intentConfidenceThreshold=function(W){p.$cctor();p.intentConfidenceThreshold=W;};p.$cctor=function(){p.$cctor=a.ignore;p.intentConfidenceThreshold=0.85;p.entityConfidenceThreshold=0.85;};r.New=function(W){return{UserName:W};};s=q.Interpreter=I.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,s);q.helloUserPhrases=function(){t.$cctor();return t.helloUserPhrases;};q.helloPhrases=function(){t.$cctor();return t.helloPhrases;};q.getRandomPhrase=function(W){return J.nth(q.rng().Next(0,W.get_Length()),W);};q.rng=function(){t.$cctor();return t.rng;};t.$cctor=function(){t.$cctor=a.ignore;t.rng=new K.New();t.helloPhrases=F.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);t.helloUserPhrases=F.ofArray(["Hi $user, welcome back.","Welcome $user, nice to see you again..","Hello $user","Good to see you $user."]);};u.toArray=function(W){return L.map(a.id,M.makeArray(W));};u.error=function(W){N.error(W);};u.info=function(W){N.info(W);};u.jserror=function(W){M.error(W);};u["Terminal.Push"]=function(W,X){var Y,Z;Y=X.get_Text();Z=X.get_Options();W.push(I.CreateFuncWithThis(Y),Z);};u["Terminal.EchoHtml'"]=function(W,X){W.disable();W.echo(X,u.rawOpt());W.enable();};u["Terminal.Echo'"]=function(W,X){W.disable();W.echo(X);W.enable();};u.rawOpt=function(){x.$cctor();return x.rawOpt;};v=f._Html=I.Class({toString:function(){return v.toString(this);}},null,v);v.toString=function(W){function X(Y){return function(Z){var _0,_1,_2,_3,_4,_5,_6;_1=O.replicate(Y," ");switch(Z.$==0?Z.$1.$==1?Z.$1.$0.$==2?Z.$1.$1.$==0?(_0=[Z.$1.$0.$0,Z.$0],1):(_0=[Z.$1,Z.$0],2):(_0=[Z.$1,Z.$0],2):(_0=[Z.$1,Z.$0],2):Z.$==2?(_0=Z.$0,3):(_0=[Z.$0,Z.$1],0)){case 0:return _0[0]+"=\""+_0[1]+"\"";case 1:_2=_0[1];return _1+"<"+_2+">"+_0[0]+"</"+_2+">\r\n";case 2:_3=_0[1];_4=F.partition(function(_7){return _7.$==1;},_0[0]);_5=_4[1];_6=_4[0];return _5.$==0?_1+"<"+_3+(_6.$===0?"":" "+O.concat(" ",F.ofSeq(J.delay(function(){return J.map(function(_7){return(X(0))(_7);},_6);}))))+"/>\r\n":_1+"<"+_3+(_6.$===0?"":" "+O.concat(" ",F.ofSeq(J.delay(function(){return J.map(function(_7){return(X(0))(_7);},_6);}))))+">\r\n"+O.concat("",F.ofSeq(J.delay(function(){return J.map(function(_7){return(X(Y+1))(_7);},_5);})))+_1+"</"+_3+">\r\n";case 3:return _1+_0+"\r\n";}};}return(X(0))(W);};w.alt=function(W){return new v({$:1,$0:"alt",$1:W});};w.src=function(W){return new v({$:1,$0:"src",$1:W});};w.cls=function(W){return new v({$:1,$0:"class",$1:W});};w.str=function(W){return v.toString(W);};w.op_PercentEquals=function(W,X){return new v({$:1,$0:W,$1:X});};w.op_Splice=function(W){var X;return F.ofArray([new v({$:2,$0:(X=W,a.String(X))})]);};w.strong=function(){x.$cctor();return x.strong;};w.h4=function(){x.$cctor();return x.h4;};w.h3=function(){x.$cctor();return x.h3;};w.h2=function(){x.$cctor();return x.h2;};w.h1=function(){x.$cctor();return x.h1;};w.li=function(){x.$cctor();return x.li;};w.ul=function(){x.$cctor();return x.ul;};w.th=function(){x.$cctor();return x.th;};w.td=function(){x.$cctor();return x.td;};w.tr=function(){x.$cctor();return x.tr;};w.a=function(){x.$cctor();return x.a;};w.p=function(){x.$cctor();return x.p;};w.area=function(){x.$cctor();return x.area;};w.map=function(){x.$cctor();return x.map;};w.img=function(){x.$cctor();return x.img;};w.tfoot=function(){x.$cctor();return x.tfoot;};w.tbody=function(){x.$cctor();return x.tbody;};w.thead=function(){x.$cctor();return x.thead;};w.table=function(){x.$cctor();return x.table;};w.span=function(){x.$cctor();return x.span;};w.section=function(){x.$cctor();return x.section;};w.br=function(){x.$cctor();return x.br;};w.div=function(){x.$cctor();return x.div;};w.body=function(){x.$cctor();return x.body;};w.style=function(){x.$cctor();return x.style;};w.title=function(){x.$cctor();return x.title;};w.head=function(){x.$cctor();return x.head;};w.html=function(){x.$cctor();return x.html;};w.elem=function(W,X){return new v({$:0,$0:W,$1:X});};x.$cctor=function(){var W;x.$cctor=a.ignore;x.rawOpt=(W={},W.raw=true,W);x.html=function(X){return w.elem("html",X);};x.head=function(X){return w.elem("head",X);};x.title=function(X){return w.elem("title",X);};x.style=function(X){return w.elem("style",X);};x.body=function(X){return w.elem("body",X);};x.div=function(X){return w.elem("div",X);};x.br=function(X){return w.elem("br",X);};x.section=function(X){return w.elem("section",X);};x.span=function(X){return w.elem("span",X);};x.table=function(X){return w.elem("table",X);};x.thead=function(X){return w.elem("thead",X);};x.tbody=function(X){return w.elem("tbody",X);};x.tfoot=function(X){return w.elem("tfoot",X);};x.img=function(X){return w.elem("img",X);};x.map=function(X){return w.elem("map",X);};x.area=function(X){return w.elem("area",X);};x.p=function(X){return w.elem("p",X);};x.a=function(X){return w.elem("a",X);};x.tr=function(X){return w.elem("tr",X);};x.td=function(X){return w.elem("td",X);};x.th=function(X){return w.elem("th",X);};x.ul=function(X){return w.elem("ul",X);};x.li=function(X){return w.elem("li",X);};x.h1=function(X){return w.elem("h1",X);};x.h2=function(X){return w.elem("h1",X);};x.h3=function(X){return w.elem("h1",X);};x.h4=function(X){return w.elem("h1",X);};x.strong=function(X){return w.elem("strong",X);};};y.updateCtx=function(W,X){y.set_context(F.append(y.context(),F.ofArray([{$:0,$0:X}])));};y.context=function(){z.$cctor();return z.context;};y.set_context=function(W){z.$cctor();z.context=W;};z.$cctor=function(){z.$cctor=a.ignore;z.context=F.T.Empty;};A.CUI=function(){var W,X;W=I.ThisFunc(function(Y,Z){return((A.Main().get_Text())(Y))(Z);});X=A.Main().get_Options();a.$("#main").terminal(W,X);return E.get_Empty();};A.Main=function(){B.$cctor();return B.Main;};A.container=function(){B.$cctor();return B.container;};A.wait=function(W){u["Terminal.Echo'"](A.currentTerm(),"please wait");A.currentTerm().disable();W();A.currentTerm().enable();};A.stopSpeaking=function(){B.$cctor();return B.stopSpeaking;};A.sayRandom=function(W){A.say(q.getRandomPhrase(W));};A.sayVoices=function(){var W,X;W=a.speechSynthesis.getVoices();!(W==null)?(X=u.toArray(W),A.say((function(Y){return function(Z){return Y("There are currently "+a.String(Z)+" voices installed on this computer or device.");};}(a.id))(L.length(X))),L.iteri(function(Y,Z){return A.say(((((I.Curried(function(_0,_1,_2,_3){return _0("Voice "+a.String(_1)+". Name: "+P.toSafe(_2)+", Local: "+P.prettyPrint(_3)+".");},4))(a.id))(Y))(Z.name))(Z.localService));},X)):void 0;};A.say=function(W){var X,Y,Z;if(X=A.currentVoice(),X!=null&&X.$==1){Y=A.currentVoice().$0;Q.Start((Z=null,Q.Delay(function(){var _0;_0=new a.SpeechSynthesisUtterance(W);_0.voice=Y;a.speechSynthesis.speak(_0);return Q.Zero();})),null);A.caption()?u["Terminal.Echo'"](A.currentTerm(),W):void 0;}else u["Terminal.Echo'"](A.currentTerm(),W);};A.initMic=function(W,X){var Y;A.set_currentMic({$:1,$0:new R.Microphone(S.getElementById("microphone"))});Y=A.currentMic().$0;Y.onconnecting=function(){A.set_currentMicState({$:1});return A.debugEcho("Mic connecting...");};Y.ondisconnected=function(){return A.debugEcho("Mic disconnected.");};Y.onaudiostart=function(){return A.debugEcho("Mic audio start...");};Y.onaudioend=function(){return A.debugEcho("Mic audio end.");};Y.onerror=function(Z){return A.debugEcho((function(_0){return function(_1){return _0("Mic error : "+P.toSafe(_1)+".");};}(a.id))(Z));};Y.onready=function(){return A.debugEcho("Mic ready.");};Y.onresult=function(Z,_0){return W(Y,[Z,_0]);};Y.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};A.initSpeech=function(){var W,X;W=a.speechSynthesis.getVoices();!(W==null)?(X=u.toArray(W),L.iter(function(Y){if(T.Equals(A.currentVoice(),null)&&(Y.name.indexOf("Microsoft Zira")!=-1||Y.name.toLowerCase().indexOf("female")!=-1)){A.set_currentVoice({$:1,$0:Y});u.info((function(Z){return function(_0){return Z("Using voice "+P.toSafe(_0)+".");};}(a.id))(A.currentVoice().$0.name));}},X),T.Equals(A.currentVoice(),null)&&L.length(X)>0?(A.set_currentVoice({$:1,$0:L.find(function(Y){return Y["default"];},X)}),u.info((function(Y){return function(Z){return Y("Using default voice "+P.toSafe(Z)+".");};}(a.id))(A.currentVoice().$0.name))):void 0):void 0;T.Equals(A.currentVoice(),null)?(u.error("No speech synthesis voice is available."),u["Terminal.Echo'"](A.currentTerm(),"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma.")):void 0;};A.debugEcho=function(W){if(A.debugMode())u["Terminal.EchoHtml'"](A.currentTerm(),W);};A.echo=function(){B.$cctor();return B.echo;};A.context=function(){B.$cctor();return B.context;};A.set_context=function(W){B.$cctor();B.context=W;};A.state=function(){return{Voice:A.currentVoice(),Mic:A.currentMic(),MicState:A.currentMicState(),Term:A.currentTerm(),Debug:A.debugMode(),Caption:A.caption()};};A.caption=function(){B.$cctor();return B.caption;};A.set_caption=function(W){B.$cctor();B.caption=W;};A.debugMode=function(){B.$cctor();return B.debugMode;};A.set_debugMode=function(W){B.$cctor();B.debugMode=W;};A.currentInterpreter=function(){B.$cctor();return B.currentInterpreter;};A.set_currentInterpreter=function(W){B.$cctor();B.currentInterpreter=W;};A.currentTerm=function(){B.$cctor();return B.currentTerm;};A.set_currentTerm=function(W){B.$cctor();B.currentTerm=W;};A.currentMicState=function(){B.$cctor();return B.currentMicState;};A.set_currentMicState=function(W){B.$cctor();B.currentMicState=W;};A.currentMic=function(){B.$cctor();return B.currentMic;};A.set_currentMic=function(W){B.$cctor();B.currentMic=W;};A.currentVoice=function(){B.$cctor();return B.currentVoice;};A.set_currentVoice=function(W){B.$cctor();B.currentVoice=W;};B.$cctor=function(){var W;B.$cctor=a.ignore;function X(Z,_0){var _1,_2;_1=_0[1];u.info(_0[0]);u.info(_1);_2=j.Greetings(_1);return _2!=null&&_2.$==1?u.info(_2.$0):u.error(_1);}function Y(Z,_0){var _1,_2,_3,_4,_5,_6;A.set_currentTerm(Z);T.Equals(A.currentVoice(),null)?A.initSpeech():void 0;T.Equals(A.currentMic(),null)?A.initMic(X,Z):void 0;return(_1=l.DebugOn(_0),_1!=null&&_1.$==1)?(A.set_debugMode(true),A.say("Debug mode is now on.")):(_2=l.DebugOff(_0),_2!=null&&_2.$==1)?(A.set_debugMode(false),A.say("Debug mode is now off.")):(_4=l.QuickHello(_0),_4!=null&&_4.$==1?(_3=_4.$0,true):(_5=l.QuickHelp(_0),_5!=null&&_5.$==1&&(_3=_5.$0,true)))?(y.updateCtx(A.state(),{$:0,$0:_3,$1:null,$2:null}),A.sayRandom(q.helloPhrases())):(u["Terminal.Echo'"](A.currentTerm(),"please wait"),Q.Start((_6=null,Q.Delay(function(){return Q.Bind((new V.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:-1757206500",[_0]),function(_7){var _8;_8=l.HelloUser(_7);return _8!=null&&_8.$==1?(A.say((function(_9){return function(_){return _9("This is the hello intent. The user name is "+P.toSafe(_)+".");};}(a.id))(_8.$0.get_Value())),Q.Zero()):(u["Terminal.Echo'"](Z,"This is the whatever intent"),Q.Zero());});})),null));}B.currentVoice=null;B.currentMic=null;B.currentMicState={$:0};B.currentTerm=null;B.currentInterpreter=null;B.debugMode=false;B.caption=false;B.context=F.T.Empty;B.echo=function(Z){u["Terminal.EchoHtml'"](A.currentTerm(),Z);};B.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;B.container=d.Container;B.Main=new s({$:0,$0:function(Z){return function(_0){return X(Z,_0);};},$1:[function(Z){return function(_0){return Y(Z,_0);};},(W={},W.name="Main",W.greetings="Welcome to Selma. Type hello to begin or help for more assistance.",W.prompt=">",W)]});};}());
