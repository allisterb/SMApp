(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=b.Bootstrap=b.Bootstrap||{};i=h.Controls=h.Controls||{};j=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};k=c.NLU=c.NLU||{};l=k.Intent=k.Intent||{};m=k.Trait=k.Trait||{};n=k.Entity=k.Entity||{};o=k.Meaning=k.Meaning||{};p=k.Question=k.Question||{};q=k.Voice=k.Voice||{};r=q["Entity'"]=q["Entity'"]||{};s=k.Text=k.Text||{};t=s["Meaning'"]=s["Meaning'"]||{};u=s["Intent'"]=s["Intent'"]||{};v=s["Entity'"]=s["Entity'"]||{};w=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};x=c.CUI=c.CUI||{};y=x.User=x.User||{};z=x.Interpreter=x.Interpreter||{};A=x.CUI=x.CUI||{};B=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};C=c.Main=c.Main||{};D=c.Client=c.Client||{};E=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};F=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};G=a.WebSharper;H=G&&G.Strings;I=G&&G.Arrays;J=a.jQuery;K=G&&G.Utils;L=a.console;M=a.IntelliFactory;N=M&&M.Runtime;O=G&&G.List;P=G&&G.Seq;Q=G&&G.UI;R=Q&&Q.Doc;S=Q&&Q.AttrModule;T=G&&G.Concurrency;U=G&&G.Random;V=G&&G.Unchecked;W=G&&G.Remoting;X=W&&W.AjaxRemotingProvider;Y=a.Wit;Z=a.document;_0=G&&G.Collections;_1=_0&&_0.Dictionary;d.replace_tok=function(_2,_3,_4){return H.Replace(_4,_2,_3);};d.toLower=function(_2){return _2.toLowerCase();};d.toArray=function(_2){return I.map(a.id,J.makeArray(_2));};d.debug=function(_2){var _3;d.info((function(_4){return function(_5){return _4("DEBUG: "+K.toSafe(_5));};}(a.id))((_3=_2,a.String(_3))));};d.error=function(_2){L.error(_2);};d.info=function(_2){L.info(_2);};d.jserror=function(_2){J.error(_2);};d["Terminal.EchoHtml'"]=function(_2,_3){_2.disable();_2.echo(_3,d.rawOpt());_2.enable();};d["Terminal.Echo'"]=function(_2,_3){_2.disable();_2.echo(_3);_2.enable();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=N.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(_2){function _3(_4){return function(_5){var _6,_7,_8,_9,_,$,ba;_7=H.replicate(_4," ");switch(_5.$==0?_5.$1.$==1?_5.$1.$0.$==2?_5.$1.$1.$==0?(_6=[_5.$1.$0.$0,_5.$0],1):(_6=[_5.$1,_5.$0],2):(_6=[_5.$1,_5.$0],2):(_6=[_5.$1,_5.$0],2):_5.$==2?(_6=_5.$0,3):(_6=[_5.$0,_5.$1],0)){case 0:return _6[0]+"=\""+_6[1]+"\"";case 1:_8=_6[1];return _7+"<"+_8+">"+_6[0]+"</"+_8+">\r\n";case 2:_9=_6[1];_=O.partition(function(bb){return bb.$==1;},_6[0]);$=_[1];ba=_[0];return $.$==0?_7+"<"+_9+(ba.$===0?"":" "+H.concat(" ",O.ofSeq(P.delay(function(){return P.map(function(bb){return(_3(0))(bb);},ba);}))))+"/>\r\n":_7+"<"+_9+(ba.$===0?"":" "+H.concat(" ",O.ofSeq(P.delay(function(){return P.map(function(bb){return(_3(0))(bb);},ba);}))))+">\r\n"+H.concat("",O.ofSeq(P.delay(function(){return P.map(function(bb){return(_3(_4+1))(bb);},$);})))+_7+"</"+_9+">\r\n";case 3:return _7+_6+"\r\n";}};}return(_3(0))(_2);};f.alt=function(_2){return new e({$:1,$0:"alt",$1:_2});};f.src=function(_2){return new e({$:1,$0:"src",$1:_2});};f.cls=function(_2){return new e({$:1,$0:"class",$1:_2});};f.str=function(_2){return e.toString(_2);};f.op_PercentEquals=function(_2,_3){return new e({$:1,$0:_2,$1:_3});};f.op_Splice=function(_2){var _3;return O.ofArray([new e({$:2,$0:(_3=_2,a.String(_3))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(_2,_3){return new e({$:0,$0:_2,$1:_3});};g.$cctor=function(){var _2;g.$cctor=a.ignore;g.rawOpt=(_2={},_2.raw=true,_2);g.html=function(_3){return f.elem("html",_3);};g.head=function(_3){return f.elem("head",_3);};g.title=function(_3){return f.elem("title",_3);};g.style=function(_3){return f.elem("style",_3);};g.body=function(_3){return f.elem("body",_3);};g.div=function(_3){return f.elem("div",_3);};g.br=function(_3){return f.elem("br",_3);};g.section=function(_3){return f.elem("section",_3);};g.span=function(_3){return f.elem("span",_3);};g.table=function(_3){return f.elem("table",_3);};g.thead=function(_3){return f.elem("thead",_3);};g.tbody=function(_3){return f.elem("tbody",_3);};g.tfoot=function(_3){return f.elem("tfoot",_3);};g.img=function(_3){return f.elem("img",_3);};g.map=function(_3){return f.elem("map",_3);};g.area=function(_3){return f.elem("area",_3);};g.p=function(_3){return f.elem("p",_3);};g.a=function(_3){return f.elem("a",_3);};g.tr=function(_3){return f.elem("tr",_3);};g.td=function(_3){return f.elem("td",_3);};g.th=function(_3){return f.elem("th",_3);};g.ul=function(_3){return f.elem("ul",_3);};g.li=function(_3){return f.elem("li",_3);};g.h1=function(_3){return f.elem("h1",_3);};g.h2=function(_3){return f.elem("h1",_3);};g.h3=function(_3){return f.elem("h1",_3);};g.h4=function(_3){return f.elem("h1",_3);};g.strong=function(_3){return f.elem("strong",_3);};};i.Radio=function(_2,_3,_4,_5,_6){return R.Element("div",new O.T({$:1,$0:(i.cls())("radio"),$1:_3}),[R.Element("label",_5,[R.Radio(_6,true,_4),R.TextNode(_2)])]);};i.Checkbox=function(_2,_3,_4,_5,_6){return R.Element("div",new O.T({$:1,$0:(i.cls())("checkbox"),$1:_3}),[R.Element("label",_5,[R.CheckBox(_6,_4),R.TextNode(_2)])]);};i.TextArea=function(_2,_3,_4,_5,_6){return R.Element("div",new O.T({$:1,$0:(i.cls())("form-group"),$1:_3}),[R.Element("label",_5,[R.TextNode(_2)]),R.InputArea(new O.T({$:1,$0:(i.cls())("form-control"),$1:_6}),_4)]);};i.InputPassword=function(_2,_3,_4,_5,_6){return R.Element("div",new O.T({$:1,$0:(i.cls())("form-group"),$1:_3}),[R.Element("label",_5,[R.TextNode(_2)]),R.PasswordBox(new O.T({$:1,$0:(i.cls())("form-control"),$1:_6}),_4)]);};i.Input=function(_2,_3,_4,_5,_6){return R.Element("div",new O.T({$:1,$0:(i.cls())("form-group"),$1:_3}),[R.Element("label",_5,[R.TextNode(_2)]),R.Input(new O.T({$:1,$0:(i.cls())("form-control"),$1:_6}),_4)]);};i.Container=function(_2){return R.Element("div",[(i.cls())("container")],_2);};i.Class=function(){j.$cctor();return j.Class;};i.cls=function(){j.$cctor();return j.cls;};j.$cctor=function(){j.$cctor=a.ignore;j.cls=S.Class;j.Class=S.Class;};l=k.Intent=N.Class({toString:function(){return(((N.Curried3(function(_2,_3,_4){return _2("Intent("+K.toSafe(_3)+", "+F.p$2(_4)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,l);m=k.Trait=N.Class({toString:function(){return(((N.Curried3(function(_2,_3,_4){return _2("Trait("+K.toSafe(_3)+", "+K.prettyPrint(_4)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,m);n=k.Entity=N.Class({toString:function(){return((((N.Curried(function(_2,_3,_4,_5){return _2("Entity("+K.toSafe(_3)+", "+K.toSafe(_4)+", "+F.p$2(_5)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[2];},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,n);o=k.Meaning=N.Class({toString:function(){return((((N.Curried(function(_2,_3,_4,_5){return _2(F.p(_3)+" "+F.p$3(_4)+". "+F.p$5(_5));},4))(a.id))(this.get_Intent()))(this.get_Trait()))(this.get_Entities());},get_Entities:function(){return(this.Unwrap())[2];},get_Trait:function(){return(this.Unwrap())[1];},get_Intent:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,o);p=k.Question=N.Class({get_Response:function(){return(this.Unwrap())[1];},get_Meaning:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1];}},null,p);r.New=function(_2,_3,_4,_5,_6){return{body:_2,end:_3,start:_4,suggested:_5,value:_6};};q["Intent'"]=function(_2,_3){return!(_3.intent==null)?{$:1,$0:new l({$:0,$0:d.toLower(_3.intent.value),$1:null})}:null;};q["Trait'"]=function(_2){return!(_2.greetings==null)?{$:1,$0:new m({$:0,$0:"greetings",$1:d.toLower(_2.contact.value)})}:null;};q["Entity'$1"]=function(_2){return!(_2.contact==null)?{$:1,$0:new n({$:0,$0:"contact",$1:d.toLower(_2.contact.value),$2:null})}:null;};t=s["Meaning'"]=N.Class({get_TopIntent:function(){return O.head(O.sortBy(function(_2){return _2.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,t);u=s["Intent'"]=N.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,u);v=s["Entity'"]=N.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,v);s.HasMeaning=function(_2){var _3,_4,_5,_6,_7,_8;return _2!=null&&_2.$==1&&(_2.$0.$0.$==0&&(_2.$0.$1.get_Length()>0&&(_3=_2.$0.$1,true)))?{$:1,$0:new o({$:0,$0:null,$1:null,$2:{$:1,$0:O.map(function(_9){return new n({$:0,$0:d.toLower(_9.get_Role()),$1:_9.get_Value(),$2:{$:1,$0:_9.get_Confidence()}});},O.filter(function(_9){return _9.get_Confidence()>s.entityConfidenceThreshold();},_3))}})}:_2!=null&&_2.$==1&&(_2.$0.$1.$==0&&(_2.$0.get_TopIntent().get_Confidence()>s.intentConfidenceThreshold()&&(_4=[_2.$0.$0,_2],true)))?(_5=_4[1],{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(_5.$0.get_TopIntent().get_Name()),$1:{$:1,$0:_5.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):_2!=null&&_2.$==1&&(_2.$0.get_TopIntent().get_Confidence()>s.intentConfidenceThreshold()&&(_6=[_2.$0.$1,_2.$0.$0,_2],true))?(_7=_6[2],(_8=O.map(function(_9){return new n({$:0,$0:d.toLower(_9.get_Role()),$1:_9.get_Value(),$2:{$:1,$0:_9.get_Confidence()}});},O.filter(function(_9){return _9.get_Confidence()>s.entityConfidenceThreshold();},_7.$0.get_Entities())),{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(_7.$0.get_TopIntent().get_Name()),$1:{$:1,$0:_7.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:_8}})})):null;};s.entityConfidenceThreshold=function(){w.$cctor();return w.entityConfidenceThreshold;};s.set_entityConfidenceThreshold=function(_2){w.$cctor();w.entityConfidenceThreshold=_2;};s.intentConfidenceThreshold=function(){w.$cctor();return w.intentConfidenceThreshold;};s.set_intentConfidenceThreshold=function(_2){w.$cctor();w.intentConfidenceThreshold=_2;};s.QuickPrograms=function(_2){return _2==="programs"?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};s.QuickNo=function(_2){var _3;return _2==="no"||(_2==="NO"||(_2==="No"||(_2==="nope"||(_2==="no way"||(_2==="nah"||(_2==="don't do it"||_2==="stop"))))))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"yes",$1:null})},$1:null,$2:null})}:null;};s.QuickYes=function(_2){var _3;return _2==="yes"||(_2==="YES"||(_2==="Yes"||(_2==="YEs"||(_2==="ok"||(_2==="sure"||(_2==="yeah"||(_2==="yep"||(_2==="uh huh"||(_2==="go ahead"||_2==="go")))))))))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"yes",$1:null})},$1:null,$2:null})}:null;};s.QuickHelp=function(_2){var _3;return _2==="help"||(_2==="help me"||(_2==="what's this?"||_2==="huh"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"help",$1:null})},$1:null,$2:null})}:null;};s.QuickHello=function(_2){var _3;return _2==="hello"||(_2==="hey"||(_2==="yo"||_2==="hi"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"hello",$1:null})},$1:null,$2:null})}:null;};s.DebugOff=function(_2){return _2==="debug off"?{$:1,$0:null}:null;};s.DebugOn=function(_2){return _2==="debug on"?{$:1,$0:null}:null;};s.Blank=function(_2){return _2===""?{$:1,$0:null}:null;};k.Yes=function(_2){var _3,_4;return(_4=k.Intent$1("yes",_2.$0),_4!=null&&_4.$==1)&&(_2.$1==null&&_2.$2==null)?{$:1,$0:null}:null;};k.Entity$1=function(_2,_3){return _3.get_Name()===_2?{$:1,$0:_3.get_Value()}:null;};k.Intent$1=function(_2,_3){var _4;return _3!=null&&_3.$==1&&(_3.$0.$0===_2&&(_4=_3.$0.$0,true))?{$:1,$0:null}:null;};w.$cctor=function(){w.$cctor=a.ignore;w.intentConfidenceThreshold=0.85;w.entityConfidenceThreshold=0.85;};y=x.User=N.Class({toString:function(){return this.Name;}},null,y);y.New=function(_2){return new y({Name:_2});};z=x.Interpreter=N.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,z);A=x.CUI=N.Class({get_StopSpeaking:function(){if(a.speechSynthesis.speaking||a.speechSynthesis.pending)a.speechSynthesis.cancel();},SayVoices:function(){var _2,_3,_4;_2=this;_3=a.speechSynthesis.getVoices();!(_3==null)?(_4=d.toArray(_3),_2.Say((function(_5){return function(_6){return _5("There are currently "+a.String(_6)+" voices installed on this computer or device.");};}(a.id))(I.length(_4))),I.iteri(function(_5,_6){return _2.Say(((((N.Curried(function(_7,_8,_9,_){return _7("Voice "+a.String(_8)+". Name: "+K.toSafe(_9)+", Local: "+K.prettyPrint(_)+".");},4))(a.id))(_5))(_6.name))(_6.localService));},_4)):void 0;},Wait:function(_2){this.Wait$1(function(){T.Start(_2,null);});},Wait$1:function(_2){this["Echo'"]("please wait...");this.Term.pause();_2();this.Term.resume();},sayRandom:function(_2,_3){this.Say(x.getRandomPhrase(_2,_3));},Say:function(_2){var _3,_4,_5;_3=this.Voice;_3!=null&&_3.$==1?(_4=_3.$0,T.Start((_5=null,T.Delay(function(){var _6;_6=new a.SpeechSynthesisUtterance(_2);_6.voice=_4;a.speechSynthesis.speak(_6);return T.Zero();})),null),this.Caption?this["Echo'"](_2):void 0):this["Echo'"](_2);},Debug:function(_2){d.debug(_2);this.DebugMode?this["EchoHtml'"](_2):void 0;},"EchoHtml'":function(_2){var _3,_4;_3=(_4={},_4.raw=true,_4);this.Term.disable();this.Term.echo(_2,_3);this.Term.enable();},"Echo'":function(_2){this.Term.disable();this.Term.echo(_2);this.Term.enable();}},null,A);A.New=function(_2,_3,_4,_5,_6){return new A({Voice:_2,Mic:_3,Term:_4,DebugMode:_5,Caption:_6});};x.helpPhrases=function(){B.$cctor();return B.helpPhrases;};x.helloUserPhrases=function(){B.$cctor();return B.helloUserPhrases;};x.helloPhrases=function(){B.$cctor();return B.helloPhrases;};x.waitRetrievePhrases=function(){B.$cctor();return B.waitRetrievePhrases;};x["getRandomPhrase'"]=function(_2){return d.replace_tok("$0","",P.nth(x.rng().Next(0,_2.get_Length()),_2));};x.getRandomPhrase=function(_2,_3){return d.replace_tok("$0",_3,P.nth(x.rng().Next(0,_2.get_Length()),_2));};x.rng=function(){B.$cctor();return B.rng;};B.$cctor=function(){B.$cctor=a.ignore;B.rng=new U.New();B.waitRetrievePhrases=O.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);B.helloPhrases=O.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);B.helloUserPhrases=O.ofArray(["Hi $0, welcome back.","Welcome $0, nice to see you again..","Hello $0","Good to see you $0."]);B.helpPhrases=O.ofArray(["What can I help you with $0?"]);};C.update=function(_2,_3,_4,_5,_6){var _7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ;function bR(b1){return _3.ContainsKey(b1);}function bS(b1){return!bR("user")?{$:1,$0:b1.Unwrap()}:null;}function bT(b1){return bR("user")?{$:1,$0:b1.Unwrap()}:null;}function bU(b1){return V.Equals(b1,_4[0].$0);}function bV(b1){_2.Say(b1);}function bW(b1){_5.unshift(b1);bV(b1);}function bX(b1,b2){var b3;b3=x.getRandomPhrase(b1,b2);_5.unshift(b3);return _2.Say(b3);}function bY(b1){var b2;T.Start((b2=null,T.Delay(function(){bX(x.waitRetrievePhrases(),"user name");return T.Bind((new X.New()).Async("SMApp.Web:SMApp.Web.Server.GetUser2:-1582576757",[b1]),function(b3){return b3==null?(bW((function(b4){return function(b5){return b4("Sorry I did not find the user name "+K.toSafe(b5)+".");};}(a.id))(b1)),T.Zero()):(_3.Add("user",b3.$0),bX(x.helloUserPhrases(),(function(b4){return function(b5){return b4(K.prettyPrint(b5));};}(a.id))(_3.get_Item("user"))),T.Zero());});})),null);}function bZ(b1){var b2,b3;for(b2=1,b3=b1;b2<=b3;b2++)_6.shift();}function b0(){_4.shift();}_7=function(b1){return _4.length>0&&bU(new o({$:0,$0:b1[0],$1:b1[1],$2:b1[2]}))?{$:1,$0:b1}:null;};_8=_6.length>=5?5:_6.length;C.debug((function(b1){return function(b2){return b1("Current context: "+K.prettyPrint(b2)+".");};}(a.id))(_6));C.debug((function(b1){return function(b2){return b1("Previous questions: "+K.prettyPrint(b2)+".");};}(a.id))(_4));_9=O.ofSeq(P.take(_8,_6));_9.$==1&&($=bS(_9.$0),$!=null&&$.$==1&&((ba=k.Intent$1("hello",$.$0[0]),ba!=null&&ba.$==1)&&($.$0[1]==null&&($.$0[2]==null&&_9.$1.$==0))))?bX(x.helloPhrases(),""):_9.$==1&&(bc=bT(_9.$0),bc!=null&&bc.$==1&&((bd=k.Intent$1("hello",bc.$0[0]),bd!=null&&bd.$==1)&&(bc.$0[1]==null&&(bc.$0[2]==null&&_9.$1.$==0))))?(bX(x.helloUserPhrases(),(function(b1){return function(b2){return b1(K.prettyPrint(b2));};}(a.id))(_3.get_Item("user"))),bZ(1)):_9.$==1&&(bf=bS(_9.$0),bf!=null&&bf.$==1&&((bg=k.Intent$1("hello",bf.$0[0]),bg!=null&&bg.$==1)&&(bf.$0[1]==null&&((bh=bf.$0[2],bh!=null&&bh.$==1)&&(bf.$0[2].$0.$==1&&(bi=k.Entity$1("contact",bf.$0[2].$0.$0),bi!=null&&bi.$==1&&(bf.$0[2].$0.$1.$==0&&(_9.$1.$==0&&(be=bi.$0,true)))))))))?(bY(be),bZ(1)):_9.$==1&&(bk=bS(_9.$0),bk!=null&&bk.$==1&&(bk.$0[0]==null&&(bk.$0[1]==null&&((bl=bk.$0[2],bl!=null&&bl.$==1)&&(bk.$0[2].$0.$==1&&(bm=k.Entity$1("contact",bk.$0[2].$0.$0),bm!=null&&bm.$==1&&(bk.$0[2].$0.$1.$==0&&(_9.$1.$==1&&(bn=bS(_9.$1.$0),bn!=null&&bn.$==1&&((bo=k.Intent$1("hello",bn.$0[0]),bo!=null&&bo.$==1)&&(bn.$0[1]==null&&(bn.$0[2]==null&&(_9.$1.$1.$==0&&(bj=bm.$0,true))))))))))))))?(bY(bj),bZ(2)):_9.$==1&&(bq=bS(_9.$0),bq!=null&&bq.$==1&&((br=k.Intent$1("hello",bq.$0[0]),br!=null&&br.$==1)&&(bq.$0[1]==null&&((bs=bq.$0[2],bs!=null&&bs.$==1)&&(bq.$0[2].$0.$==1&&(bt=k.Entity$1("contact",bq.$0[2].$0.$0),bt!=null&&bt.$==1&&(bq.$0[2].$0.$1.$==0&&(_9.$1.$==1&&(bu=bS(_9.$1.$0),bu!=null&&bu.$==1&&((bv=k.Intent$1("hello",bu.$0[0]),bv!=null&&bv.$==1)&&(bu.$0[1]==null&&(bu.$0[2]==null&&(_9.$1.$1.$==0&&(bp=bt.$0,true))))))))))))))?(bY(bp),bZ(2)):_9.$==1&&(bx=bT(_9.$0),bx!=null&&bx.$==1&&((by=k.Intent$1("hello",bx.$0[0]),by!=null&&by.$==1)&&(bx.$0[1]==null&&((bz=bx.$0[2],bz!=null&&bz.$==1)&&(bx.$0[2].$0.$==1&&(bA=k.Entity$1("contact",bx.$0[2].$0.$0),bA!=null&&bA.$==1&&(bx.$0[2].$0.$1.$==0&&(_9.$1.$==0&&(bw=[_9,bA.$0],true)))))))))?(bW("Are you sure you want to switch users?"),_4.unshift(new p({$:0,$0:O.head(bw[0]),$1:"Are you sure you want to switch users?"})),C.debug((function(b1){return function(b2){return b1("Add question: "+F.p$8(b2)+".");};}(a.id))(_4[0]))):_9.$==1&&(bC=bT(_9.$0),bC!=null&&bC.$==1&&((bD=k.Intent$1("yes",bC.$0[0]),bD!=null&&bD.$==1)&&(bC.$0[1]==null&&(bC.$0[2]==null&&(_9.$1.$==1&&(bE=bT(_9.$1.$0),bE!=null&&bE.$==1&&(bF=_7(bE.$0),bF!=null&&bF.$==1&&((bG=k.Intent$1("hello",bF.$0[0]),bG!=null&&bG.$==1)&&(bF.$0[1]==null&&((bH=bF.$0[2],bH!=null&&bH.$==1)&&(bF.$0[2].$0.$==1&&(bI=k.Entity$1("contact",bF.$0[2].$0.$0),bI!=null&&bI.$==1&&(bF.$0[2].$0.$1.$==0&&(_9.$1.$1.$==0&&(bB=bI.$0,true)))))))))))))))?(bY(bB),bZ(2),b0()):_9.$==1&&(bK=bT(_9.$0),bK!=null&&bK.$==1&&((bL=k.Intent$1("no",bK.$0[0]),bL!=null&&bL.$==1)&&(bK.$0[1]==null&&(bK.$0[2]==null&&(_9.$1.$==1&&(bM=bT(_9.$1.$0),bM!=null&&bM.$==1&&(bN=_7(bM.$0),bN!=null&&bN.$==1&&((bO=k.Intent$1("hello",bN.$0[0]),bO!=null&&bO.$==1)&&(bN.$0[1]==null&&((bP=bN.$0[2],bP!=null&&bP.$==1)&&(bN.$0[2].$0.$==1&&((bQ=k.Entity$1("contact",bN.$0[2].$0.$0),bQ!=null&&bQ.$==1)&&(bN.$0[2].$0.$1.$==0&&_9.$1.$1.$==0)))))))))))))?(bZ(2),b0()):(bZ(1),bW("Sorry I didn't understand what you meant."),_4.length>0?bW(_4[0].get_Response()):void 0);};C.debug=function(_2){d.debug((function(_3){return function(_4){return _3("Main: "+K.prettyPrint(_4));};}(a.id))(_2));};D.run=function(){var _2,_3;_2=N.ThisFunc(function(_4,_5){return((D.Main().get_Text())(_4))(_5);});_3=D.Main().get_Options();a.$("#main").terminal(_2,_3);return R.get_Empty();};D.Main=function(){E.$cctor();return E.Main;};D.container=function(){E.$cctor();return E.container;};D.wait=function(_2){d["Terminal.Echo'"](D.CUI().Term,"please wait");D.CUI().Term.disable();_2();D.CUI().Term.enable();};D.sayRandom=function(_2,_3){D.say(x.getRandomPhrase(_3,_2));};D.sayVoices=function(){var _2,_3;_2=a.speechSynthesis.getVoices();!(_2==null)?(_3=d.toArray(_2),D["say'"]((function(_4){return function(_5){return _4("There are currently "+a.String(_5)+" voices installed on this computer or device.");};}(a.id))(I.length(_3))),I.iteri(function(_4,_5){return D["say'"](((((N.Curried(function(_6,_7,_8,_9){return _6("Voice "+a.String(_7)+". Name: "+K.toSafe(_8)+", Local: "+K.prettyPrint(_9)+".");},4))(a.id))(_4))(_5.name))(_5.localService));},_3)):void 0;};D.say=function(_2){D.Responses().unshift(_2);D["say'"](_2);};D["say'"]=function(_2){var _3,_4,_5;_3=D.CUI().Voice;_3!=null&&_3.$==1?(_4=_3.$0,T.Start((_5=null,T.Delay(function(){var _6;_6=new a.SpeechSynthesisUtterance(_2);_6.voice=_4;a.speechSynthesis.speak(_6);D.CUI().Caption?d["Terminal.Echo'"](D.CUI().Term,_2):void 0;return T.Zero();})),null)):d["Terminal.Echo'"](D.CUI().Term,_2);};D.initMic=function(_2){var _3,_4;D.set_CUI((_3={$:1,$0:new Y.Microphone(Z.getElementById("microphone"))},A.New(D.CUI().Voice,_3,D.CUI().Term,D.CUI().DebugMode,D.CUI().Caption)));_4=D.CUI().Mic.$0;_4.onconnecting=function(){D.set_MicState({$:1});return D.debug("Mic connecting...");};_4.ondisconnected=function(){D.set_MicState({$:2});return D.debug("Mic disconnected.");};_4.onaudiostart=function(){D.set_MicState({$:3});return D.debug("Mic audio start...");};_4.onaudioend=function(){D.set_MicState({$:4});return D.debug("Mic audio end.");};_4.onerror=function(_5){D.set_MicState({$:6,$0:_5});return D.debug((function(_6){return function(_7){return _6("Mic error : "+K.toSafe(_7)+".");};}(a.id))(_5));};_4.onready=function(){D.set_MicState({$:5});return D.debug("Mic ready.");};_4.onresult=function(_5,_6){return!(_5==null||_6==null)?(D.set_MicState({$:7,$0:_5,$1:_6}),D.debug((((N.Curried3(function(_7,_8,_9){return _7("Mic result: "+K.prettyPrint(_8)+" "+K.prettyPrint(_9)+".");}))(a.id))(_5))(_6)),_2(_4,[_5,_6])):D.debug("Mic: No result returned.");};_4.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};D.initSpeech=function(){var _2,_3;_2=a.speechSynthesis.getVoices();!(_2==null)?(_3=d.toArray(_2),I.iter(function(_4){if(V.Equals(D.CUI().Voice,null)&&(_4.name.indexOf("Microsoft Zira")!=-1||_4.name.toLowerCase().indexOf("female")!=-1)){D.set_CUI(A.New({$:1,$0:_4},D.CUI().Mic,D.CUI().Term,D.CUI().DebugMode,D.CUI().Caption));D.debug((function(_5){return function(_6){return _5("Using voice "+K.toSafe(_6)+".");};}(a.id))(D.CUI().Voice.$0.name));}},_3),V.Equals(D.CUI().Voice,null)&&I.length(_3)>0?(D.set_CUI(A.New({$:1,$0:I.find(function(_4){return _4["default"];},_3)},D.CUI().Mic,D.CUI().Term,D.CUI().DebugMode,D.CUI().Caption)),D.debug((function(_4){return function(_5){return _4("Using default voice "+K.toSafe(_5)+".");};}(a.id))(D.CUI().Voice.$0.name))):void 0):void 0;V.Equals(D.CUI().Voice,null)?(d.error("No speech synthesis voice is available."),d["Terminal.Echo'"](D.CUI().Term,"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma.")):void 0;};D.pushCtx=function(_2){D.Context().unshift(_2);return D.Context();};D.Responses=function(){E.$cctor();return E.Responses;};D.Questions=function(){E.$cctor();return E.Questions;};D.Context=function(){E.$cctor();return E.Context;};D.debug=function(_2){var _3;_3=(function(_4){return function(_5){return _4("Client: "+K.prettyPrint(_5));};}(a.id))(_2);d.debug(_3);D.CUI().DebugMode?d["Terminal.EchoHtml'"](D.CUI().Term,_3):void 0;};D.Props=function(){E.$cctor();return E.Props;};D.OpState=function(){E.$cctor();return E.OpState;};D.set_OpState=function(_2){E.$cctor();E.OpState=_2;};D.MicState=function(){E.$cctor();return E.MicState;};D.set_MicState=function(_2){E.$cctor();E.MicState=_2;};D.CUI=function(){E.$cctor();return E.CUI;};D.set_CUI=function(_2){E.$cctor();E.CUI=_2;};E.$cctor=function(){var _2;E.$cctor=a.ignore;function _3(_5,_6){var _7,_8,_9,_,$,ba,bb,bc,bd,be,bf;_7=_6[0];_8=_6[1];D.debug((((N.Curried3(function(bg,bh,bi){return bg("Voice: "+K.prettyPrint(bh)+" "+K.prettyPrint(bi));}))(a.id))(_7))(_8));_9=(_=q["Intent'"](_7,_8),_!=null&&_.$==1?{$:1,$0:_.$0}:null);$=(ba=q["Trait'"](_8),ba!=null&&ba.$==1?{$:1,$0:ba.$0}:null);bb=(bc=q["Entity'$1"](_8),bc!=null&&bc.$==1?{$:1,$0:O.ofArray([bc.$0])}:null);return _9==null&&($==null&&bb==null)?null:(D.debug(((((N.Curried(function(bg,bh,bi,bj){return bg("Voice: "+F.p(bh)+" "+F.p$3(bi)+" "+F.p$5(bj));},4))(a.id))(_9))($))(bb)),(D.OpState()==null?false:D.OpState().$0.$==0)?D["say'"]("I'm still working on understanding your last message."):(bf=D.pushCtx(new o({$:0,$0:_9,$1:$,$2:bb})),C.update(D.CUI(),D.Props(),D.Questions(),D.Responses(),bf)));}function _4(_5,_6){var _7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg;D.set_CUI(A.New(D.CUI().Voice,D.CUI().Mic,_5,D.CUI().DebugMode,D.CUI().Caption));V.Equals(D.CUI().Voice,null)?D.initSpeech():void 0;V.Equals(D.CUI().Mic,null)?D.initMic(_3):void 0;return(_7=s.Blank(_6),_7!=null&&_7.$==1)?D["say'"]("Tell me what you want me to do or ask me a question."):(_8=s.DebugOn(_6),_8!=null&&_8.$==1)?(D.set_CUI(A.New(D.CUI().Voice,D.CUI().Mic,D.CUI().Term,true,D.CUI().Caption)),D["say'"]("Debug mode is now on.")):(_9=s.DebugOff(_6),_9!=null&&_9.$==1)?(D.set_CUI(A.New(D.CUI().Voice,D.CUI().Mic,D.CUI().Term,false,D.CUI().Caption)),D["say'"]("Debug mode is now off.")):(D.OpState()==null?false:D.OpState().$0.$==0)?D["say'"]("I'm still working on understanding your last message."):(ba=s.QuickHello(_6),ba!=null&&ba.$==1?($=ba.$0,true):(bb=s.QuickHelp(_6),bb!=null&&bb.$==1?($=bb.$0,true):(bc=s.QuickYes(_6),bc!=null&&bc.$==1?($=bc.$0,true):(bd=s.QuickNo(_6),bd!=null&&bd.$==1?($=bd.$0,true):(be=s.QuickPrograms(_6),be!=null&&be.$==1&&($=be.$0,true))))))?(D.debug((function(bh){return function(bi){return bh("Quick Text: "+F.p$7(bi)+".");};}(a.id))($)),bf=D.pushCtx($),C.update(D.CUI(),D.Props(),D.Questions(),D.Responses(),bf)):D.CUI().Wait((bg=null,T.Delay(function(){D.set_OpState({$:1,$0:{$:0}});return T.Combine(T.Bind((new X.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:880623687",[_6]),function(bh){var bi,bj,bk;bi=s.HasMeaning(bh);return bi!=null&&bi.$==1?(bj=bi.$0,(D.debug(((((N.Curried(function(bl,bm,bn,bo){return bl("Text: "+F.p(bm)+" "+F.p$3(bn)+" "+F.p$5(bo));},4))(a.id))(bj.get_Intent()))(bj.get_Trait()))(bj.get_Entities())),bk=D.pushCtx(bj),C.update(D.CUI(),D.Props(),D.Questions(),D.Responses(),bk),T.Zero())):(D.debug("Text: Did not receive a response from the server."),d["Terminal.Echo'"](_5,"Sorry I did not understand what you said."),T.Zero());}),T.Delay(function(){D.set_OpState(null);return T.Zero();}));})));}E.CUI=A.New(null,null,null,false,false);E.MicState={$:0};E.OpState=null;E.Props=new _1.New$5();E.Context=[];E.Questions=[];E.Responses=[];E.container=i.Container;E.Main=new z({$:0,$0:function(_5){return function(_6){return _3(_5,_6);};},$1:[function(_5){return function(_6){return _4(_5,_6);};},(_2={},_2.name="Main",_2.greetings="Welcome to Selma. Enter 'hello my name is...(you)' to begin and initialize speech or help for more assistance.",_2.prompt=">",_2)]});};F.p$8=function(_2){return"Question ("+F.p$7(_2.$0)+", "+K.prettyPrint(_2.$1)+")";};F.p$2=function(_2){return _2==null?"null":"Some "+K.prettyPrint(_2.$0);};F.p$1=function(_2){return"Intent ("+K.prettyPrint(_2.$0)+", "+F.p$2(_2.$1)+")";};F.p=function(_2){return _2==null?"null":"Some "+F.p$1(_2.$0);};F.p$4=function(_2){return"Trait ("+K.prettyPrint(_2.$0)+", "+K.prettyPrint(_2.$1)+")";};F.p$3=function(_2){return _2==null?"null":"Some "+F.p$4(_2.$0);};F.p$6=function(_2){return"Entity ("+K.prettyPrint(_2.$0)+", "+K.prettyPrint(_2.$1)+", "+F.p$2(_2.$2)+")";};F.p$5=function(_2){return _2==null?"null":"Some "+K.printList(function(_3){return F.p$6(_3);},_2.$0);};F.p$7=function(_2){return"Meaning ("+F.p(_2.$0)+", "+F.p$3(_2.$1)+", "+F.p$5(_2.$2)+")";};}());
