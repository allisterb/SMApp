(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=c.TypingDNA=c.TypingDNA||{};i=h.SaveResponse=h.SaveResponse||{};j=h.UserResponse=h.UserResponse||{};k=h.VerifyResponse=h.VerifyResponse||{};l=c.Bs=c.Bs||{};m=b.NLU=b.NLU||{};n=m.Babelfy=m.Babelfy||{};o=n.ApiResponse=n.ApiResponse||{};p=n.TokenFragment=n.TokenFragment||{};q=n.CharFragment=n.CharFragment||{};r=m.Witai=m.Witai||{};s=r.Utterance=r.Utterance||{};t=r.Intent=r.Intent||{};u=r.Entity=r.Entity||{};v=r.Trait=r.Trait||{};w=r["Utterance'"]=r["Utterance'"]||{};x=r["Value'"]=r["Value'"]||{};y=m.QnAMaker=m.QnAMaker||{};z=y.ITSQuestion=y.ITSQuestion||{};A=y.ITSAnswerContext=y.ITSAnswerContext||{};B=y.ITSAnswer=y.ITSAnswer||{};C=y.ITSAnswers=y.ITSAnswers||{};D=c.NLG=c.NLG||{};E=a.StartupCode$SMApp_Web$NLG=a.StartupCode$SMApp_Web$NLG||{};F=c.NLU=c.NLU||{};G=F.Intent=F.Intent||{};H=F.Trait=F.Trait||{};I=F.Entity=F.Entity||{};J=F.Utterance=F.Utterance||{};K=F.Voice=F.Voice||{};L=K["Entity'"]=K["Entity'"]||{};M=F.Text=F.Text||{};N=M["Utterance'"]=M["Utterance'"]||{};O=M["Intent'"]=M["Intent'"]||{};P=M["Entity'"]=M["Entity'"]||{};Q=M["Trait'"]=M["Trait'"]||{};R=F.Domain=F.Domain||{};S=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};T=c.CUI=c.CUI||{};U=T.MicState=T.MicState||{};V=T.ClientState=T.ClientState||{};W=T.Interpreter=T.Interpreter||{};X=T.CUI=T.CUI||{};Y=c.Question=c.Question||{};Z=c.QuestionType=c.QuestionType||{};_0=c.Dialogue=c.Dialogue||{};_1=c.DialogueModule=c.DialogueModule||{};_2=c.User=c.User||{};_3=a.StartupCode$SMApp_Web$User=a.StartupCode$SMApp_Web$User||{};_4=c.Main=c.Main||{};_5=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};_6=c.Client=c.Client||{};_7=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};_8=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};_9=a.GeneratedPrintf=a.GeneratedPrintf||{};_=a.IntelliFactory;$=_&&_.Runtime;ba=a.WebSharper;bb=ba&&ba.UI;bc=bb&&bb.Doc;bd=bb&&bb.AttrProxy;be=bb&&bb.Client;bf=be&&be.Templates;bg=ba&&ba.Arrays;bh=ba&&ba.Utils;bi=a.console;bj=a.jQuery;bk=ba&&ba.Strings;bl=ba&&ba.List;bm=ba&&ba.Seq;bn=bb&&bb.AttrModule;bo=ba&&ba.Concurrency;bp=a.JSON;bq=ba&&ba.Random;br=ba&&ba.Collections;bs=br&&br.Map;bt=ba&&ba.JavaScript;bu=bt&&bt.Pervasives;bv=a.SDK;bw=ba&&ba.Remoting;bx=bw&&bw.AjaxRemotingProvider;by=a.Wit;bz=a.document;bA=ba&&ba.Unchecked;bB=br&&br.Dictionary;d.startCamera=function(bC,bD){return a.startCamera(bC,bD);};d.speechSynthesis=function(){return a.speechSynthesis;};d.lastMicData=function(){return a.lastMicData;};d.questionBox=function(bC,bD,bE,bF,bG){var bH,bI;(bH=a.Sweetalert2((bI={},bI.titleText=bC,bI.text=bD,bI.type="question",bI.width=a.String(bE),bI.html=((($.Curried3(function(bJ,bK,bL){return bJ("<div style=\"width:"+a.String(bK)+"px;height:"+a.String(bL)+"px\"></div>");}))(a.id))(bE))(bF),bI.input="text",bI.confirmButtonText="Ok",bI)),bH).then(bG);};d.createCanvas=function(bC,bD,bE,bF){var bG;bG=bc.Element("canvas",[d.eid(bC),bd.Create("width",bD),bd.Create("height",bE)],[]);bf.LoadLocalTemplates("");bc.Run(bF,bG);return bF.firstChild;};d.elementHTML=function(bC){return bC.innerHTML;};d.createElement=function(bC){var bD;bD=self.document.createElement("div");self.document.appendChild(bD);bf.LoadLocalTemplates("");bc.RunAppend(bD,bC);};d.container=function(bC){return bc.Element("div",[d.cls("container")],bC);};d.dindex=function(bC){return bd.Create("data-index",a.String(bC));};d.cls=function(bC){return bd.Create("class",bC);};d.eid=function(bC){return bd.Create("id",bC);};d.termOutput=function(){return bg.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(bC){return bC.toLowerCase();};d.debug=function(bC,bD){d.info(((($.Curried3(function(bE,bF,bG){return bE("DEBUG: "+bh.toSafe(bF)+": "+bh.prettyPrint(bG));}))(a.id))(bC.toUpperCase()))(bD));};d.error=function(bC){bi.error(bC);};d.info=function(bC){bi.info(bC);};d.jserror=function(bC){bj.error(bC);};d.toArray=function(bC){return bg.map(a.id,bj.makeArray(bC));};d["Terminal.EchoHtml'"]=function(bC,bD){bC.pause();bC.echo(bD,d.rawOpt());bC.resume();};d["Terminal.Echo'"]=function(bC,bD){bC.pause();bC.echo(bD);bC.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=$.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(bC){function bD(bE){return function(bF){var bG,bH,bI,bJ,bK,bL,bM;bH=bk.replicate(bE," ");switch(bF.$==0?bF.$1.$==1?bF.$1.$0.$==2?bF.$1.$1.$==0?(bG=[bF.$1.$0.$0,bF.$0],1):(bG=[bF.$1,bF.$0],2):(bG=[bF.$1,bF.$0],2):(bG=[bF.$1,bF.$0],2):bF.$==2?(bG=bF.$0,3):(bG=[bF.$0,bF.$1],0)){case 0:return bG[0]+"=\""+bG[1]+"\"";case 1:bI=bG[1];return bH+"<"+bI+">"+bG[0]+"</"+bI+">\r\n";case 2:bJ=bG[1];bK=bl.partition(function(bN){return bN.$==1;},bG[0]);bL=bK[1];bM=bK[0];return bL.$==0?bH+"<"+bJ+(bM.$===0?"":" "+bk.concat(" ",bl.ofSeq(bm.delay(function(){return bm.map(function(bN){return(bD(0))(bN);},bM);}))))+"/>\r\n":bH+"<"+bJ+(bM.$===0?"":" "+bk.concat(" ",bl.ofSeq(bm.delay(function(){return bm.map(function(bN){return(bD(0))(bN);},bM);}))))+">\r\n"+bk.concat("",bl.ofSeq(bm.delay(function(){return bm.map(function(bN){return(bD(bE+1))(bN);},bL);})))+bH+"</"+bJ+">\r\n";case 3:return bH+bG+"\r\n";}};}return(bD(0))(bC);};f.alt=function(bC){return new e({$:1,$0:"alt",$1:bC});};f.src=function(bC){return new e({$:1,$0:"src",$1:bC});};f.cls=function(bC){return new e({$:1,$0:"class",$1:bC});};f.str=function(bC){return e.toString(bC);};f.op_PercentEquals=function(bC,bD){return new e({$:1,$0:bC,$1:bD});};f.op_Splice=function(bC){var bD;return bl.ofArray([new e({$:2,$0:(bD=bC,a.String(bD))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(bC,bD){return new e({$:0,$0:bC,$1:bD});};g.$cctor=function(){var bC;g.$cctor=a.ignore;g.rawOpt=(bC={},bC.raw=true,bC);g.html=function(bD){return f.elem("html",bD);};g.head=function(bD){return f.elem("head",bD);};g.title=function(bD){return f.elem("title",bD);};g.style=function(bD){return f.elem("style",bD);};g.body=function(bD){return f.elem("body",bD);};g.div=function(bD){return f.elem("div",bD);};g.br=function(bD){return f.elem("br",bD);};g.section=function(bD){return f.elem("section",bD);};g.span=function(bD){return f.elem("span",bD);};g.table=function(bD){return f.elem("table",bD);};g.thead=function(bD){return f.elem("thead",bD);};g.tbody=function(bD){return f.elem("tbody",bD);};g.tfoot=function(bD){return f.elem("tfoot",bD);};g.img=function(bD){return f.elem("img",bD);};g.map=function(bD){return f.elem("map",bD);};g.area=function(bD){return f.elem("area",bD);};g.p=function(bD){return f.elem("p",bD);};g.a=function(bD){return f.elem("a",bD);};g.tr=function(bD){return f.elem("tr",bD);};g.td=function(bD){return f.elem("td",bD);};g.th=function(bD){return f.elem("th",bD);};g.ul=function(bD){return f.elem("ul",bD);};g.li=function(bD){return f.elem("li",bD);};g.h1=function(bD){return f.elem("h1",bD);};g.h2=function(bD){return f.elem("h1",bD);};g.h3=function(bD){return f.elem("h1",bD);};g.h4=function(bD){return f.elem("h1",bD);};g.strong=function(bD){return f.elem("strong",bD);};};i.New=function(bC,bD,bE,bF){return{name:bC,message:bD,message_code:bE,status:bF};};j.New=function(bC,bD,bE,bF,bG){return{message:bC,message_code:bD,success:bE,count:bF,status:bG};};k.New=function(bC,bD,bE,bF,bG,bH){return{message:bC,message_code:bD,success:bE,result:bF,score:bG,confidence:bH};};h.getSameTextTypingPattern=function(bC,bD){var bE;return bD.getTypingPattern((bE={type:1},bE.text=bC,bE.caseSensitive=true,bE));};l.Radio=function(bC,bD,bE,bF,bG){return bc.Element("div",new bl.T({$:1,$0:d.cls("radio"),$1:bD}),[bc.Element("label",bF,[bc.Radio(bG,true,bE),bc.TextNode(bC)])]);};l.checkbox=function(bC,bD,bE,bF,bG){return bc.Element("div",new bl.T({$:1,$0:d.cls("checkbox"),$1:bD}),[bc.Element("label",bF,[bc.CheckBox(bG,bE),bc.TextNode(bC)])]);};l.textArea=function(bC,bD,bE,bF,bG){return bc.Element("div",new bl.T({$:1,$0:d.cls("form-group"),$1:bD}),[bc.Element("label",bF,[bc.TextNode(bC)]),bc.InputArea(new bl.T({$:1,$0:d.cls("form-control"),$1:bG}),bE)]);};l.inputPassword=function(bC,bD,bE,bF,bG){return bc.Element("div",new bl.T({$:1,$0:d.cls("form-group"),$1:bD}),[bc.Element("label",bF,[bc.TextNode(bC)]),bc.PasswordBox(new bl.T({$:1,$0:d.cls("form-control"),$1:bG}),bE)]);};l.input=function(bC,bD,bE,bF,bG){return bc.Element("div",new bl.T({$:1,$0:d.cls("form-group"),$1:bD}),[bc.Element("label",bF,[bc.TextNode(bC)]),bc.Input([d.cls("form-control"),bG],bE)]);};l.btnSecondary=function(bC,bD,bE){return bc.Element("button",[d.eid(bC),d.cls("btn btn-secondary"),bn.Handler("click",bE)],[bc.TextNode(bD)]);};l.btnPrimary=function(bC,bD,bE){return bc.Element("button",[d.eid(bC),d.cls("btn btn-primary"),bn.Handler("click",bE)],[bc.TextNode(bD)]);};o.New=function(bC,bD,bE,bF,bG,bH,bI,bJ,bK){return{tokenFragment:bC,charFragment:bD,babelSynsetID:bE,DBpediaURL:bF,BabelNetURL:bG,score:bH,cohrenceScore:bI,globalScore:bJ,source:bK};};p.New=function(bC,bD){return{start:bC,end:bD};};q.New=function(bC,bD){return{start:bC,end:bD};};n.disambiguate=function(bC){function bD(bE,bF){var bG;bj.ajax((bG={},bG.url=(function(bH){return function(bI){return bH("https://babelfy.io/v1/disambiguate?text="+bh.toSafe(bI)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bC),bG.type="GET",bG.success=function(bH){return bE(bH);},bG.error=function(bH){return bF(new a.Error(bH.responseText));},bG));}return bo.FromContinuations(function(bE,bF,bG){return bD.apply(null,[bE,bF,bG]);});};s.New=function(bC,bD,bE,bF){return{text:bC,intents:bD,entities:bE,traits:bF};};t.New=function(bC,bD,bE){return{id:bC,name:bD,confidence:bE};};u.New=function(bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM){return{id:bC,name:bD,role:bE,start:bF,end:bG,body:bH,confidence:bI,entities:bJ,suggested:bK,value:bL,type:bM};};v.New=function(bC,bD,bE){return{id:bC,value:bD,confidence:bE};};w.New=function(bC){return{intent:bC};};x.New=function(bC){return{value:bC};};r.getMeaning2=function(bC,bD){function bE(bF,bG){var bH;bj.ajax((bH={},bH.url=(function(bI){return function(bJ){return bI("https://api.wit.ai/message?q="+bh.toSafe(bJ));};}(a.id))(bD),bH.type="GET",bH.beforeSend=function(bI){return bI.setRequestHeader("Authorization","Bearer "+bC);},bH.success=function(bI){return bF(bI);},bH.error=function(bI){return bG(new a.Error(bI.responseText));},bH));}return bo.FromContinuations(function(bF,bG,bH){return bE.apply(null,[bF,bG,bH]);});};r.getMeaning=function(bC,bD,bE,bF){var bG;bj.ajax((bG={},bG.url=(function(bH){return function(bI){return bH("https://api.wit.ai/message?q="+bh.toSafe(bI));};}(a.id))(bD),bG.type="GET",bG.beforeSend=function(bH){return bH.setRequestHeader("Authorization","Bearer "+bC);},bG.success=bE,bG.error=bF,bG));};z.New=function(bC){return{question:bC};};A.New=function(bC,bD){return{isContextOnly:bC,prompts:bD};};B.New=function(bC,bD,bE,bF,bG,bH,bI){return{questions:bC,answer:bD,score:bE,id:bF,source:bG,metadata:bH,context:bI};};C.New=function(bC){return{answers:bC};};y.getAnswer=function(bC){function bD(bE,bF){var bG;bj.ajax((bG={},bG.url="https://lerna.azurewebsites.net/qnamaker/knowledgebases/13a6a026-942b-4612-a8cb-654086ec76ee/generateAnswer",bG.type="POST",bG.beforeSend=function(bH){return bH.setRequestHeader("Authorization","EndpointKey e5a55563-b1b0-4343-8796-bda5a0509385");},bG.contentType="application/json",bG.dataType="json",bG.data=bp.stringify(z.New(bC)),bG.success=function(bH){return bE(bH);},bG.error=function(bH){return bF(new a.Error(bH.responseText));},bG));}return bo.FromContinuations(function(bE,bF,bG){return bD.apply(null,[bE,bF,bG]);});};D.waitAddPhrases=function(){E.$cctor();return E.waitAddPhrases;};D.waitRetrievePhrases=function(){E.$cctor();return E.waitRetrievePhrases;};D.helpPhrases=function(){E.$cctor();return E.helpPhrases;};D.helloUserPhrases=function(){E.$cctor();return E.helloUserPhrases;};D.helloPhrases=function(){E.$cctor();return E.helloPhrases;};D["getRandomPhrase'"]=function(bC){return D.replace_tok("$0","",bm.nth(D.rng().Next(0,bC.get_Length()),bC));};D.getRandomPhrase=function(bC,bD){return D.replace_tok("$0",bD,bm.nth(D.rng().Next(0,bC.get_Length()),bC));};D.replace_tok=function(bC,bD,bE){return bk.Replace(bE,bC,bD);};D.rng=function(){E.$cctor();return E.rng;};E.$cctor=function(){E.$cctor=a.ignore;E.rng=new bq.New();E.helloPhrases=bl.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);E.helloUserPhrases=bl.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);E.helpPhrases=bl.ofArray(["What can I help you with $0?"]);E.waitRetrievePhrases=bl.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);E.waitAddPhrases=bl.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};G=F.Intent=$.Class({toString:function(){return((($.Curried3(function(bC,bD,bE){return bC("Intent("+bh.toSafe(bD)+", "+_8.p$2(bE)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);H=F.Trait=$.Class({toString:function(){return((($.Curried3(function(bC,bD,bE){return bC("Trait("+bh.toSafe(bD)+", "+bh.prettyPrint(bE)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,H);I=F.Entity=$.Class({toString:function(){return((((($.Curried(function(bC,bD,bE,bF,bG){return bC("Entity("+bh.toSafe(bD)+", "+bh.toSafe(bE)+", "+bh.toSafe(bF)+", "+_8.p$2(bG)+")");},5))(a.id))(this.get_Name()))(this.get_Role()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$3;},get_Value:function(){return this.$2;},get_Role:function(){return this.$1;},get_Name:function(){return this.$0;}},null,I);J=F.Utterance=$.Class({toString:function(){return(((($.Curried(function(bC,bD,bE,bF){return bC(_8.p(bD)+" "+_8.p$3(bE)+" "+_8.p$5(bF));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bC;bC=this.$3;return bC!=null?{$:1,$0:bl.sortBy(function(bD){return bD.get_Name();},bC.$0)}:null;},get_Traits:function(){var bC;bC=this.$2;return bC!=null?{$:1,$0:bl.sortBy(function(bD){return bD.get_Name();},bC.$0)}:null;},get_Intent:function(){return this.$1;},get_Text:function(){return this.$0;}},null,J);L.New=function(bC,bD,bE,bF,bG){return{body:bC,end:bD,start:bE,suggested:bF,value:bG};};K["Intent'"]=function(bC,bD){return!(bD.intent==null)?{$:1,$0:new G({$:0,$0:d.toLower(bD.intent.value),$1:null})}:null;};K["Trait'"]=function(bC){return!(bC.domain==null)?{$:1,$0:new H({$:0,$0:"domain",$1:d.toLower(bC.domain.value),$2:null})}:!(bC.dialogue_act==null)?{$:1,$0:new H({$:0,$0:"dialogue_act",$1:d.toLower(bC.dialogue_act.value),$2:null})}:null;};K["Entity'$1"]=function(bC){return!(bC.contact==null)?{$:1,$0:new I({$:0,$0:"contact",$1:"",$2:d.toLower(bC.contact.value),$3:null})}:null;};N=M["Utterance'"]=$.Class({get_TopIntent:function(){return bl.head(bl.sortBy(function(bC){return bC.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$3;},get_Entities:function(){return this.$2;},get_Intents:function(){return this.$1;},get_Text:function(){return this.$0;}},null,N);O=M["Intent'"]=$.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,O);P=M["Entity'"]=$.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,P);Q=M["Trait'"]=$.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,Q);M.HasUtterance=function(bC){var bD,bE,bF,bG,bH,bI;return bC!=null&&bC.$==1&&(bC.$0.$2.get_Length()>0&&(bD=[bC.$0.$2,bC.$0.$1,bC,bC.$0.$0,bC.$0.$3],true))?(bE=bD[0],(bF=bD[2],(bG=bD[4],(bH=bD[1].$==0?null:{$:1,$0:new G({$:0,$0:bF.$0.get_TopIntent().get_Name(),$1:{$:1,$0:bF.$0.get_TopIntent().get_Confidence()}})},(bI=bE.$==0?null:{$:1,$0:bl.map(function(bJ){return new I({$:0,$0:bJ.get_Name(),$1:d.toLower(bJ.get_Role()),$2:bJ.get_Value(),$3:{$:1,$0:bJ.get_Confidence()}});},bl.filter(function(bJ){return bJ.get_Confidence()>M.entityConfidenceThreshold();},bE))},{$:1,$0:new J({$:0,$0:bD[3],$1:bH,$2:bG.$==0?null:{$:1,$0:bl.map(function(bJ){return new H({$:0,$0:d.toLower(bJ.get_Name()),$1:bJ.get_Value(),$2:{$:1,$0:bJ.get_Confidence()}});},bl.filter(function(bJ){return bJ.get_Confidence()>M.entityConfidenceThreshold();},bG))},$3:bI})}))))):null;};M.entityConfidenceThreshold=function(){S.$cctor();return S.entityConfidenceThreshold;};M.set_entityConfidenceThreshold=function(bC){S.$cctor();S.entityConfidenceThreshold=bC;};M.intentConfidenceThreshold=function(){S.$cctor();return S.intentConfidenceThreshold;};M.set_intentConfidenceThreshold=function(bC){S.$cctor();S.intentConfidenceThreshold=bC;};M.getUtterance2=function(bC){var bD;bD=null;return bo.Delay(function(){return bo.Bind(r.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bC),function(bE){d.debug("NLU",(function(bF){return function(bG){return bF("Wit.ai returned "+_9.p(bG)+" ");};}(a.id))(bE));return bo.Return(new N({$:0,$0:bC,$1:bl.ofArray(bg.map(function(bF){return new O({$:0,$0:bF.name,$1:bF.confidence});},bE.intents)),$2:bl.map(function(bF){return new P({$:0,$0:bF.name,$1:bF.confidence,$2:bF.role,$3:bF.value});},bl.ofSeq(bm.concat(bm.map(function(bF){return bF[1];},bs.ToSeq(bE.entities))))),$3:bl.ofSeq(bm.map(function(bF){var bG;bG=bF[1];return new Q({$:0,$0:bF[0],$1:bg.get(bG,0).confidence,$2:bg.get(bG,0).value});},bs.ToSeq(bE.traits)))}));});});};M.getUtterance=function(bC,bD){r.getMeaning("OOGDHEQL7JZRQASXN2N2GHFUKGO3SCNV",bC,function(bE){var bF,bG;d.debug("NLU",(function(bH){return function(bI){return bH("Wit.ai returned: "+bh.prettyPrint(bI));};}(a.id))(bE));bF=!(bE.intents==null)?bl.ofArray(bg.map(function(bH){return new O({$:0,$0:bH.name,$1:bH.confidence});},bE.intents)):bl.T.Empty;bG=!(bE.traits==null)?bl.ofSeq(bm.concat(bl.map(function(bH){return bg.map(function(bI){return new Q({$:0,$0:bH,$1:bI.confidence,$2:bI.value});},bu.GetJS(bE.traits,[bH]));},bl.filter(function(bH){return!(bu.GetJS(bE.traits,[bH])==null);},M.trait_types())))):bl.T.Empty;return bD({$:1,$0:new N({$:0,$0:bC,$1:bF,$2:!(bE.entities==null)?bl.ofSeq(bm.concat(bl.map(function(bH){return bg.map(function(bI){return new P({$:0,$0:bI.name,$1:bI.confidence,$2:bI.role,$3:bI.value});},bu.GetJS(bE.entities,[bH]));},bl.filter(function(bH){return!(bu.GetJS(bE.entities,[bH])==null);},M.entity_types())))):bl.T.Empty,$3:bG})});},function(bE,bF,bG){d.error(((($.Curried3(function(bH,bI,bJ){return bH("Wit.ai returned: "+bh.prettyPrint(bI)+" "+bh.prettyPrint(bJ));}))(a.id))(bF))(bG));return bD(null);});};M.trait_types=function(){S.$cctor();return S.trait_types;};M.entity_types=function(){S.$cctor();return S.entity_types;};M.QuickNumber=function(bC){var bD,bE,bF;return(bE=M.One(bC),bE!=null&&bE.$==1?(bD=bE.$0,true):(bF=M.Two(bC),bF!=null&&bF.$==1&&(bD=bF.$0,true)))?{$:1,$0:bD}:null;};M.Three=function(bC){var bD;return bC==="3"||bC==="three"?{$:1,$0:new J({$:0,$0:"three",$1:{$:1,$0:new G({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bl.ofArray([new I({$:0,$0:"wit/ordinal",$1:"",$2:"three",$3:{$:1,$0:1}})])}})}:null;};M.Two=function(bC){var bD;return bC==="2"||bC==="two"?{$:1,$0:new J({$:0,$0:"two",$1:{$:1,$0:new G({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bl.ofArray([new I({$:0,$0:"wit/ordinal",$1:"",$2:"two",$3:{$:1,$0:1}})])}})}:null;};M.One=function(bC){var bD;return bC==="1"||bC==="one"?{$:1,$0:new J({$:0,$0:"one",$1:{$:1,$0:new G({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bl.ofArray([new I({$:0,$0:"wit/ordinal",$1:"",$2:"one",$3:{$:1,$0:1}})])}})}:null;};M.QuickNo=function(bC){var bD;return bC==="no"||(bC==="nope"||(bC==="no way"||(bC==="nah"||(bC==="don't do it"||bC==="stop"))))?{$:1,$0:new J({$:0,$0:"no",$1:{$:1,$0:new G({$:0,$0:"reject",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};M.QuickYes=function(bC){var bD;return bC==="yes"||(bC==="ok"||(bC==="sure"||(bC==="yeah"||(bC==="yep"||(bC==="uh huh"||(bC==="go ahead"||bC==="go"))))))?{$:1,$0:new J({$:0,$0:"yes",$1:{$:1,$0:new G({$:0,$0:"verify",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};M.QuickHelp=function(bC){var bD;return bC==="help"||(bC==="help me"||(bC==="what's this?"||bC==="huh"))?{$:1,$0:new J({$:0,$0:"help",$1:{$:1,$0:new G({$:0,$0:"help",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};M.QuickHello=function(bC){var bD;return bC==="hello"||(bC==="hey"||(bC==="yo"||bC==="hi"))?{$:1,$0:new J({$:0,$0:"hello",$1:{$:1,$0:new G({$:0,$0:"greet",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};M.Voices=function(bC){return bC==="voices"?{$:1,$0:null}:null;};M.Debug=function(bC){return bC==="debug"?{$:1,$0:null}:null;};M.Blank=function(bC){return bC===""?{$:1,$0:null}:null;};R.Study=function(bC){return bC.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};F.Str=function(bC){var bD;return bC!=null&&bC.$==1&&(typeof bC.$0=="string"&&(bD=bC.$0,true))?{$:1,$0:bD}:null;};F.No=function(bC){var bD,bE;return(bE=F.Intent$1("reject",bC),bE!=null&&bE.$==1&&(bE.$0[0]==null&&(bE.$0[1]==null&&(bD=bC,true))))?{$:1,$0:bD}:null;};F.Yes=function(bC){var bD,bE;return(bE=F.Intent$1("verify",bC),bE!=null&&bE.$==1&&(bE.$0[0]==null&&(bE.$0[1]==null&&(bD=bC,true))))?{$:1,$0:bD}:null;};F.EntityManyofMany=function(bC,bD){return{$:1,$0:bs.OfArray(bg.ofSeq(bl.map(function(bE){return bl.exists(function(bF){return bF.get_Role()===bE;},bD)?[bE,{$:1,$0:bl.filter(function(bF){return bF.get_Role()===bE;},bD)}]:[bE,null];},bC)))};};F.EntityManyOf1=function(bC,bD){var bE;return bD!=null&&bD.$==1&&(bl.exists(function(bF){return bF.get_Role()===bC;},bD.$0)&&(bE=bD.$0,true))?{$:1,$0:bl.filter(function(bF){return bF.get_Role()===bC;},bE)}:null;};F.Entity1OfAny=function(bC,bD){var bE;return bD!=null&&bD.$==1&&(bl.exists(function(bF){return bF.get_Role()===bC;},bD.$0)&&(bE=bD.$0,true))?{$:1,$0:bl.head(bl.sortBy(function(bF){return bF.get_Role();},bl.filter(function(bF){return bF.get_Role()===bC;},bE)))}:null;};F.Entity1Of1=function(bC,bD){var bE,bF;return bD!=null&&bD.$==1&&(bD.$0.$==1&&(bD.$0.$1.$==0&&((bF=bD.$0.$0,bF.get_Role()===bC||bF.get_Name()===bC)&&(bE=bD.$0.$0,true))))?{$:1,$0:bE}:null;};F.Intent$1=function(bC,bD){return bD.get_Intent()!=null&&bD.get_Intent().$0.get_Name()===bC?{$:1,$0:[bD.get_Traits(),bD.get_Entities()]}:null;};S.$cctor=function(){S.$cctor=a.ignore;S.entity_types=bl.ofArray(["wit$contact:name","wit$datetime:datetime","term:subject","term:object","term:verb"]);S.trait_types=bl.ofArray(["domain","dialogue_act"]);S.intentConfidenceThreshold=0.85;S.entityConfidenceThreshold=0.85;};U.MicReady={$:5};U.MicAudioEnd={$:4};U.MicAudioStart={$:3};U.MicDisconnected={$:2};U.MicConnecting={$:1};U.MicNotInitialized={$:0};V.ClientUnderstand={$:2};V.ClientReady={$:1};V.ClientNotInitialzed={$:0};W=T.Interpreter=$.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,W);X=T.CUI=$.Class({MonitorTypingPattern:function(bC){this.TypingDNA.reset();bC!=null?this.TypingDNA.addTarget(bC.$0):void 0;this.TypingDNA.start();},GetSameTextTypingPattern:function(bC,bD){var bE,bF;return this.TypingDNA.getTypingPattern(bD==null?(bE={type:1},bE.text=bC,bE.caseSensitive=false,bE):(bF={type:1},bF.text=bC,bF.caseSensitive=false,bF.targetId=bD.$0,bF));},SayVoices:function(){var bC,bD,bE;bC=this;bD=a.speechSynthesis.getVoices();!(bD==null)?(bE=d.toArray(bD),bC.Say((function(bF){return function(bG){return bF("There are currently "+a.String(bG)+" voices installed on this computer or device.");};}(a.id))(bg.length(bE))),bg.iteri(function(bF,bG){return bC.Say((((($.Curried(function(bH,bI,bJ,bK){return bH("Voice "+a.String(bI)+". Name: "+bh.toSafe(bJ)+", Local: "+bh.prettyPrint(bK)+".");},4))(a.id))(bF))(bG.name))(bG.localService));},bE)):void 0;},Wait:function(bC){this.Wait$1(function(){bo.Start(bC,null);});},Wait$1:function(bC){this["Echo'"]("please wait...");this.Term.pause();bC();this.Term.resume();},sayRandom:function(bC,bD){this.Say(D.getRandomPhrase(bC,bD));},SayAngry:function(bC){var bD,bE;bD=this;bo.Start((bE=null,bo.Delay(function(){return bo.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bv.chime(),bo.Zero()):bo.Zero(),bo.Delay(function(){a.addMessage(bD.Avatar,bC,"","");bD.Avatar.processMessages(0);return bo.Zero();}));})),null);},SayDoc:function(bC){var bD,bE,bF;bD=bg.get(bj(".terminal-output").get(),0).childNodes.length;bE=bc.Element("div",[d.cls("terminal-command"),d.dindex(bD+1)],[bC]);bF=d.termOutput();bf.LoadLocalTemplates("");bc.RunAppend(bF,bE);},Say:function(bC){var bD,bE;bD=this;bo.Start((bE=null,bo.Delay(function(){return bo.Combine(a.speechSynthesis.speaking?(bv.chime(),bo.Zero()):bo.Zero(),bo.Delay(function(){bD.Avatar.addMessage(bC);bD.Avatar.processMessages(0);return bo.Zero();}));})),null);},Debug:function(bC,bD){d.debug(bC,bD);},"EchoHtml'":function(bC){var bD,bE;bD=(bE={},bE.raw=true,bE);this.Term.disable();this.Term.echo(bC,bD);this.Term.enable();},"Echo'":function(bC){this.Term.disable();this.Term.echo(bC);this.Term.enable();}},null,X);X.New=function(bC,bD,bE,bF,bG,bH,bI){return new X({Voice:bC,Mic:bD,Term:bE,Avatar:bF,Caption:bG,TypingDNA:bH,AudioEnd:bI});};Y=c.Question=$.Class({toString:function(){return((((($.Curried(function(bC,bD,bE,bF,bG){return bC("Name: "+bh.toSafe(bD)+" Text: "+bh.toSafe(bE)+" Type: "+_8.p$8(bF)+" Module: "+bh.toSafe(bG));},5))(a.id))(this.get_Name()))(this.get_Text()))(this.get_Type()))(this.get_Module());},get_Module:function(){return this.$3;},get_Type:function(){return this.$2;},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,Y);Z.ConceptCompletion={$:3};Z.Disjunctive={$:2};Z.Verification={$:1};_0=c.Dialogue=$.Class({get_Utterances:function(){return this.$4;},get_Output:function(){return this.$3;},get_DialogueQuestions:function(){return this.$2;},get_Props:function(){return this.$1;},get_Cui:function(){return this.$0;}},null,_0);_1["Response'_"]=function(bC,bD,bE){var bF,bG,bH;return(bG=_1.PropNotSet_(bC,"user",bE),bG!=null&&bG.$==1&&(bC.get_DialogueQuestions().length>0&&(bC.get_DialogueQuestions())[0].get_Name()===bD&&(bF=bG.$0,true)))?_1.have(bC,bD)?(bH=bC.get_Props().get_Item(bD),(_1["delete"](bC,bD),{$:1,$0:[bF,{$:1,$0:bH}]})):{$:1,$0:[bF,null]}:null;};_1.Response_=function(bC,bD,bE){var bF,bG,bH;return(bG=_1.PropSet_(bC,"user",bE),bG!=null&&bG.$==1&&(bC.get_DialogueQuestions().length>0&&(bC.get_DialogueQuestions())[0].get_Name()===bD&&(bF=bG.$0,true)))?_1.have(bC,bD)?(bH=bC.get_Props().get_Item(bD),(_1["delete"](bC,bD),{$:1,$0:[bF,{$:1,$0:bH}]})):{$:1,$0:[bF,null]}:null;};_1["User'_"]=function(bC,bD){var bE,bF;return(bF=_1.PropNotSet_(bC,"user",bD),bF!=null&&bF.$==1&&(bC.get_DialogueQuestions().length===0&&(bE=bF.$0,true)))?{$:1,$0:bE}:null;};_1.User_=function(bC,bD){var bE,bF;return(bF=_1.PropSet_(bC,"user",bD),bF!=null&&bF.$==1&&(bC.get_DialogueQuestions().length===0&&(bE=bF.$0,true)))?{$:1,$0:bE}:null;};_1.PropNotSet_=function(bC,bD,bE){return!_1.have(bC,bD)?{$:1,$0:bE}:null;};_1.PropSet_=function(bC,bD,bE){return _1.have(bC,bD)?{$:1,$0:bE}:null;};_1.Agenda_=function(bC,bD,bE){return bC.get_DialogueQuestions().length>0&&(bC.get_DialogueQuestions())[0].get_Module()===bD?{$:1,$0:null}:null;};_1.didNotUnderstand=function(bC,bD,bE){var bF;bD((function(bG){return function(bH){return bG(bh.toSafe(bH)+" interpreter did not understand utterance.");};}(a.id))(bE));_1.say(bC,"Sorry I didn't understand what you meant.");bC.get_DialogueQuestions().length>0?(bF=bm.nth(0,bC.get_DialogueQuestions()),_1.have(bC,bF.get_Name())?_1.say(bC,D.replace_tok("$0",bC.get_Props().get_Item(bF.get_Name()),bF.get_Text())):_1.say(bC,bF.get_Text())):void 0;};_1.dispatch=function(bC,bD,bE,bF){bD((((($.Curried(function(bG,bH,bI,bJ){return bG("Dispatch to module "+bh.toSafe(bH)+" utterances: "+bh.prettyPrint(bI)+" questions: "+bh.prettyPrint(bJ)+".");},4))(a.id))(bE))(bC.get_Utterances()))(bC.get_DialogueQuestions()));bF(bC);};_1["handle'"]=function(bC,bD,bE,bF){_1.popt(bC);bD((function(bG){return function(bH){return bG("Turn end: "+bh.toSafe(bH)+".");};}(a.id))(bE));bF();};_1.handle=function(bC,bD,bE,bF){_1.popu(bC);bD((function(bG){return function(bH){return bG("Handle: "+bh.toSafe(bH)+".");};}(a.id))(bE));bF();};_1.ask=function(bC,bD,bE,bF){var bG,bH,bI;_1.pushq(bC,bF);bG=bF.get_Type();bG.$==0?(bH=bG.$0,bC.get_Cui().TypingDNA.reset(),d.questionBox("Biometric Authentication","",640,480,function(){var bJ,bK;bJ=bC.get_Cui().GetSameTextTypingPattern("Hello my name is John Brown and I am an administrator",null);bD("Text pattern: "+bJ);bK=bg.get(bj(".swal2-content").get(),0).firstChild.firstChild;(bH(bJ))(bK);}),bg.get(bj(".swal2-input").get(),0).setAttribute("id","auth-input"),bC.get_Cui().MonitorTypingPattern(null),bI=d.createCanvas("camera","640","480",bg.get(bj(".swal2-content").get(),0).firstChild),d.startCamera(self.document.body,bI)):void 0;};_1.popt=function(bC){_1.popu(bC);_1.popq(bC);};_1.popq=function(bC){bC.get_DialogueQuestions().shift();};_1.pushq=function(bC,bD){bC.get_DialogueQuestions().unshift(bD);};_1.popu=function(bC){bC.get_Utterances().shift();};_1.pushu=function(bC,bD){bC.get_Utterances().unshift(bD);};_1.prop=function(bC,bD){return bC.get_Props().get_Item(bD);};_1["delete"]=function(bC,bD){bC.get_Props().Remove(bD);};_1.add=function(bC,bD,bE){bC.get_Props().Add(bD,bE);};_1.have=function(bC,bD){return bC.get_Props().ContainsKey(bD);};_1["sayRandom'"]=function(bC,bD){_1.sayRandom(bC,bD,"");};_1.sayRandom=function(bC,bD,bE){var bF;bF=D.getRandomPhrase(bD,bE);bC.get_Output().unshift(bF);bC.get_Cui().Say(bF);};_1.say=function(bC,bD){bC.get_Output().unshift(bD);_1["say'"](bC,bD);};_1["say'"]=function(bC,bD){bC.get_Cui().Say(bD);};_1.echo=function(bC,bD){(bC.get_Cui())["EchoHtml'"](bD);};_2.update=function(bC){var bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp;function cq(cI){_1.echo(bC,cI);}function cr(cI){_1.say(bC,cI);}function cs(cI,cJ){return _1.sayRandom(bC,cI,cJ);}function ct(cI,cJ){return _1.add(bC,cI,cJ);}function cu(cI){return _1.prop(bC,cI);}function cv(){return cu("user");}function cw(cI){_2.debug(cI);}function cx(cI){_2.debug(cI);}function cy(cI){return _1.User_(bC,cI);}function cz(cI){return _1["User'_"](bC,cI);}function cA(cI,cJ){return _1.Response_(bC,cI,cJ);}function cB(cI){return new Y({$:0,$0:"authenticateUser",$1:"",$2:{$:0,$0:function(cJ){return function(){var cK;return cJ==null?bG.Say("Sorry I could not authenticate your pass phrase."):bo.Start((cK=null,bo.Delay(function(){return bo.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.verifyUserTypingPattern:-697060909",["john",cI]),function(cL){_2.debug((function(cM){return function(cN){return cM("TypingDNA: "+_8.p$9(cN));};}(a.id))(cL));return cL.$==1?(d.error(cL.$0),bo.Zero()):cL.$0.confidence>50?(bG.Say("You are now authenticated."),bo.Zero()):(bG.Say("Sorry I could not authenticate your passphrase."),bo.Zero());});})),null);};}},$3:_2.name()});}function cC(cI){return new Y({$:0,$0:"addUser",$1:(function(cJ){return function(cK){return cJ("Do you want me to add the user "+bh.toSafe(cK)+"?");};}(a.id))(cI),$2:Z.Verification,$3:_2.name()});}function cD(cI){return new Y({$:0,$0:"switchUser",$1:(function(cJ){return function(cK){return cJ("Do you want me to switch to the user "+bh.toSafe(cK));};}(a.id))(cI),$2:Z.Verification,$3:_2.name()});}function cE(cI){var cJ;cs(D.waitRetrievePhrases(),"user name");bo.Start((cJ=null,bo.Delay(function(){return bo.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:1952335863",[cI]),function(cK){var cL;return cK==null?(cr((function(cM){return function(cN){return cM("I did not find a user with the name "+bh.toSafe(cN)+".");};}(a.id))(cI)),(bH(function(cM){_2.update(cM);}))(cC(cI)),bo.Zero()):(cL=cK.$0,bo.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:-1518036560",[cL.Name]),function(){ct("user",cL);cs(D.helloUserPhrases(),(function(cM){return function(cN){return cM(bh.prettyPrint(cN));};}(a.id))(bE.get_Item("user")));return cL.LastLoggedIn!=null?bo.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:296374240",[cL.LastLoggedIn.$0]),function(cM){cr((function(cN){return function(cO){return cN("You last logged in "+bh.toSafe(cO)+".");};}(a.id))(cM));cr("Since you will be accessing sensitive data I need to authenticate you via facial recognition and typing behaviour. Enter the pass phrase you were assigned during enrollment in the box provided. Then, look into your camera until you see the red box around your face and press the Ok button.");(bH(function(cN){_2.update(cN);}))(cB(cI));return bo.Zero();}):bo.Zero();}));});})),null);}function cF(cI,cJ){var cK;return bo.Start((cK=null,bo.Delay(function(){cs(D.waitAddPhrases(),"user");return bo.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:-1518036560",[cI]),function(cL){return cL.$==1?(cr((function(cM){return function(cN){return cM("Sorry I was not able to add the user "+bh.toSafe(cN)+" to the system.");};}(a.id))(cI)),bo.Zero()):bo.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.addUserTypingPattern:2129763137",[cI,cJ]),function(cM){return cM.$==1?(cr((function(cN){return function(cO){return cN("Sorry I was not able to add the user "+bh.toSafe(cO)+" to the system.");};}(a.id))(cI)),bo.Zero()):(ct("user",cI),cr((function(cN){return function(cO){return cN("Hello "+bh.prettyPrint(cO)+", nice to meet you.");};}(a.id))(bE.get_Item("user"))),bo.Zero());});});})),null);}function cG(cI,cJ,cK){var cL;return bo.Start((cL=null,bo.Delay(function(){cs(D.waitAddPhrases(),"symptom entry");return bo.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:1931294837",[cv().Name,cI,cJ,cK]),function(cM){return cM.$==1?(cr(function(cN){return cN("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),bo.Zero()):(cr((function(cN){return function(cO){return cN("OK I added that "+bh.toSafe(cO)+" symptom to your journal.");};}(a.id))(cI)),bo.Zero());});})),null);}function cH(cI){_2.debug(cI);}bD=bC.$4;bE=bC.$1;bF=bC.$2;bG=bC.$0;bH=$.Curried(_1.ask,2,[bC,cw]);bI=$.Curried(_1.handle,2,[bC,cx]);_2.debug(((($.Curried3(function(cI,cJ,cK){return cI("Starting utterances:"+bh.prettyPrint(cJ)+". Starting questions: "+bh.prettyPrint(cK)+".");}))(a.id))(bD))(bF));bJ=bl.ofSeq(bm.take(bD.length>=5?5:bD.length,bD));bJ.$==1&&(bL=cz(bJ.$0),bL!=null&&bL.$==1&&(bM=F.Intent$1("greet",bL.$0),bM!=null&&bM.$==1&&(bN=F.Entity1Of1("name",bM.$0[1]),bN!=null&&bN.$==1&&(bJ.$1.$==0&&(bK=bN.$0,true)))))?(bI("loginUser"))(function(){cE(bK.get_Value());}):bJ.$==1&&(bP=cz(bJ.$0),bP!=null&&bP.$==1&&(bQ=F.Intent$1("hello",bP.$0),bQ!=null&&bQ.$==1&&(bR=F.Entity1Of1("contact",bQ.$0[1]),bR!=null&&bR.$==1&&(bJ.$1.$==0&&(bO=bR.$0,true)))))?(bI("loginUser"))(function(){cE(bO.get_Value());}):bJ.$==1&&(bT=_1["Response'_"](bC,"inputPassPhrase",bJ.$0),bT!=null&&bT.$==1&&(bU=F.Str(bT.$0[1]),bU!=null&&bU.$==1&&(bJ.$1.$==0&&(bS=bU.$0,true))))?(($.Curried(_1["handle'"],2,[bC,cH]))("addUser"))(function(){bG.TypingDNA.stop();cF(bS,bG.GetSameTextTypingPattern(bS,null));}):bJ.$==1&&(bW=cy(bJ.$0),bW!=null&&bW.$==1&&(bX=F.Intent$1("hello",bW.$0),bX!=null&&bX.$==1&&(bX.$0[0]==null&&(bY=F.Entity1Of1("name",bX.$0[1]),bY!=null&&bY.$==1&&(bJ.$1.$==0&&(bV=bY.$0,true))))))?bo.Start((bZ=null,bo.Delay(function(){return bo.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:1952335863",[bV.get_Value()]),function(cI){return cI==null?(cr((function(cJ){return function(cK){return cJ("Sorry, the user "+bh.toSafe(cK)+" does not exist.");};}(a.id))(bV.get_Value())),bo.Zero()):((bH(function(cJ){_2.update(cJ);}))(cD(cI.$0.Name)),bo.Zero());});})),null):bJ.$==1&&(b1=F.Yes(bJ.$0),b1!=null&&b1.$==1&&(b2=cA("switchUser",b1.$0),b2!=null&&b2.$==1&&(b3=F.Str(b2.$0[1]),b3!=null&&b3.$==1&&(bJ.$1.$==0&&(b0=b3.$0,true)))))?(bE.set_Item("user",b0),cr((function(cI){return function(cJ){return cI("Ok I switched to user "+bh.prettyPrint(cJ)+".");};}(a.id))(b0))):bJ.$==1&&(b5=F.No(bJ.$0),b5!=null&&b5.$==1&&(b6=cA("switchUser",b5.$0),b6!=null&&b6.$==1&&(b7=F.Str(b6.$0[1]),b7!=null&&b7.$==1&&(bJ.$1.$==0&&(b4=b7.$0,true)))))?cr((function(cI){return function(cJ){return cI("Ok I did not switch to user "+bh.toSafe(cJ)+".");};}(a.id))(b4)):bJ.$==1&&(b9=cz(bJ.$0),b9!=null&&b9.$==1?(b_=F.Intent$1("kbquery",b9.$0),b_!=null&&b_.$==1)?bJ.$1.$==0&&(b8=b9.$0,true):(b$=cy(bJ.$0),b$!=null&&b$.$==1&&((ca=F.Intent$1("kbquery",b$.$0),ca!=null&&ca.$==1)&&(bJ.$1.$==0&&(b8=b$.$0,true)))):(cb=cy(bJ.$0),cb!=null&&cb.$==1&&((cc=F.Intent$1("kbquery",cb.$0),cc!=null&&cc.$==1)&&(bJ.$1.$==0&&(b8=cb.$0,true)))))?bo.Start((cd=null,bo.Delay(function(){return bo.Bind(y.getAnswer(b8.get_Text()),function(cI){var cJ;return bo.Bind((cJ=bg.get(cI.answers,0).answer,(new bx.New()).Async("SMApp.Web:SMApp.Web.Server.mdtohtml:1581252605",[cJ])),function(cK){var cL;return bo.Bind((cL=bg.get(cI.answers,0).answer,(new bx.New()).Async("SMApp.Web:SMApp.Web.Server.mdtotext:1581252605",[cL])),function(cM){cq(cK);cr(cM);return bo.Zero();});});});})),null):bJ.$==1&&(cf=cy(bJ.$0),cf!=null&&cf.$==1&&(cg=F.Intent$1("symptom",cf.$0),cg!=null&&cg.$==1&&(ch=F.Entity1OfAny("symptom_name",cg.$0[1]),ch!=null&&ch.$==1&&(bJ.$1.$==0&&(ce=ch.$0,true)))))?bo.Start((ci=null,bo.Delay(function(){cr("Ok I'll add that entry to your symptom journal");cG(ce.get_Value(),null,null);return bo.Zero();})),null):bJ.$==1&&(ck=F.Yes(bJ.$0),ck!=null&&ck.$==1&&((cl=cA("painVideo",ck.$0),cl!=null&&cl.$==1)&&bJ.$1.$==0))?bG["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bJ.$==1&&(cn=cy(bJ.$0),cn!=null&&cn.$==1&&(co=F.Intent$1("medjournal",cn.$0),co!=null&&co.$==1&&((cp=co.$0[1],cp!=null&&cp.$==1)&&(bJ.$1.$==0&&(cm=co.$0[1].$0,true)))))?(cr("ok I added that entry to your medication journal."),cr("You should be careful not to take too many painkillers over a short period of time.")):_1.didNotUnderstand(bC,function(cI){_2.debug(cI);},_2.name());_2.debug(((($.Curried3(function(cI,cJ,cK){return cI("Ending utterances: "+bh.prettyPrint(cJ)+". Ending questions:"+bh.prettyPrint(cK)+".");}))(a.id))(bD))(bF));};_2.debug=function(bC){d.debug(_2.name(),bC);};_2.name=function(){_3.$cctor();return _3.name;};_3.$cctor=function(){_3.$cctor=a.ignore;_3.name="User";};_4.update=function(bC){var bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY;function bZ(b4){_1.say(bC,b4);}function b0(b4){_1["sayRandom'"](bC,b4);}function b1(b4){_4.debug(b4);}function b2(b4){_4.debug(b4);}function b3(b4){return _1["User'_"](bC,b4);}bD=bC.$4;bE=bC.$2;_4.debug(((($.Curried3(function(b4,b5,b6){return b4("Starting utterances:"+bh.prettyPrint(b5)+". Starting questions: "+bh.prettyPrint(b6)+".");}))(a.id))(bD))(bE));bF=$.Curried(_1.dispatch,2,[bC,b1]);bG=$.Curried(_1.handle,2,[bC,b2]);bH=bl.ofSeq(bm.take(bD.length>=5?5:bD.length,bD));bI=_1.Agenda_(bC,_2.name(),bH);bI!=null&&bI.$==1?_2.update(bC):bH.$==1&&(bK=(bL=_1.PropNotSet_(bC,"started",bH.$0),bL!=null&&bL.$==1?{$:1,$0:bL.$0}:null),bK!=null&&bK.$==1&&(bM=b3(bK.$0),bM!=null&&bM.$==1&&(bN=F.Intent$1("greet",bM.$0),bN!=null&&bN.$==1&&(bN.$0[1]==null&&bH.$1.$==0))))?(_1.add(bC,"started",true),(bG("Hello"))(function(){b0(D.helloPhrases());})):bH.$==1&&(bP=b3(bH.$0),bP!=null&&bP.$==1&&(bQ=F.Intent$1("greet",bP.$0),bQ!=null&&bQ.$==1&&(bQ.$0[1]==null&&bH.$1.$==0)))?(bG("Hello"))(function(){bZ("Hello, tell me your name to get started.");}):bH.$==1&&(bS=b3(bH.$0),bS!=null&&bS.$==1&&(bT=F.Intent$1("greet",bS.$0),bT!=null&&bT.$==1&&((bU=F.Entity1Of1("name",bT.$0[1]),bU!=null&&bU.$==1)&&bH.$1.$==0)))?(bF(_2.name()))(function(b4){_2.update(b4);}):bH.$==1&&(bW=b3(bH.$0),bW!=null&&bW.$==1&&(bX=F.Intent$1("hello",bW.$0),bX!=null&&bX.$==1&&((bY=F.Entity1Of1("contact",bX.$0[1]),bY!=null&&bY.$==1)&&bH.$1.$==0)))?(bF(_2.name()))(function(b4){_2.update(b4);}):_1.didNotUnderstand(bC,function(b4){_4.debug(b4);},_4.name());_4.debug(((($.Curried3(function(b4,b5,b6){return b4("Ending utterances: "+bh.prettyPrint(b5)+". Ending questions:"+bh.prettyPrint(b6)+".");}))(a.id))(bD))(bE));};_4.debug=function(bC){d.debug(_4.name(),bC);};_4.name=function(){_5.$cctor();return _5.name;};_5.$cctor=function(){_5.$cctor=a.ignore;_5.name="Main";};_6.run=function(){var bC,bD;bC=$.ThisFunc(function(bE,bF){return((_6.Main().get_Text())(bE))(bF);});bD=_6.Main().get_Options();a.$("#term").terminal(bC,bD);return bc.get_Empty();};_6.Main=function(){_7.$cctor();return _7.Main;};_6.initMic=function(bC){var bD,bE;_6.set_CUI((bD={$:1,$0:new by.Microphone(bz.getElementById("microphone"))},X.New(_6.CUI().Voice,bD,_6.CUI().Term,_6.CUI().Avatar,_6.CUI().Caption,_6.CUI().TypingDNA,_6.CUI().AudioEnd)));bE=_6.CUI().Mic.$0;bE.onconnecting=function(){_6.set_MicState(U.MicConnecting);return _6.debug("Mic connecting...");};bE.ondisconnected=function(){_6.set_MicState(U.MicDisconnected);return _6.debug("Mic disconnected.");};bE.onaudiostart=function(){_6.set_MicState(U.MicAudioStart);return _6.debug("Mic audio start...");};bE.onaudioend=function(){_6.set_MicState(U.MicAudioEnd);_6.debug("Mic audio end.");return _6.debug(self.lastMicData);};bE.onerror=function(bF){_6.set_MicState({$:6,$0:bF});return _6.debug((function(bG){return function(bH){return bG("Mic error : "+bh.toSafe(bH)+".");};}(a.id))(bF));};bE.onready=function(){_6.set_MicState(U.MicReady);return _6.debug("Mic ready.");};bE.onresult=function(bF,bG){return _6.ClientState().$==2?_6.echo("I'm still trying to understand what you said before."):_6.ClientState().$==0?d.error("Client is not intialized."):!(bF==null||bG==null)?(_6.set_MicState({$:7,$0:bF,$1:bG}),_6.debug(((($.Curried3(function(bH,bI,bJ){return bH("Mic result: "+bh.prettyPrint(bI)+" "+bh.prettyPrint(bJ)+".");}))(a.id))(bF))(bG)),bC(bF,bG)):_6.debug("Mic: No result returned.");};bE.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};_6.sayRandom=function(bC,bD){_6.say(D.getRandomPhrase(bD,bC));};_6.say=function(bC){_6.Output().unshift(bC);_6["say'"](bC);};_6["say'"]=function(bC){_6.CUI().Say(bC);};_6.initSpeech=function(){var bC;bC=d.toArray(_6.synth().getVoices());bg.length(bC)>0?(bg.iter(function(bD){if(bA.Equals(_6.CUI().Voice,null)&&(bD.name.indexOf("Microsoft Zira")!=-1||bD.name.toLowerCase().indexOf("female")!=-1)){_6.set_CUI(X.New({$:1,$0:bD},_6.CUI().Mic,_6.CUI().Term,_6.CUI().Avatar,_6.CUI().Caption,_6.CUI().TypingDNA,_6.CUI().AudioEnd));_6.debug((function(bE){return function(bF){return bE("Using browser speech synthesis voice "+bh.toSafe(bF)+".");};}(a.id))(_6.CUI().Voice.$0.name));}},bC),!bA.Equals(_6.CUI().Voice,null)?(_6.CUI().Avatar.nativeVoice=true,_6.CUI().Avatar.nativeVoiceName=_6.CUI().Voice.$0.name,_6.debug((function(bD){return function(bE){return bD("Using browser speech synthesis voice "+bh.toSafe(bE)+".");};}(a.id))(_6.CUI().Voice.$0.name))):void 0):void 0;bA.Equals(_6.CUI().Voice,null)?_6.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};_6.synth=function(){_7.$cctor();return _7.synth;};_6.push=function(bC){_6.Utterances().unshift(bC);return _6.Dialogue();};_6.Dialogue=function(){_7.$cctor();return _7.Dialogue;};_6.Utterances=function(){_7.$cctor();return _7.Utterances;};_6.Questions=function(){_7.$cctor();return _7.Questions;};_6.Output=function(){_7.$cctor();return _7.Output;};_6.Props=function(){_7.$cctor();return _7.Props;};_6.wait=function(bC){d["Terminal.Echo'"](_6.CUI().Term,"please wait");_6.CUI().Term.pause();bC();_6.CUI().Term.resume();};_6.debug=function(bC){d.debug("CLIENT",bC);};_6.echo=function(bC){d["Terminal.EchoHtml'"](_6.CUI().Term,(function(bD){return function(bE){return bD(bh.prettyPrint(bE));};}(a.id))(bC));};_6.ClientState=function(){_7.$cctor();return _7.ClientState;};_6.set_ClientState=function(bC){_7.$cctor();_7.ClientState=bC;};_6.MicState=function(){_7.$cctor();return _7.MicState;};_6.set_MicState=function(bC){_7.$cctor();_7.MicState=bC;};_6.CUI=function(){_7.$cctor();return _7.CUI;};_6.set_CUI=function(bC){_7.$cctor();_7.CUI=bC;};_7.$cctor=function(){var bC,bD,bE,bF;_7.$cctor=a.ignore;function bG(bI,bJ){var bK,bL,bM,bN,bO,bP,bQ;_6.debug(((($.Curried3(function(bR,bS,bT){return bR("Voice: "+bh.prettyPrint(bS)+" "+bh.prettyPrint(bT));}))(a.id))(bI))(bJ));bK=(bL=K["Intent'"](bI,bJ),bL!=null&&bL.$==1?{$:1,$0:bL.$0}:null);bM=(bN=K["Trait'"](bJ),bN!=null&&bN.$==1?{$:1,$0:bl.ofArray([bN.$0])}:null);bO=(bP=K["Entity'$1"](bJ),bP!=null&&bP.$==1?{$:1,$0:bl.ofArray([bP.$0])}:null);bK==null&&(bM==null&&bO==null)?void 0:(_6.debug((((($.Curried(function(bR,bS,bT,bU){return bR("Voice: "+_8.p(bS)+" "+_8.p$3(bT)+" "+_8.p$5(bU));},4))(a.id))(bK))(bM))(bO)),_4.update(_6.push(new J({$:0,$0:"",$1:bK,$2:bM,$3:bO}))));}function bH(bI,bJ){var bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU;_6.set_CUI(X.New(_6.CUI().Voice,_6.CUI().Mic,bI,_6.CUI().Avatar,_6.CUI().Caption,_6.CUI().TypingDNA,_6.CUI().AudioEnd));bA.Equals(_6.CUI().Mic,null)?_6.initMic(bG):void 0;bA.Equals(_6.CUI().Voice,null)?_6.initSpeech():void 0;_6.ClientState().$===0?_6.set_ClientState(V.ClientReady):void 0;return(bK=M.Blank(bJ),bK!=null&&bK.$==1)?_6["say'"]("Tell me what you want me to do or ask me a question."):(bL=M.Debug(bJ),bL!=null&&bL.$==1)?(_6.debug((function(bV){return function(bW){return bV("Utterances: "+bh.prettyPrint(bW));};}(a.id))(_6.Utterances())),_6.debug((function(bV){return function(bW){return bV("Questions: "+bh.prettyPrint(bW));};}(a.id))(_6.Questions()))):(bM=M.Voices(bJ),bM!=null&&bM.$==1)?(bN=d.toArray(d.speechSynthesis().getVoices()),(_6["say'"]((function(bV){return function(bW){return bV("There are currently "+a.String(bW)+" voices installed on this computer or device.");};}(a.id))(bg.length(bN))),bg.iteri(function(bV,bW){return _6["say'"]((((($.Curried(function(bX,bY,bZ,b0){return bX("Voice "+a.String(bY)+". Name: "+bh.toSafe(bZ)+", Local: "+bh.prettyPrint(b0)+".");},4))(a.id))(bV))(bW.name))(bW.localService));},bN))):_6.ClientState().$==1?(bP=M.QuickHello(bJ),bP!=null&&bP.$==1?(bO=bP.$0,true):(bQ=M.QuickHelp(bJ),bQ!=null&&bQ.$==1?(bO=bQ.$0,true):(bR=M.QuickYes(bJ),bR!=null&&bR.$==1?(bO=bR.$0,true):(bS=M.QuickNo(bJ),bS!=null&&bS.$==1?(bO=bS.$0,true):(bT=M.QuickNumber(bJ),bT!=null&&bT.$==1&&(bO=bT.$0,true))))))?(_6.debug((function(bV){return function(bW){return bV("Quick Text: "+_8.p$7(bW)+".");};}(a.id))(bO)),_4.update(_6.push(bO)),_6.set_ClientState(V.ClientReady)):_6.CUI().Wait((bU=null,bo.Delay(function(){_6.set_ClientState(V.ClientUnderstand);M.getUtterance(bJ,function(bV){var bW,bX;bW=M.HasUtterance(bV);bW!=null&&bW.$==1?(bX=bW.$0,_6.debug((((($.Curried(function(bY,bZ,b0,b1){return bY("Text: Intent: "+_8.p(bZ)+", Traits: "+_8.p$3(b0)+", Entities: "+_8.p$5(b1)+".");},4))(a.id))(bX.get_Intent()))(bX.get_Traits()))(bX.get_Entities())),_4.update(_6.push(bX))):(_6.debug("Text: Did not receive a meaning from the server."),_6["say'"]("Sorry I did not understand what you said."));});_6.set_ClientState(V.ClientReady);return bo.Zero();}))):_6.ClientState().$==0?d.error("Client is not initialized."):_6["say'"]("I'm still trying to understand what you said before.");}_7.CUI=X.New(null,null,null,(bv.applicationId="4277115329081938617",bC=new a.SDKConnection(),bD=new a.WebAvatar(),bD.version=8.5,bD.connection=bC,bD.avatar="20926186",bD.voice="cmu-slt",bD.voiceMod="default",bD.width=175,bD.createBox(),bD.addMessage(""),bD.processMessages(0),bD),false,(bE=new a.TypingDNA(),(bE.stop(),bE)),[]);_7.MicState=U.MicNotInitialized;_7.ClientState=V.ClientNotInitialzed;_7.Props=new bB.New$5();_7.Output=[];_7.Questions=[];_7.Utterances=[];_7.Dialogue=new _0({$:0,$0:_6.CUI(),$1:_6.Props(),$2:_6.Questions(),$3:_6.Output(),$4:_6.Utterances()});_7.synth=a.speechSynthesis;_7.Main=new W({$:0,$0:function(bI){return bG(bI[0],bI[1]);},$1:[function(bI){return function(bJ){return bH(bI,bJ);};},(bF={},bF.name="Main",bF.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bF.prompt=">",bF)]});};_8.p$8=function(bC){return bC.$==3?"ConceptCompletion":bC.$==2?"Disjunctive":bC.$==1?"Verification":"UserAuthentication <fun>";};_9.p=function(bC){return"{"+("text = "+bh.prettyPrint(bC.text))+"; "+("intents = "+bh.printArray(function(bD){return _9.p$1(bD);},bC.intents))+"; "+("entities = "+bh.prettyPrint(bC.entities))+"; "+("traits = "+bh.prettyPrint(bC.traits))+"}";};_9.p$1=function(bC){return"{"+("id = "+bh.prettyPrint(bC.id))+"; "+("name = "+bh.prettyPrint(bC.name))+"; "+("confidence = "+bh.prettyPrint(bC.confidence))+"}";};_8.p$9=function(bC){return bC.$==1?"Error "+bh.prettyPrint(bC.$0):"Ok "+_9.p$2(bC.$0);};_9.p$2=function(bC){return"{"+("message = "+bh.prettyPrint(bC.message))+"; "+("message_code = "+bh.prettyPrint(bC.message_code))+"; "+("success = "+bh.prettyPrint(bC.success))+"; "+("result = "+bh.prettyPrint(bC.result))+"; "+("score = "+bh.prettyPrint(bC.score))+"; "+("confidence = "+bh.prettyPrint(bC.confidence))+"}";};_8.p$2=function(bC){return bC==null?"null":"Some "+bh.prettyPrint(bC.$0);};_8.p$1=function(bC){return"Intent ("+bh.prettyPrint(bC.$0)+", "+_8.p$2(bC.$1)+")";};_8.p=function(bC){return bC==null?"null":"Some "+_8.p$1(bC.$0);};_8.p$4=function(bC){return"Trait ("+bh.prettyPrint(bC.$0)+", "+bh.prettyPrint(bC.$1)+", "+_8.p$2(bC.$2)+")";};_8.p$3=function(bC){return bC==null?"null":"Some "+bh.printList(function(bD){return _8.p$4(bD);},bC.$0);};_8.p$6=function(bC){return"Entity ("+bh.prettyPrint(bC.$0)+", "+bh.prettyPrint(bC.$1)+", "+bh.prettyPrint(bC.$2)+", "+_8.p$2(bC.$3)+")";};_8.p$5=function(bC){return bC==null?"null":"Some "+bh.printList(function(bD){return _8.p$6(bD);},bC.$0);};_8.p$7=function(bC){return"Utterance ("+bh.prettyPrint(bC.$0)+", "+_8.p(bC.$1)+", "+_8.p$3(bC.$2)+", "+_8.p$5(bC.$3)+")";};}());
