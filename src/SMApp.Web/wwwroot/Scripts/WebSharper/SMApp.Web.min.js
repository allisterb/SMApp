(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=c.Bs=c.Bs||{};i=b.NLU=b.NLU||{};j=i.Babelfy=i.Babelfy||{};k=j.ApiResponse=j.ApiResponse||{};l=j.TokenFragment=j.TokenFragment||{};m=j.CharFragment=j.CharFragment||{};n=i.Witai=i.Witai||{};o=n.Utterance=n.Utterance||{};p=n.Intent=n.Intent||{};q=n.Entity=n.Entity||{};r=n.Trait=n.Trait||{};s=n["Utterance'"]=n["Utterance'"]||{};t=n["Value'"]=n["Value'"]||{};u=i.QnAMaker=i.QnAMaker||{};v=u.ITSQuestion=u.ITSQuestion||{};w=u.ITSAnswerContext=u.ITSAnswerContext||{};x=u.ITSAnswer=u.ITSAnswer||{};y=u.ITSAnswers=u.ITSAnswers||{};z=c.TypingDNA=c.TypingDNA||{};A=z.Response=z.Response||{};B=c.NLG=c.NLG||{};C=a.StartupCode$SMApp_Web$NLG=a.StartupCode$SMApp_Web$NLG||{};D=c.NLU=c.NLU||{};E=D.Intent=D.Intent||{};F=D.Trait=D.Trait||{};G=D.Entity=D.Entity||{};H=D.Utterance=D.Utterance||{};I=D.Question=D.Question||{};J=D.Voice=D.Voice||{};K=J["Entity'"]=J["Entity'"]||{};L=D.Text=D.Text||{};M=L["Utterance'"]=L["Utterance'"]||{};N=L["Intent'"]=L["Intent'"]||{};O=L["Entity'"]=L["Entity'"]||{};P=L["Trait'"]=L["Trait'"]||{};Q=D.Domain=D.Domain||{};R=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};S=c.CUI=c.CUI||{};T=S.MicState=S.MicState||{};U=S.ClientState=S.ClientState||{};V=S.Interpreter=S.Interpreter||{};W=S.CUI=S.CUI||{};X=c.Dialogue=c.Dialogue||{};Y=X.Dialogue=X.Dialogue||{};Z=c.User=c.User||{};_0=a.StartupCode$SMApp_Web$User=a.StartupCode$SMApp_Web$User||{};_1=c.Main=c.Main||{};_2=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};_3=c.Client=c.Client||{};_4=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};_5=a.GeneratedPrintf=a.GeneratedPrintf||{};_6=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};_7=a.WebSharper;_8=_7&&_7.UI;_9=_8&&_8.Client;_=_9&&_9.Templates;$=_8&&_8.Doc;ba=_8&&_8.AttrProxy;bb=_7&&_7.Arrays;bc=a.IntelliFactory;bd=bc&&bc.Runtime;be=_7&&_7.Utils;bf=a.console;bg=a.jQuery;bh=_7&&_7.Strings;bi=_7&&_7.List;bj=_7&&_7.Seq;bk=_8&&_8.AttrModule;bl=_7&&_7.Concurrency;bm=a.JSON;bn=_7&&_7.Random;bo=_7&&_7.Collections;bp=bo&&bo.Map;bq=_7&&_7.JavaScript;br=bq&&bq.Pervasives;bs=a.SDK;bt=_7&&_7.Operators;bu=_7&&_7.Remoting;bv=bu&&bu.AjaxRemotingProvider;bw=a.Wit;bx=a.document;by=_7&&_7.Unchecked;bz=bo&&bo.Dictionary;d.speechSynthesis=function(){return a.speechSynthesis;};d.elementHTML=function(bA){return bA.innerHTML;};d.createElement=function(bA){var bB;bB=self.document.createElement("div");_.LoadLocalTemplates("");$.RunAppend(bB,bA);};d.container=function(bA){return $.Element("div",[d.cls("container")],bA);};d.dindex=function(bA){return ba.Create("data-index",a.String(bA));};d.cls=function(bA){return ba.Create("class",bA);};d.eid=function(bA){return ba.Create("id",bA);};d.termOutput=function(){return bb.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(bA){return bA.toLowerCase();};d.debug=function(bA,bB){d.info((((bd.Curried3(function(bC,bD,bE){return bC("DEBUG: "+be.toSafe(bD)+": "+be.prettyPrint(bE));}))(a.id))(bA.toUpperCase()))(bB));};d.error=function(bA){bf.error(bA);};d.info=function(bA){bf.info(bA);};d.jserror=function(bA){bg.error(bA);};d.toArray=function(bA){return bb.map(a.id,bg.makeArray(bA));};d["Terminal.EchoHtml'"]=function(bA,bB){bA.pause();bA.echo(bB,d.rawOpt());bA.resume();};d["Terminal.Echo'"]=function(bA,bB){bA.pause();bA.echo(bB);bA.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=bd.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(bA){function bB(bC){return function(bD){var bE,bF,bG,bH,bI,bJ,bK;bF=bh.replicate(bC," ");switch(bD.$==0?bD.$1.$==1?bD.$1.$0.$==2?bD.$1.$1.$==0?(bE=[bD.$1.$0.$0,bD.$0],1):(bE=[bD.$1,bD.$0],2):(bE=[bD.$1,bD.$0],2):(bE=[bD.$1,bD.$0],2):bD.$==2?(bE=bD.$0,3):(bE=[bD.$0,bD.$1],0)){case 0:return bE[0]+"=\""+bE[1]+"\"";case 1:bG=bE[1];return bF+"<"+bG+">"+bE[0]+"</"+bG+">\r\n";case 2:bH=bE[1];bI=bi.partition(function(bL){return bL.$==1;},bE[0]);bJ=bI[1];bK=bI[0];return bJ.$==0?bF+"<"+bH+(bK.$===0?"":" "+bh.concat(" ",bi.ofSeq(bj.delay(function(){return bj.map(function(bL){return(bB(0))(bL);},bK);}))))+"/>\r\n":bF+"<"+bH+(bK.$===0?"":" "+bh.concat(" ",bi.ofSeq(bj.delay(function(){return bj.map(function(bL){return(bB(0))(bL);},bK);}))))+">\r\n"+bh.concat("",bi.ofSeq(bj.delay(function(){return bj.map(function(bL){return(bB(bC+1))(bL);},bJ);})))+bF+"</"+bH+">\r\n";case 3:return bF+bE+"\r\n";}};}return(bB(0))(bA);};f.alt=function(bA){return new e({$:1,$0:"alt",$1:bA});};f.src=function(bA){return new e({$:1,$0:"src",$1:bA});};f.cls=function(bA){return new e({$:1,$0:"class",$1:bA});};f.str=function(bA){return e.toString(bA);};f.op_PercentEquals=function(bA,bB){return new e({$:1,$0:bA,$1:bB});};f.op_Splice=function(bA){var bB;return bi.ofArray([new e({$:2,$0:(bB=bA,a.String(bB))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(bA,bB){return new e({$:0,$0:bA,$1:bB});};g.$cctor=function(){var bA;g.$cctor=a.ignore;g.rawOpt=(bA={},bA.raw=true,bA);g.html=function(bB){return f.elem("html",bB);};g.head=function(bB){return f.elem("head",bB);};g.title=function(bB){return f.elem("title",bB);};g.style=function(bB){return f.elem("style",bB);};g.body=function(bB){return f.elem("body",bB);};g.div=function(bB){return f.elem("div",bB);};g.br=function(bB){return f.elem("br",bB);};g.section=function(bB){return f.elem("section",bB);};g.span=function(bB){return f.elem("span",bB);};g.table=function(bB){return f.elem("table",bB);};g.thead=function(bB){return f.elem("thead",bB);};g.tbody=function(bB){return f.elem("tbody",bB);};g.tfoot=function(bB){return f.elem("tfoot",bB);};g.img=function(bB){return f.elem("img",bB);};g.map=function(bB){return f.elem("map",bB);};g.area=function(bB){return f.elem("area",bB);};g.p=function(bB){return f.elem("p",bB);};g.a=function(bB){return f.elem("a",bB);};g.tr=function(bB){return f.elem("tr",bB);};g.td=function(bB){return f.elem("td",bB);};g.th=function(bB){return f.elem("th",bB);};g.ul=function(bB){return f.elem("ul",bB);};g.li=function(bB){return f.elem("li",bB);};g.h1=function(bB){return f.elem("h1",bB);};g.h2=function(bB){return f.elem("h1",bB);};g.h3=function(bB){return f.elem("h1",bB);};g.h4=function(bB){return f.elem("h1",bB);};g.strong=function(bB){return f.elem("strong",bB);};};h.Radio=function(bA,bB,bC,bD,bE){return $.Element("div",new bi.T({$:1,$0:d.cls("radio"),$1:bB}),[$.Element("label",bD,[$.Radio(bE,true,bC),$.TextNode(bA)])]);};h.checkbox=function(bA,bB,bC,bD,bE){return $.Element("div",new bi.T({$:1,$0:d.cls("checkbox"),$1:bB}),[$.Element("label",bD,[$.CheckBox(bE,bC),$.TextNode(bA)])]);};h.textArea=function(bA,bB,bC,bD,bE){return $.Element("div",new bi.T({$:1,$0:d.cls("form-group"),$1:bB}),[$.Element("label",bD,[$.TextNode(bA)]),$.InputArea(new bi.T({$:1,$0:d.cls("form-control"),$1:bE}),bC)]);};h.inputPassword=function(bA,bB,bC,bD,bE){return $.Element("div",new bi.T({$:1,$0:d.cls("form-group"),$1:bB}),[$.Element("label",bD,[$.TextNode(bA)]),$.PasswordBox(new bi.T({$:1,$0:d.cls("form-control"),$1:bE}),bC)]);};h.input=function(bA,bB,bC,bD,bE){return $.Element("div",new bi.T({$:1,$0:d.cls("form-group"),$1:bB}),[$.Element("label",bD,[$.TextNode(bA)]),$.Input([d.cls("form-control"),bE],bC)]);};h.btnSecondary=function(bA,bB,bC){return $.Element("button",[d.eid(bA),d.cls("btn btn-secondary"),bk.Handler("click",bC)],[$.TextNode(bB)]);};h.btnPrimary=function(bA,bB,bC){return $.Element("button",[d.eid(bA),d.cls("btn btn-primary"),bk.Handler("click",bC)],[$.TextNode(bB)]);};k.New=function(bA,bB,bC,bD,bE,bF,bG,bH,bI){return{tokenFragment:bA,charFragment:bB,babelSynsetID:bC,DBpediaURL:bD,BabelNetURL:bE,score:bF,cohrenceScore:bG,globalScore:bH,source:bI};};l.New=function(bA,bB){return{start:bA,end:bB};};m.New=function(bA,bB){return{start:bA,end:bB};};j.disambiguate=function(bA){function bB(bC,bD){var bE;bg.ajax((bE={},bE.url=(function(bF){return function(bG){return bF("https://babelfy.io/v1/disambiguate?text="+be.toSafe(bG)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bA),bE.type="GET",bE.success=function(bF){return bC(bF);},bE.error=function(bF){return bD(new a.Error(bF.responseText));},bE));}return bl.FromContinuations(function(bC,bD,bE){return bB.apply(null,[bC,bD,bE]);});};o.New=function(bA,bB,bC,bD){return{text:bA,intents:bB,entities:bC,traits:bD};};p.New=function(bA,bB,bC){return{id:bA,name:bB,confidence:bC};};q.New=function(bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK){return{id:bA,name:bB,role:bC,start:bD,end:bE,body:bF,confidence:bG,entities:bH,suggested:bI,value:bJ,type:bK};};r.New=function(bA,bB,bC){return{id:bA,value:bB,confidence:bC};};s.New=function(bA){return{intent:bA};};t.New=function(bA){return{value:bA};};n.getMeaning2=function(bA,bB){function bC(bD,bE){var bF;bg.ajax((bF={},bF.url=(function(bG){return function(bH){return bG("https://api.wit.ai/message?q="+be.toSafe(bH));};}(a.id))(bB),bF.type="GET",bF.beforeSend=function(bG){return bG.setRequestHeader("Authorization","Bearer "+bA);},bF.success=function(bG){return bD(bG);},bF.error=function(bG){return bE(new a.Error(bG.responseText));},bF));}return bl.FromContinuations(function(bD,bE,bF){return bC.apply(null,[bD,bE,bF]);});};n.getMeaning=function(bA,bB,bC,bD){var bE;bg.ajax((bE={},bE.url=(function(bF){return function(bG){return bF("https://api.wit.ai/message?q="+be.toSafe(bG));};}(a.id))(bB),bE.type="GET",bE.beforeSend=function(bF){return bF.setRequestHeader("Authorization","Bearer "+bA);},bE.success=bC,bE.error=bD,bE));};v.New=function(bA){return{question:bA};};w.New=function(bA,bB){return{isContextOnly:bA,prompts:bB};};x.New=function(bA,bB,bC,bD,bE,bF,bG){return{questions:bA,answer:bB,score:bC,id:bD,source:bE,metadata:bF,context:bG};};y.New=function(bA){return{answers:bA};};u.getAnswer=function(bA){function bB(bC,bD){var bE;bg.ajax((bE={},bE.url="https://lerna.azurewebsites.net/qnamaker/knowledgebases/13a6a026-942b-4612-a8cb-654086ec76ee/generateAnswer",bE.type="POST",bE.beforeSend=function(bF){return bF.setRequestHeader("Authorization","EndpointKey e5a55563-b1b0-4343-8796-bda5a0509385");},bE.contentType="application/json",bE.dataType="json",bE.data=bm.stringify(v.New(bA)),bE.success=function(bF){return bC(bF);},bE.error=function(bF){return bD(new a.Error(bF.responseText));},bE));}return bl.FromContinuations(function(bC,bD,bE){return bB.apply(null,[bC,bD,bE]);});};A.New=function(bA,bB,bC,bD){return{name:bA,message:bB,message_code:bC,status:bD};};B.waitAddPhrases=function(){C.$cctor();return C.waitAddPhrases;};B.waitRetrievePhrases=function(){C.$cctor();return C.waitRetrievePhrases;};B.helpPhrases=function(){C.$cctor();return C.helpPhrases;};B.helloUserPhrases=function(){C.$cctor();return C.helloUserPhrases;};B.helloPhrases=function(){C.$cctor();return C.helloPhrases;};B["getRandomPhrase'"]=function(bA){return B.replace_tok("$0","",bj.nth(B.rng().Next(0,bA.get_Length()),bA));};B.getRandomPhrase=function(bA,bB){return B.replace_tok("$0",bB,bj.nth(B.rng().Next(0,bA.get_Length()),bA));};B.replace_tok=function(bA,bB,bC){return bh.Replace(bC,bA,bB);};B.rng=function(){C.$cctor();return C.rng;};C.$cctor=function(){C.$cctor=a.ignore;C.rng=new bn.New();C.helloPhrases=bi.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);C.helloUserPhrases=bi.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);C.helpPhrases=bi.ofArray(["What can I help you with $0?"]);C.waitRetrievePhrases=bi.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);C.waitAddPhrases=bi.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};E=D.Intent=bd.Class({toString:function(){return(((bd.Curried3(function(bA,bB,bC){return bA("Intent("+be.toSafe(bB)+", "+_6.p$2(bC)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,E);F=D.Trait=bd.Class({toString:function(){return(((bd.Curried3(function(bA,bB,bC){return bA("Trait("+be.toSafe(bB)+", "+be.prettyPrint(bC)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,F);G=D.Entity=bd.Class({toString:function(){return(((((bd.Curried(function(bA,bB,bC,bD,bE){return bA("Entity("+be.toSafe(bB)+", "+be.toSafe(bC)+", "+be.toSafe(bD)+", "+_6.p$2(bE)+")");},5))(a.id))(this.get_Name()))(this.get_Role()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$3;},get_Value:function(){return this.$2;},get_Role:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);H=D.Utterance=bd.Class({toString:function(){return((((bd.Curried(function(bA,bB,bC,bD){return bA(_6.p(bB)+" "+_6.p$3(bC)+" "+_6.p$5(bD));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bA;bA=this.$3;return bA!=null?{$:1,$0:bi.sortBy(function(bB){return bB.get_Name();},bA.$0)}:null;},get_Traits:function(){var bA;bA=this.$2;return bA!=null?{$:1,$0:bi.sortBy(function(bB){return bB.get_Name();},bA.$0)}:null;},get_Intent:function(){return this.$1;},get_Text:function(){return this.$0;}},null,H);I=D.Question=bd.Class({toString:function(){return(((bd.Curried3(function(bA,bB,bC){return bA("Name: "+be.toSafe(bB)+" Text: "+be.toSafe(bC));}))(a.id))(this.get_Name()))(this.get_Text());},get_Module:function(){return this.$3;},get_Type:function(){return this.$2;},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,I);K.New=function(bA,bB,bC,bD,bE){return{body:bA,end:bB,start:bC,suggested:bD,value:bE};};J["Intent'"]=function(bA,bB){return!(bB.intent==null)?{$:1,$0:new E({$:0,$0:d.toLower(bB.intent.value),$1:null})}:null;};J["Trait'"]=function(bA){return!(bA.domain==null)?{$:1,$0:new F({$:0,$0:"domain",$1:d.toLower(bA.domain.value),$2:null})}:!(bA.dialogue_act==null)?{$:1,$0:new F({$:0,$0:"dialogue_act",$1:d.toLower(bA.dialogue_act.value),$2:null})}:null;};J["Entity'$1"]=function(bA){return!(bA.contact==null)?{$:1,$0:new G({$:0,$0:"contact",$1:"",$2:d.toLower(bA.contact.value),$3:null})}:null;};M=L["Utterance'"]=bd.Class({get_TopIntent:function(){return bi.head(bi.sortBy(function(bA){return bA.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$3;},get_Entities:function(){return this.$2;},get_Intents:function(){return this.$1;},get_Text:function(){return this.$0;}},null,M);N=L["Intent'"]=bd.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,N);O=L["Entity'"]=bd.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,O);P=L["Trait'"]=bd.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,P);L.HasUtterance=function(bA){var bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO;return bA!=null&&bA.$==1&&(bA.$0.$1.$==0&&(bA.$0.$2.get_Length()>0&&(bB=[bA.$0.$2,bA.$0.$0,bA.$0.$3],true)))?(bC=bi.map(function(bP){return new G({$:0,$0:bP.get_Name(),$1:d.toLower(bP.get_Role()),$2:bP.get_Value(),$3:{$:1,$0:bP.get_Confidence()}});},bi.filter(function(bP){return bP.get_Confidence()>L.entityConfidenceThreshold();},bB[0])),{$:1,$0:new H({$:0,$0:bB[1],$1:null,$2:{$:1,$0:bi.map(function(bP){return new F({$:0,$0:d.toLower(bP.get_Name()),$1:bP.get_Value(),$2:{$:1,$0:bP.get_Confidence()}});},bi.filter(function(bP){return bP.get_Confidence()>L.entityConfidenceThreshold();},bB[2]))},$3:{$:1,$0:bC}})}):bA!=null&&bA.$==1&&(bA.$0.$2.$==0&&(bA.$0.$3.$==0&&(bA.$0.$1.get_Length()>0&&bA.$0.get_TopIntent().get_Confidence()>L.intentConfidenceThreshold()&&(bD=[bA.$0.$1,bA,bA.$0.$0],true))))?(bE=bD[1],{$:1,$0:new H({$:0,$0:bD[2],$1:{$:1,$0:new E({$:0,$0:d.toLower(bE.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bE.$0.get_TopIntent().get_Confidence()}})},$2:null,$3:null})}):bA!=null&&bA.$==1&&(bA.$0.$3.$==0&&(bA.$0.$1.get_Length()>0&&bA.$0.get_TopIntent().get_Confidence()>L.intentConfidenceThreshold()&&(bF=[bA.$0.$1,bA,bA.$0.$0],true)))?(bG=bF[1],(bH=bi.map(function(bP){return new G({$:0,$0:bP.get_Name(),$1:d.toLower(bP.get_Role()),$2:bP.get_Value(),$3:{$:1,$0:bP.get_Confidence()}});},bi.filter(function(bP){return bP.get_Confidence()>L.entityConfidenceThreshold();},bG.$0.get_Entities())),{$:1,$0:new H({$:0,$0:bF[2],$1:{$:1,$0:new E({$:0,$0:d.toLower(bG.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bG.$0.get_TopIntent().get_Confidence()}})},$2:null,$3:{$:1,$0:bH}})})):bA!=null&&bA.$==1&&(bA.$0.$2.$==0&&(bA.$0.$1.get_Length()>0&&bA.$0.get_TopIntent().get_Confidence()>L.intentConfidenceThreshold()&&(bI=[bA.$0.$1,bA,bA.$0.$0],true)))?(bJ=bI[1],(bK=bi.map(function(bP){return new F({$:0,$0:d.toLower(bP.get_Name()),$1:bP.get_Value(),$2:{$:1,$0:bP.get_Confidence()}});},bi.filter(function(bP){return bP.get_Confidence()>L.entityConfidenceThreshold();},bJ.$0.get_Traits())),{$:1,$0:new H({$:0,$0:bI[2],$1:{$:1,$0:new E({$:0,$0:d.toLower(bJ.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bJ.$0.get_TopIntent().get_Confidence()}})},$2:{$:1,$0:bK},$3:null})})):bA!=null&&bA.$==1&&(bA.$0.$1.get_Length()>0&&bA.$0.get_TopIntent().get_Confidence()>L.intentConfidenceThreshold()&&(bL=[bA.$0.$1,bA,bA.$0.$0],true))?(bM=bL[1],(bN=bi.map(function(bP){return new G({$:0,$0:bP.get_Name(),$1:d.toLower(bP.get_Role()),$2:bP.get_Value(),$3:{$:1,$0:bP.get_Confidence()}});},bi.filter(function(bP){return bP.get_Confidence()>L.entityConfidenceThreshold();},bM.$0.get_Entities())),(bO=bi.map(function(bP){return new F({$:0,$0:d.toLower(bP.get_Name()),$1:bP.get_Value(),$2:{$:1,$0:bP.get_Confidence()}});},bi.filter(function(bP){return bP.get_Confidence()>L.entityConfidenceThreshold();},bM.$0.get_Traits())),{$:1,$0:new H({$:0,$0:bL[2],$1:{$:1,$0:new E({$:0,$0:d.toLower(bM.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bM.$0.get_TopIntent().get_Confidence()}})},$2:{$:1,$0:bO},$3:{$:1,$0:bN}})}))):null;};L.entityConfidenceThreshold=function(){R.$cctor();return R.entityConfidenceThreshold;};L.set_entityConfidenceThreshold=function(bA){R.$cctor();R.entityConfidenceThreshold=bA;};L.intentConfidenceThreshold=function(){R.$cctor();return R.intentConfidenceThreshold;};L.set_intentConfidenceThreshold=function(bA){R.$cctor();R.intentConfidenceThreshold=bA;};L.getUtterance2=function(bA){var bB;bB=null;return bl.Delay(function(){return bl.Bind(n.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bA),function(bC){d.debug("NLU",(function(bD){return function(bE){return bD("Wit.ai returned "+_5.p(bE)+" ");};}(a.id))(bC));return bl.Return(new M({$:0,$0:bA,$1:bi.ofArray(bb.map(function(bD){return new N({$:0,$0:bD.name,$1:bD.confidence});},bC.intents)),$2:bi.map(function(bD){return new O({$:0,$0:bD.name,$1:bD.confidence,$2:bD.role,$3:bD.value});},bi.ofSeq(bj.concat(bj.map(function(bD){return bD[1];},bp.ToSeq(bC.entities))))),$3:bi.ofSeq(bj.map(function(bD){var bE;bE=bD[1];return new P({$:0,$0:bD[0],$1:bb.get(bE,0).confidence,$2:bb.get(bE,0).value});},bp.ToSeq(bC.traits)))}));});});};L.getUtterance=function(bA,bB){n.getMeaning("OOGDHEQL7JZRQASXN2N2GHFUKGO3SCNV",bA,function(bC){var bD,bE;d.debug("NLU",(function(bF){return function(bG){return bF("Wit.ai returned: "+be.prettyPrint(bG));};}(a.id))(bC));bD=!(bC.intents==null)?bi.ofArray(bb.map(function(bF){return new N({$:0,$0:bF.name,$1:bF.confidence});},bC.intents)):bi.T.Empty;bE=!(bC.traits==null)?bi.ofSeq(bj.concat(bi.map(function(bF){return bb.map(function(bG){return new P({$:0,$0:bF,$1:bG.confidence,$2:bG.value});},br.GetJS(bC.traits,[bF]));},bi.filter(function(bF){return!(br.GetJS(bC.traits,[bF])==null);},L.trait_types())))):bi.T.Empty;return bB({$:1,$0:new M({$:0,$0:bA,$1:bD,$2:!(bC.entities==null)?bi.ofSeq(bj.concat(bi.map(function(bF){return bb.map(function(bG){return new O({$:0,$0:bG.name,$1:bG.confidence,$2:bG.role,$3:bG.value});},br.GetJS(bC.entities,[bF]));},bi.filter(function(bF){return!(br.GetJS(bC.entities,[bF])==null);},L.entity_types())))):bi.T.Empty,$3:bE})});},function(bC,bD,bE){d.error((((bd.Curried3(function(bF,bG,bH){return bF("Wit.ai returned: "+be.prettyPrint(bG)+" "+be.prettyPrint(bH));}))(a.id))(bD))(bE));return bB(null);});};L.trait_types=function(){R.$cctor();return R.trait_types;};L.entity_types=function(){R.$cctor();return R.entity_types;};L.QuickNumber=function(bA){var bB,bC,bD;return(bC=L.One(bA),bC!=null&&bC.$==1?(bB=bC.$0,true):(bD=L.Two(bA),bD!=null&&bD.$==1&&(bB=bD.$0,true)))?{$:1,$0:bB}:null;};L.Three=function(bA){var bB;return bA==="3"||bA==="three"?{$:1,$0:new H({$:0,$0:"three",$1:{$:1,$0:new E({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bi.ofArray([new G({$:0,$0:"wit/ordinal",$1:"",$2:"three",$3:{$:1,$0:1}})])}})}:null;};L.Two=function(bA){var bB;return bA==="2"||bA==="two"?{$:1,$0:new H({$:0,$0:"two",$1:{$:1,$0:new E({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bi.ofArray([new G({$:0,$0:"wit/ordinal",$1:"",$2:"two",$3:{$:1,$0:1}})])}})}:null;};L.One=function(bA){var bB;return bA==="1"||bA==="one"?{$:1,$0:new H({$:0,$0:"one",$1:{$:1,$0:new E({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bi.ofArray([new G({$:0,$0:"wit/ordinal",$1:"",$2:"one",$3:{$:1,$0:1}})])}})}:null;};L.QuickNo=function(bA){var bB;return bA==="no"||(bA==="nope"||(bA==="no way"||(bA==="nah"||(bA==="don't do it"||bA==="stop"))))?{$:1,$0:new H({$:0,$0:"no",$1:{$:1,$0:new E({$:0,$0:"reject",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};L.QuickYes=function(bA){var bB;return bA==="yes"||(bA==="ok"||(bA==="sure"||(bA==="yeah"||(bA==="yep"||(bA==="uh huh"||(bA==="go ahead"||bA==="go"))))))?{$:1,$0:new H({$:0,$0:"yes",$1:{$:1,$0:new E({$:0,$0:"verify",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};L.QuickHelp=function(bA){var bB;return bA==="help"||(bA==="help me"||(bA==="what's this?"||bA==="huh"))?{$:1,$0:new H({$:0,$0:"help",$1:{$:1,$0:new E({$:0,$0:"help",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};L.QuickHello=function(bA){var bB;return bA==="hello"||(bA==="hey"||(bA==="yo"||bA==="hi"))?{$:1,$0:new H({$:0,$0:"hello",$1:{$:1,$0:new E({$:0,$0:"greet",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};L.Voices=function(bA){return bA==="voices"?{$:1,$0:null}:null;};L.Debug=function(bA){return bA==="debug"?{$:1,$0:null}:null;};L.Blank=function(bA){return bA===""?{$:1,$0:null}:null;};Q.Study=function(bA){return bA.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};D.Str=function(bA){var bB;return bA!=null&&bA.$==1&&(typeof bA.$0=="string"&&(bB=bA.$0,true))?{$:1,$0:bB}:null;};D.No=function(bA){var bB,bC;return(bC=D.Intent$1("reject",bA),bC!=null&&bC.$==1&&(bC.$0[0]==null&&(bC.$0[1]==null&&(bB=bA,true))))?{$:1,$0:bB}:null;};D.Yes=function(bA){var bB,bC;return(bC=D.Intent$1("verify",bA),bC!=null&&bC.$==1&&(bC.$0[0]==null&&(bC.$0[1]==null&&(bB=bA,true))))?{$:1,$0:bB}:null;};D.EntityManyofMany=function(bA,bB){return{$:1,$0:bp.OfArray(bb.ofSeq(bi.map(function(bC){return bi.exists(function(bD){return bD.get_Role()===bC;},bB)?[bC,{$:1,$0:bi.filter(function(bD){return bD.get_Role()===bC;},bB)}]:[bC,null];},bA)))};};D.EntityManyOf1=function(bA,bB){var bC;return bB!=null&&bB.$==1&&(bi.exists(function(bD){return bD.get_Role()===bA;},bB.$0)&&(bC=bB.$0,true))?{$:1,$0:bi.filter(function(bD){return bD.get_Role()===bA;},bC)}:null;};D.Entity1OfAny=function(bA,bB){var bC;return bB!=null&&bB.$==1&&(bi.exists(function(bD){return bD.get_Role()===bA;},bB.$0)&&(bC=bB.$0,true))?{$:1,$0:bi.head(bi.sortBy(function(bD){return bD.get_Role();},bi.filter(function(bD){return bD.get_Role()===bA;},bC)))}:null;};D.Entity1Of1=function(bA,bB){var bC;return bB!=null&&bB.$==1&&(bB.$0.$==1&&(bB.$0.$1.$==0&&(bB.$0.$0.get_Role()===bA&&(bC=bB.$0.$0,true))))?{$:1,$0:bC}:null;};D.Intent$1=function(bA,bB){return bB.get_Intent()!=null&&bB.get_Intent().$0.get_Name()===bA?{$:1,$0:[bB.get_Traits(),bB.get_Entities()]}:null;};R.$cctor=function(){R.$cctor=a.ignore;R.entity_types=bi.ofArray(["wit$contact:name","wit$datetime:datetime","term:subject","term:object","term:verb"]);R.trait_types=bi.ofArray(["domain","dialogue_act"]);R.intentConfidenceThreshold=0.85;R.entityConfidenceThreshold=0.85;};T.MicReady={$:5};T.MicAudioEnd={$:4};T.MicAudioStart={$:3};T.MicDisconnected={$:2};T.MicConnecting={$:1};T.MicNotInitialized={$:0};U.ClientUnderstand={$:2};U.ClientReady={$:1};U.ClientNotInitialzed={$:0};V=S.Interpreter=bd.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,V);W=S.CUI=bd.Class({SayVoices:function(){var bA,bB,bC;bA=this;bB=a.speechSynthesis.getVoices();!(bB==null)?(bC=d.toArray(bB),bA.Say((function(bD){return function(bE){return bD("There are currently "+a.String(bE)+" voices installed on this computer or device.");};}(a.id))(bb.length(bC))),bb.iteri(function(bD,bE){return bA.Say(((((bd.Curried(function(bF,bG,bH,bI){return bF("Voice "+a.String(bG)+". Name: "+be.toSafe(bH)+", Local: "+be.prettyPrint(bI)+".");},4))(a.id))(bD))(bE.name))(bE.localService));},bC)):void 0;},Wait:function(bA){this.Wait$1(function(){bl.Start(bA,null);});},Wait$1:function(bA){this["Echo'"]("please wait...");this.Term.pause();bA();this.Term.resume();},sayRandom:function(bA,bB){this.Say(B.getRandomPhrase(bA,bB));},SayAngry:function(bA){var bB,bC;bB=this;bl.Start((bC=null,bl.Delay(function(){return bl.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bs.chime(),bl.Zero()):bl.Zero(),bl.Delay(function(){a.addMessage(bB.Avatar,bA,"","");bB.Avatar.processMessages(0);return bl.Zero();}));})),null);},SayDoc:function(bA){var bB,bC,bD;bB=bb.get(bg(".terminal-output").get(),0).childNodes.length;bC=$.Element("div",[d.cls("terminal-command"),d.dindex(bB+1)],[bA]);bD=d.termOutput();_.LoadLocalTemplates("");$.RunAppend(bD,bC);},Say:function(bA){var bB,bC;bB=this;bl.Start((bC=null,bl.Delay(function(){return bl.Combine(a.speechSynthesis.speaking?(bs.chime(),bl.Zero()):bl.Zero(),bl.Delay(function(){bB.Avatar.addMessage(bA);bB.Avatar.processMessages(0);return bl.Zero();}));})),null);},Debug:function(bA,bB){d.debug(bA,bB);},"EchoHtml'":function(bA){var bB,bC;bB=(bC={},bC.raw=true,bC);this.Term.disable();this.Term.echo(bA,bB);this.Term.enable();},"Echo'":function(bA){this.Term.disable();this.Term.echo(bA);this.Term.enable();}},null,W);W.New=function(bA,bB,bC,bD,bE,bF){return new W({Voice:bA,Mic:bB,Term:bC,Avatar:bD,Caption:bE,TypingDNA:bF});};Y=X.Dialogue=bd.Class({get_Utterances:function(){return this.$4;},get_Output:function(){return this.$3;},get_DialogueQuestions:function(){return this.$2;},get_Props:function(){return this.$1;},get_Cui:function(){return this.$0;}},null,Y);X["Response'_"]=function(bA,bB,bC,bD){var bE,bF,bG;return(bF=X.PropNotSet_(bA,"user",bD),bF!=null&&bF.$==1&&(X.haveQuestion(bB,bC)&&bA.get_DialogueQuestions().length>0&&(bA.get_DialogueQuestions())[0].get_Name()===bC&&(bE=bF.$0,true)))?X.haveProp(bA,bC)?(bG=bA.get_Props().get_Item(bC),(X.deleteProp(bA,bC),{$:1,$0:[bE,{$:1,$0:bG}]})):{$:1,$0:[bE,null]}:null;};X.Response_=function(bA,bB,bC,bD){var bE,bF,bG;return(bF=X.PropSet_(bA,"user",bD),bF!=null&&bF.$==1&&(X.haveQuestion(bB,bC)&&bA.get_DialogueQuestions().length>0&&(bA.get_DialogueQuestions())[0].get_Name()===bC&&(bE=bF.$0,true)))?X.haveProp(bA,bC)?(bG=bA.get_Props().get_Item(bC),(X.deleteProp(bA,bC),{$:1,$0:[bE,{$:1,$0:bG}]})):{$:1,$0:[bE,null]}:null;};X["User'_"]=function(bA,bB){var bC,bD;return(bD=X.PropNotSet_(bA,"user",bB),bD!=null&&bD.$==1&&(bA.get_DialogueQuestions().length===0&&(bC=bD.$0,true)))?{$:1,$0:bC}:null;};X.User_=function(bA,bB){var bC,bD;return(bD=X.PropSet_(bA,"user",bB),bD!=null&&bD.$==1&&(bA.get_DialogueQuestions().length===0&&(bC=bD.$0,true)))?{$:1,$0:bC}:null;};X.PropNotSet_=function(bA,bB,bC){return!X.haveProp(bA,bB)?{$:1,$0:bC}:null;};X.PropSet_=function(bA,bB,bC){return X.haveProp(bA,bB)?{$:1,$0:bC}:null;};X.Agenda_=function(bA,bB,bC){return bA.get_DialogueQuestions().length>0&&(bA.get_DialogueQuestions())[0].get_Name()===bB?{$:1,$0:null}:null;};X.didNotUnderstand=function(bA,bB,bC){var bD;bB((function(bE){return function(bF){return bE(be.toSafe(bF)+" interpreter did not understand utterance.");};}(a.id))(bC));X.say(bA,"Sorry I didn't understand what you meant.");bA.get_DialogueQuestions().length>0?(bD=bj.nth(0,bA.get_DialogueQuestions()),X.haveProp(bA,bD.get_Name())?X.say(bA,B.replace_tok("$0",bA.get_Props().get_Item(bD.get_Name()),bD.get_Text())):X.say(bA,bD.get_Text())):void 0;};X.dispatch=function(bA,bB,bC,bD){bB(((((bd.Curried(function(bE,bF,bG,bH){return bE("Dispatch to module "+be.toSafe(bF)+" utterances: "+be.prettyPrint(bG)+" questions: "+be.prettyPrint(bH)+".");},4))(a.id))(bC))(bA.get_Utterances()))(bA.get_DialogueQuestions()));bD(bA);};X.handle=function(bA,bB,bC,bD){X.popu(bA);bB((function(bE){return function(bF){return bE("Handle: "+be.toSafe(bF));};}(a.id))(bC));bD();};X.ask=function(bA,bB,bC,bD){X.addProp(bA,bC,bD);X.pushq(bA,bB,bC);X.say(bA,B.replace_tok("$0",bD,X.getQuestion(bB,bC).$0.get_Text()));};X.popt=function(bA){X.popu(bA);X.popq(bA);};X.pushq=function(bA,bB,bC){var bD;bD=X.getQuestion(bB,bC);bD==null?(function(bE){return function(bF){return bE("No such question: "+be.toSafe(bF));};}(bt.FailWith))(bC):bA.get_DialogueQuestions().unshift(bD.$0);};X.popq=function(bA){bA.get_DialogueQuestions().shift();};X.popu=function(bA){bA.get_Utterances().shift();};X.pushu=function(bA,bB){bA.get_Utterances().unshift(bB);};X.haveQuestion=function(bA,bB){return bi.exists(function(bC){return bC.get_Name()===bB;},bA);};X.getQuestion=function(bA,bB){return bj.tryFind(function(bC){return bC.get_Name()===bB;},bA);};X.prop=function(bA,bB){return bA.get_Props().get_Item(bB);};X.deleteProp=function(bA,bB){bA.get_Props().Remove(bB);};X.addProp=function(bA,bB,bC){bA.get_Props().Add(bB,bC);};X.haveProp=function(bA,bB){return bA.get_Props().ContainsKey(bB);};X.question=function(bA,bB,bC,bD){return new I({$:0,$0:bB,$1:bC,$2:bD,$3:bA});};X["sayRandom'"]=function(bA,bB){X.sayRandom(bA,bB,"");};X.sayRandom=function(bA,bB,bC){var bD;bD=B.getRandomPhrase(bB,bC);bA.get_Output().unshift(bD);bA.get_Cui().Say(bD);};X.say=function(bA,bB){bA.get_Output().unshift(bB);X["say'"](bA,bB);};X["say'"]=function(bA,bB){bA.get_Cui().Say(bB);};X.echo=function(bA,bB){(bA.get_Cui())["EchoHtml'"](bB);};Z.update=function(bA){var bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn;function co(cA){X.echo(bA,cA);}function cp(cA){X.say(bA,cA);}function cq(cA,cB){return X.sayRandom(bA,cA,cB);}function cr(cA,cB){return X.addProp(bA,cA,cB);}function cs(cA){return X.prop(bA,cA);}function ct(){return cs("user");}function cu(cA,cB){return X.ask(bA,Z.moduleQuestions(),cA,cB);}function cv(cA){return X.User_(bA,cA);}function cw(cA){return X["User'_"](bA,cA);}function cx(cA,cB){return X.Response_(bA,Z.moduleQuestions(),cA,cB);}function cy(cA,cB){return X["Response'_"](bA,Z.moduleQuestions(),cA,cB);}function cz(cA,cB,cC){var cD;return bl.Start((cD=null,bl.Delay(function(){cq(B.waitAddPhrases(),"symptom entry");return bl.Bind((new bv.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:-1971578899",[ct().Name,cA,cB,cC]),function(cE){return cE.$==1?(cp(function(cF){return cF("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),bl.Zero()):(cp((function(cF){return function(cG){return cF("OK I added that "+be.toSafe(cG)+" symptom to your journal.");};}(a.id))(cA)),bl.Zero());});})),null);}bB=bA.$4;bC=bA.$1;Z.debug((((bd.Curried3(function(cA,cB,cC){return cA("Starting utterances:"+be.prettyPrint(cB)+". Starting questions: "+be.prettyPrint(cC)+".");}))(a.id))(bB))(bA.$2));bD=bi.ofSeq(bj.take(bB.length>=5?5:bB.length,bB));bD.$==1&&(bF=cw(bD.$0),bF!=null&&bF.$==1&&(bG=D.Intent$1("greet",bF.$0),bG!=null&&bG.$==1&&(bH=D.Entity1Of1("name",bG.$0[1]),bH!=null&&bH.$==1&&(bD.$1.$==0&&(bE=bH.$0,true)))))?(X.popu(bA),bI=bE.get_Value(),cq(B.waitRetrievePhrases(),"user name"),bl.Start((bJ=null,bl.Delay(function(){return bl.Bind((new bv.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:421155979",[bI]),function(cA){var cB;return cA==null?(cp((function(cC){return function(cD){return cC("I did not find a user with the name "+be.toSafe(cD)+".");};}(a.id))(bI)),cu("addUser",bI),bl.Zero()):(cB=cA.$0,bl.Bind((new bv.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:-1549667606",[cB.Name]),function(){bC.Add("user",cB);cq(B.helloUserPhrases(),(function(cC){return function(cD){return cC(be.prettyPrint(cD));};}(a.id))(bC.get_Item("user")));return cB.LastLoggedIn!=null?bl.Bind((new bv.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:-1633867943",[cB.LastLoggedIn.$0]),function(cC){cp((function(cD){return function(cE){return cD("You last logged in "+be.toSafe(cE)+".");};}(a.id))(cC));return bl.Zero();}):bl.Zero();}));});})),null)):bD.$==1&&(bL=D.Yes(bD.$0),bL!=null&&bL.$==1&&(bM=cy("addUser",bL.$0),bM!=null&&bM.$==1&&(bN=D.Str(bM.$0[1]),bN!=null&&bN.$==1&&(bD.$1.$==0&&(bK=bN.$0,true)))))?bl.Start((bO=null,bl.Delay(function(){cq(B.waitAddPhrases(),"user");return bl.Bind((new bv.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:-1549667606",[bK]),function(cA){return cA.$==1?(cp((function(cB){return function(cC){return cB("Sorry I was not able to add the user "+be.toSafe(cC)+" to the system.");};}(a.id))(bK)),bl.Zero()):(cr("user",bK),cp((function(cB){return function(cC){return cB("Hello "+be.prettyPrint(cC)+", nice to meet you.");};}(a.id))(bC.get_Item("user"))),bl.Zero());});})),null):bD.$==1&&(bQ=D.No(bD.$0),bQ!=null&&bQ.$==1&&(bR=cy("addUser",bQ.$0),bR!=null&&bR.$==1&&(bS=D.Str(bR.$0[1]),bS!=null&&bS.$==1&&(bD.$1.$==0&&(bP=bS.$0,true)))))?cp((function(cA){return function(cB){return cA("Ok I did not add the user "+be.toSafe(cB)+". But you must login for me to help you.");};}(a.id))(bP)):bD.$==1&&(bU=cv(bD.$0),bU!=null&&bU.$==1&&(bV=D.Intent$1("hello",bU.$0),bV!=null&&bV.$==1&&(bV.$0[0]==null&&(bW=D.Entity1Of1("name",bV.$0[1]),bW!=null&&bW.$==1&&(bD.$1.$==0&&(bT=bW.$0,true))))))?bl.Start((bX=null,bl.Delay(function(){return bl.Bind((new bv.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:421155979",[bT.get_Value()]),function(cA){return cA==null?(cp((function(cB){return function(cC){return cB("Sorry, the user "+be.toSafe(cC)+" does not exist.");};}(a.id))(bT.get_Value())),bl.Zero()):(cu("switchUser",cA.$0.Name),bl.Zero());});})),null):bD.$==1&&(bZ=D.Yes(bD.$0),bZ!=null&&bZ.$==1&&(b0=cx("switchUser",bZ.$0),b0!=null&&b0.$==1&&(b1=D.Str(b0.$0[1]),b1!=null&&b1.$==1&&(bD.$1.$==0&&(bY=b1.$0,true)))))?(bC.set_Item("user",bY),cp((function(cA){return function(cB){return cA("Ok I switched to user "+be.prettyPrint(cB)+".");};}(a.id))(bY))):bD.$==1&&(b3=D.No(bD.$0),b3!=null&&b3.$==1&&(b4=cx("switchUser",b3.$0),b4!=null&&b4.$==1&&(b5=D.Str(b4.$0[1]),b5!=null&&b5.$==1&&(bD.$1.$==0&&(b2=b5.$0,true)))))?cp((function(cA){return function(cB){return cA("Ok I did not switch to user "+be.toSafe(cB)+".");};}(a.id))(b2)):bD.$==1&&(b7=cw(bD.$0),b7!=null&&b7.$==1?(b8=D.Intent$1("kbquery",b7.$0),b8!=null&&b8.$==1)?bD.$1.$==0&&(b6=b7.$0,true):(b9=cv(bD.$0),b9!=null&&b9.$==1&&((b_=D.Intent$1("kbquery",b9.$0),b_!=null&&b_.$==1)&&(bD.$1.$==0&&(b6=b9.$0,true)))):(b$=cv(bD.$0),b$!=null&&b$.$==1&&((ca=D.Intent$1("kbquery",b$.$0),ca!=null&&ca.$==1)&&(bD.$1.$==0&&(b6=b$.$0,true)))))?bl.Start((cb=null,bl.Delay(function(){return bl.Bind(u.getAnswer(b6.get_Text()),function(cA){var cB;return bl.Bind((cB=bb.get(cA.answers,0).answer,(new bv.New()).Async("SMApp.Web:SMApp.Web.Server.mdtohtml:1988356664",[cB])),function(cC){var cD;return bl.Bind((cD=bb.get(cA.answers,0).answer,(new bv.New()).Async("SMApp.Web:SMApp.Web.Server.mdtotext:1988356664",[cD])),function(cE){co(cC);cp(cE);return bl.Zero();});});});})),null):bD.$==1&&(cd=cv(bD.$0),cd!=null&&cd.$==1&&(ce=D.Intent$1("symptom",cd.$0),ce!=null&&ce.$==1&&(cf=D.Entity1OfAny("symptom_name",ce.$0[1]),cf!=null&&cf.$==1&&(bD.$1.$==0&&(cc=cf.$0,true)))))?bl.Start((cg=null,bl.Delay(function(){cp("Ok I'll add that entry to your symptom journal");cz(cc.get_Value(),null,null);return bl.Zero();})),null):bD.$==1&&(ci=D.Yes(bD.$0),ci!=null&&ci.$==1&&((cj=cx("painVideo",ci.$0),cj!=null&&cj.$==1)&&bD.$1.$==0))?bA.$0["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bD.$==1&&(cl=cv(bD.$0),cl!=null&&cl.$==1&&(cm=D.Intent$1("medjournal",cl.$0),cm!=null&&cm.$==1&&((cn=cm.$0[1],cn!=null&&cn.$==1)&&(bD.$1.$==0&&(ck=cm.$0[1].$0,true)))))?(cp("ok I added that entry to your medication journal."),cp("You should be careful not to take too many painkillers over a short period of time.")):X.didNotUnderstand(bA,function(cA){Z.debug(cA);},Z.name());};Z.haveQuestion=function(bA){return function(bB){return X.haveQuestion(Z.moduleQuestions(),bB);};};Z.getQuestion=function(bA){return function(bB){return X.getQuestion(Z.moduleQuestions(),bB);};};Z.moduleQuestions=function(){_0.$cctor();return _0.moduleQuestions;};Z.debug=function(bA){d.debug(Z.name(),bA);};Z.name=function(){_0.$cctor();return _0.name;};_0.$cctor=function(){_0.$cctor=a.ignore;_0.name="User";_0.moduleQuestions=bi.ofArray([new I({$:0,$0:"inputPassPhrase",$1:"",$2:{$:1,$0:false},$3:Z.name()}),new I({$:0,$0:"addUser",$1:"Do you want me to add the user $0?",$2:{$:1,$0:true},$3:Z.name()}),new I({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?",$2:{$:1,$0:true},$3:Z.name()})]);};_1.update=function(bA){var bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR;function bS(bX){X.say(bA,bX);}function bT(bX){X["sayRandom'"](bA,bX);}function bU(bX){_1.debug(bX);}function bV(bX){return X["User'_"](bA,bX);}function bW(bX){_1.debug(bX);}bB=bA.$4;bC=bA.$2;_1.debug((((bd.Curried3(function(bX,bY,bZ){return bX("Starting utterances:"+be.prettyPrint(bY)+". Starting questions: "+be.prettyPrint(bZ)+".");}))(a.id))(bB))(bC));bD=bd.Curried(X.handle,2,[bA,bU]);bE=bi.ofSeq(bj.take(bB.length>=5?5:bB.length,bB));bF=X.Agenda_(bA,"User",bE);bF!=null&&bF.$==1?Z.update(bA):bE.$==1&&(bH=(bI=X.PropNotSet_(bA,"started",bE.$0),bI!=null&&bI.$==1?{$:1,$0:bI.$0}:null),bH!=null&&bH.$==1&&(bJ=bV(bH.$0),bJ!=null&&bJ.$==1&&(bK=D.Intent$1("greet",bJ.$0),bK!=null&&bK.$==1&&(bK.$0[1]==null&&bE.$1.$==0))))?(bA.$1.Add("started",true),(bD("hello"))(function(){bT(B.helloPhrases());})):bE.$==1&&(bM=bV(bE.$0),bM!=null&&bM.$==1&&(bN=D.Intent$1("greet",bM.$0),bN!=null&&bN.$==1&&(bN.$0[1]==null&&bE.$1.$==0)))?(bD("hello"))(function(){bS("Hello, tell me your name to get started.");}):bE.$==1&&(bP=bV(bE.$0),bP!=null&&bP.$==1&&(bQ=D.Intent$1("greet",bP.$0),bQ!=null&&bQ.$==1&&((bR=D.Entity1Of1("name",bQ.$0[1]),bR!=null&&bR.$==1)&&bE.$1.$==0)))?((bd.Curried(X.dispatch,2,[bA,bW]))(Z.name()))(function(bX){Z.update(bX);}):X.didNotUnderstand(bA,function(bX){_1.debug(bX);},_1.name());_1.debug((((bd.Curried3(function(bX,bY,bZ){return bX("Ending utterances: "+be.prettyPrint(bY)+". Ending questions:"+be.prettyPrint(bZ)+".");}))(a.id))(bB))(bC));};_1.haveQuestion=function(bA){return bi.exists(function(bB){return bB.get_Name()===bA;},_1.moduleQuestions());};_1.getQuestion=function(bA){return bj.tryFind(function(bB){return bB.get_Name()===bA;},_1.moduleQuestions());};_1.moduleQuestions=function(){_2.$cctor();return _2.moduleQuestions;};_1.debug=function(bA){d.debug(_1.name(),bA);};_1.name=function(){_2.$cctor();return _2.name;};_2.$cctor=function(){_2.$cctor=a.ignore;_2.name="Main";_2.moduleQuestions=bi.T.Empty;};_3.run=function(){var bA,bB;bA=bd.ThisFunc(function(bC,bD){return((_3.Main().get_Text())(bC))(bD);});bB=_3.Main().get_Options();a.$("#term").terminal(bA,bB);return $.get_Empty();};_3.Main=function(){_4.$cctor();return _4.Main;};_3.initMic=function(bA){var bB,bC;_3.set_CUI((bB={$:1,$0:new bw.Microphone(bx.getElementById("microphone"))},W.New(_3.CUI().Voice,bB,_3.CUI().Term,_3.CUI().Avatar,_3.CUI().Caption,_3.CUI().TypingDNA)));bC=_3.CUI().Mic.$0;bC.onconnecting=function(){_3.set_MicState(T.MicConnecting);return _3.debug("Mic connecting...");};bC.ondisconnected=function(){_3.set_MicState(T.MicDisconnected);return _3.debug("Mic disconnected.");};bC.onaudiostart=function(){_3.set_MicState(T.MicAudioStart);return _3.debug("Mic audio start...");};bC.onaudioend=function(){_3.set_MicState(T.MicAudioEnd);_3.debug("Mic audio end.");return _3.debug(self.lastMicData);};bC.onerror=function(bD){_3.set_MicState({$:6,$0:bD});return _3.debug((function(bE){return function(bF){return bE("Mic error : "+be.toSafe(bF)+".");};}(a.id))(bD));};bC.onready=function(){_3.set_MicState(T.MicReady);return _3.debug("Mic ready.");};bC.onresult=function(bD,bE){return _3.ClientState().$==2?_3.echo("I'm still trying to understand what you said before."):_3.ClientState().$==0?d.error("Client is not intialized."):!(bD==null||bE==null)?(_3.set_MicState({$:7,$0:bD,$1:bE}),_3.debug((((bd.Curried3(function(bF,bG,bH){return bF("Mic result: "+be.prettyPrint(bG)+" "+be.prettyPrint(bH)+".");}))(a.id))(bD))(bE)),bA(bD,bE)):_3.debug("Mic: No result returned.");};bC.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};_3.sayRandom=function(bA,bB){_3.say(B.getRandomPhrase(bB,bA));};_3.say=function(bA){_3.Output().unshift(bA);_3["say'"](bA);};_3["say'"]=function(bA){_3.CUI().Say(bA);};_3.initSpeech=function(){var bA;bA=d.toArray(_3.synth().getVoices());bb.length(bA)>0?(bb.iter(function(bB){if(by.Equals(_3.CUI().Voice,null)&&(bB.name.indexOf("Microsoft Zira")!=-1||bB.name.toLowerCase().indexOf("female")!=-1)){_3.set_CUI(W.New({$:1,$0:bB},_3.CUI().Mic,_3.CUI().Term,_3.CUI().Avatar,_3.CUI().Caption,_3.CUI().TypingDNA));_3.debug((function(bC){return function(bD){return bC("Using browser speech synthesis voice "+be.toSafe(bD)+".");};}(a.id))(_3.CUI().Voice.$0.name));}},bA),!by.Equals(_3.CUI().Voice,null)?(_3.CUI().Avatar.nativeVoice=true,_3.CUI().Avatar.nativeVoiceName=_3.CUI().Voice.$0.name,_3.debug((function(bB){return function(bC){return bB("Using browser speech synthesis voice "+be.toSafe(bC)+".");};}(a.id))(_3.CUI().Voice.$0.name))):void 0):void 0;by.Equals(_3.CUI().Voice,null)?_3.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};_3.synth=function(){_4.$cctor();return _4.synth;};_3.push=function(bA){_3.Utterances().unshift(bA);return _3.Dialogue();};_3.Dialogue=function(){_4.$cctor();return _4.Dialogue;};_3.Utterances=function(){_4.$cctor();return _4.Utterances;};_3.Questions=function(){_4.$cctor();return _4.Questions;};_3.Output=function(){_4.$cctor();return _4.Output;};_3.Props=function(){_4.$cctor();return _4.Props;};_3.wait=function(bA){d["Terminal.Echo'"](_3.CUI().Term,"please wait");_3.CUI().Term.pause();bA();_3.CUI().Term.resume();};_3.debug=function(bA){d.debug("CLIENT",bA);};_3.echo=function(bA){d["Terminal.EchoHtml'"](_3.CUI().Term,(function(bB){return function(bC){return bB(be.prettyPrint(bC));};}(a.id))(bA));};_3.ClientState=function(){_4.$cctor();return _4.ClientState;};_3.set_ClientState=function(bA){_4.$cctor();_4.ClientState=bA;};_3.MicState=function(){_4.$cctor();return _4.MicState;};_3.set_MicState=function(bA){_4.$cctor();_4.MicState=bA;};_3.CUI=function(){_4.$cctor();return _4.CUI;};_3.set_CUI=function(bA){_4.$cctor();_4.CUI=bA;};_4.$cctor=function(){var bA,bB,bC,bD;_4.$cctor=a.ignore;function bE(bG,bH){var bI,bJ,bK,bL,bM,bN,bO;_3.debug((((bd.Curried3(function(bP,bQ,bR){return bP("Voice: "+be.prettyPrint(bQ)+" "+be.prettyPrint(bR));}))(a.id))(bG))(bH));bI=(bJ=J["Intent'"](bG,bH),bJ!=null&&bJ.$==1?{$:1,$0:bJ.$0}:null);bK=(bL=J["Trait'"](bH),bL!=null&&bL.$==1?{$:1,$0:bi.ofArray([bL.$0])}:null);bM=(bN=J["Entity'$1"](bH),bN!=null&&bN.$==1?{$:1,$0:bi.ofArray([bN.$0])}:null);bI==null&&(bK==null&&bM==null)?void 0:(_3.debug(((((bd.Curried(function(bP,bQ,bR,bS){return bP("Voice: "+_6.p(bQ)+" "+_6.p$3(bR)+" "+_6.p$5(bS));},4))(a.id))(bI))(bK))(bM)),_1.update(_3.push(new H({$:0,$0:"",$1:bI,$2:bK,$3:bM}))));}function bF(bG,bH){var bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS;_3.set_CUI(W.New(_3.CUI().Voice,_3.CUI().Mic,bG,_3.CUI().Avatar,_3.CUI().Caption,_3.CUI().TypingDNA));by.Equals(_3.CUI().Mic,null)?_3.initMic(bE):void 0;by.Equals(_3.CUI().Voice,null)?_3.initSpeech():void 0;_3.ClientState().$===0?_3.set_ClientState(U.ClientReady):void 0;return(bI=L.Blank(bH),bI!=null&&bI.$==1)?_3["say'"]("Tell me what you want me to do or ask me a question."):(bJ=L.Debug(bH),bJ!=null&&bJ.$==1)?(_3.debug(_3.CUI().TypingDNA.getTypingPattern((bK={type:0},bK.length=100,bK))),_3.debug((function(bT){return function(bU){return bT("Utterances: "+be.prettyPrint(bU));};}(a.id))(_3.Utterances())),_3.debug((function(bT){return function(bU){return bT("Questions: "+be.prettyPrint(bU));};}(a.id))(_3.Questions()))):(bL=L.Voices(bH),bL!=null&&bL.$==1)?(bM=d.toArray(d.speechSynthesis().getVoices()),(_3["say'"]((function(bT){return function(bU){return bT("There are currently "+a.String(bU)+" voices installed on this computer or device.");};}(a.id))(bb.length(bM))),bb.iteri(function(bT,bU){return _3["say'"](((((bd.Curried(function(bV,bW,bX,bY){return bV("Voice "+a.String(bW)+". Name: "+be.toSafe(bX)+", Local: "+be.prettyPrint(bY)+".");},4))(a.id))(bT))(bU.name))(bU.localService));},bM))):_3.ClientState().$==1?(bO=L.QuickHello(bH),bO!=null&&bO.$==1?(bN=bO.$0,true):(bP=L.QuickHelp(bH),bP!=null&&bP.$==1?(bN=bP.$0,true):(bQ=L.QuickYes(bH),bQ!=null&&bQ.$==1?(bN=bQ.$0,true):(bR=L.QuickNo(bH),bR!=null&&bR.$==1&&(bN=bR.$0,true)))))?(_3.debug((function(bT){return function(bU){return bT("Quick Text: "+_6.p$7(bU)+".");};}(a.id))(bN)),_1.update(_3.push(bN)),_3.set_ClientState(U.ClientReady)):_3.CUI().Wait((bS=null,bl.Delay(function(){_3.set_ClientState(U.ClientUnderstand);L.getUtterance(bH,function(bT){var bU,bV;bU=L.HasUtterance(bT);bU!=null&&bU.$==1?(bV=bU.$0,_3.debug(((((bd.Curried(function(bW,bX,bY,bZ){return bW("Text: Intent: "+_6.p(bX)+", Traits: "+_6.p$3(bY)+", Entities: "+_6.p$5(bZ));},4))(a.id))(bV.get_Intent()))(bV.get_Traits()))(bV.get_Entities())),_1.update(_3.push(bV))):(_3.debug("Text: Did not receive a meaning from the server."),_3["say'"]("Sorry I did not understand what you said."));});_3.set_ClientState(U.ClientReady);return bl.Zero();}))):_3.ClientState().$==0?d.error("Client is not initialized."):_3["say'"]("I'm still trying to understand what you said before.");}_4.CUI=W.New(null,null,null,(bs.applicationId="4277115329081938617",bA=new a.SDKConnection(),bB=new a.WebAvatar(),bB.version=8.5,bB.connection=bA,bB.avatar="20926186",bB.voice="cmu-slt",bB.voiceMod="default",bB.width=175,bB.createBox(),bB.addMessage(""),bB.processMessages(0),bB),false,(bC=new a.TypingDNA(),(bC.stop(),bC)));_4.MicState=T.MicNotInitialized;_4.ClientState=U.ClientNotInitialzed;_4.Props=new bz.New$5();_4.Output=[];_4.Questions=[];_4.Utterances=[];_4.Dialogue=new Y({$:0,$0:_3.CUI(),$1:_3.Props(),$2:_3.Questions(),$3:_3.Output(),$4:_3.Utterances()});_4.synth=a.speechSynthesis;_4.Main=new V({$:0,$0:function(bG){return bE(bG[0],bG[1]);},$1:[function(bG){return function(bH){return bF(bG,bH);};},(bD={},bD.name="Main",bD.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bD.prompt=">",bD)]});};_5.p=function(bA){return"{"+("text = "+be.prettyPrint(bA.text))+"; "+("intents = "+be.printArray(function(bB){return _5.p$1(bB);},bA.intents))+"; "+("entities = "+be.prettyPrint(bA.entities))+"; "+("traits = "+be.prettyPrint(bA.traits))+"}";};_5.p$1=function(bA){return"{"+("id = "+be.prettyPrint(bA.id))+"; "+("name = "+be.prettyPrint(bA.name))+"; "+("confidence = "+be.prettyPrint(bA.confidence))+"}";};_6.p$2=function(bA){return bA==null?"null":"Some "+be.prettyPrint(bA.$0);};_6.p$1=function(bA){return"Intent ("+be.prettyPrint(bA.$0)+", "+_6.p$2(bA.$1)+")";};_6.p=function(bA){return bA==null?"null":"Some "+_6.p$1(bA.$0);};_6.p$4=function(bA){return"Trait ("+be.prettyPrint(bA.$0)+", "+be.prettyPrint(bA.$1)+", "+_6.p$2(bA.$2)+")";};_6.p$3=function(bA){return bA==null?"null":"Some "+be.printList(function(bB){return _6.p$4(bB);},bA.$0);};_6.p$6=function(bA){return"Entity ("+be.prettyPrint(bA.$0)+", "+be.prettyPrint(bA.$1)+", "+be.prettyPrint(bA.$2)+", "+_6.p$2(bA.$3)+")";};_6.p$5=function(bA){return bA==null?"null":"Some "+be.printList(function(bB){return _6.p$6(bB);},bA.$0);};_6.p$7=function(bA){return"Utterance ("+be.prettyPrint(bA.$0)+", "+_6.p(bA.$1)+", "+_6.p$3(bA.$2)+", "+_6.p$5(bA.$3)+")";};}());
