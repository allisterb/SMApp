(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;a=self;b=a.SMApp=a.SMApp||{};c=b.Bootstrap=b.Bootstrap||{};d=c.Controls=c.Controls||{};e=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};f=b.Web=b.Web||{};g=f.User=f.User||{};h=f.Meaning=f.Meaning||{};i=f.Intent=f.Intent||{};j=f.Entity=f.Entity||{};k=f.Interpreter=f.Interpreter||{};l=f.Resource=f.Resource||{};m=f.NLU=f.NLU||{};n=m.Voice=m.Voice||{};o=n.Entity=n.Entity||{};p=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};q=f.CUI=f.CUI||{};r=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};s=f.ClientExtensions=f.ClientExtensions||{};t=f._Html=f._Html||{};u=f.htmModule=f.htmModule||{};v=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};w=f.Client=f.Client||{};x=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};y=a.WebSharper;z=y&&y.UI;A=z&&z.Doc;B=y&&y.List;C=z&&z.AttrModule;D=a.IntelliFactory;E=D&&D.Runtime;F=y&&y.Seq;G=y&&y.Random;H=y&&y.Arrays;I=a.jQuery;J=a.console;K=y&&y.Strings;L=y&&y.Utils;M=y&&y.Concurrency;N=y&&y.Unchecked;O=a.Wit;P=a.document;Q=y&&y.Remoting;R=Q&&Q.AjaxRemotingProvider;d.Radio=function(S,T,U,V,W){return A.Element("div",new B.T({$:1,$0:(d.cls())("radio"),$1:T}),[A.Element("label",V,[A.Radio(W,true,U),A.TextNode(S)])]);};d.Checkbox=function(S,T,U,V,W){return A.Element("div",new B.T({$:1,$0:(d.cls())("checkbox"),$1:T}),[A.Element("label",V,[A.CheckBox(W,U),A.TextNode(S)])]);};d.TextArea=function(S,T,U,V,W){return A.Element("div",new B.T({$:1,$0:(d.cls())("form-group"),$1:T}),[A.Element("label",V,[A.TextNode(S)]),A.InputArea(new B.T({$:1,$0:(d.cls())("form-control"),$1:W}),U)]);};d.InputPassword=function(S,T,U,V,W){return A.Element("div",new B.T({$:1,$0:(d.cls())("form-group"),$1:T}),[A.Element("label",V,[A.TextNode(S)]),A.PasswordBox(new B.T({$:1,$0:(d.cls())("form-control"),$1:W}),U)]);};d.Input=function(S,T,U,V,W){return A.Element("div",new B.T({$:1,$0:(d.cls())("form-group"),$1:T}),[A.Element("label",V,[A.TextNode(S)]),A.Input(new B.T({$:1,$0:(d.cls())("form-control"),$1:W}),U)]);};d.Container=function(S){return A.Element("div",[(d.cls())("container")],S);};d.Class=function(){e.$cctor();return e.Class;};d.cls=function(){e.$cctor();return e.cls;};e.$cctor=function(){e.$cctor=a.ignore;e.cls=C.Class;e.Class=C.Class;};g.New=function(S){return{UserName:S};};h=f.Meaning=E.Class({get_TopIntent:function(){return B.head(B.sortBy(function(S){return S.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,h);i=f.Intent=E.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,i);j=f.Entity=E.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,j);k=f.Interpreter=E.Class({get_Options:function(){return(this.get_Unwrap())[1];},get_Func:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0[0],this.$0[1]];}},null,k);l.New=function(S,T,U){return{Name:S,Description:T,Url:U};};o.New=function(S,T,U,V,W){return{body:S,end:T,start:U,suggested:V,value:W};};n.Contact=function(S){return!(S.contact==null)?{$:1,$0:o.New(S.body,S.end,S.start,S.ff,S.value)}:null;};n.Greetings=function(S){return!(S.greetings==null)&&!(S.greetings.value==null)?{$:1,$0:S.greetings.value}:null;};m.HelloUser=function(S){var T,U;return(U=m.Hello(S),U!=null&&U.$==1&&(U.$0.$==1&&(U.$0.$1.$==0&&(U.$0.$0.get_Role()==="contact"&&(T=U.$0.$0,true)))))?{$:1,$0:T}:null;};m.Hello=function(S){var T,U;return S!=null&&S.$==1&&(U=m.Intent("Hello",S.$0),U!=null&&U.$==1&&(T=U.$0,true))?{$:1,$0:T}:null;};m.QuickHello=function(S){var T;switch(S==="hello"?0:S==="hey"?0:S==="yo"?0:S==="hi"?0:S==="help"?1:S==="debug on"?2:S==="debug off"?3:S.toLowerCase()==="programs"?4:5){case 0:return{$:0,$0:null};case 1:return{$:1,$0:null};case 2:return{$:2,$0:null};case 3:return{$:3,$0:null};case 4:return{$:4,$0:null};case 5:return{$:5,$0:null};}};m.Intent=function(S,T){return T.get_TopIntent().get_Name()===S&&T.get_TopIntent().get_Confidence()>m.intentConfidenceThreshold()?{$:1,$0:B.filter(function(U){return U.get_Confidence()>m.entityConfidenceThreshold();},T.get_Entities())}:null;};m.availablePrograms=function(){p.$cctor();return p.availablePrograms;};m.entityConfidenceThreshold=function(){p.$cctor();return p.entityConfidenceThreshold;};m.set_entityConfidenceThreshold=function(S){p.$cctor();p.entityConfidenceThreshold=S;};m.intentConfidenceThreshold=function(){p.$cctor();return p.intentConfidenceThreshold;};m.set_intentConfidenceThreshold=function(S){p.$cctor();p.intentConfidenceThreshold=S;};p.$cctor=function(){p.$cctor=a.ignore;p.intentConfidenceThreshold=0.85;p.entityConfidenceThreshold=0.85;p.availablePrograms=B.ofArray(["Depression","Arthritis"]);};q.helloUserPhrases=function(){r.$cctor();return r.helloUserPhrases;};q.helloPhrases=function(){r.$cctor();return r.helloPhrases;};q.getRandomPhrase=function(S){return F.nth(q.rng().Next(0,S.get_Length()),S);};q.rng=function(){r.$cctor();return r.rng;};r.$cctor=function(){r.$cctor=a.ignore;r.rng=new G.New();r.helloPhrases=B.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);r.helloUserPhrases=B.ofArray(["Hi $user, welcome back.","Welcome $user, nice to see you again..","Hello $user","Good to see you $user."]);};s.toArray=function(S){return H.map(a.id,I.makeArray(S));};s.error=function(S){J.error(S);};s.info=function(S){J.info(S);};s.jserror=function(S){I.error(S);};s["Terminal.Push"]=function(S,T){var U,V;U=T.get_Func();V=T.get_Options();S.push(E.CreateFuncWithThis(U),V);};s["Terminal.EchoHtml'"]=function(S,T){S.disable();S.echo(T,s.rawOpt());S.enable();};s["Terminal.Echo'"]=function(S,T){S.disable();S.echo(T);S.enable();};s.rawOpt=function(){v.$cctor();return v.rawOpt;};t=f._Html=E.Class({toString:function(){return t.toString(this);}},null,t);t.toString=function(S){function T(U){return function(V){var W,X,Y,Z,_0,_1,_2;X=K.replicate(U," ");switch(V.$==0?V.$1.$==1?V.$1.$0.$==2?V.$1.$1.$==0?(W=[V.$1.$0.$0,V.$0],1):(W=[V.$1,V.$0],2):(W=[V.$1,V.$0],2):(W=[V.$1,V.$0],2):V.$==2?(W=V.$0,3):(W=[V.$0,V.$1],0)){case 0:return W[0]+"=\""+W[1]+"\"";case 1:Y=W[1];return X+"<"+Y+">"+W[0]+"</"+Y+">\r\n";case 2:Z=W[1];_0=B.partition(function(_3){return _3.$==1;},W[0]);_1=_0[1];_2=_0[0];return _1.$==0?X+"<"+Z+(_2.$===0?"":" "+K.concat(" ",B.ofSeq(F.delay(function(){return F.map(function(_3){return(T(0))(_3);},_2);}))))+"/>\r\n":X+"<"+Z+(_2.$===0?"":" "+K.concat(" ",B.ofSeq(F.delay(function(){return F.map(function(_3){return(T(0))(_3);},_2);}))))+">\r\n"+K.concat("",B.ofSeq(F.delay(function(){return F.map(function(_3){return(T(U+1))(_3);},_1);})))+X+"</"+Z+">\r\n";case 3:return X+W+"\r\n";}};}return(T(0))(S);};u.alt=function(S){return new t({$:1,$0:"alt",$1:S});};u.src=function(S){return new t({$:1,$0:"src",$1:S});};u.cls=function(S){return new t({$:1,$0:"class",$1:S});};u.str=function(S){return t.toString(S);};u.op_PercentEquals=function(S,T){return new t({$:1,$0:S,$1:T});};u.op_Splice=function(S){var T;return B.ofArray([new t({$:2,$0:(T=S,a.String(T))})]);};u.strong=function(){v.$cctor();return v.strong;};u.h4=function(){v.$cctor();return v.h4;};u.h3=function(){v.$cctor();return v.h3;};u.h2=function(){v.$cctor();return v.h2;};u.h1=function(){v.$cctor();return v.h1;};u.li=function(){v.$cctor();return v.li;};u.ul=function(){v.$cctor();return v.ul;};u.th=function(){v.$cctor();return v.th;};u.td=function(){v.$cctor();return v.td;};u.tr=function(){v.$cctor();return v.tr;};u.a=function(){v.$cctor();return v.a;};u.p=function(){v.$cctor();return v.p;};u.area=function(){v.$cctor();return v.area;};u.map=function(){v.$cctor();return v.map;};u.img=function(){v.$cctor();return v.img;};u.tfoot=function(){v.$cctor();return v.tfoot;};u.tbody=function(){v.$cctor();return v.tbody;};u.thead=function(){v.$cctor();return v.thead;};u.table=function(){v.$cctor();return v.table;};u.span=function(){v.$cctor();return v.span;};u.section=function(){v.$cctor();return v.section;};u.br=function(){v.$cctor();return v.br;};u.div=function(){v.$cctor();return v.div;};u.body=function(){v.$cctor();return v.body;};u.style=function(){v.$cctor();return v.style;};u.title=function(){v.$cctor();return v.title;};u.head=function(){v.$cctor();return v.head;};u.html=function(){v.$cctor();return v.html;};u.elem=function(S,T){return new t({$:0,$0:S,$1:T});};v.$cctor=function(){var S;v.$cctor=a.ignore;v.rawOpt=(S={},S.raw=true,S);v.html=function(T){return u.elem("html",T);};v.head=function(T){return u.elem("head",T);};v.title=function(T){return u.elem("title",T);};v.style=function(T){return u.elem("style",T);};v.body=function(T){return u.elem("body",T);};v.div=function(T){return u.elem("div",T);};v.br=function(T){return u.elem("br",T);};v.section=function(T){return u.elem("section",T);};v.span=function(T){return u.elem("span",T);};v.table=function(T){return u.elem("table",T);};v.thead=function(T){return u.elem("thead",T);};v.tbody=function(T){return u.elem("tbody",T);};v.tfoot=function(T){return u.elem("tfoot",T);};v.img=function(T){return u.elem("img",T);};v.map=function(T){return u.elem("map",T);};v.area=function(T){return u.elem("area",T);};v.p=function(T){return u.elem("p",T);};v.a=function(T){return u.elem("a",T);};v.tr=function(T){return u.elem("tr",T);};v.td=function(T){return u.elem("td",T);};v.th=function(T){return u.elem("th",T);};v.ul=function(T){return u.elem("ul",T);};v.li=function(T){return u.elem("li",T);};v.h1=function(T){return u.elem("h1",T);};v.h2=function(T){return u.elem("h1",T);};v.h3=function(T){return u.elem("h1",T);};v.h4=function(T){return u.elem("h1",T);};v.strong=function(T){return u.elem("strong",T);};};w.Term=function(){var S,T;S=E.ThisFunc(function(U,V){return((w.Main().get_Func())(U))(V);});T=w.Main().get_Options();a.$("#main").terminal(S,T);w.context().unshift({$:0,$0:w.Main()});return A.get_Empty();};w.Main=function(){x.$cctor();return x.Main;};w.container=function(){x.$cctor();return x.container;};w.wait=function(S){s["Terminal.Echo'"](w.currentTerm(),"please wait");w.currentTerm().disable();S();w.currentTerm().enable();};w.stopSpeaking=function(){x.$cctor();return x.stopSpeaking;};w.sayRandom=function(S){w.say(q.getRandomPhrase(S));};w.sayVoices=function(){var S;S=s.toArray(a.speechSynthesis.getVoices());w.say((function(T){return function(U){return T("There are currently "+a.String(U)+" voices installed on this computer or device.");};}(a.id))(H.length(S)));H.iteri(function(T,U){return w.say(((((E.Curried(function(V,W,X,Y){return V("Voice "+a.String(W)+". Name: "+L.toSafe(X)+", Local: "+L.prettyPrint(Y)+".");},4))(a.id))(T))(U.name))(U.localService));},S);};w.say=function(S){var T,U,V;if(T=w.currentVoice(),T!=null&&T.$==1){U=w.currentVoice().$0;M.Start((V=null,M.Delay(function(){var W;W=new a.SpeechSynthesisUtterance(S);W.voice=U;a.speechSynthesis.speak(W);return M.Zero();})),null);w.echo()?s["Terminal.Echo'"](w.currentTerm(),S):void 0;}else s["Terminal.Echo'"](w.currentTerm(),S);};w.initSpeech=function(){var S;S=s.toArray(a.speechSynthesis.getVoices());H.iter(function(T){if(N.Equals(w.currentVoice(),null)&&(T.name.indexOf("Microsoft Zira")!=-1||T.name.toLowerCase().indexOf("female")!=-1)){w.set_currentVoice({$:1,$0:T});s.info((function(U){return function(V){return U("Using voice "+L.toSafe(V)+".");};}(a.id))(w.currentVoice().$0.name));}},S);N.Equals(w.currentVoice(),null)&&H.length(S)>0?(w.set_currentVoice({$:1,$0:H.find(function(T){return T["default"];},S)}),s.info((function(T){return function(U){return T("Using default voice "+L.toSafe(U)+".");};}(a.id))(w.currentVoice().$0.name))):N.Equals(w.currentVoice(),null)?s["Terminal.Echo'"](w.currentTerm(),"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma."):void 0;};w.echo=function(){x.$cctor();return x.echo;};w.set_echo=function(S){x.$cctor();x.echo=S;};w.debugMode=function(){x.$cctor();return x.debugMode;};w.set_debugMode=function(S){x.$cctor();x.debugMode=S;};w.currentTerm=function(){x.$cctor();return x.currentTerm;};w.set_currentTerm=function(S){x.$cctor();x.currentTerm=S;};w.currentVoice=function(){x.$cctor();return x.currentVoice;};w.set_currentVoice=function(S){x.$cctor();x.currentVoice=S;};w.context=function(){x.$cctor();return x.context;};x.$cctor=function(){var S;x.$cctor=a.ignore;function T(U,V){var W,X,Y;w.set_currentTerm(U);N.Equals(w.currentVoice(),null)?w.initSpeech():void 0;W=m.QuickHello(V);return W.$==1?(X=new O.Microphone(P.getElementById("microphone")),(X.onready=function(){return s["Terminal.Echo'"](U,"Ready.");},X.onconnecting=function(){return s["Terminal.Echo'"](U,"Connecting...");},X.ondisconnected=function(){return s["Terminal.Echo'"](U,"Disconnected.");},X.onaudiostart=function(){return s["Terminal.Echo'"](U,"Audio start...");},X.onaudioend=function(){return s["Terminal.Echo'"](U,"Audio end.");},X.onerror=function(Z){return s["Terminal.Echo'"](U,(function(_0){return function(_1){return _0("Error : "+L.toSafe(_1)+".");};}(a.id))(Z));},X.onresult=function(Z,_0){var _1;_1=n.Greetings(_0);return _1!=null&&_1.$==1?s.info(_1.$0):s.error(_0);},X.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT"))):W.$==2?(w.set_debugMode(true),w.say("Debug mode is now on.")):W.$==3?(w.set_debugMode(false),w.say("Debug mode is now off.")):W.$==4?(w.say("The following programs are available:"),B.iteri(function(Z,_0){return w.say((((E.Curried3(function(_1,_2,_3){return _1(a.String(_2)+". "+L.toSafe(_3));}))(a.id))(Z))(_0));},m.availablePrograms())):W.$==5?(s["Terminal.Echo'"](w.currentTerm(),"please wait"),U.disable(),M.Start((Y=null,M.Delay(function(){return M.Combine(M.Bind((new R.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:1266014957",[V]),function(Z){var _0;_0=m.HelloUser(Z);return _0!=null&&_0.$==1?(w.say((function(_1){return function(_2){return _1("This is the hello intent. The user name is "+L.toSafe(_2)+".");};}(a.id))(_0.$0.get_Value())),M.Zero()):(s["Terminal.Echo'"](U,"This is the whatever intent"),M.Zero());}),M.Delay(function(){U.enable();return M.Zero();}));})),null)):w.sayRandom(q.helloPhrases());}x.context=[];x.currentVoice=null;x.currentTerm=null;x.debugMode=false;x.echo=false;x.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;x.container=d.Container;x.Main=new k({$:0,$0:[function(U){return function(V){return T(U,V);};},(S={},S.name="Main",S.greetings="Welcome to Selma. Type hello to begin or help for more assistance.",S.prompt=">",S)]});};}());
