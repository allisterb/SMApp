(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=b.Bootstrap=b.Bootstrap||{};i=h.Controls=h.Controls||{};j=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};k=c.NLU=c.NLU||{};l=k.Intent=k.Intent||{};m=k.Trait=k.Trait||{};n=k.Entity=k.Entity||{};o=k.Meaning=k.Meaning||{};p=k.Voice=k.Voice||{};q=p["Entity'"]=p["Entity'"]||{};r=k.Text=k.Text||{};s=r["Meaning'"]=r["Meaning'"]||{};t=r["Intent'"]=r["Intent'"]||{};u=r["Entity'"]=r["Entity'"]||{};v=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};w=c.CUI=c.CUI||{};x=w.User=w.User||{};y=w.Interpreter=w.Interpreter||{};z=w.CUI=w.CUI||{};A=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};B=c.Main=c.Main||{};C=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};D=c.Client=c.Client||{};E=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};F=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};G=a.WebSharper;H=G&&G.Strings;I=G&&G.Arrays;J=a.jQuery;K=G&&G.Utils;L=a.console;M=a.IntelliFactory;N=M&&M.Runtime;O=G&&G.List;P=G&&G.Seq;Q=G&&G.UI;R=Q&&Q.Doc;S=Q&&Q.AttrModule;T=G&&G.Concurrency;U=G&&G.Random;V=G&&G.Remoting;W=V&&V.AjaxRemotingProvider;X=a.Wit;Y=a.document;Z=G&&G.Unchecked;_0=G&&G.Collections;_1=_0&&_0.Dictionary;d.replace_tok=function(_2,_3,_4){return H.Replace(_4,_2,_3);};d.toLower=function(_2){return _2.toLowerCase();};d.toArray=function(_2){return I.map(a.id,J.makeArray(_2));};d.debug=function(_2){var _3;d.info((function(_4){return function(_5){return _4("DEBUG: "+K.toSafe(_5));};}(a.id))((_3=_2,a.String(_3))));};d.error=function(_2){L.error(_2);};d.info=function(_2){L.info(_2);};d.jserror=function(_2){J.error(_2);};d["Terminal.EchoHtml'"]=function(_2,_3){_2.disable();_2.echo(_3,d.rawOpt());_2.enable();};d["Terminal.Echo'"]=function(_2,_3){_2.disable();_2.echo(_3);_2.enable();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=N.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(_2){function _3(_4){return function(_5){var _6,_7,_8,_9,_,$,ba;_7=H.replicate(_4," ");switch(_5.$==0?_5.$1.$==1?_5.$1.$0.$==2?_5.$1.$1.$==0?(_6=[_5.$1.$0.$0,_5.$0],1):(_6=[_5.$1,_5.$0],2):(_6=[_5.$1,_5.$0],2):(_6=[_5.$1,_5.$0],2):_5.$==2?(_6=_5.$0,3):(_6=[_5.$0,_5.$1],0)){case 0:return _6[0]+"=\""+_6[1]+"\"";case 1:_8=_6[1];return _7+"<"+_8+">"+_6[0]+"</"+_8+">\r\n";case 2:_9=_6[1];_=O.partition(function(bb){return bb.$==1;},_6[0]);$=_[1];ba=_[0];return $.$==0?_7+"<"+_9+(ba.$===0?"":" "+H.concat(" ",O.ofSeq(P.delay(function(){return P.map(function(bb){return(_3(0))(bb);},ba);}))))+"/>\r\n":_7+"<"+_9+(ba.$===0?"":" "+H.concat(" ",O.ofSeq(P.delay(function(){return P.map(function(bb){return(_3(0))(bb);},ba);}))))+">\r\n"+H.concat("",O.ofSeq(P.delay(function(){return P.map(function(bb){return(_3(_4+1))(bb);},$);})))+_7+"</"+_9+">\r\n";case 3:return _7+_6+"\r\n";}};}return(_3(0))(_2);};f.alt=function(_2){return new e({$:1,$0:"alt",$1:_2});};f.src=function(_2){return new e({$:1,$0:"src",$1:_2});};f.cls=function(_2){return new e({$:1,$0:"class",$1:_2});};f.str=function(_2){return e.toString(_2);};f.op_PercentEquals=function(_2,_3){return new e({$:1,$0:_2,$1:_3});};f.op_Splice=function(_2){var _3;return O.ofArray([new e({$:2,$0:(_3=_2,a.String(_3))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(_2,_3){return new e({$:0,$0:_2,$1:_3});};g.$cctor=function(){var _2;g.$cctor=a.ignore;g.rawOpt=(_2={},_2.raw=true,_2);g.html=function(_3){return f.elem("html",_3);};g.head=function(_3){return f.elem("head",_3);};g.title=function(_3){return f.elem("title",_3);};g.style=function(_3){return f.elem("style",_3);};g.body=function(_3){return f.elem("body",_3);};g.div=function(_3){return f.elem("div",_3);};g.br=function(_3){return f.elem("br",_3);};g.section=function(_3){return f.elem("section",_3);};g.span=function(_3){return f.elem("span",_3);};g.table=function(_3){return f.elem("table",_3);};g.thead=function(_3){return f.elem("thead",_3);};g.tbody=function(_3){return f.elem("tbody",_3);};g.tfoot=function(_3){return f.elem("tfoot",_3);};g.img=function(_3){return f.elem("img",_3);};g.map=function(_3){return f.elem("map",_3);};g.area=function(_3){return f.elem("area",_3);};g.p=function(_3){return f.elem("p",_3);};g.a=function(_3){return f.elem("a",_3);};g.tr=function(_3){return f.elem("tr",_3);};g.td=function(_3){return f.elem("td",_3);};g.th=function(_3){return f.elem("th",_3);};g.ul=function(_3){return f.elem("ul",_3);};g.li=function(_3){return f.elem("li",_3);};g.h1=function(_3){return f.elem("h1",_3);};g.h2=function(_3){return f.elem("h1",_3);};g.h3=function(_3){return f.elem("h1",_3);};g.h4=function(_3){return f.elem("h1",_3);};g.strong=function(_3){return f.elem("strong",_3);};};i.Radio=function(_2,_3,_4,_5,_6){return R.Element("div",new O.T({$:1,$0:(i.cls())("radio"),$1:_3}),[R.Element("label",_5,[R.Radio(_6,true,_4),R.TextNode(_2)])]);};i.Checkbox=function(_2,_3,_4,_5,_6){return R.Element("div",new O.T({$:1,$0:(i.cls())("checkbox"),$1:_3}),[R.Element("label",_5,[R.CheckBox(_6,_4),R.TextNode(_2)])]);};i.TextArea=function(_2,_3,_4,_5,_6){return R.Element("div",new O.T({$:1,$0:(i.cls())("form-group"),$1:_3}),[R.Element("label",_5,[R.TextNode(_2)]),R.InputArea(new O.T({$:1,$0:(i.cls())("form-control"),$1:_6}),_4)]);};i.InputPassword=function(_2,_3,_4,_5,_6){return R.Element("div",new O.T({$:1,$0:(i.cls())("form-group"),$1:_3}),[R.Element("label",_5,[R.TextNode(_2)]),R.PasswordBox(new O.T({$:1,$0:(i.cls())("form-control"),$1:_6}),_4)]);};i.Input=function(_2,_3,_4,_5,_6){return R.Element("div",new O.T({$:1,$0:(i.cls())("form-group"),$1:_3}),[R.Element("label",_5,[R.TextNode(_2)]),R.Input(new O.T({$:1,$0:(i.cls())("form-control"),$1:_6}),_4)]);};i.Container=function(_2){return R.Element("div",[(i.cls())("container")],_2);};i.Class=function(){j.$cctor();return j.Class;};i.cls=function(){j.$cctor();return j.cls;};j.$cctor=function(){j.$cctor=a.ignore;j.cls=S.Class;j.Class=S.Class;};l=k.Intent=N.Class({toString:function(){return(((N.Curried3(function(_2,_3,_4){return _2("Intent("+K.toSafe(_3)+", "+F.p$2(_4)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,l);m=k.Trait=N.Class({toString:function(){return(((N.Curried3(function(_2,_3,_4){return _2("Trait("+K.toSafe(_3)+", "+K.prettyPrint(_4)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,m);n=k.Entity=N.Class({toString:function(){return((((N.Curried(function(_2,_3,_4,_5){return _2("Entity("+K.toSafe(_3)+", "+K.toSafe(_4)+", "+F.p$2(_5)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[2];},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,n);o=k.Meaning=N.Class({toString:function(){return((((N.Curried(function(_2,_3,_4,_5){return _2(F.p(_3)+" "+F.p$3(_4)+". "+F.p$5(_5));},4))(a.id))(this.get_Intent()))(this.get_Trait()))(this.get_Entities());},get_Entities:function(){return(this.Unwrap())[2];},get_Trait:function(){return(this.Unwrap())[1];},get_Intent:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,o);q.New=function(_2,_3,_4,_5,_6){return{body:_2,end:_3,start:_4,suggested:_5,value:_6};};p["Intent'"]=function(_2,_3){return!(_3.intent==null)?{$:1,$0:new l({$:0,$0:d.toLower(_3.intent.value),$1:null})}:null;};p["Trait'"]=function(_2){return!(_2.greetings==null)?{$:1,$0:new m({$:0,$0:"greetings",$1:d.toLower(_2.contact.value)})}:null;};p["Entity'$1"]=function(_2){return!(_2.contact==null)?{$:1,$0:new n({$:0,$0:"contact",$1:d.toLower(_2.contact.value),$2:null})}:null;};s=r["Meaning'"]=N.Class({get_TopIntent:function(){return O.head(O.sortBy(function(_2){return _2.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,s);t=r["Intent'"]=N.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,t);u=r["Entity'"]=N.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,u);r.HasMeaning=function(_2){var _3,_4,_5,_6,_7,_8;return _2!=null&&_2.$==1&&(_2.$0.$0.$==0&&(_2.$0.$1.get_Length()>0&&(_3=_2.$0.$1,true)))?{$:1,$0:new o({$:0,$0:null,$1:null,$2:{$:1,$0:O.map(function(_9){return new n({$:0,$0:d.toLower(_9.get_Role()),$1:_9.get_Value(),$2:{$:1,$0:_9.get_Confidence()}});},O.filter(function(_9){return _9.get_Confidence()>r.entityConfidenceThreshold();},_3))}})}:_2!=null&&_2.$==1&&(_2.$0.$1.$==0&&(_2.$0.get_TopIntent().get_Confidence()>r.intentConfidenceThreshold()&&(_4=[_2.$0.$0,_2],true)))?(_5=_4[1],{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(_5.$0.get_TopIntent().get_Name()),$1:{$:1,$0:_5.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):_2!=null&&_2.$==1&&(_2.$0.get_TopIntent().get_Confidence()>r.intentConfidenceThreshold()&&(_6=[_2.$0.$1,_2.$0.$0,_2],true))?(_7=_6[2],(_8=O.map(function(_9){return new n({$:0,$0:d.toLower(_9.get_Role()),$1:_9.get_Value(),$2:{$:1,$0:_9.get_Confidence()}});},O.filter(function(_9){return _9.get_Confidence()>r.entityConfidenceThreshold();},_7.$0.get_Entities())),{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(_7.$0.get_TopIntent().get_Name()),$1:{$:1,$0:_7.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:_8}})})):null;};r.entityConfidenceThreshold=function(){v.$cctor();return v.entityConfidenceThreshold;};r.set_entityConfidenceThreshold=function(_2){v.$cctor();v.entityConfidenceThreshold=_2;};r.intentConfidenceThreshold=function(){v.$cctor();return v.intentConfidenceThreshold;};r.set_intentConfidenceThreshold=function(_2){v.$cctor();v.intentConfidenceThreshold=_2;};r.QuickPrograms=function(_2){return _2==="programs"?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};r.QuickNo=function(_2){var _3;return _2==="no"||(_2==="NO"||(_2==="No"||(_2==="nope"||(_2==="no way"||(_2==="nah"||(_2==="don't do it"||_2==="stop"))))))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"yes",$1:null})},$1:null,$2:null})}:null;};r.QuickYes=function(_2){var _3;return _2==="yes"||(_2==="YES"||(_2==="Yes"||(_2==="YEs"||(_2==="ok"||(_2==="sure"||(_2==="yeah"||(_2==="yep"||(_2==="uh huh"||(_2==="go ahead"||_2==="go")))))))))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"yes",$1:null})},$1:null,$2:null})}:null;};r.QuickHelp=function(_2){var _3;return _2==="help"||(_2==="help me"||(_2==="what's this?"||_2==="huh"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"help",$1:null})},$1:null,$2:null})}:null;};r.QuickHello=function(_2){var _3;return _2==="hello"||(_2==="hey"||(_2==="yo"||_2==="hi"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"hello",$1:null})},$1:null,$2:null})}:null;};r.DebugOff=function(_2){return _2==="debug off"?{$:1,$0:null}:null;};r.DebugOn=function(_2){return _2==="debug on"?{$:1,$0:null}:null;};r.Blank=function(_2){return _2===""?{$:1,$0:null}:null;};v.$cctor=function(){v.$cctor=a.ignore;v.intentConfidenceThreshold=0.85;v.entityConfidenceThreshold=0.85;};x=w.User=N.Class({toString:function(){return this.Name;}},null,x);x.New=function(_2){return new x({Name:_2});};y=w.Interpreter=N.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,y);z=w.CUI=N.Class({get_StopSpeaking:function(){if(a.speechSynthesis.speaking||a.speechSynthesis.pending)a.speechSynthesis.cancel();},SayVoices:function(){var _2,_3,_4;_2=this;_3=a.speechSynthesis.getVoices();!(_3==null)?(_4=d.toArray(_3),_2.Say((function(_5){return function(_6){return _5("There are currently "+a.String(_6)+" voices installed on this computer or device.");};}(a.id))(I.length(_4))),I.iteri(function(_5,_6){return _2.Say(((((N.Curried(function(_7,_8,_9,_){return _7("Voice "+a.String(_8)+". Name: "+K.toSafe(_9)+", Local: "+K.prettyPrint(_)+".");},4))(a.id))(_5))(_6.name))(_6.localService));},_4)):void 0;},Wait:function(_2){this.Wait$1(function(){T.Start(_2,null);});},Wait$1:function(_2){this["Echo'"]("please wait...");this.Term.pause();_2();this.Term.resume();},sayRandom:function(_2,_3){this.Say(w.getRandomPhrase(_2,_3));},Say:function(_2){var _3,_4,_5;_3=this.Voice;_3!=null&&_3.$==1?(_4=_3.$0,T.Start((_5=null,T.Delay(function(){var _6;_6=new a.SpeechSynthesisUtterance(_2);_6.voice=_4;a.speechSynthesis.speak(_6);return T.Zero();})),null),this.Caption?this["Echo'"](_2):void 0):this["Echo'"](_2);},Debug:function(_2){d.debug(_2);this.DebugMode?this["EchoHtml'"](_2):void 0;},"EchoHtml'":function(_2){var _3,_4;_3=(_4={},_4.raw=true,_4);this.Term.disable();this.Term.echo(_2,_3);this.Term.enable();},"Echo'":function(_2){this.Term.disable();this.Term.echo(_2);this.Term.enable();}},null,z);z.New=function(_2,_3,_4,_5,_6){return new z({Voice:_2,Mic:_3,Term:_4,DebugMode:_5,Caption:_6});};w.helpPhrases=function(){A.$cctor();return A.helpPhrases;};w.helloUserPhrases=function(){A.$cctor();return A.helloUserPhrases;};w.helloPhrases=function(){A.$cctor();return A.helloPhrases;};w.waitRetrievePhrases=function(){A.$cctor();return A.waitRetrievePhrases;};w["getRandomPhrase'"]=function(_2){return d.replace_tok("$0","",P.nth(w.rng().Next(0,_2.get_Length()),_2));};w.getRandomPhrase=function(_2,_3){return d.replace_tok("$0",_3,P.nth(w.rng().Next(0,_2.get_Length()),_2));};w.rng=function(){A.$cctor();return A.rng;};A.$cctor=function(){A.$cctor=a.ignore;A.rng=new U.New();A.waitRetrievePhrases=O.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);A.helloPhrases=O.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);A.helloUserPhrases=O.ofArray(["Hi $0, welcome back.","Welcome $0, nice to see you again..","Hello $0","Good to see you $0."]);A.helpPhrases=O.ofArray(["What can I help you with $0?"]);};B.update=function(_2,_3,_4,_5){var _6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt;function bu(bA){return _3.ContainsKey(bA);}function bv(bA){return!bu("user")?{$:1,$0:bA.Unwrap()}:null;}function bw(bA){var bB;_4.unshift((bB=bA,a.String(bB)));_2.Say(bA);}function bx(bA,bB){var bC;bC=w.getRandomPhrase(bA,bB);_4.unshift(bC);return _2.Say(bC);}function by(bA){var bB;T.Start((bB=null,T.Delay(function(){bx(w.waitRetrievePhrases(),"user name");return T.Bind((new W.New()).Async("SMApp.Web:SMApp.Web.Server.GetUser2:105540119",[bA]),function(bC){return bC==null?(bw((function(bD){return function(bE){return bD("Sorry I did not find the user name "+K.toSafe(bE)+".");};}(a.id))(bA)),T.Zero()):(_3.Add("user",bC.$0),bx(w.helloUserPhrases(),(function(bD){return function(bE){return bD(K.prettyPrint(bE));};}(a.id))(_3.get_Item("user"))),T.Zero());});})),null);}function bz(bA){var bB,bC;for(bB=1,bC=bA;bB<=bC;bB++)_5.shift();}_6=_5.length>=5?5:_5.length;B.debug((function(bA){return function(bB){return bA("Current context: "+K.prettyPrint(bB)+".");};}(a.id))(_5));_7=O.ofSeq(P.take(_6,_5));_7.$==1&&(_9=bv(_7.$0),_9!=null&&_9.$==1&&((_=B.Intent("hello",_9.$0[0]),_!=null&&_.$==1)&&(_9.$0[1]==null&&(_9.$0[2]==null&&_7.$1.$==0))))?bx(w.helloPhrases(),""):_7.$==1&&(ba=bu("user")?{$:1,$0:_7.$0.Unwrap()}:null,ba!=null&&ba.$==1&&((bb=B.Intent("hello",ba.$0[0]),bb!=null&&bb.$==1)&&(ba.$0[1]==null&&(ba.$0[2]==null&&_7.$1.$==0))))?(bx(w.helloUserPhrases(),(function(bA){return function(bB){return bA(K.prettyPrint(bB));};}(a.id))(_3.get_Item("user"))),bz(1)):_7.$==1&&(bd=bv(_7.$0),bd!=null&&bd.$==1&&((be=B.Intent("hello",bd.$0[0]),be!=null&&be.$==1)&&(bd.$0[1]==null&&((bf=bd.$0[2],bf!=null&&bf.$==1)&&(bd.$0[2].$0.$==1&&(bg=B.Entity("contact",bd.$0[2].$0.$0),bg!=null&&bg.$==1&&(bd.$0[2].$0.$1.$==0&&(_7.$1.$==0&&(bc=bg.$0,true)))))))))?(by(bc),bz(1)):_7.$==1&&(bi=bv(_7.$0),bi!=null&&bi.$==1&&(bi.$0[0]==null&&(bi.$0[1]==null&&((bj=bi.$0[2],bj!=null&&bj.$==1)&&(bi.$0[2].$0.$==1&&(bk=B.Entity("contact",bi.$0[2].$0.$0),bk!=null&&bk.$==1&&(bi.$0[2].$0.$1.$==0&&(_7.$1.$==1&&(bl=bv(_7.$1.$0),bl!=null&&bl.$==1&&((bm=B.Intent("hello",bl.$0[0]),bm!=null&&bm.$==1)&&(bl.$0[1]==null&&(bl.$0[2]==null&&(_7.$1.$1.$==0&&(bh=bk.$0,true))))))))))))))?(by(bh),bz(2)):_7.$==1&&(bo=bv(_7.$0),bo!=null&&bo.$==1&&((bp=B.Intent("hello",bo.$0[0]),bp!=null&&bp.$==1)&&(bo.$0[1]==null&&((bq=bo.$0[2],bq!=null&&bq.$==1)&&(bo.$0[2].$0.$==1&&(br=B.Entity("contact",bo.$0[2].$0.$0),br!=null&&br.$==1&&(bo.$0[2].$0.$1.$==0&&(_7.$1.$==1&&(bs=bv(_7.$1.$0),bs!=null&&bs.$==1&&((bt=B.Intent("hello",bs.$0[0]),bt!=null&&bt.$==1)&&(bs.$0[1]==null&&(bs.$0[2]==null&&(_7.$1.$1.$==0&&(bn=br.$0,true))))))))))))))?(by(bn),bz(2)):(bz(1),bw("Sorry I didn't understand what you meant."));};B.Entity=function(_2,_3){return _3.get_Name()===_2?{$:1,$0:_3.get_Value()}:null;};B.Intent=function(_2,_3){var _4;return _3!=null&&_3.$==1&&(_3.$0.$0===_2&&(_4=_3.$0.$0,true))?{$:1,$0:null}:null;};B.history=function(){C.$cctor();return C.history;};B.debug=function(_2){d.debug((function(_3){return function(_4){return _3("Main: "+K.prettyPrint(_4));};}(a.id))(_2));};C.$cctor=function(){C.$cctor=a.ignore;C.history=[];};D.run=function(){var _2,_3;_2=N.ThisFunc(function(_4,_5){return((D.Main().get_Text())(_4))(_5);});_3=D.Main().get_Options();a.$("#main").terminal(_2,_3);return R.get_Empty();};D.Main=function(){E.$cctor();return E.Main;};D.container=function(){E.$cctor();return E.container;};D.wait=function(_2){d["Terminal.Echo'"](D.CUI().Term,"please wait");D.CUI().Term.disable();_2();D.CUI().Term.enable();};D.stopSpeaking=function(){E.$cctor();return E.stopSpeaking;};D.sayRandom=function(_2,_3){D.say(w.getRandomPhrase(_3,_2));};D.sayVoices=function(){var _2,_3;_2=a.speechSynthesis.getVoices();!(_2==null)?(_3=d.toArray(_2),D.say((function(_4){return function(_5){return _4("There are currently "+a.String(_5)+" voices installed on this computer or device.");};}(a.id))(I.length(_3))),I.iteri(function(_4,_5){return D.say(((((N.Curried(function(_6,_7,_8,_9){return _6("Voice "+a.String(_7)+". Name: "+K.toSafe(_8)+", Local: "+K.prettyPrint(_9)+".");},4))(a.id))(_4))(_5.name))(_5.localService));},_3)):void 0;};D.say=function(_2){var _3,_4,_5;D.Msgs().unshift(_2);_3=D.CUI().Voice;_3!=null&&_3.$==1?(_4=_3.$0,T.Start((_5=null,T.Delay(function(){var _6;_6=new a.SpeechSynthesisUtterance(_2);_6.voice=_4;a.speechSynthesis.speak(_6);D.CUI().Caption?d["Terminal.Echo'"](D.CUI().Term,_2):void 0;return T.Zero();})),null)):d["Terminal.Echo'"](D.CUI().Term,_2);};D.initMic=function(_2){var _3,_4;D.set_CUI((_3={$:1,$0:new X.Microphone(Y.getElementById("microphone"))},z.New(D.CUI().Voice,_3,D.CUI().Term,D.CUI().DebugMode,D.CUI().Caption)));_4=D.CUI().Mic.$0;_4.onconnecting=function(){D.set_MicState({$:1});return D.debug("Mic connecting...");};_4.ondisconnected=function(){D.set_MicState({$:2});return D.debug("Mic disconnected.");};_4.onaudiostart=function(){D.set_MicState({$:3});return D.debug("Mic audio start...");};_4.onaudioend=function(){D.set_MicState({$:4});return D.debug("Mic audio end.");};_4.onerror=function(_5){D.set_MicState({$:6,$0:_5});return D.debug((function(_6){return function(_7){return _6("Mic error : "+K.toSafe(_7)+".");};}(a.id))(_5));};_4.onready=function(){D.set_MicState({$:5});return D.debug("Mic ready.");};_4.onresult=function(_5,_6){return!(_5==null||_6==null)?(D.set_MicState({$:7,$0:_5,$1:_6}),D.debug((((N.Curried3(function(_7,_8,_9){return _7("Mic result: "+K.prettyPrint(_8)+" "+K.prettyPrint(_9)+".");}))(a.id))(_5))(_6)),_2(_4,[_5,_6])):D.debug("Mic: No result returned.");};_4.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};D.initSpeech=function(){var _2,_3;_2=a.speechSynthesis.getVoices();!(_2==null)?(_3=d.toArray(_2),I.iter(function(_4){if(Z.Equals(D.CUI().Voice,null)&&(_4.name.indexOf("Microsoft Zira")!=-1||_4.name.toLowerCase().indexOf("female")!=-1)){D.set_CUI(z.New({$:1,$0:_4},D.CUI().Mic,D.CUI().Term,D.CUI().DebugMode,D.CUI().Caption));D.debug((function(_5){return function(_6){return _5("Using voice "+K.toSafe(_6)+".");};}(a.id))(D.CUI().Voice.$0.name));}},_3),Z.Equals(D.CUI().Voice,null)&&I.length(_3)>0?(D.set_CUI(z.New({$:1,$0:I.find(function(_4){return _4["default"];},_3)},D.CUI().Mic,D.CUI().Term,D.CUI().DebugMode,D.CUI().Caption)),D.debug((function(_4){return function(_5){return _4("Using default voice "+K.toSafe(_5)+".");};}(a.id))(D.CUI().Voice.$0.name))):void 0):void 0;Z.Equals(D.CUI().Voice,null)?(d.error("No speech synthesis voice is available."),d["Terminal.Echo'"](D.CUI().Term,"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma.")):void 0;};D.pushCtx=function(_2){D.Context().unshift(_2);return D.Context();};D.Context=function(){E.$cctor();return E.Context;};D.debug=function(_2){var _3;_3=(function(_4){return function(_5){return _4("Client: "+K.prettyPrint(_5));};}(a.id))(_2);d.debug(_3);D.CUI().DebugMode?d["Terminal.EchoHtml'"](D.CUI().Term,_3):void 0;};D.Msgs=function(){E.$cctor();return E.Msgs;};D.Props=function(){E.$cctor();return E.Props;};D.OpState=function(){E.$cctor();return E.OpState;};D.set_OpState=function(_2){E.$cctor();E.OpState=_2;};D.MicState=function(){E.$cctor();return E.MicState;};D.set_MicState=function(_2){E.$cctor();E.MicState=_2;};D.CUI=function(){E.$cctor();return E.CUI;};D.set_CUI=function(_2){E.$cctor();E.CUI=_2;};E.$cctor=function(){var _2;E.$cctor=a.ignore;function _3(_5,_6){var _7,_8,_9,_,$,ba,bb,bc,bd,be,bf;_7=_6[0];_8=_6[1];D.debug((((N.Curried3(function(bg,bh,bi){return bg("Voice: "+K.prettyPrint(bh)+" "+K.prettyPrint(bi));}))(a.id))(_7))(_8));_9=(_=p["Intent'"](_7,_8),_!=null&&_.$==1?{$:1,$0:_.$0}:null);$=(ba=p["Trait'"](_8),ba!=null&&ba.$==1?{$:1,$0:ba.$0}:null);bb=(bc=p["Entity'$1"](_8),bc!=null&&bc.$==1?{$:1,$0:O.ofArray([bc.$0])}:null);return _9==null&&($==null&&bb==null)?null:(D.debug(((((N.Curried(function(bg,bh,bi,bj){return bg("Voice: "+F.p(bh)+" "+F.p$3(bi)+" "+F.p$5(bj));},4))(a.id))(_9))($))(bb)),(D.OpState()==null?false:D.OpState().$0.$==0)?D.say("I'm still working on understanding your last message."):(bf=D.pushCtx(new o({$:0,$0:_9,$1:$,$2:bb})),B.update(D.CUI(),D.Props(),D.Msgs(),bf)));}function _4(_5,_6){var _7,_8,_9,_,$,ba,bb,bc,bd,be;D.set_CUI(z.New(D.CUI().Voice,D.CUI().Mic,_5,D.CUI().DebugMode,D.CUI().Caption));Z.Equals(D.CUI().Voice,null)?D.initSpeech():void 0;Z.Equals(D.CUI().Mic,null)?D.initMic(_3):void 0;return(_7=r.Blank(_6),_7!=null&&_7.$==1)?D.say("Tell me what you want me to do or ask me a question."):(_8=r.DebugOn(_6),_8!=null&&_8.$==1)?(D.set_CUI(z.New(D.CUI().Voice,D.CUI().Mic,D.CUI().Term,true,D.CUI().Caption)),D.say("Debug mode is now on.")):(_9=r.DebugOff(_6),_9!=null&&_9.$==1)?(D.set_CUI(z.New(D.CUI().Voice,D.CUI().Mic,D.CUI().Term,false,D.CUI().Caption)),D.say("Debug mode is now off.")):(D.OpState()==null?false:D.OpState().$0.$==0)?D.say("I'm still working on understanding your last message."):(ba=r.QuickHello(_6),ba!=null&&ba.$==1?($=ba.$0,true):(bb=r.QuickHelp(_6),bb!=null&&bb.$==1?($=bb.$0,true):(bc=r.QuickPrograms(_6),bc!=null&&bc.$==1&&($=bc.$0,true))))?(D.debug((function(bf){return function(bg){return bf("Quick Text: "+F.p$7(bg)+".");};}(a.id))($)),bd=D.pushCtx($),B.update(D.CUI(),D.Props(),D.Msgs(),bd)):D.CUI().Wait((be=null,T.Delay(function(){D.set_OpState({$:1,$0:{$:0}});return T.Combine(T.Bind((new W.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:1740520286",[_6]),function(bf){var bg,bh,bi;bg=r.HasMeaning(bf);return bg!=null&&bg.$==1?(bh=bg.$0,(D.debug(((((N.Curried(function(bj,bk,bl,bm){return bj("Text: "+F.p(bk)+" "+F.p$3(bl)+" "+F.p$5(bm));},4))(a.id))(bh.get_Intent()))(bh.get_Trait()))(bh.get_Entities())),bi=D.pushCtx(bh),B.update(D.CUI(),D.Props(),D.Msgs(),bi),T.Zero())):(D.debug("Text: Did not receive a response from the server."),d["Terminal.Echo'"](_5,"Sorry I did not understand what you said."),T.Zero());}),T.Delay(function(){D.set_OpState(null);return T.Zero();}));})));}E.CUI=z.New(null,null,null,false,false);E.MicState={$:0};E.OpState=null;E.Props=new _1.New$5();E.Msgs=[];E.Context=[];E.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;E.container=i.Container;E.Main=new y({$:0,$0:function(_5){return function(_6){return _3(_5,_6);};},$1:[function(_5){return function(_6){return _4(_5,_6);};},(_2={},_2.name="Main",_2.greetings="Welcome to Selma. Enter 'hello my name is...(you)' to begin and initialize speech or help for more assistance.",_2.prompt=">",_2)]});};F.p$2=function(_2){return _2==null?"null":"Some "+K.prettyPrint(_2.$0);};F.p$1=function(_2){return"Intent ("+K.prettyPrint(_2.$0)+", "+F.p$2(_2.$1)+")";};F.p=function(_2){return _2==null?"null":"Some "+F.p$1(_2.$0);};F.p$4=function(_2){return"Trait ("+K.prettyPrint(_2.$0)+", "+K.prettyPrint(_2.$1)+")";};F.p$3=function(_2){return _2==null?"null":"Some "+F.p$4(_2.$0);};F.p$6=function(_2){return"Entity ("+K.prettyPrint(_2.$0)+", "+K.prettyPrint(_2.$1)+", "+F.p$2(_2.$2)+")";};F.p$5=function(_2){return _2==null?"null":"Some "+K.printList(function(_3){return F.p$6(_3);},_2.$0);};F.p$7=function(_2){return"Meaning ("+F.p(_2.$0)+", "+F.p$3(_2.$1)+", "+F.p$5(_2.$2)+")";};}());
