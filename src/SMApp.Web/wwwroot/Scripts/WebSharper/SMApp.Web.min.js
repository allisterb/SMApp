(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=b.Bootstrap=b.Bootstrap||{};i=h.Controls=h.Controls||{};j=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};k=c.NLU=c.NLU||{};l=k.Intent=k.Intent||{};m=k.Trait=k.Trait||{};n=k.Meaning=k.Meaning||{};o=k.Voice=k.Voice||{};p=o["Entity'"]=o["Entity'"]||{};q=k.Text=k.Text||{};r=q.Meaning=q.Meaning||{};s=q.Intent=q.Intent||{};t=q.Entity=q.Entity||{};u=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};v=c.CUI=c.CUI||{};w=c.CUIModule=c.CUIModule||{};x=w.User=w.User||{};y=w.Interpreter=w.Interpreter||{};z=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};A=c.Main=c.Main||{};B=c.Client=c.Client||{};C=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};D=a.WebSharper;E=D&&D.Arrays;F=a.jQuery;G=a.console;H=a.IntelliFactory;I=H&&H.Runtime;J=D&&D.Strings;K=D&&D.List;L=D&&D.Seq;M=D&&D.UI;N=M&&M.Doc;O=M&&M.AttrModule;P=D&&D.Utils;Q=D&&D.Concurrency;R=D&&D.Random;S=D&&D.Remoting;T=S&&S.AjaxRemotingProvider;U=a.Wit;V=a.document;W=D&&D.Unchecked;d.toArray=function(X){return E.map(a.id,F.makeArray(X));};d.error=function(X){G.error(X);};d.info=function(X){G.info(X);};d.jserror=function(X){F.error(X);};d["Terminal.EchoHtml'"]=function(X,Y){X.disable();X.echo(Y,d.rawOpt());X.enable();};d["Terminal.Echo'"]=function(X,Y){X.disable();X.echo(Y);X.enable();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=I.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(X){function Y(Z){return function(_0){var _1,_2,_3,_4,_5,_6,_7;_2=J.replicate(Z," ");switch(_0.$==0?_0.$1.$==1?_0.$1.$0.$==2?_0.$1.$1.$==0?(_1=[_0.$1.$0.$0,_0.$0],1):(_1=[_0.$1,_0.$0],2):(_1=[_0.$1,_0.$0],2):(_1=[_0.$1,_0.$0],2):_0.$==2?(_1=_0.$0,3):(_1=[_0.$0,_0.$1],0)){case 0:return _1[0]+"=\""+_1[1]+"\"";case 1:_3=_1[1];return _2+"<"+_3+">"+_1[0]+"</"+_3+">\r\n";case 2:_4=_1[1];_5=K.partition(function(_8){return _8.$==1;},_1[0]);_6=_5[1];_7=_5[0];return _6.$==0?_2+"<"+_4+(_7.$===0?"":" "+J.concat(" ",K.ofSeq(L.delay(function(){return L.map(function(_8){return(Y(0))(_8);},_7);}))))+"/>\r\n":_2+"<"+_4+(_7.$===0?"":" "+J.concat(" ",K.ofSeq(L.delay(function(){return L.map(function(_8){return(Y(0))(_8);},_7);}))))+">\r\n"+J.concat("",K.ofSeq(L.delay(function(){return L.map(function(_8){return(Y(Z+1))(_8);},_6);})))+_2+"</"+_4+">\r\n";case 3:return _2+_1+"\r\n";}};}return(Y(0))(X);};f.alt=function(X){return new e({$:1,$0:"alt",$1:X});};f.src=function(X){return new e({$:1,$0:"src",$1:X});};f.cls=function(X){return new e({$:1,$0:"class",$1:X});};f.str=function(X){return e.toString(X);};f.op_PercentEquals=function(X,Y){return new e({$:1,$0:X,$1:Y});};f.op_Splice=function(X){var Y;return K.ofArray([new e({$:2,$0:(Y=X,a.String(Y))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(X,Y){return new e({$:0,$0:X,$1:Y});};g.$cctor=function(){var X;g.$cctor=a.ignore;g.rawOpt=(X={},X.raw=true,X);g.html=function(Y){return f.elem("html",Y);};g.head=function(Y){return f.elem("head",Y);};g.title=function(Y){return f.elem("title",Y);};g.style=function(Y){return f.elem("style",Y);};g.body=function(Y){return f.elem("body",Y);};g.div=function(Y){return f.elem("div",Y);};g.br=function(Y){return f.elem("br",Y);};g.section=function(Y){return f.elem("section",Y);};g.span=function(Y){return f.elem("span",Y);};g.table=function(Y){return f.elem("table",Y);};g.thead=function(Y){return f.elem("thead",Y);};g.tbody=function(Y){return f.elem("tbody",Y);};g.tfoot=function(Y){return f.elem("tfoot",Y);};g.img=function(Y){return f.elem("img",Y);};g.map=function(Y){return f.elem("map",Y);};g.area=function(Y){return f.elem("area",Y);};g.p=function(Y){return f.elem("p",Y);};g.a=function(Y){return f.elem("a",Y);};g.tr=function(Y){return f.elem("tr",Y);};g.td=function(Y){return f.elem("td",Y);};g.th=function(Y){return f.elem("th",Y);};g.ul=function(Y){return f.elem("ul",Y);};g.li=function(Y){return f.elem("li",Y);};g.h1=function(Y){return f.elem("h1",Y);};g.h2=function(Y){return f.elem("h1",Y);};g.h3=function(Y){return f.elem("h1",Y);};g.h4=function(Y){return f.elem("h1",Y);};g.strong=function(Y){return f.elem("strong",Y);};};i.Radio=function(X,Y,Z,_0,_1){return N.Element("div",new K.T({$:1,$0:(i.cls())("radio"),$1:Y}),[N.Element("label",_0,[N.Radio(_1,true,Z),N.TextNode(X)])]);};i.Checkbox=function(X,Y,Z,_0,_1){return N.Element("div",new K.T({$:1,$0:(i.cls())("checkbox"),$1:Y}),[N.Element("label",_0,[N.CheckBox(_1,Z),N.TextNode(X)])]);};i.TextArea=function(X,Y,Z,_0,_1){return N.Element("div",new K.T({$:1,$0:(i.cls())("form-group"),$1:Y}),[N.Element("label",_0,[N.TextNode(X)]),N.InputArea(new K.T({$:1,$0:(i.cls())("form-control"),$1:_1}),Z)]);};i.InputPassword=function(X,Y,Z,_0,_1){return N.Element("div",new K.T({$:1,$0:(i.cls())("form-group"),$1:Y}),[N.Element("label",_0,[N.TextNode(X)]),N.PasswordBox(new K.T({$:1,$0:(i.cls())("form-control"),$1:_1}),Z)]);};i.Input=function(X,Y,Z,_0,_1){return N.Element("div",new K.T({$:1,$0:(i.cls())("form-group"),$1:Y}),[N.Element("label",_0,[N.TextNode(X)]),N.Input(new K.T({$:1,$0:(i.cls())("form-control"),$1:_1}),Z)]);};i.Container=function(X){return N.Element("div",[(i.cls())("container")],X);};i.Class=function(){j.$cctor();return j.Class;};i.cls=function(){j.$cctor();return j.cls;};j.$cctor=function(){j.$cctor=a.ignore;j.cls=O.Class;j.Class=O.Class;};l.Programs={$:3};l.Onboard={$:2};l.Help={$:1};l.Hello={$:0};m.Greetings={$:0};n=k.Meaning=I.Class({get_Entities:function(){return(this.Unwrap())[2];},get_Trait:function(){return(this.Unwrap())[1];},get_Intent:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,n);p.New=function(X,Y,Z,_0,_1){return{body:X,end:Y,start:Z,suggested:_0,value:_1};};o.Contact=function(X){return!(X.contact==null)?{$:1,$0:{$:0,$0:p.New(X.body,X.end,X.start,X.ff,X.value).value}}:null;};o.Greetings=function(X){return!(X.greetings==null)&&!(X.greetings.value==null)?{$:1,$0:m.Greetings}:null;};o.Hello=function(X){return typeof X=="string"&&X.toLowerCase()==="default_intent"?{$:1,$0:l.Hello}:null;};r=q.Meaning=I.Class({get_TopIntent:function(){return K.head(K.sortBy(function(X){return X.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,r);s=q.Intent=I.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,s);t=q.Entity=I.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,t);q.HelloUser=function(X){var Y,Z;return(Z=q.Hello(X),Z!=null&&Z.$==1&&(Z.$0.$==1&&(Z.$0.$1.$==0&&(Z.$0.$0.get_Role()==="contact"&&(Y=Z.$0.$0,true)))))?{$:1,$0:Y}:null;};q.Hello=function(X){var Y,Z;return X!=null&&X.$==1&&(Z=q.Intent$1("Hello",X.$0),Z!=null&&Z.$==1&&(Y=Z.$0,true))?{$:1,$0:Y}:null;};q.Intent$1=function(X,Y){return Y.get_TopIntent().get_Name()===X&&Y.get_TopIntent().get_Confidence()>q.intentConfidenceThreshold()?{$:1,$0:K.filter(function(Z){return Z.get_Confidence()>q.entityConfidenceThreshold();},Y.get_Entities())}:null;};q.entityConfidenceThreshold=function(){u.$cctor();return u.entityConfidenceThreshold;};q.set_entityConfidenceThreshold=function(X){u.$cctor();u.entityConfidenceThreshold=X;};q.intentConfidenceThreshold=function(){u.$cctor();return u.intentConfidenceThreshold;};q.set_intentConfidenceThreshold=function(X){u.$cctor();u.intentConfidenceThreshold=X;};q.QuickPrograms=function(X){return X==="programs"?{$:1,$0:l.Programs}:null;};q.QuickHelp=function(X){var Y;return X==="help"||(X==="help me"||(X==="what's this?"||X==="huh"))?{$:1,$0:l.Help}:null;};q.QuickHello=function(X){var Y;return X==="hello"||(X==="hey"||(X==="yo"||X==="hi"))?{$:1,$0:l.Hello}:null;};q.DebugOff=function(X){return X==="debug off"?{$:1,$0:null}:null;};q.DebugOn=function(X){return X==="debug on"?{$:1,$0:null}:null;};u.$cctor=function(){u.$cctor=a.ignore;u.intentConfidenceThreshold=0.85;u.entityConfidenceThreshold=0.85;};v=c.CUI=I.Class({get_StopSpeaking:function(){if(a.speechSynthesis.speaking||a.speechSynthesis.pending)a.speechSynthesis.cancel();},SayVoices:function(){var X,Y,Z;X=this;Y=a.speechSynthesis.getVoices();!(Y==null)?(Z=d.toArray(Y),X.Say((function(_0){return function(_1){return _0("There are currently "+a.String(_1)+" voices installed on this computer or device.");};}(a.id))(E.length(Z))),E.iteri(function(_0,_1){return X.Say(((((I.Curried(function(_2,_3,_4,_5){return _2("Voice "+a.String(_3)+". Name: "+P.toSafe(_4)+", Local: "+P.prettyPrint(_5)+".");},4))(a.id))(_0))(_1.name))(_1.localService));},Z)):void 0;},Wait:function(X){this.Wait$1(function(){Q.Start(X,null);});},Wait$1:function(X){this["Echo'"]("please wait");this.Term.disable();X();this.Term.enable();},Say:function(X){var Y,Z,_0;Y=this.Voice;Y!=null&&Y.$==1?(Z=Y.$0,Q.Start((_0=null,Q.Delay(function(){var _1;_1=new a.SpeechSynthesisUtterance(X);_1.voice=Z;a.speechSynthesis.speak(_1);return Q.Zero();})),null),this.Caption?this["Echo'"](X):void 0):this["Echo'"](X);},DebugEcho:function(X){if(this.Debug)this["EchoHtml'"](X);},"EchoHtml'":function(X){var Y,Z;Y=(Z={},Z.raw=true,Z);this.Term.disable();this.Term.echo(X,Y);this.Term.enable();},"Echo'":function(X){this.Term.disable();this.Term.echo(X);this.Term.enable();}},null,v);v.New=function(X,Y,Z,_0,_1){return new v({Voice:X,Mic:Y,Term:Z,Debug:_0,Caption:_1});};x.New=function(X){return{UserName:X};};y=w.Interpreter=I.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,y);w.helloUserPhrases=function(){z.$cctor();return z.helloUserPhrases;};w.helloPhrases=function(){z.$cctor();return z.helloPhrases;};w.getRandomPhrase=function(X){return L.nth(w.rng().Next(0,X.get_Length()),X);};w.rng=function(){z.$cctor();return z.rng;};z.$cctor=function(){z.$cctor=a.ignore;z.rng=new R.New();z.helloPhrases=K.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);z.helloUserPhrases=K.ofArray(["Hi $user, welcome back.","Welcome $user, nice to see you again..","Hello $user","Good to see you $user."]);};A.update=function(X,Y){var Z;X.Say("I'm in the Main module.");Y.$==1?Y.$0.$0.get_Intent().$===3?X.Wait((Z=null,Q.Delay(function(){return Q.Bind((new T.New()).Async("SMApp.Web:SMApp.Web.Server.GetPatients:1596745484",[]),function(_0){return _0.$==1?(X.Say((function(_1){return function(_2){return _1("I did not get the patients. Error "+P.toSafe(_2));};}(a.id))(_0.$0)),Q.Zero()):(X.Say("I got the patients"),Q.Zero());});}))):void 0:void 0;};B.run=function(){var X,Y;X=I.ThisFunc(function(Z,_0){return((B.Main().get_Text())(Z))(_0);});Y=B.Main().get_Options();a.$("#main").terminal(X,Y);return N.get_Empty();};B.Main=function(){C.$cctor();return C.Main;};B.container=function(){C.$cctor();return C.container;};B.wait=function(X){d["Terminal.Echo'"](B.CUI().Term,"please wait");B.CUI().Term.disable();X();B.CUI().Term.enable();};B.stopSpeaking=function(){C.$cctor();return C.stopSpeaking;};B.sayRandom=function(X){B.say(w.getRandomPhrase(X));};B.sayVoices=function(){var X,Y;X=a.speechSynthesis.getVoices();!(X==null)?(Y=d.toArray(X),B.say((function(Z){return function(_0){return Z("There are currently "+a.String(_0)+" voices installed on this computer or device.");};}(a.id))(E.length(Y))),E.iteri(function(Z,_0){return B.say(((((I.Curried(function(_1,_2,_3,_4){return _1("Voice "+a.String(_2)+". Name: "+P.toSafe(_3)+", Local: "+P.prettyPrint(_4)+".");},4))(a.id))(Z))(_0.name))(_0.localService));},Y)):void 0;};B.say=function(X){var Y,Z,_0;Y=B.CUI().Voice;Y!=null&&Y.$==1?(Z=Y.$0,Q.Start((_0=null,Q.Delay(function(){var _1;_1=new a.SpeechSynthesisUtterance(X);_1.voice=Z;a.speechSynthesis.speak(_1);return Q.Zero();})),null),B.CUI().Caption?d["Terminal.Echo'"](B.CUI().Term,X):void 0):d["Terminal.Echo'"](B.CUI().Term,X);};B.initMic=function(X,Y){var Z,_0;B.set_CUI((Z={$:1,$0:new U.Microphone(V.getElementById("microphone"))},v.New(B.CUI().Voice,Z,B.CUI().Term,B.CUI().Debug,B.CUI().Caption)));_0=B.CUI().Mic.$0;_0.onconnecting=function(){B.set_MicState({$:1});return B.debugEcho("Mic connecting...");};_0.ondisconnected=function(){return B.debugEcho("Mic disconnected.");};_0.onaudiostart=function(){return B.debugEcho("Mic audio start...");};_0.onaudioend=function(){return B.debugEcho("Mic audio end.");};_0.onerror=function(_1){return B.debugEcho((function(_2){return function(_3){return _2("Mic error : "+P.toSafe(_3)+".");};}(a.id))(_1));};_0.onready=function(){return B.debugEcho("Mic ready.");};_0.onresult=function(_1,_2){return X(_0,[_1,_2]);};_0.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};B.initSpeech=function(){var X,Y;X=a.speechSynthesis.getVoices();!(X==null)?(Y=d.toArray(X),E.iter(function(Z){if(W.Equals(B.CUI().Voice,null)&&(Z.name.indexOf("Microsoft Zira")!=-1||Z.name.toLowerCase().indexOf("female")!=-1)){B.set_CUI(v.New({$:1,$0:Z},B.CUI().Mic,B.CUI().Term,B.CUI().Debug,B.CUI().Caption));d.info((function(_0){return function(_1){return _0("Using voice "+P.toSafe(_1)+".");};}(a.id))(B.CUI().Voice.$0.name));}},Y),W.Equals(B.CUI().Voice,null)&&E.length(Y)>0?(B.set_CUI(v.New({$:1,$0:E.find(function(Z){return Z["default"];},Y)},B.CUI().Mic,B.CUI().Term,B.CUI().Debug,B.CUI().Caption)),d.info((function(Z){return function(_0){return Z("Using default voice "+P.toSafe(_0)+".");};}(a.id))(B.CUI().Voice.$0.name))):void 0):void 0;W.Equals(B.CUI().Voice,null)?(d.error("No speech synthesis voice is available."),d["Terminal.Echo'"](B.CUI().Term,"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma.")):void 0;};B.updateCtx=function(X){B.set_context(K.append(K.ofArray([{$:0,$0:X}]),B.context()));return K.ofSeq(L.take(B.context().get_Length()>=5?5:B.context().get_Length(),B.context()));};B.context=function(){C.$cctor();return C.context;};B.set_context=function(X){C.$cctor();C.context=X;};B.MicState=function(){C.$cctor();return C.MicState;};B.set_MicState=function(X){C.$cctor();C.MicState=X;};B.debugEcho=function(X){if(B.CUI().Debug)d["Terminal.EchoHtml'"](B.CUI().Term,X);};B.echo=function(){C.$cctor();return C.echo;};B.CUI=function(){C.$cctor();return C.CUI;};B.set_CUI=function(X){C.$cctor();C.CUI=X;};C.$cctor=function(){var X,Y;C.$cctor=a.ignore;function Z(_1,_2){var _3,_4;_3=_2[1];d.info(_2[0]);d.info(_3);_4=o.Greetings(_3);return _4!=null&&_4.$==1?d.info(_4.$0):d.error(_3);}function _0(_1,_2){var _3,_4,_5,_6,_7,_8,_9,_;B.set_CUI(v.New(B.CUI().Voice,B.CUI().Mic,_1,B.CUI().Debug,B.CUI().Caption));W.Equals(B.CUI().Voice,null)?B.initSpeech():void 0;W.Equals(B.CUI().Mic,null)?B.initMic(Z,_1):void 0;return(_3=q.DebugOn(_2),_3!=null&&_3.$==1)?(B.set_CUI(v.New(B.CUI().Voice,B.CUI().Mic,B.CUI().Term,true,B.CUI().Caption)),B.say("Debug mode is now on.")):(_4=q.DebugOff(_2),_4!=null&&_4.$==1)?(B.set_CUI(v.New(B.CUI().Voice,B.CUI().Mic,B.CUI().Term,false,B.CUI().Caption)),B.say("Debug mode is now off.")):(_6=q.QuickHello(_2),_6!=null&&_6.$==1?(_5=_6.$0,true):(_7=q.QuickHelp(_2),_7!=null&&_7.$==1?(_5=_7.$0,true):(_8=q.QuickPrograms(_2),_8!=null&&_8.$==1&&(_5=_8.$0,true))))?(_9=B.updateCtx(new n({$:0,$0:_5,$1:null,$2:null})),A.update(B.CUI(),_9)):B.CUI().Wait((_=null,Q.Delay(function(){return Q.Bind((new T.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:976018238",[_2]),function($){var ba;ba=q.HelloUser($);return ba!=null&&ba.$==1?(B.say((function(bb){return function(bc){return bb("This is the hello intent. The user name is "+P.toSafe(bc)+".");};}(a.id))(ba.$0.get_Value())),Q.Zero()):(d["Terminal.Echo'"](_1,"This is the whatever intent"),Q.Zero());});})));}C.CUI=v.New(null,null,null,false,false);C.echo=(X=B.CUI().Term,function(_1){d["Terminal.EchoHtml'"](X,_1);});C.MicState={$:0};C.context=K.T.Empty;C.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;C.container=i.Container;C.Main=new y({$:0,$0:function(_1){return function(_2){return Z(_1,_2);};},$1:[function(_1){return function(_2){return _0(_1,_2);};},(Y={},Y.name="Main",Y.greetings="Welcome to Selma. Type hello to begin or help for more assistance.",Y.prompt=">",Y)]});};}());
