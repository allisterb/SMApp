(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=d.SweetAlert=d.SweetAlert||{};f=c._Html=c._Html||{};g=c.htmModule=c.htmModule||{};h=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};i=c.TypingDNA=c.TypingDNA||{};j=i.SaveResponse=i.SaveResponse||{};k=i.UserResponse=i.UserResponse||{};l=i.VerifyResponse=i.VerifyResponse||{};m=c.Bs=c.Bs||{};n=b.NLU=b.NLU||{};o=n.Witai=n.Witai||{};p=o.Utterance=o.Utterance||{};q=o.Intent=o.Intent||{};r=o.Entity=o.Entity||{};s=o.Trait=o.Trait||{};t=o["Utterance'"]=o["Utterance'"]||{};u=o["Value'"]=o["Value'"]||{};v=c.BabelNet=c.BabelNet||{};w=v.DisambiguateApiResponse=v.DisambiguateApiResponse||{};x=v.TokenFragment=v.TokenFragment||{};y=v.CharFragment=v.CharFragment||{};z=c.NLG=c.NLG||{};A=a.StartupCode$SMApp_Web$NLG=a.StartupCode$SMApp_Web$NLG||{};B=c.NLU=c.NLU||{};C=B.Intent=B.Intent||{};D=B.Trait=B.Trait||{};E=B.Entity=B.Entity||{};F=B.Utterance=B.Utterance||{};G=B.Voice=B.Voice||{};H=G["Entity'"]=G["Entity'"]||{};I=B.Text=B.Text||{};J=I["Utterance'"]=I["Utterance'"]||{};K=I["Intent'"]=I["Intent'"]||{};L=I["Entity'"]=I["Entity'"]||{};M=I["Trait'"]=I["Trait'"]||{};N=B.Domain=B.Domain||{};O=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};P=c.Knowledge=c.Knowledge||{};Q=P.EmotionalTrait=P.EmotionalTrait||{};R=P.Relation=P.Relation||{};S=P.Triple=P.Triple||{};T=P.Subject=P.Subject||{};U=P.Verb=P.Verb||{};V=P.Object=P.Object||{};W=c.CUI=c.CUI||{};X=W.MicState=W.MicState||{};Y=W.ClientState=W.ClientState||{};Z=W.Interpreter=W.Interpreter||{};_0=W.CUI=W.CUI||{};_1=c.Dialogue=c.Dialogue||{};_2=c.Question=c.Question||{};_3=c.QuestionType=c.QuestionType||{};_4=c.DialogueModule=c.DialogueModule||{};_5=c.Questions=c.Questions||{};_6=c.User=c.User||{};_7=a.StartupCode$SMApp_Web$User=a.StartupCode$SMApp_Web$User||{};_8=c.Journal=c.Journal||{};_9=a.StartupCode$SMApp_Web$Journal=a.StartupCode$SMApp_Web$Journal||{};_=c.Symptoms=c.Symptoms||{};$=a.StartupCode$SMApp_Web$Symptoms=a.StartupCode$SMApp_Web$Symptoms||{};ba=c.Main=c.Main||{};bb=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};bc=c.Client=c.Client||{};bd=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};be=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};bf=a.GeneratedPrintf=a.GeneratedPrintf||{};bg=a.WebSharper;bh=bg&&bg.Arrays;bi=a.SweetAlert;bj=a.IntelliFactory;bk=bj&&bj.Runtime;bl=bg&&bg.Operators;bm=bg&&bg.UI;bn=bm&&bm.Doc;bo=bm&&bm.AttrProxy;bp=bm&&bm.Client;bq=bp&&bp.Templates;br=bg&&bg.Utils;bs=a.console;bt=a.jQuery;bu=bg&&bg.Strings;bv=bg&&bg.List;bw=bg&&bg.Seq;bx=bm&&bm.AttrModule;by=bg&&bg.Concurrency;bz=bg&&bg.Random;bA=bg&&bg.Collections;bB=bA&&bA.Map;bC=bg&&bg.JavaScript;bD=bC&&bC.Pervasives;bE=bg&&bg.ClientSideJson;bF=bE&&bE.Provider;bG=a.JSON;bH=a.SDK;bI=bg&&bg.Unchecked;bJ=bg&&bg.Remoting;bK=bJ&&bJ.AjaxRemotingProvider;bL=a.Wit;bM=a.document;bN=bA&&bA.Dictionary;d.getCameraCanvas=function(){return a.getCameraCanvas();};d.stopCamera=function(){return a.stopCamera();};d.startCamera=function(bO,bP){return a.startCamera(bO,bP);};d.speechSynthesis=function(){return a.speechSynthesis;};d.lastMicData=function(){return a.lastMicData;};d.Terminal=function(){return a.$("#term").terminal();};d.enableTerminal=function(){return a.$("#term").terminal().enable();};d.disableTerminal=function(){return a.$("#term").terminal().disable();};d.boxesWithTitles=function(bO){return bh.map(function(bP){var bQ;bQ={};bQ.titleText=bP;return bQ;},bO);};d.confirmQuestionBox=function(){bi.clickConfirm();};d.questionBox=function(bO,bP,bQ,bR,bS,bT,bU){var bV,bW,bX,bY,bZ,b0;bV=(bW=bR==null?(bX={},bX.titleText=bO,bX.text=bP,bX.icon="question",bX.html="<div></div>",bX.allowOutsideClick=false,bX):(bY=bR.$0[0],(bZ={},bZ.titleText=bO,bZ.text=bP,bZ.icon="question",bZ.width=a.String(bY),bZ.html=(((bk.Curried3(function(b1,b2,b3){return b1("<div class=\"swal2-content-custom\" style=\"width:"+a.String(b2)+"px;height:"+a.String(b3)+"px\"></div>");}))(a.id))(bY))(bR.$0[1]),bZ.allowOutsideClick=false,bZ)),(bS!=null?bS.$0(bW):void 0,bQ!=null&&bQ.$==1?(b0=bQ.$0,(bW.progressSteps=bh.ofSeq(bl.range(1,bh.length(b0))),bi.mixin(bW).queue(bh.create(bh.length(b0),bW)))):bi.fire(bW)));bT!=null?bT.$0():void 0;bV.then(bU);};e.get_QueueBoxes=function(){var bO;bO=bi.mixin({});return function(bP){return bO.queue(bP);};};d.getDialogueBoxInput=function(){return bh.get(a.jQuery(".swal2-input").get(),0);};d.getDialogueBoxCanvas=function(){return bh.get(a.jQuery("canvas.swal2-content").get(),0);};d.getDialogueBoxContent=function(){return bh.get(a.jQuery("#swal2-content").get(),0).firstChild;};d.createDialogueBoxCanvas=function(){return d.createCanvas("camera","640","480",bh.get(a.jQuery("#swal2-content").get(),0).firstChild);};d.createCanvas=function(bO,bP,bQ,bR){var bS;bS=bn.Element("canvas",[d.eid(bO),bo.Create("width",bP),bo.Create("height",bQ)],[]);bq.LoadLocalTemplates("");bn.Run(bR,bS);return bR.firstChild;};d.elementHTML=function(bO){return bO.innerHTML;};d.createElement=function(bO){var bP;bP=self.document.createElement("div");self.document.appendChild(bP);bq.LoadLocalTemplates("");bn.RunAppend(bP,bO);};d.getContainer=function(){return bh.get(a.jQuery("#container").get(),0).firstChild;};d.container=function(bO){return bn.Element("div",[d.cls("container")],bO);};d.dindex=function(bO){return bo.Create("data-index",a.String(bO));};d.cls=function(bO){return bo.Create("class",bO);};d.eid=function(bO){return bo.Create("id",bO);};d.getMic=function(){return bh.get(a.jQuery("#microphone").get(),0);};d.terminalOutput=function(){return bh.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(bO){return bO.toLowerCase();};d.debug=function(bO,bP){d.info((((bk.Curried3(function(bQ,bR,bS){return bQ("DEBUG: "+br.toSafe(bR)+": "+br.prettyPrint(bS));}))(a.id))(bO.toUpperCase()))(bP));};d.error=function(bO){bs.error(bO);};d.info=function(bO){bs.info(bO);};d.jserror=function(bO){bt.error(bO);};d.toArray=function(bO){return bh.map(a.id,bt.makeArray(bO));};d["Terminal.EchoHtml'"]=function(bO,bP){bO.pause();bO.echo(bP,d.rawOpt());bO.resume();};d["Terminal.Echo'"]=function(bO,bP){bO.pause();bO.echo(bP);bO.resume();};d.rawOpt=function(){h.$cctor();return h.rawOpt;};f=c._Html=bk.Class({toString:function(){return f.toString(this);}},null,f);f.toString=function(bO){function bP(bQ){return function(bR){var bS,bT,bU,bV,bW,bX,bY;bT=bu.replicate(bQ," ");switch(bR.$==0?bR.$1.$==1?bR.$1.$0.$==2?bR.$1.$1.$==0?(bS=[bR.$1.$0.$0,bR.$0],1):(bS=[bR.$1,bR.$0],2):(bS=[bR.$1,bR.$0],2):(bS=[bR.$1,bR.$0],2):bR.$==2?(bS=bR.$0,3):(bS=[bR.$0,bR.$1],0)){case 0:return bS[0]+"=\""+bS[1]+"\"";case 1:bU=bS[1];return bT+"<"+bU+">"+bS[0]+"</"+bU+">\r\n";case 2:bV=bS[1];bW=bv.partition(function(bZ){return bZ.$==1;},bS[0]);bX=bW[1];bY=bW[0];return bX.$==0?bT+"<"+bV+(bY.$===0?"":" "+bu.concat(" ",bv.ofSeq(bw.delay(function(){return bw.map(function(bZ){return(bP(0))(bZ);},bY);}))))+"/>\r\n":bT+"<"+bV+(bY.$===0?"":" "+bu.concat(" ",bv.ofSeq(bw.delay(function(){return bw.map(function(bZ){return(bP(0))(bZ);},bY);}))))+">\r\n"+bu.concat("",bv.ofSeq(bw.delay(function(){return bw.map(function(bZ){return(bP(bQ+1))(bZ);},bX);})))+bT+"</"+bV+">\r\n";case 3:return bT+bS+"\r\n";}};}return(bP(0))(bO);};g.alt=function(bO){return new f({$:1,$0:"alt",$1:bO});};g.src=function(bO){return new f({$:1,$0:"src",$1:bO});};g.cls=function(bO){return new f({$:1,$0:"class",$1:bO});};g.str=function(bO){return f.toString(bO);};g.op_PercentEquals=function(bO,bP){return new f({$:1,$0:bO,$1:bP});};g.op_Splice=function(bO){var bP;return bv.ofArray([new f({$:2,$0:(bP=bO,a.String(bP))})]);};g.strong=function(){h.$cctor();return h.strong;};g.h4=function(){h.$cctor();return h.h4;};g.h3=function(){h.$cctor();return h.h3;};g.h2=function(){h.$cctor();return h.h2;};g.h1=function(){h.$cctor();return h.h1;};g.li=function(){h.$cctor();return h.li;};g.ul=function(){h.$cctor();return h.ul;};g.th=function(){h.$cctor();return h.th;};g.td=function(){h.$cctor();return h.td;};g.tr=function(){h.$cctor();return h.tr;};g.a=function(){h.$cctor();return h.a;};g.p=function(){h.$cctor();return h.p;};g.area=function(){h.$cctor();return h.area;};g.map=function(){h.$cctor();return h.map;};g.img=function(){h.$cctor();return h.img;};g.tfoot=function(){h.$cctor();return h.tfoot;};g.tbody=function(){h.$cctor();return h.tbody;};g.thead=function(){h.$cctor();return h.thead;};g.table=function(){h.$cctor();return h.table;};g.span=function(){h.$cctor();return h.span;};g.section=function(){h.$cctor();return h.section;};g.br=function(){h.$cctor();return h.br;};g.div=function(){h.$cctor();return h.div;};g.body=function(){h.$cctor();return h.body;};g.style=function(){h.$cctor();return h.style;};g.title=function(){h.$cctor();return h.title;};g.head=function(){h.$cctor();return h.head;};g.html=function(){h.$cctor();return h.html;};g.elem=function(bO,bP){return new f({$:0,$0:bO,$1:bP});};h.$cctor=function(){var bO;h.$cctor=a.ignore;h.rawOpt=(bO={},bO.raw=true,bO);h.html=function(bP){return g.elem("html",bP);};h.head=function(bP){return g.elem("head",bP);};h.title=function(bP){return g.elem("title",bP);};h.style=function(bP){return g.elem("style",bP);};h.body=function(bP){return g.elem("body",bP);};h.div=function(bP){return g.elem("div",bP);};h.br=function(bP){return g.elem("br",bP);};h.section=function(bP){return g.elem("section",bP);};h.span=function(bP){return g.elem("span",bP);};h.table=function(bP){return g.elem("table",bP);};h.thead=function(bP){return g.elem("thead",bP);};h.tbody=function(bP){return g.elem("tbody",bP);};h.tfoot=function(bP){return g.elem("tfoot",bP);};h.img=function(bP){return g.elem("img",bP);};h.map=function(bP){return g.elem("map",bP);};h.area=function(bP){return g.elem("area",bP);};h.p=function(bP){return g.elem("p",bP);};h.a=function(bP){return g.elem("a",bP);};h.tr=function(bP){return g.elem("tr",bP);};h.td=function(bP){return g.elem("td",bP);};h.th=function(bP){return g.elem("th",bP);};h.ul=function(bP){return g.elem("ul",bP);};h.li=function(bP){return g.elem("li",bP);};h.h1=function(bP){return g.elem("h1",bP);};h.h2=function(bP){return g.elem("h1",bP);};h.h3=function(bP){return g.elem("h1",bP);};h.h4=function(bP){return g.elem("h1",bP);};h.strong=function(bP){return g.elem("strong",bP);};};j.New=function(bO,bP,bQ,bR){return{name:bO,message:bP,message_code:bQ,status:bR};};k.New=function(bO,bP,bQ,bR,bS){return{message:bO,message_code:bP,success:bQ,count:bR,status:bS};};l.New=function(bO,bP,bQ,bR,bS,bT){return{message:bO,message_code:bP,success:bQ,result:bR,score:bS,confidence:bT};};m.Radio=function(bO,bP,bQ,bR,bS){return bn.Element("div",new bv.T({$:1,$0:d.cls("radio"),$1:bP}),[bn.Element("label",bR,[bn.Radio(bS,true,bQ),bn.TextNode(bO)])]);};m.checkbox=function(bO,bP,bQ,bR,bS){return bn.Element("div",new bv.T({$:1,$0:d.cls("checkbox"),$1:bP}),[bn.Element("label",bR,[bn.CheckBox(bS,bQ),bn.TextNode(bO)])]);};m.textArea=function(bO,bP,bQ,bR,bS){return bn.Element("div",new bv.T({$:1,$0:d.cls("form-group"),$1:bP}),[bn.Element("label",bR,[bn.TextNode(bO)]),bn.InputArea(new bv.T({$:1,$0:d.cls("form-control"),$1:bS}),bQ)]);};m.inputPassword=function(bO,bP,bQ,bR,bS){return bn.Element("div",new bv.T({$:1,$0:d.cls("form-group"),$1:bP}),[bn.Element("label",bR,[bn.TextNode(bO)]),bn.PasswordBox(new bv.T({$:1,$0:d.cls("form-control"),$1:bS}),bQ)]);};m.input=function(bO,bP,bQ,bR,bS){return bn.Element("div",new bv.T({$:1,$0:d.cls("form-group"),$1:bP}),[bn.Element("label",bR,[bn.TextNode(bO)]),bn.Input([d.cls("form-control"),bS],bQ)]);};m.btnSecondary=function(bO,bP,bQ){return bn.Element("button",[d.eid(bO),d.cls("btn btn-secondary"),bx.Handler("click",bQ)],[bn.TextNode(bP)]);};m.btnPrimary=function(bO,bP,bQ){return bn.Element("button",[d.eid(bO),d.cls("btn btn-primary"),bx.Handler("click",bQ)],[bn.TextNode(bP)]);};p.New=function(bO,bP,bQ,bR){return{text:bO,intents:bP,entities:bQ,traits:bR};};q.New=function(bO,bP,bQ){return{id:bO,name:bP,confidence:bQ};};r.New=function(bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY){return{id:bO,name:bP,role:bQ,start:bR,end:bS,body:bT,confidence:bU,entities:bV,suggested:bW,value:bX,type:bY};};s.New=function(bO,bP,bQ){return{id:bO,value:bP,confidence:bQ};};t.New=function(bO){return{intent:bO};};u.New=function(bO){return{value:bO};};o.getMeaning2=function(bO,bP){function bQ(bR,bS){var bT;bt.ajax((bT={},bT.url=(function(bU){return function(bV){return bU("https://api.wit.ai/message?q="+br.toSafe(bV));};}(a.id))(bP),bT.type="GET",bT.beforeSend=function(bU){return bU.setRequestHeader("Authorization","Bearer "+bO);},bT.success=function(bU){return bR(bU);},bT.error=function(bU){return bS(new a.Error(bU.responseText));},bT));}return by.FromContinuations(function(bR,bS,bT){return bQ.apply(null,[bR,bS,bT]);});};o.getMeaning=function(bO,bP,bQ,bR){var bS;bt.ajax((bS={},bS.url=(function(bT){return function(bU){return bT("https://api.wit.ai/message?q="+br.toSafe(bU));};}(a.id))(bP),bS.type="GET",bS.beforeSend=function(bT){return bT.setRequestHeader("Authorization","Bearer "+bO);},bS.success=bQ,bS.error=bR,bS));};w.New=function(bO,bP,bQ,bR,bS,bT,bU,bV,bW){return{tokenFragment:bO,charFragment:bP,babelSynsetID:bQ,DBpediaURL:bR,BabelNetURL:bS,score:bT,cohrenceScore:bU,globalScore:bV,source:bW};};x.New=function(bO,bP){return{start:bO,end:bP};};y.New=function(bO,bP){return{start:bO,end:bP};};v.disambiguate=function(bO){function bP(bQ,bR){var bS;bt.ajax((bS={},bS.url=(function(bT){return function(bU){return bT("https://babelfy.io/v1/disambiguate?text="+br.toSafe(bU)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bO),bS.type="GET",bS.success=function(bT){return bQ(bT);},bS.error=function(bT){return bR(new a.Error(bT.responseText));},bS));}return by.FromContinuations(function(bQ,bR,bS){return bP.apply(null,[bQ,bR,bS]);});};z.waitAddPhrases=function(){A.$cctor();return A.waitAddPhrases;};z.waitRetrievePhrases=function(){A.$cctor();return A.waitRetrievePhrases;};z.helpPhrases=function(){A.$cctor();return A.helpPhrases;};z.helloUserPhrases=function(){A.$cctor();return A.helloUserPhrases;};z.helloPhrases=function(){A.$cctor();return A.helloPhrases;};z["getRandomPhrase'"]=function(bO){return z.replace_tok("$0","",bw.nth(z.rng().Next(0,bO.get_Length()),bO));};z.getRandomPhrase=function(bO,bP){return z.replace_tok("$0",bP,bw.nth(z.rng().Next(0,bO.get_Length()),bO));};z.replace_tok=function(bO,bP,bQ){return bu.Replace(bQ,bO,bP);};z.rng=function(){A.$cctor();return A.rng;};A.$cctor=function(){A.$cctor=a.ignore;A.rng=new bz.New();A.helloPhrases=bv.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);A.helloUserPhrases=bv.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);A.helpPhrases=bv.ofArray(["What can I help you with $0?"]);A.waitRetrievePhrases=bv.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);A.waitAddPhrases=bv.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};C=B.Intent=bk.Class({toString:function(){return(((bk.Curried3(function(bO,bP,bQ){return bO("Intent("+br.toSafe(bP)+", "+be.p$2(bQ)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,C);D=B.Trait=bk.Class({toString:function(){return(((bk.Curried3(function(bO,bP,bQ){return bO("Trait("+br.toSafe(bP)+", "+br.prettyPrint(bQ)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,D);E=B.Entity=bk.Class({toString:function(){return(((((bk.Curried(function(bO,bP,bQ,bR,bS){return bO("Entity("+br.toSafe(bP)+", "+br.toSafe(bQ)+", "+br.toSafe(bR)+", "+be.p$2(bS)+")");},5))(a.id))(this.get_Name()))(this.get_Role()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$3;},get_Value:function(){return this.$2;},get_Role:function(){return this.$1;},get_Name:function(){return this.$0;}},null,E);F=B.Utterance=bk.Class({toString:function(){return((((bk.Curried(function(bO,bP,bQ,bR){return bO(be.p(bP)+" "+be.p$3(bQ)+" "+be.p$5(bR));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bO;bO=this.$3;return bO!=null?{$:1,$0:bv.sortBy(function(bP){return bP.get_Name();},bO.$0)}:null;},get_Traits:function(){var bO;bO=this.$2;return bO!=null?{$:1,$0:bv.sortBy(function(bP){return bP.get_Name();},bO.$0)}:null;},get_Intent:function(){return this.$1;},get_Text:function(){return this.$0;}},null,F);H.New=function(bO,bP,bQ,bR,bS){return{body:bO,end:bP,start:bQ,suggested:bR,value:bS};};G["Intent'"]=function(bO,bP){return!(bP.intent==null)?{$:1,$0:new C({$:0,$0:d.toLower(bP.intent.value),$1:null})}:null;};G["Trait'"]=function(bO){return!(bO.domain==null)?{$:1,$0:new D({$:0,$0:"domain",$1:d.toLower(bO.domain.value),$2:null})}:!(bO.dialogue_act==null)?{$:1,$0:new D({$:0,$0:"dialogue_act",$1:d.toLower(bO.dialogue_act.value),$2:null})}:null;};G["Entity'$1"]=function(bO){return!(bO.contact==null)?{$:1,$0:new E({$:0,$0:"contact",$1:"",$2:d.toLower(bO.contact.value),$3:null})}:null;};J=I["Utterance'"]=bk.Class({get_TopIntent:function(){return bv.head(bv.sortBy(function(bO){return bO.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$3;},get_Entities:function(){return this.$2;},get_Intents:function(){return this.$1;},get_Text:function(){return this.$0;}},null,J);K=I["Intent'"]=bk.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,K);L=I["Entity'"]=bk.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,L);M=I["Trait'"]=bk.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,M);I.HasUtterance=function(bO){var bP,bQ,bR,bS,bT,bU;return bO!=null&&bO.$==1&&(bO.$0.$2.get_Length()>0&&(bP=[bO.$0.$2,bO.$0.$1,bO,bO.$0.$0,bO.$0.$3],true))?(bQ=bP[0],(bR=bP[2],(bS=bP[4],(bT=bP[1].$==0?null:{$:1,$0:new C({$:0,$0:bR.$0.get_TopIntent().get_Name(),$1:{$:1,$0:bR.$0.get_TopIntent().get_Confidence()}})},(bU=bQ.$==0?null:{$:1,$0:bv.map(function(bV){return new E({$:0,$0:bV.get_Name(),$1:d.toLower(bV.get_Role()),$2:bV.get_Value(),$3:{$:1,$0:bV.get_Confidence()}});},bv.filter(function(bV){return bV.get_Confidence()>I.entityConfidenceThreshold();},bQ))},{$:1,$0:new F({$:0,$0:bP[3],$1:bT,$2:bS.$==0?null:{$:1,$0:bv.map(function(bV){return new D({$:0,$0:d.toLower(bV.get_Name()),$1:bV.get_Value(),$2:{$:1,$0:bV.get_Confidence()}});},bv.filter(function(bV){return bV.get_Confidence()>I.entityConfidenceThreshold();},bS))},$3:bU})}))))):null;};I.entityConfidenceThreshold=function(){O.$cctor();return O.entityConfidenceThreshold;};I.set_entityConfidenceThreshold=function(bO){O.$cctor();O.entityConfidenceThreshold=bO;};I.intentConfidenceThreshold=function(){O.$cctor();return O.intentConfidenceThreshold;};I.set_intentConfidenceThreshold=function(bO){O.$cctor();O.intentConfidenceThreshold=bO;};I.getUtterance2=function(bO){var bP;bP=null;return by.Delay(function(){return by.Bind(o.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bO),function(bQ){d.debug("NLU",(function(bR){return function(bS){return bR("Wit.ai returned "+bf.p$3(bS)+" ");};}(a.id))(bQ));return by.Return(new J({$:0,$0:bO,$1:bv.ofArray(bh.map(function(bR){return new K({$:0,$0:bR.name,$1:bR.confidence});},bQ.intents)),$2:bv.map(function(bR){return new L({$:0,$0:bR.name,$1:bR.confidence,$2:bR.role,$3:bR.value});},bv.ofSeq(bw.concat(bw.map(function(bR){return bR[1];},bB.ToSeq(bQ.entities))))),$3:bv.ofSeq(bw.map(function(bR){var bS;bS=bR[1];return new M({$:0,$0:bR[0],$1:bh.get(bS,0).confidence,$2:bh.get(bS,0).value});},bB.ToSeq(bQ.traits)))}));});});};I.getUtterance=function(bO,bP){o.getMeaning("OOGDHEQL7JZRQASXN2N2GHFUKGO3SCNV",bO,function(bQ){var bR,bS;d.debug("NLU",(function(bT){return function(bU){return bT("Wit.ai returned: "+br.prettyPrint(bU));};}(a.id))(bQ));bR=!(bQ.intents==null)?bv.ofArray(bh.map(function(bT){return new K({$:0,$0:bT.name,$1:bT.confidence});},bQ.intents)):bv.T.Empty;bS=!(bQ.traits==null)?bv.ofSeq(bw.concat(bv.map(function(bT){return bh.map(function(bU){return new M({$:0,$0:bT,$1:bU.confidence,$2:bU.value});},bD.GetJS(bQ.traits,[bT]));},bv.filter(function(bT){return!(bD.GetJS(bQ.traits,[bT])==null);},I.trait_types())))):bv.T.Empty;return bP({$:1,$0:new J({$:0,$0:bO,$1:bR,$2:!(bQ.entities==null)?bv.ofSeq(bw.concat(bv.map(function(bT){return bh.map(function(bU){return new L({$:0,$0:bU.name,$1:bU.confidence,$2:bU.role,$3:bU.value});},bD.GetJS(bQ.entities,[bT]));},bv.filter(function(bT){return!(bD.GetJS(bQ.entities,[bT])==null);},I.entity_types())))):bv.T.Empty,$3:bS})});},function(bQ,bR,bS){d.error((((bk.Curried3(function(bT,bU,bV){return bT("Wit.ai returned: "+br.prettyPrint(bU)+" "+br.prettyPrint(bV));}))(a.id))(bR))(bS));return bP(null);});};I.trait_types=function(){O.$cctor();return O.trait_types;};I.entity_types=function(){O.$cctor();return O.entity_types;};I.JournalEntry=function(bO){var bP;return bu.StartsWith(bO,"journal ")&&bu.Replace(bO,"journal ","")!==""?(bP=bu.Replace(bO,"journal ",""),{$:1,$0:new F({$:0,$0:"journal",$1:{$:1,$0:new C({$:0,$0:"journal",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bv.ofArray([new E({$:0,$0:"journal_entry",$1:"",$2:bP,$3:{$:1,$0:1}})])}})}):null;};I.QuickJournal=function(bO){var bP;return bO==="journal"||bO==="diary"?{$:1,$0:new F({$:0,$0:"journal",$1:{$:1,$0:new C({$:0,$0:"journal",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.QuickNumber=function(bO){var bP,bQ,bR,bS,bT,bU;return(bQ=I.One(bO),bQ!=null&&bQ.$==1?(bP=bQ.$0,true):(bR=I.Two(bO),bR!=null&&bR.$==1?(bP=bR.$0,true):(bS=I.Three(bO),bS!=null&&bS.$==1?(bP=bS.$0,true):(bT=I.Four(bO),bT!=null&&bT.$==1?(bP=bT.$0,true):(bU=I.Five(bO),bU!=null&&bU.$==1&&(bP=bU.$0,true))))))?{$:1,$0:bP}:null;};I.Five=function(bO){var bP;return bO==="5"||bO==="five"?{$:1,$0:new F({$:0,$0:"five",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bv.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"five",$3:{$:1,$0:1}})])}})}:null;};I.Four=function(bO){var bP;return bO==="4"||bO==="four"?{$:1,$0:new F({$:0,$0:"four",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bv.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"four",$3:{$:1,$0:1}})])}})}:null;};I.Three=function(bO){var bP;return bO==="3"||bO==="three"?{$:1,$0:new F({$:0,$0:"three",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bv.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"three",$3:{$:1,$0:1}})])}})}:null;};I.Two=function(bO){var bP;return bO==="2"||bO==="two"?{$:1,$0:new F({$:0,$0:"two",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bv.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"two",$3:{$:1,$0:1}})])}})}:null;};I.One=function(bO){var bP;return bO==="1"||bO==="one"?{$:1,$0:new F({$:0,$0:"one",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bv.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"one",$3:{$:1,$0:1}})])}})}:null;};I.QuickNo=function(bO){var bP;return bO==="no"||(bO==="nope"||(bO==="no way"||(bO==="nah"||(bO==="don't do it"||bO==="stop"))))?{$:1,$0:new F({$:0,$0:"no",$1:{$:1,$0:new C({$:0,$0:"reject",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.QuickYes=function(bO){var bP;return bO==="yes"||(bO==="ok"||(bO==="sure"||(bO==="yeah"||(bO==="yep"||(bO==="uh huh"||(bO==="go ahead"||bO==="go"))))))?{$:1,$0:new F({$:0,$0:"yes",$1:{$:1,$0:new C({$:0,$0:"verify",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.QuickHelp=function(bO){var bP;return bO==="help"||(bO==="help me"||(bO==="what's this?"||bO==="huh"))?{$:1,$0:new F({$:0,$0:"help",$1:{$:1,$0:new C({$:0,$0:"help",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.QuickHello=function(bO){var bP;return bO==="hello"||(bO==="hey"||(bO==="yo"||bO==="hi"))?{$:1,$0:new F({$:0,$0:"hello",$1:{$:1,$0:new C({$:0,$0:"greet",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};I.Voices=function(bO){return bO==="voices"?{$:1,$0:null}:null;};I.DebugEmotionalTraits=function(bO){return bu.StartsWith(bO,"debug-et ")?{$:1,$0:bu.Replace(bO,"debug-et ","")}:null;};I.DebugTriples=function(bO){return bu.StartsWith(bO,"debug-triples ")?{$:1,$0:bu.Replace(bO,"debug-triples ","")}:null;};I.DebugEntities=function(bO){return bu.StartsWith(bO,"debug-entities ")?{$:1,$0:bu.Replace(bO,"debug-entities ","")}:null;};I.Debug=function(bO){return bO==="debug"?{$:1,$0:null}:null;};I.Blank=function(bO){return bO===""?{$:1,$0:null}:null;};N.Study=function(bO){return bO.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};B.StrA=function(bO){if(bO!=null&&bO.$==1)try{return{$:1,$0:((bF.DecodeArray(bF.Id()))())(bG.parse(bO.$0))};}catch(bP){return null;}else return null;};B.PStr=function(bO){var bP;return bO!=null&&bO.$==1&&(typeof bO.$0=="string"&&(bP=bO.$0,true))?{$:1,$0:bP}:null;};B.No=function(bO){var bP,bQ;return(bQ=B.Intent$1("reject",bO),bQ!=null&&bQ.$==1&&(bQ.$0[0]==null&&(bQ.$0[1]==null&&(bP=bO,true))))?{$:1,$0:bP}:null;};B.Yes=function(bO){var bP,bQ;return(bQ=B.Intent$1("verify",bO),bQ!=null&&bQ.$==1&&(bQ.$0[0]==null&&(bQ.$0[1]==null&&(bP=bO,true))))?{$:1,$0:bP}:null;};B.EntityManyofMany=function(bO,bP){return{$:1,$0:bB.OfArray(bh.ofSeq(bv.map(function(bQ){return bv.exists(function(bR){return bR.get_Role()===bQ;},bP)?[bQ,{$:1,$0:bv.filter(function(bR){return bR.get_Role()===bQ;},bP)}]:[bQ,null];},bO)))};};B.EntityManyOf1=function(bO,bP){var bQ;return bP!=null&&bP.$==1&&(bv.exists(function(bR){return bR.get_Role()===bO;},bP.$0)&&(bQ=bP.$0,true))?{$:1,$0:bv.filter(function(bR){return bR.get_Role()===bO;},bQ)}:null;};B.Entity1OfAny=function(bO,bP){var bQ;return bP!=null&&bP.$==1&&(bv.exists(function(bR){return bR.get_Role()===bO;},bP.$0)&&(bQ=bP.$0,true))?{$:1,$0:bv.head(bv.sortBy(function(bR){return bR.get_Role();},bv.filter(function(bR){return bR.get_Role()===bO;},bQ)))}:null;};B.Entity1Of1=function(bO,bP){var bQ,bR;return bP!=null&&bP.$==1&&(bP.$0.$==1&&(bP.$0.$1.$==0&&((bR=bP.$0.$0,bR.get_Role()===bO||bR.get_Name()===bO)&&(bQ=bP.$0.$0,true))))?{$:1,$0:bQ}:null;};B.Intent$1=function(bO,bP){return bP.get_Intent()!=null&&bP.get_Intent().$0.get_Name()===bO?{$:1,$0:[bP.get_Traits(),bP.get_Entities()]}:null;};O.$cctor=function(){O.$cctor=a.ignore;O.entity_types=bv.ofArray(["wit$contact:name","wit$datetime:datetime","term:subject","term:object","term:verb"]);O.trait_types=bv.ofArray(["domain","dialogue_act"]);O.intentConfidenceThreshold=0.85;O.entityConfidenceThreshold=0.85;};Q=P.EmotionalTrait=bk.Class({get_Frequence:function(){return this.$2;},get_Hierarchy:function(){return this.$1;},get_Label:function(){return this.$0;}},null,Q);R=P.Relation=bk.Class({toString:function(){return((((bk.Curried(function(bO,bP,bQ,bR){return bO("("+br.prettyPrint(bP)+", "+br.prettyPrint(bQ)+", "+br.prettyPrint(bR)+")");},4))(a.id))(this.get_T1()))(this.get_Name()))(this.get_T2());},get_T2:function(){return this.$2;},get_Name:function(){return this.$1;},get_T1:function(){return this.$0;}},null,R);S=P.Triple=bk.Class({toString:function(){return((((bk.Curried(function(bO,bP,bQ,bR){return bO("("+be.p$9(bP)+", "+be.p$11(bQ)+", "+be.p$17(bR)+")");},4))(a.id))(this.get_Subject()))(this.get_Verb()))(this.get_Object());},get_Object:function(){var bO;bO=this.$1;return bO!=null?{$:1,$0:bO.$0.get_T2()}:null;},get_Verb:function(){return this.$0.get_T2();},get_Subject:function(){return this.$0.get_T1();}},null,S);T=P.Subject=bk.Class({toString:function(){return this.$==1?a.String(this.$0):this.$0;}},null,T);U=P.Verb=bk.Class({toString:function(){return this.$0;}},null,U);V=P.Object=bk.Class({toString:function(){return this.$==1?a.String(this.$0):this.$0;}},null,V);P.SubjectVerbObject1OfAny=function(bO,bP,bQ,bR,bS,bT){return bT==null?null:bw.tryPick(function(bU){var bV,bW,bX,bY,bZ,b0,b1,b2;return(bW=P.TripleSubject(bO,bU.$0.$0),bW!=null&&bW.$==1)&&((bX=P.TripleRelation(bP,bU.$0.$1),bX!=null&&bX.$==1)&&((bY=P.TripleVerb(bQ,bU.$0.$2),bY!=null&&bY.$==1)&&((bZ=bU.$1,bZ!=null&&bZ.$==1)&&((b0=P.TripleVerb(bQ,bU.$1.$0.$0),b0!=null&&b0.$==1)&&((b1=P.TripleRelation(bR,bU.$1.$0.$1),b1!=null&&b1.$==1)&&(b2=P.TripleObject(bS,bU.$1.$0.$2),b2!=null&&b2.$==1))))))?{$:1,$0:bU}:null;},bT.$0);};P.SubjectVerb1OfAny=function(bO,bP,bQ,bR){return bR==null?null:bw.tryPick(function(bS){var bT,bU,bV,bW;return(bU=P.TripleSubject(bO,bS.$0.$0),bU!=null&&bU.$==1)&&((bV=P.TripleRelation(bP,bS.$0.$1),bV!=null&&bV.$==1)&&(bW=P.TripleVerb(bQ,bS.$0.$2),bW!=null&&bW.$==1))?{$:1,$0:bS}:null;},bR.$0);};P.TripleObject=function(bO,bP){var bQ;return bP.$==0&&(bP.$0.toUpperCase()===bO.toUpperCase()&&(bQ=bP.$0,true))?{$:1,$0:null}:null;};P.TripleVerb=function(bO,bP){return bP.$0.toUpperCase()===bO.toUpperCase()?{$:1,$0:null}:null;};P.TripleRelation=function(bO,bP){return bP.toUpperCase()===bO.toUpperCase()?{$:1,$0:null}:null;};P.TripleSubject=function(bO,bP){var bQ;return bP.$==0&&(bP.$0.toUpperCase()===bO.toUpperCase()&&(bQ=bP.$0,true))?{$:1,$0:null}:null;};X.MicReady={$:5};X.MicAudioEnd={$:4};X.MicAudioStart={$:3};X.MicDisconnected={$:2};X.MicConnecting={$:1};X.MicNotInitialized={$:0};Y.ClientUnderstand={$:2};Y.ClientReady={$:1};Y.ClientNotInitialzed={$:0};Z=W.Interpreter=bk.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,Z);_0=W.CUI=bk.Class({SayVoices:function(){var bO,bP,bQ;bO=this;bP=a.speechSynthesis.getVoices();!(bP==null)?(bQ=d.toArray(bP),bO.Say((function(bR){return function(bS){return bR("There are currently "+a.String(bS)+" voices installed on this computer or device.");};}(a.id))(bh.length(bQ))),bh.iteri(function(bR,bS){return bO.Say(((((bk.Curried(function(bT,bU,bV,bW){return bT("Voice "+a.String(bU)+". Name: "+br.toSafe(bV)+", Local: "+br.prettyPrint(bW)+".");},4))(a.id))(bR))(bS.name))(bS.localService));},bQ)):void 0;},Wait:function(bO){this.Wait$1(function(){by.Start(bO,null);});},Wait$1:function(bO){this["Echo'"]("please wait...");this.Term.pause();bO();this.Term.resume();},sayRandom:function(bO,bP){this.Say(z.getRandomPhrase(bO,bP));},SayAngry:function(bO){var bP,bQ;bP=this;by.Start((bQ=null,by.Delay(function(){return by.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bH.chime(),by.Zero()):by.Zero(),by.Delay(function(){a.addMessage(bP.Avatar,bO,"","");bP.Avatar.processMessages(0);return by.Zero();}));})),null);},SayDoc:function(bO){var bP,bQ,bR;bP=bh.get(bt(".terminal-output").get(),0).childNodes.length;bQ=bn.Element("div",[d.cls("terminal-command"),d.dindex(bP+1)],[bO]);bR=d.terminalOutput();bq.LoadLocalTemplates("");bn.RunAppend(bR,bQ);},Say:function(bO){var bP,bQ;bP=this;by.Start((bQ=null,by.Delay(function(){return by.Combine(a.speechSynthesis.speaking?(bH.chime(),by.Zero()):by.Zero(),by.Delay(function(){bP.Avatar.addMessage(bO);bP.Avatar.processMessages(0);return by.Zero();}));})),null);},Debug:function(bO,bP){d.debug(bO,bP);},"EchoHtml'":function(bO){var bP,bQ;bP=(bQ={},bQ.raw=true,bQ);this.Term.disable();this.Term.echo(bO,bP);this.Term.enable();},"Echo'":function(bO){this.Term.disable();this.Term.echo(bO);this.Term.enable();}},null,_0);_0.New=function(bO,bP,bQ,bR,bS,bT,bU){return new _0({Voice:bO,Mic:bP,Term:bQ,Avatar:bR,Caption:bS,AudioHandlers:bT,TypingDNA:bU});};_1=c.Dialogue=bk.Class({get_Utterances:function(){return this.$4;},get_Output:function(){return this.$3;},get_DialogueQuestions:function(){return this.$2;},get_Props:function(){return this.$1;},get_Cui:function(){return this.$0;}},null,_1);_2=c.Question=bk.Class({toString:function(){return((((bk.Curried(function(bO,bP,bQ,bR){return bO("Name: "+br.toSafe(bP)+" Module: "+br.toSafe(bQ)+" Type: "+be.p$18(bR)+" ");},4))(a.id))(this.get_Name()))(this.get_Module()))(this.get_Type());},get_Target:function(){return this.$4;},get_Params:function(){return this.$3;},get_Type:function(){return this.$2;},get_Module:function(){return this.$1;},get_Name:function(){return this.$0;}},null,_2);_3.ConceptCompletion={$:3};_3.Disjunctive={$:2};_3.Verification={$:1};_4["Response'_"]=function(bO,bP,bQ){var bR,bS,bT,bU,bV,bW,bX,bY;return(bS=_4.PropNotSet_(bO,"user",bQ),bS!=null&&bS.$==1?(bT=_4.Form(bO,bP,bS.$0),bT!=null&&bT.$==1?(bR=bT.$0,true):(bU=_4.PropNotSet_(bO,"user",bQ),bU!=null&&bU.$==1&&(bV=_4.NotForm(bO,bP,bU.$0),bV!=null&&bV.$==1&&(bR=bV.$0,true)))):(bW=_4.PropNotSet_(bO,"user",bQ),bW!=null&&bW.$==1&&(bX=_4.NotForm(bO,bP,bW.$0),bX!=null&&bX.$==1&&(bR=bX.$0,true))))?(bY=_4.have(bO,bP)?{$:1,$0:_4.prop(bO,bP)}:null,bR.get_Text()!==""?{$:1,$0:[bR,{$:1,$0:bR.get_Text()},bY]}:{$:1,$0:[bR,null,bY]}):null;};_4.Response_=function(bO,bP,bQ){var bR,bS,bT,bU,bV,bW,bX,bY;return(bS=_4.PropSet_(bO,"user",bQ),bS!=null&&bS.$==1?(bT=_4.Form(bO,bP,bS.$0),bT!=null&&bT.$==1?(bR=bT.$0,true):(bU=_4.PropSet_(bO,"user",bQ),bU!=null&&bU.$==1&&(bV=_4.NotForm(bO,bP,bU.$0),bV!=null&&bV.$==1&&(bR=bV.$0,true)))):(bW=_4.PropSet_(bO,"user",bQ),bW!=null&&bW.$==1&&(bX=_4.NotForm(bO,bP,bW.$0),bX!=null&&bX.$==1&&(bR=bX.$0,true))))?(bY=_4.have(bO,bP)?{$:1,$0:_4.prop(bO,bP)}:null,bR.get_Text()!==""?{$:1,$0:[bR,{$:1,$0:bR.get_Text()},bY]}:{$:1,$0:[bR,null,bY]}):null;};_4.NotForm=function(bO,bP,bQ){return bO.get_DialogueQuestions().length>0&&(bO.get_DialogueQuestions())[0].get_Name()===bP&&bQ.get_Text()!==""?{$:1,$0:bQ}:null;};_4.Form=function(bO,bP,bQ){return bO.get_DialogueQuestions().length>0&&(bO.get_DialogueQuestions())[0].get_Name()===bP&&bQ.get_Intent()!=null&&bQ.get_Intent().$0.get_Name()===bP&&bI.Equals(bQ.get_Intent().$0.get_Confidence(),{$:1,$0:1})&&bI.Equals(bQ.get_Traits(),null)&&bI.Equals(bQ.get_Entities(),null)?{$:1,$0:bQ}:null;};_4["User'_"]=function(bO,bP){var bQ,bR;return(bR=_4.PropNotSet_(bO,"user",bP),bR!=null&&bR.$==1&&(bO.get_DialogueQuestions().length===0&&(bQ=bR.$0,true)))?{$:1,$0:bQ}:null;};_4.User_=function(bO,bP){var bQ,bR;return(bR=_4.PropSet_(bO,"user",bP),bR!=null&&bR.$==1&&(bO.get_DialogueQuestions().length===0&&(bQ=bR.$0,true)))?{$:1,$0:bQ}:null;};_4.PropNotSet_=function(bO,bP,bQ){return!_4.have(bO,bP)?{$:1,$0:bQ}:null;};_4.PropSet_=function(bO,bP,bQ){return _4.have(bO,bP)?{$:1,$0:bQ}:null;};_4.Agenda_=function(bO,bP,bQ,bR){return bO.get_DialogueQuestions().length>0&&(bO.get_DialogueQuestions())[0].get_Module()===bQ?{$:1,$0:null}:null;};_4.debugInterpreterEnd=function(bO,bP,bQ){bP(((((bk.Curried(function(bR,bS,bT,bU){return bR(br.toSafe(bS)+" ending utterances:"+br.prettyPrint(bT)+", questions: "+br.prettyPrint(bU)+".");},4))(a.id))(bQ))(bO.get_Utterances()))(bO.get_DialogueQuestions()));};_4.debugInterpreterStart=function(bO,bP,bQ){bP(((((bk.Curried(function(bR,bS,bT,bU){return bR(br.toSafe(bS)+" starting utterances:"+br.prettyPrint(bT)+", questions: "+br.prettyPrint(bU)+".");},4))(a.id))(bQ))(bO.get_Utterances()))(bO.get_DialogueQuestions()));};_4.frame=function(bO){return bv.ofSeq(bw.take(bO.length>=5?5:bO.length,bO));};_4.didNotUnderstand=function(bO,bP,bQ){bP((function(bR){return function(bS){return bR(br.toSafe(bS)+" interpreter did not understand utterance.");};}(a.id))(bQ));_4.popu(bO,bP);_4.say(bO,"Sorry I didn't understand what you meant.");!_4.have(bO,"user")?_4.say(bO,"You must login to use most functions in Selma."):void 0;};_4.endt=function(bO,bP,bQ,bR){_4.popu(bO,bP);_4.popq(bO,bP);_4.have(bO,bQ)?_4.remove(bO,bP,bQ):void 0;bP((function(bS){return function(bT){return bS("End turn "+br.toSafe(bT)+".");};}(a.id))(bQ));bR();};_4.cancel=function(bO,bP,bQ){var bR;bR=(bO.get_DialogueQuestions())[0];bR.get_Name()!==bQ?(((bk.Curried3(function(bS,bT,bU){return bS(be.p$19(bT)+" at the top of the stack does not have the name "+br.toSafe(bU)+".");}))(bl.FailWith))(bR))(bQ):void 0;_4.popq(bO,bP);bP((function(bS){return function(bT){return bS("Cancel "+be.p$19(bT)+".");};}(a.id))(bR));};_4.trigger=function(bO,bP,bQ,bR,bS){_4.pushu(bO,bP,new F({$:0,$0:bG.stringify(bS),$1:{$:1,$0:new C({$:0,$0:bR,$1:{$:1,$0:1}})},$2:null,$3:null}));bQ(bO);};_4.handle=function(bO,bP,bQ,bR){_4.popu(bO,bP);bP((function(bS){return function(bT){return bS("Handle utterance "+br.toSafe(bT)+".");};}(a.id))(bQ));bR();};_4.dispatch=function(bO,bP,bQ,bR){bP(((((bk.Curried(function(bS,bT,bU,bV){return bS("Dispatch to module "+br.toSafe(bT)+" utterances: "+br.prettyPrint(bU)+" questions: "+br.prettyPrint(bV)+".");},4))(a.id))(bQ))(bO.get_Utterances()))(bO.get_DialogueQuestions()));bR(bO);};_4.popq=function(bO,bP){var bQ;bQ=bO.get_DialogueQuestions().shift();bP((function(bR){return function(bS){return bR("Pop "+be.p$19(bS)+".");};}(a.id))(bQ));};_4.pushq=function(bO,bP,bQ){bO.get_DialogueQuestions().unshift(bQ);bP((function(bR){return function(bS){return bR("Push "+be.p$19(bS)+".");};}(a.id))(bQ));};_4.popu=function(bO,bP){var bQ;bQ=bO.get_Utterances().shift();bP((function(bR){return function(bS){return bR("Pop "+be.p$16(bS)+".");};}(a.id))(bQ));};_4.pushu=function(bO,bP,bQ){bP((function(bR){return function(bS){return bR("Push "+be.p$16(bS)+".");};}(a.id))(bQ));bO.get_Utterances().unshift(bQ);};_4.remove=function(bO,bP,bQ){bP((function(bR){return function(bS){return bR("Remove property "+br.toSafe(bS)+".");};}(a.id))(bQ));bO.get_Props().Remove(bQ);};_4.add=function(bO,bP,bQ,bR){bO.get_Props().Add(bQ,bR);bP((((bk.Curried3(function(bS,bT,bU){return bS("Add property "+br.toSafe(bT)+":"+br.prettyPrint(bU)+".");}))(a.id))(bQ))(bR));};_4.prop=function(bO,bP){return bO.get_Props().ContainsKey(bP)?bO.get_Props().get_Item(bP):(function(bQ){return function(bR){return bQ("The "+br.toSafe(bR)+" dialogue property does not exist.");};}(bl.FailWith))(bP);};_4.have=function(bO,bP){return bO.get_Props().ContainsKey(bP);};_4["sayRandom'"]=function(bO,bP){_4.sayRandom(bO,bP,"");};_4.sayRandom=function(bO,bP,bQ){var bR;bR=z.getRandomPhrase(bP,bQ);bO.get_Output().unshift(bR);bO.get_Cui().Say(bR);};_4.say=function(bO,bP){bO.get_Output().unshift(bP);_4["say'"](bO,bP);};_4["say'"]=function(bO,bP){bO.get_Cui().Say(bP);};_4.echo=function(bO,bP){(bO.get_Cui())["EchoHtml'"](bP);};_5.ask=function(bO,bP,bQ){var bR,bS,bT,bU;function bV(b0){_4.say(bO,b0);}function bW(b0){b0.input="text";b0.showCancelButton=true;b0.confirmButtonText="Ok";}function bX(b0){b0.confirmButtonClass="invisible";b0.showCancelButton=true;}function bY(){var b0;b0=d.createDialogueBoxCanvas();d.startCamera(self.document.body,b0);}function bZ(b0){var b1,b2;b1=b0[0];b2=b0[1];d.questionBox("Biometric Authentication","",{$:1,$0:d.boxesWithTitles(["2","3"])},{$:1,$0:[640,480]},{$:1,$0:bW},{$:1,$0:bY},function(b3){var b4,b5,b6,b7;b3.isConfirmed?(b4=bO.get_Cui().TypingDNA.getTypingPattern((b5={},b5.type=1,b5.text=bU,b5.caseSensitive=false,b5)),b6=b3.value,b7=d.getCameraCanvas().toDataURL(),bP((function(b8){return function(b9){return b8("User image is "+br.toSafe(b9)+"...");};}(a.id))(bu.Substring(b7,0,10))),d.stopCamera(),bP((((bk.Curried3(function(b8,b9,b_){return b8("User entered typing pattern "+br.toSafe(b9)+" for text "+br.toSafe(b_));}))(a.id))(b4))(b6)),b6.toLowerCase()!==bU.toLowerCase()?(bV("Sorry you did not enter the passphrase correctly. Please try again."),bZ([b1,b2])):d.questionBox("Biometric Authentication","",null,null,{$:1,$0:bX},{$:1,$0:function(){d.getDialogueBoxContent().appendChild(d.getMic());bO.get_Cui().AudioHandlers.Add("VoiceAuthentication",function(b8){bG.stringify(((bF.Id())())(b8));d.confirmQuestionBox();});}},function(b8){if(!b8.isConfirmed){bO.get_Cui().AudioHandlers.Remove("VoiceAuthentication");bV("OK but you must login for me to help you.");}})):bV("OK but you must login for me to help you.");});}_4.pushq(bO,bP,bQ);bR=bQ.get_Type();bR.$==0?(bS=bQ.get_Target(),bT=bQ.get_Name(),bU=(function(b0){return function(b1){return b0("Hello my name is "+br.toSafe(b1)+" and I am an administrator");};}(a.id))(bR.$0),bV((function(b0){return function(b1){return b0("Enter the phrase "+br.toSafe(b1)+".");};}(a.id))(bU)),bZ([0,[]])):bl.FailWith("Not implemented");};_6.update=function(bO){var bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp;function cq(cB){_4.say(bO,cB);}function cr(cB,cC){return _4.sayRandom(bO,cB,cC);}function cs(cB,cC){return _4.add(bO,function(cD){_6.debug(cD);},cB,cC);}function ct(cB){_6.debug(cB);}function cu(cB){_6.debug(cB);}function cv(cB){_6.debug(cB);}function cw(cB){return _4["User'_"](bO,cB);}function cx(cB,cC){return _4.Response_(bO,cB,cC);}function cy(cB,cC){return _4["Response'_"](bO,cB,cC);}function cz(cB){var cC;cr(z.waitRetrievePhrases(),"user name");by.Start((cC=null,by.Delay(function(){return by.Bind((new bK.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-1129382380",[cB]),function(cD){var cE;return cD==null?(cq((function(cF){return function(cG){return cF("I did not find a user with the name "+br.toSafe(cG)+".");};}(a.id))(cB)),bR(new _2({$:0,$0:"addUser",$1:_6.name(),$2:_3.Verification,$3:null,$4:function(){cs("addUser",cB);cq((function(cF){return function(cG){return cF("Do you want me to add the user "+br.toSafe(cG)+"?");};}(a.id))(cB));}})),by.Zero()):(cE=cD.$0,(cs("user",cB),by.Bind((new bK.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:1406773965",[cE.Name]),function(){cr(z.helloUserPhrases(),cE.Name);return cE.LastLoggedIn!=null?by.Bind((new bK.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:-1686857129",[cE.LastLoggedIn.$0]),function(cF){cq((function(cG){return function(cH){return cG("You last logged in "+br.toSafe(cH)+".");};}(a.id))(cF));return by.Zero();}):by.Zero();})));});})),null);}function cA(cB){return new _2({$:0,$0:"switchUser",$1:_6.name(),$2:_3.Verification,$3:null,$4:function(){cq((function(cC){return function(cD){return cC("Do you want me to switch to the user "+br.toSafe(cD));};}(a.id))(cB));}});}_4.debugInterpreterStart(bO,function(cB){_6.debug(cB);},_6.name());bP=bk.Curried(_4.handle,2,[bO,ct]);bQ=bk.Curried(_4.endt,2,[bO,cu]);bR=function(cB){_5.ask(bO,cv,cB);};bS=_4.frame(bO.$4);bS.$==1&&(bU=cw(bS.$0),bU!=null&&bU.$==1&&(bV=B.Intent$1("greet",bU.$0),bV!=null&&bV.$==1&&(bW=B.Entity1Of1("name",bV.$0[1]),bW!=null&&bW.$==1&&(bS.$1.$==0&&(bT=bW.$0,true)))))?(bP("loginUser"))(function(){cz(bT.get_Value());}):bS.$==1&&(bY=cw(bS.$0),bY!=null&&bY.$==1&&(bZ=B.Intent$1("hello",bY.$0),bZ!=null&&bZ.$==1&&(b0=B.Entity1Of1("contact",bZ.$0[1]),b0!=null&&b0.$==1&&(bS.$1.$==0&&(bX=b0.$0,true)))))?(bP("loginUser"))(function(){cz(bX.get_Value());}):bS.$==1&&(b2=cy("authenticateUser",bS.$0),b2!=null&&b2.$==1&&(b3=B.StrA(b2.$0[1]),b3!=null&&b3.$==1&&(bS.$1.$==0&&(b1=b3.$0,true))))?(bQ("authenticateUser"))(function(){var cB;_6.debug(b1);by.Start((cB=null,by.Delay(function(){return by.Bind((new bK.New()).Async("SMApp.Web:SMApp.Web.Server.hasFace:-1148526753",[bh.get(b1,2)]),function(cC){return cC?(cq("Face detected"),by.Zero()):(cq(function(cD){return cD("Sorry I did not detect a face in the camera image. Make sure you can see the red square around your face in the camera window when you click the OK button.");}(a.id)),by.Zero());});})),null);}):bS.$==1&&(b5=B.No(bS.$0),b5!=null&&b5.$==1&&(b6=cy("addUser",b5.$0),b6!=null&&b6.$==1&&(b7=B.PStr(b6.$0[2]),b7!=null&&b7.$==1&&(bS.$1.$==0&&(b4=b7.$0,true)))))?(bQ("addUser"))(function(){cq((function(cB){return function(cC){return cB("Ok I did not add the user "+br.toSafe(cC)+". But you must login for me to help you.");};}(a.id))(b4));}):bS.$==1&&(b9=B.Yes(bS.$0),b9!=null&&b9.$==1&&(b_=cy("addUser",b9.$0),b_!=null&&b_.$==1&&(b$=B.PStr(b_.$0[2]),b$!=null&&b$.$==1&&(bS.$1.$==0&&(b8=b$.$0,true)))))?(bQ("addUser"))(function(){bR(new _2({$:0,$0:"authenticateNewUser1",$1:_6.name(),$2:{$:0,$0:b8},$3:null,$4:function(cB){_6.update(cB);}}));}):bS.$==1&&(cb=cy("authenticateNewUser1",bS.$0),cb!=null&&cb.$==1&&(cc=B.StrA(cb.$0[1]),cc!=null&&cc.$==1&&(bS.$1.$==0&&(ca=cc.$0,true))))?(bQ("authenticateNewUser1"))(function(){cq((function(cB){return function(cC){return cB("Authenticate new user "+br.toSafe(cC)+".");};}(a.id))(bh.get(ca,0)));}):bS.$==1&&(ce=_4.User_(bO,bS.$0),ce!=null&&ce.$==1&&(cf=B.Intent$1("hello",ce.$0),cf!=null&&cf.$==1&&(cf.$0[0]==null&&(cg=B.Entity1Of1("name",cf.$0[1]),cg!=null&&cg.$==1&&(bS.$1.$==0&&(cd=cg.$0,true))))))?by.Start((ch=null,by.Delay(function(){return by.Bind((new bK.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-1129382380",[cd.get_Value()]),function(cB){return cB==null?(cq((function(cC){return function(cD){return cC("Sorry, the user "+br.toSafe(cD)+" does not exist.");};}(a.id))(cd.get_Value())),by.Zero()):(bR(cA(cB.$0.Name)),by.Zero());});})),null):bS.$==1&&(cj=B.Yes(bS.$0),cj!=null&&cj.$==1&&(ck=cx("switchUser",cj.$0),ck!=null&&ck.$==1&&(cl=B.PStr(ck.$0[2]),cl!=null&&cl.$==1&&(bS.$1.$==0&&(ci=cl.$0,true)))))?(bO.$1.set_Item("user",ci),cq((function(cB){return function(cC){return cB("Ok I switched to user "+br.prettyPrint(cC)+".");};}(a.id))(ci))):bS.$==1&&(cn=B.No(bS.$0),cn!=null&&cn.$==1&&(co=cx("switchUser",cn.$0),co!=null&&co.$==1&&(cp=B.PStr(co.$0[2]),cp!=null&&cp.$==1&&(bS.$1.$==0&&(cm=cp.$0,true)))))?cq((function(cB){return function(cC){return cB("Ok I did not switch to user "+br.toSafe(cC)+".");};}(a.id))(cm)):_4.didNotUnderstand(bO,function(cB){_6.debug(cB);},_6.name());_4.debugInterpreterEnd(bO,function(cB){_6.debug(cB);},_6.name());};_6.debug=function(bO){d.debug(_6.name(),bO);};_6.name=function(){_7.$cctor();return _7.name;};_7.$cctor=function(){_7.$cctor=a.ignore;_7.name="User";};_8.update=function(bO){var bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4;function b5(b$){_4.say(bO,b$);}function b6(b$){return _4.prop(bO,b$);}function b7(b$,ca){return _4.add(bO,function(cb){_8.debug(cb);},b$,ca);}function b8(b$){return _4.User_(bO,b$);}function b9(){b6("journal_entry");}function b_(b$){var ca;ca=null;return by.Delay(function(){return by.Bind((new bK.New()).Async("SMApp.Web:SMApp.Web.Server.getTriples:-578366823",[b$]),function(cb){var cc;return cb.$==1?(b5((function(cd){return function(ce){return cd("I could not add your journal entry. The following error occurred: "+br.prettyPrint(ce));};}(a.id))(cb.$0)),by.Zero()):(cc=cb.$0,cc.get_Length()>0?(_8.debug((function(cd){return function(ce){return cd("Got "+a.String(ce)+" sentences from NLU server");};}(a.id))(cc.get_Length())),b7("journal_entry",[].concat(bh.ofSeq(cc)).reverse()),b9(),by.Zero()):(b5(function(cd){return cd("Sorry I could not add an entry your journal entry.");}(a.id)),by.Zero()));});});}_4.debugInterpreterStart(bO,function(b$){_8.debug(b$);},_8.name());bv.ofArray(["What do you feel about your day today and why?","Describe the place that makes you feel the calmest. Is there anything that could be added to make it even better?","What makes you feel like the best version of yourself?","What made you feel uneasy today? "]);bP=_4.frame(bO.$4);bP.$==1&&(bR=b8(bP.$0),bR!=null&&bR.$==1&&(bS=B.Intent$1("journal",bR.$0),bS!=null&&bS.$==1&&(bT=B.Entity1Of1("journal_entry",bS.$0[1]),bT!=null&&bT.$==1&&(bP.$1.$==0&&(bQ=bT.$0,true)))))?by.Start((bU=null,by.Delay(function(){b5("Ok I'll add that entry to your symptom journal.");return by.Bind(b_(bQ.get_Value()),function(){return by.Return(null);});})),null):bP.$==1&&(bW=B.Yes(bP.$0),bW!=null&&bW.$==1&&((bX=_4.Response_(bO,"painVideo",bW.$0),bX!=null&&bX.$==1)&&bP.$1.$==0))?bO.$0["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bP.$==1&&(bZ=b8(bP.$0),bZ!=null&&bZ.$==1&&(b0=B.Intent$1("medjournal",bZ.$0),b0!=null&&b0.$==1&&((b1=b0.$0[1],b1!=null&&b1.$==1)&&(bP.$1.$==0&&(bY=b0.$0[1].$0,true)))))?(b5("ok I added that entry to your medication journal."),b5("You should be careful not to take too many painkillers over a short period of time.")):bP.$==1&&(b3=b8(bP.$0),b3!=null&&b3.$==1&&((b4=B.Intent$1("kbquery",b3.$0),b4!=null&&b4.$==1)&&(bP.$1.$==0&&(b2=b3.$0,true))))?void 0:_4.didNotUnderstand(bO,function(b$){_8.debug(b$);},_8.name());_4.debugInterpreterEnd(bO,function(b$){_8.debug(b$);},_8.name());};_8.debug=function(bO){d.debug(_8.name(),bO);};_8.name=function(){_9.$cctor();return _9.name;};_9.$cctor=function(){_9.$cctor=a.ignore;_9.name="Journal";};_.update=function(bO){var bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4;function b5(b$){_4.say(bO,b$);}function b6(b$,ca){return _4.sayRandom(bO,b$,ca);}function b7(b$){return _4.prop(bO,b$);}function b8(b$){return _4.User_(bO,b$);}function b9(){return b7("user");}function b_(b$,ca,cb){var cc;return by.Start((cc=null,by.Delay(function(){b6(z.waitAddPhrases(),"symptom entry");return by.Bind((new bK.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:839306054",[b9().Name,b$,ca,cb]),function(cd){return cd.$==1?(b5(function(ce){return ce("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),by.Zero()):(b5((function(ce){return function(cf){return ce("OK I added that "+br.toSafe(cf)+" symptom to your journal.");};}(a.id))(b$)),by.Zero());});})),null);}_4.debugInterpreterStart(bO,function(b$){_.debug(b$);},_.name());bP=_4.frame(bO.$4);bP.$==1&&(bR=b8(bP.$0),bR!=null&&bR.$==1&&(bS=B.Intent$1("symptom",bR.$0),bS!=null&&bS.$==1&&(bT=B.Entity1OfAny("symptom_name",bS.$0[1]),bT!=null&&bT.$==1&&(bP.$1.$==0&&(bQ=bT.$0,true)))))?by.Start((bU=null,by.Delay(function(){b5("Ok I'll add that entry to your symptom journal");b_(bQ.get_Value(),null,null);return by.Zero();})),null):bP.$==1&&(bW=B.Yes(bP.$0),bW!=null&&bW.$==1&&((bX=_4.Response_(bO,"painVideo",bW.$0),bX!=null&&bX.$==1)&&bP.$1.$==0))?bO.$0["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bP.$==1&&(bZ=b8(bP.$0),bZ!=null&&bZ.$==1&&(b0=B.Intent$1("medjournal",bZ.$0),b0!=null&&b0.$==1&&((b1=b0.$0[1],b1!=null&&b1.$==1)&&(bP.$1.$==0&&(bY=b0.$0[1].$0,true)))))?(b5("ok I added that entry to your medication journal."),b5("You should be careful not to take too many painkillers over a short period of time.")):bP.$==1&&(b3=b8(bP.$0),b3!=null&&b3.$==1&&((b4=B.Intent$1("kbquery",b3.$0),b4!=null&&b4.$==1)&&(bP.$1.$==0&&(b2=b3.$0,true))))?void 0:_4.didNotUnderstand(bO,function(b$){_.debug(b$);},_.name());_4.debugInterpreterEnd(bO,function(b$){_.debug(b$);},_.name());};_.debug=function(bO){d.debug(_.name(),bO);};_.name=function(){$.$cctor();return $.name;};$.$cctor=function(){$.$cctor=a.ignore;$.name="Symptoms";};ba.update=function(bO){var bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca;function cb(cg){_4.say(bO,cg);}function cc(cg){_4["sayRandom'"](bO,cg);}function cd(cg){ba.debug(cg);}function ce(cg){ba.debug(cg);}function cf(cg){return _4["User'_"](bO,cg);}bP=bO.$4;ba.debug(((((bk.Curried(function(cg,ch,ci,cj){return cg("Module "+br.toSafe(ch)+" starting utterances:"+br.prettyPrint(ci)+", questions: "+br.prettyPrint(cj)+".");},4))(a.id))(ba.name()))(bP))(bO.$2));bQ=bk.Curried(_4.dispatch,2,[bO,cd]);bR=bk.Curried(_4.handle,2,[bO,ce]);bS=_4.frame(bP);bT=_4.Agenda_(bO,function(cg){ba.debug(cg);},_6.name(),bS);bT!=null&&bT.$==1?(ba.debug((function(cg){return function(ch){return cg("Agenda is "+be.p$19(ch)+".");};}(a.id))((bO.get_DialogueQuestions())[0])),_6.update(bO)):bS.$==1&&(bV=(bW=_4.PropNotSet_(bO,"started",bS.$0),bW!=null&&bW.$==1?{$:1,$0:bW.$0}:null),bV!=null&&bV.$==1&&(bX=cf(bV.$0),bX!=null&&bX.$==1&&(bY=B.Intent$1("greet",bX.$0),bY!=null&&bY.$==1&&(bY.$0[1]==null&&bS.$1.$==0))))?(_4.add(bO,function(cg){ba.debug(cg);},"started",true),(bR("greet"))(function(){cc(z.helloPhrases());})):bS.$==1&&(b0=cf(bS.$0),b0!=null&&b0.$==1&&(b1=B.Intent$1("greet",b0.$0),b1!=null&&b1.$==1&&(b1.$0[1]==null&&bS.$1.$==0)))?(bR("greet"))(function(){cb("Hello, tell me your name to get started.");}):bS.$==1&&(b3=cf(bS.$0),b3!=null&&b3.$==1&&(b4=B.Intent$1("greet",b3.$0),b4!=null&&b4.$==1&&((b5=B.Entity1Of1("name",b4.$0[1]),b5!=null&&b5.$==1)&&bS.$1.$==0)))?(bQ(_6.name()))(function(cg){_6.update(cg);}):bS.$==1&&(b7=cf(bS.$0),b7!=null&&b7.$==1&&(b8=B.Intent$1("hello",b7.$0),b8!=null&&b8.$==1&&((b9=B.Entity1Of1("contact",b8.$0[1]),b9!=null&&b9.$==1)&&bS.$1.$==0)))?(bQ(_6.name()))(function(cg){_6.update(cg);}):bS.$==1&&(b$=_4.User_(bO,bS.$0),b$!=null&&b$.$==1&&((ca=B.Intent$1("journal",b$.$0),ca!=null&&ca.$==1)&&bS.$1.$==0))?(bQ(_8.name()))(function(cg){_8.update(cg);}):_4.didNotUnderstand(bO,function(cg){ba.debug(cg);},ba.name());_4.debugInterpreterEnd(bO,function(cg){ba.debug(cg);},ba.name());};ba.debug=function(bO){d.debug(ba.name(),bO);};ba.name=function(){bb.$cctor();return bb.name;};bb.$cctor=function(){bb.$cctor=a.ignore;bb.name="Main";};bc.run=function(){var bO,bP;bO=bk.ThisFunc(function(bQ,bR){return((bc.Main().get_Text())(bQ))(bR);});bP=bc.Main().get_Options();a.$("#term").terminal(bO,bP);return bn.get_Empty();};bc.Main=function(){bd.$cctor();return bd.Main;};bc.initMic=function(bO){var bP,bQ;bc.set_CUI((bP={$:1,$0:new bL.Microphone(bM.getElementById("microphone"))},_0.New(bc.CUI().Voice,bP,bc.CUI().Term,bc.CUI().Avatar,bc.CUI().Caption,bc.CUI().AudioHandlers,bc.CUI().TypingDNA)));bQ=bc.CUI().Mic.$0;bQ.onconnecting=function(){bc.set_MicState(X.MicConnecting);return bc.debug("Mic connecting...");};bQ.ondisconnected=function(){bc.set_MicState(X.MicDisconnected);return bc.debug("Mic disconnected.");};bQ.onaudiostart=function(){bc.set_MicState(X.MicAudioStart);return bc.debug("Mic audio start...");};bQ.onaudioend=function(){var bR,bS,bT,bU;bc.debug("Mic audio end.");bS=bc.CUI().AudioHandlers;bR=bS.GetEnumerator$1();try{while(bR.MoveNext()){bT=bR.Current();bc.debug((function(bV){return function(bW){return bV("Executing audio handler "+br.toSafe(bW)+".");};}(a.id))(bT.K));bc.set_MicState({$:7,$0:bT.K});bU=bT.V;bc.CUI().AudioHandlers.Remove(bT.K);bU(d.lastMicData());}return;}finally{bR.Dispose();}};bQ.onerror=function(bR){bc.set_MicState({$:6,$0:bR});return bc.debug((function(bS){return function(bT){return bS("Mic error : "+br.toSafe(bT)+".");};}(a.id))(bR));};bQ.onready=function(){bc.set_MicState(X.MicReady);return bc.debug("Mic ready.");};bQ.onresult=function(bR,bS){return bc.ClientState().$==2?bc.echo("I'm still trying to understand what you said before."):bc.ClientState().$==0?d.error("Client is not intialized."):bc.MicState().$==7?null:!(bR==null||bS==null)?(bc.set_MicState({$:8,$0:bR,$1:bS}),bc.debug((((bk.Curried3(function(bT,bU,bV){return bT("Mic result: "+br.prettyPrint(bU)+" "+br.prettyPrint(bV)+".");}))(a.id))(bR))(bS)),bO(bR,bS)):bc.debug("Mic: No result returned.");};bQ.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};bc.sayRandom=function(bO,bP){bc.say(z.getRandomPhrase(bP,bO));};bc.say=function(bO){bc.Output().unshift(bO);bc["say'"](bO);};bc["say'"]=function(bO){bc.CUI().Say(bO);};bc.initSpeech=function(){var bO;bO=d.toArray(bc.synth().getVoices());bh.length(bO)>0?(bh.iter(function(bP){if(bI.Equals(bc.CUI().Voice,null)&&(bP.name.indexOf("Microsoft Zira")!=-1||bP.name.toLowerCase().indexOf("female")!=-1)){bc.set_CUI(_0.New({$:1,$0:bP},bc.CUI().Mic,bc.CUI().Term,bc.CUI().Avatar,bc.CUI().Caption,bc.CUI().AudioHandlers,bc.CUI().TypingDNA));bc.debug((function(bQ){return function(bR){return bQ("Using browser speech synthesis voice "+br.toSafe(bR)+".");};}(a.id))(bc.CUI().Voice.$0.name));}},bO),!bI.Equals(bc.CUI().Voice,null)?(bc.CUI().Avatar.nativeVoice=true,bc.CUI().Avatar.nativeVoiceName=bc.CUI().Voice.$0.name,bc.debug((function(bP){return function(bQ){return bP("Using browser speech synthesis voice "+br.toSafe(bQ)+".");};}(a.id))(bc.CUI().Voice.$0.name))):void 0):void 0;bI.Equals(bc.CUI().Voice,null)?bc.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};bc.synth=function(){bd.$cctor();return bd.synth;};bc.push=function(bO){bc.Utterances().unshift(bO);return bc.Dialogue();};bc.Dialogue=function(){bd.$cctor();return bd.Dialogue;};bc.Utterances=function(){bd.$cctor();return bd.Utterances;};bc.Questions=function(){bd.$cctor();return bd.Questions;};bc.Output=function(){bd.$cctor();return bd.Output;};bc.Props=function(){bd.$cctor();return bd.Props;};bc.wait=function(bO){d["Terminal.Echo'"](bc.CUI().Term,"please wait");bc.CUI().Term.pause();bO();bc.CUI().Term.resume();};bc.debug=function(bO){d.debug("CLIENT",bO);};bc.echo=function(bO){d["Terminal.EchoHtml'"](bc.CUI().Term,(function(bP){return function(bQ){return bP(br.prettyPrint(bQ));};}(a.id))(bO));};bc.ClientState=function(){bd.$cctor();return bd.ClientState;};bc.set_ClientState=function(bO){bd.$cctor();bd.ClientState=bO;};bc.MicState=function(){bd.$cctor();return bd.MicState;};bc.set_MicState=function(bO){bd.$cctor();bd.MicState=bO;};bc.CUI=function(){bd.$cctor();return bd.CUI;};bc.set_CUI=function(bO){bd.$cctor();bd.CUI=bO;};bd.$cctor=function(){var bO,bP,bQ;bd.$cctor=a.ignore;function bR(bT,bU){var bV,bW,bX,bY,bZ,b0,b1;bc.debug((((bk.Curried3(function(b2,b3,b4){return b2("Voice: "+br.prettyPrint(b3)+" "+br.prettyPrint(b4));}))(a.id))(bT))(bU));bV=(bW=G["Intent'"](bT,bU),bW!=null&&bW.$==1?{$:1,$0:bW.$0}:null);bX=(bY=G["Trait'"](bU),bY!=null&&bY.$==1?{$:1,$0:bv.ofArray([bY.$0])}:null);bZ=(b0=G["Entity'$1"](bU),b0!=null&&b0.$==1?{$:1,$0:bv.ofArray([b0.$0])}:null);bV==null&&(bX==null&&bZ==null)?void 0:(bc.debug(((((bk.Curried(function(b2,b3,b4,b5){return b2("Voice: "+be.p(b3)+" "+be.p$3(b4)+" "+be.p$5(b5));},4))(a.id))(bV))(bX))(bZ)),ba.update(bc.push(new F({$:0,$0:"",$1:bV,$2:bX,$3:bZ}))));}function bS(bT,bU){var bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg;bc.set_CUI(_0.New(bc.CUI().Voice,bc.CUI().Mic,bT,bc.CUI().Avatar,bc.CUI().Caption,bc.CUI().AudioHandlers,bc.CUI().TypingDNA));if(bI.Equals(bc.CUI().Mic,null))bc.initMic(bR);if(bI.Equals(bc.CUI().Voice,null))bc.initSpeech();if(bc.ClientState().$===0)bc.set_ClientState(Y.ClientReady);ce=I.Blank(bU);if(ce!=null&&ce.$==1)return bc["say'"]("Tell me what you want me to do or ask me a question.");else{cf=I.Debug(bU);if(cf!=null&&cf.$==1){bc.debug((function(ch){return function(ci){return ch("Utterances: "+br.prettyPrint(ci));};}(a.id))(bc.Utterances()));bc.debug((function(ch){return function(ci){return ch("Questions: "+br.prettyPrint(ci));};}(a.id))(bc.Questions()));bV=bc.Props().GetEnumerator$1();try{while(bV.MoveNext()){cg=bV.Current();bc.debug((((bk.Curried3(function(ch,ci,cj){return ch(br.toSafe(ci)+": "+br.prettyPrint(cj));}))(a.id))(cg.K))(cg.V));}return;}finally{bV.Dispose();}}else{bW=I.DebugEntities(bU);return bW!=null&&bW.$==1?(bX=bW.$0,bc.CUI().Wait((bY=null,by.Delay(function(){return by.Bind(v.disambiguate(bX),function(ch){return by.For(ch,function(ci){bc.debug((function(cj){return function(ck){return cj(bf.p(ck));};}(a.id))(ci));return by.Zero();});});})))):(bZ=I.DebugTriples(bU),bZ!=null&&bZ.$==1?(b0=bZ.$0,bc.CUI().Wait((b1=null,by.Delay(function(){return by.Bind((new bK.New()).Async("SMApp.Web:SMApp.Web.Server.getTriples:-578366823",[b0]),function(ch){return ch.$==1?(bc.debug(ch.$0),by.Zero()):by.For(ch.$0,function(ci){return by.For(ci,function(cj){bc.debug((function(ck){return function(cl){return ck(be.p$7(cl));};}(a.id))(cj));return by.Zero();});});});})))):(b2=I.DebugEmotionalTraits(bU),b2!=null&&b2.$==1?(b3=b2.$0,bc.CUI().Wait((b4=null,by.Delay(function(){return by.Bind((new bK.New()).Async("SMApp.Web:SMApp.Web.Server.getEmotionalTraits:915661547",[b3]),function(ch){return ch.$==1?(bc.debug(ch.$0),by.Zero()):by.For(ch.$0,function(ci){bc.debug((function(cj){return function(ck){return cj(be.p$15(ck));};}(a.id))(ci));return by.Zero();});});})))):(b5=I.Voices(bU),b5!=null&&b5.$==1?(b6=d.toArray(d.speechSynthesis().getVoices()),bc["say'"]((function(ch){return function(ci){return ch("There are currently "+a.String(ci)+" voices installed on this computer or device.");};}(a.id))(bh.length(b6))),bh.iteri(function(ch,ci){return bc["say'"](((((bk.Curried(function(cj,ck,cl,cm){return cj("Voice "+a.String(ck)+". Name: "+br.toSafe(cl)+", Local: "+br.prettyPrint(cm)+".");},4))(a.id))(ch))(ci.name))(ci.localService));},b6)):bc.ClientState().$==1?(b8=I.QuickHello(bU),(b8!=null&&b8.$==1?(b7=b8.$0,true):(b9=I.QuickHelp(bU),b9!=null&&b9.$==1?(b7=b9.$0,true):(b_=I.QuickYes(bU),b_!=null&&b_.$==1?(b7=b_.$0,true):(b$=I.QuickNo(bU),b$!=null&&b$.$==1?(b7=b$.$0,true):(ca=I.QuickNumber(bU),ca!=null&&ca.$==1&&(b7=ca.$0,true))))))?(bc.debug((function(ch){return function(ci){return ch("Quick Text: "+be.p$16(ci)+".");};}(a.id))(b7)),ba.update(bc.push(b7)),bc.set_ClientState(Y.ClientReady)):(cb=I.JournalEntry(bU),cb!=null&&cb.$==1?(cc=cb.$0,bc.debug((function(ch){return function(ci){return ch("Journal entry: "+be.p$16(ci)+".");};}(a.id))(cc)),ba.update(bc.push(cc)),bc.set_ClientState(Y.ClientReady)):bc.CUI().Wait((cd=null,by.Delay(function(){bc.set_ClientState(Y.ClientUnderstand);I.getUtterance(bU,function(ch){var ci,cj;ci=I.HasUtterance(ch);ci!=null&&ci.$==1?(cj=ci.$0,bc.debug(((((bk.Curried(function(ck,cl,cm,cn){return ck("Text: Intent: "+be.p(cl)+", Traits: "+be.p$3(cm)+", Entities: "+be.p$5(cn)+".");},4))(a.id))(cj.get_Intent()))(cj.get_Traits()))(cj.get_Entities())),ba.update(bc.push(cj))):(bc.debug("Text: Did not receive a meaning from the server."),bc["say'"]("Sorry I did not understand what you said."));});bc.set_ClientState(Y.ClientReady);return by.Zero();}))))):bc.ClientState().$==0?d.error("Client is not initialized."):bc["say'"]("I'm still trying to understand what you said before."))));}}}bd.CUI=_0.New(null,null,null,(bH.applicationId="4277115329081938617",bO=new a.SDKConnection(),bP=new a.WebAvatar(),bP.version=8.5,bP.connection=bO,bP.avatar="20926186",bP.voice="cmu-slt",bP.voiceMod="default",bP.width=175,bP.createBox(),bP.addMessage(""),bP.processMessages(0),bP),false,new bN.New$5(),new a.TypingDNA());bd.MicState=X.MicNotInitialized;bd.ClientState=Y.ClientNotInitialzed;bd.Props=new bN.New$5();bd.Output=[];bd.Questions=[];bd.Utterances=[];bd.Dialogue=new _1({$:0,$0:bc.CUI(),$1:bc.Props(),$2:bc.Questions(),$3:bc.Output(),$4:bc.Utterances()});bd.synth=a.speechSynthesis;bd.Main=new Z({$:0,$0:function(bT){return bR(bT[0],bT[1]);},$1:[function(bT){return function(bU){return bS(bT,bU);};},(bQ={},bQ.name="Main",bQ.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bQ.prompt=">",bQ)]});};be.p$17=function(bO){return bO==null?"null":"Some "+be.p$14(bO.$0);};be.p$18=function(bO){return bO.$==3?"ConceptCompletion":bO.$==2?"Disjunctive":bO.$==1?"Verification":"UserAuthentication "+br.prettyPrint(bO.$0);};bf.p$3=function(bO){return"{"+("text = "+br.prettyPrint(bO.text))+"; "+("intents = "+br.printArray(function(bP){return bf.p$4(bP);},bO.intents))+"; "+("entities = "+br.prettyPrint(bO.entities))+"; "+("traits = "+br.prettyPrint(bO.traits))+"}";};bf.p$4=function(bO){return"{"+("id = "+br.prettyPrint(bO.id))+"; "+("name = "+br.prettyPrint(bO.name))+"; "+("confidence = "+br.prettyPrint(bO.confidence))+"}";};be.p$19=function(bO){return"Question ("+br.prettyPrint(bO.$0)+", "+br.prettyPrint(bO.$1)+", "+be.p$18(bO.$2)+", "+be.p$20(bO.$3)+", "+"<fun>"+")";};be.p$20=function(bO){return bO==null?"null":"Some "+br.printArray(br.prettyPrint,bO.$0);};be.p$2=function(bO){return bO==null?"null":"Some "+br.prettyPrint(bO.$0);};be.p$1=function(bO){return"Intent ("+br.prettyPrint(bO.$0)+", "+be.p$2(bO.$1)+")";};be.p=function(bO){return bO==null?"null":"Some "+be.p$1(bO.$0);};be.p$4=function(bO){return"Trait ("+br.prettyPrint(bO.$0)+", "+br.prettyPrint(bO.$1)+", "+be.p$2(bO.$2)+")";};be.p$3=function(bO){return bO==null?"null":"Some "+br.printList(function(bP){return be.p$4(bP);},bO.$0);};be.p$6=function(bO){return"Entity ("+br.prettyPrint(bO.$0)+", "+br.prettyPrint(bO.$1)+", "+br.prettyPrint(bO.$2)+", "+be.p$2(bO.$3)+")";};be.p$5=function(bO){return bO==null?"null":"Some "+br.printList(function(bP){return be.p$6(bP);},bO.$0);};bf.p$1=function(bO){return"{"+("start = "+br.prettyPrint(bO.start))+"; "+("end = "+br.prettyPrint(bO.end))+"}";};bf.p$2=function(bO){return"{"+("start = "+br.prettyPrint(bO.start))+"; "+("end = "+br.prettyPrint(bO.end))+"}";};bf.p=function(bO){return"{"+("tokenFragment = "+bf.p$1(bO.tokenFragment))+"; "+("charFragment = "+bf.p$2(bO.charFragment))+"; "+("babelSynsetID = "+br.prettyPrint(bO.babelSynsetID))+"; "+("DBpediaURL = "+br.prettyPrint(bO.DBpediaURL))+"; "+("BabelNetURL = "+br.prettyPrint(bO.BabelNetURL))+"; "+("score = "+br.prettyPrint(bO.score))+"; "+("cohrenceScore = "+br.prettyPrint(bO.cohrenceScore))+"; "+("globalScore = "+br.prettyPrint(bO.globalScore))+"; "+("source = "+br.prettyPrint(bO.source))+"}";};be.p$10=function(bO){return"Relation ("+br.prettyPrint(bO.$0)+", "+br.prettyPrint(bO.$1)+", "+br.prettyPrint(bO.$2)+")";};be.p$9=function(bO){return bO.$==1?"Relation "+be.p$10(bO.$0):"Subject "+br.prettyPrint(bO.$0);};be.p$11=function(bO){return"Verb "+br.prettyPrint(bO.$0);};be.p$8=function(bO){return"Relation ("+be.p$9(bO.$0)+", "+br.prettyPrint(bO.$1)+", "+be.p$11(bO.$2)+")";};be.p$14=function(bO){return bO.$==1?"Relation "+be.p$10(bO.$0):"Object "+br.prettyPrint(bO.$0);};be.p$13=function(bO){return"Relation ("+be.p$11(bO.$0)+", "+br.prettyPrint(bO.$1)+", "+be.p$14(bO.$2)+")";};be.p$12=function(bO){return bO==null?"null":"Some "+be.p$13(bO.$0);};be.p$7=function(bO){return"Triple ("+be.p$8(bO.$0)+", "+be.p$12(bO.$1)+")";};be.p$15=function(bO){return"EmotionalTrait ("+br.prettyPrint(bO.$0)+", "+br.printList(br.prettyPrint,bO.$1)+", "+br.prettyPrint(bO.$2)+")";};be.p$16=function(bO){return"Utterance ("+br.prettyPrint(bO.$0)+", "+be.p(bO.$1)+", "+be.p$3(bO.$2)+", "+be.p$5(bO.$3)+")";};}());
