(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W;a=self;b=a.SMApp=a.SMApp||{};c=b.Bootstrap=b.Bootstrap||{};d=c.Controls=c.Controls||{};e=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};f=b.Web=b.Web||{};g=f.NLU=f.NLU||{};h=g.Intent=g.Intent||{};i=g.Trait=g.Trait||{};j=g.Meaning=g.Meaning||{};k=g.Voice=g.Voice||{};l=k["Entity'"]=k["Entity'"]||{};m=g.Text=g.Text||{};n=m.Meaning=m.Meaning||{};o=m.Intent=m.Intent||{};p=m.Entity=m.Entity||{};q=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};r=f.CUI=f.CUI||{};s=f.CUIModule=f.CUIModule||{};t=s.User=s.User||{};u=s.Interpreter=s.Interpreter||{};v=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};w=f.Main=f.Main||{};x=f.ClientExtensions=f.ClientExtensions||{};y=f._Html=f._Html||{};z=f.htmModule=f.htmModule||{};A=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};B=f.Client=f.Client||{};C=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};D=a.WebSharper;E=D&&D.UI;F=E&&E.Doc;G=D&&D.List;H=E&&E.AttrModule;I=a.IntelliFactory;J=I&&I.Runtime;K=D&&D.Concurrency;L=D&&D.Seq;M=D&&D.Random;N=D&&D.Remoting;O=N&&N.AjaxRemotingProvider;P=D&&D.Arrays;Q=a.jQuery;R=a.console;S=D&&D.Strings;T=D&&D.Utils;U=a.Wit;V=a.document;W=D&&D.Unchecked;d.Radio=function(X,Y,Z,_0,_1){return F.Element("div",new G.T({$:1,$0:(d.cls())("radio"),$1:Y}),[F.Element("label",_0,[F.Radio(_1,true,Z),F.TextNode(X)])]);};d.Checkbox=function(X,Y,Z,_0,_1){return F.Element("div",new G.T({$:1,$0:(d.cls())("checkbox"),$1:Y}),[F.Element("label",_0,[F.CheckBox(_1,Z),F.TextNode(X)])]);};d.TextArea=function(X,Y,Z,_0,_1){return F.Element("div",new G.T({$:1,$0:(d.cls())("form-group"),$1:Y}),[F.Element("label",_0,[F.TextNode(X)]),F.InputArea(new G.T({$:1,$0:(d.cls())("form-control"),$1:_1}),Z)]);};d.InputPassword=function(X,Y,Z,_0,_1){return F.Element("div",new G.T({$:1,$0:(d.cls())("form-group"),$1:Y}),[F.Element("label",_0,[F.TextNode(X)]),F.PasswordBox(new G.T({$:1,$0:(d.cls())("form-control"),$1:_1}),Z)]);};d.Input=function(X,Y,Z,_0,_1){return F.Element("div",new G.T({$:1,$0:(d.cls())("form-group"),$1:Y}),[F.Element("label",_0,[F.TextNode(X)]),F.Input(new G.T({$:1,$0:(d.cls())("form-control"),$1:_1}),Z)]);};d.Container=function(X){return F.Element("div",[(d.cls())("container")],X);};d.Class=function(){e.$cctor();return e.Class;};d.cls=function(){e.$cctor();return e.cls;};e.$cctor=function(){e.$cctor=a.ignore;e.cls=H.Class;e.Class=H.Class;};h.Programs={$:3};h.Onboard={$:2};h.Help={$:1};h.Hello={$:0};i.Greetings={$:0};j=g.Meaning=J.Class({get_Entities:function(){return(this.Unwrap())[2];},get_Trait:function(){return(this.Unwrap())[1];},get_Intent:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,j);l.New=function(X,Y,Z,_0,_1){return{body:X,end:Y,start:Z,suggested:_0,value:_1};};k.Contact=function(X){return!(X.contact==null)?{$:1,$0:{$:0,$0:l.New(X.body,X.end,X.start,X.ff,X.value).value}}:null;};k.Greetings=function(X){return!(X.greetings==null)&&!(X.greetings.value==null)?{$:1,$0:i.Greetings}:null;};k.Hello=function(X){return typeof X=="string"&&X.toLowerCase()==="default_intent"?{$:1,$0:h.Hello}:null;};n=m.Meaning=J.Class({get_TopIntent:function(){return G.head(G.sortBy(function(X){return X.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,n);o=m.Intent=J.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,o);p=m.Entity=J.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,p);m.HelloUser=function(X){var Y,Z;return(Z=m.Hello(X),Z!=null&&Z.$==1&&(Z.$0.$==1&&(Z.$0.$1.$==0&&(Z.$0.$0.get_Role()==="contact"&&(Y=Z.$0.$0,true)))))?{$:1,$0:Y}:null;};m.Hello=function(X){var Y,Z;return X!=null&&X.$==1&&(Z=m.Intent$1("Hello",X.$0),Z!=null&&Z.$==1&&(Y=Z.$0,true))?{$:1,$0:Y}:null;};m.Intent$1=function(X,Y){return Y.get_TopIntent().get_Name()===X&&Y.get_TopIntent().get_Confidence()>m.intentConfidenceThreshold()?{$:1,$0:G.filter(function(Z){return Z.get_Confidence()>m.entityConfidenceThreshold();},Y.get_Entities())}:null;};m.entityConfidenceThreshold=function(){q.$cctor();return q.entityConfidenceThreshold;};m.set_entityConfidenceThreshold=function(X){q.$cctor();q.entityConfidenceThreshold=X;};m.intentConfidenceThreshold=function(){q.$cctor();return q.intentConfidenceThreshold;};m.set_intentConfidenceThreshold=function(X){q.$cctor();q.intentConfidenceThreshold=X;};m.QuickPrograms=function(X){return X==="programs"?{$:1,$0:h.Programs}:null;};m.QuickHelp=function(X){var Y;return X==="help"||(X==="help me"||(X==="what's this?"||X==="huh"))?{$:1,$0:h.Help}:null;};m.QuickHello=function(X){var Y;return X==="hello"||(X==="hey"||(X==="yo"||X==="hi"))?{$:1,$0:h.Hello}:null;};m.DebugOff=function(X){return X==="debug off"?{$:1,$0:null}:null;};m.DebugOn=function(X){return X==="debug on"?{$:1,$0:null}:null;};q.$cctor=function(){q.$cctor=a.ignore;q.intentConfidenceThreshold=0.85;q.entityConfidenceThreshold=0.85;};r=f.CUI=J.Class({Say:function(X){var Y,Z,_0;Y=this.Voice;Y!=null&&Y.$==1?(Z=Y.$0,K.Start((_0=null,K.Delay(function(){var _1;_1=new a.SpeechSynthesisUtterance(X);_1.voice=Z;a.speechSynthesis.speak(_1);return K.Zero();})),null),this.Caption?this["Echo'"](X):void 0):this["Echo'"](X);},"EchoHtml'":function(X){var Y,Z;Y=(Z={},Z.raw=true,Z);this.Term.disable();this.Term.echo(X,Y);this.Term.enable();},"Echo'":function(X){this.Term.disable();this.Term.echo(X);this.Term.enable();}},null,r);r.New=function(X,Y,Z,_0,_1){return new r({Voice:X,Mic:Y,Term:Z,Debug:_0,Caption:_1});};t.New=function(X){return{UserName:X};};u=s.Interpreter=J.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,u);s.helloUserPhrases=function(){v.$cctor();return v.helloUserPhrases;};s.helloPhrases=function(){v.$cctor();return v.helloPhrases;};s.getRandomPhrase=function(X){return L.nth(s.rng().Next(0,X.get_Length()),X);};s.rng=function(){v.$cctor();return v.rng;};v.$cctor=function(){v.$cctor=a.ignore;v.rng=new M.New();v.helloPhrases=G.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);v.helloUserPhrases=G.ofArray(["Hi $user, welcome back.","Welcome $user, nice to see you again..","Hello $user","Good to see you $user."]);};w.update=function(X,Y){var Z;X.Say("I'm in the Main module.");Y.$==1?Y.$0.$0.get_Intent().$===3?K.Start((Z=null,K.Delay(function(){return K.Bind((new O.New()).Async("SMApp.Web:SMApp.Web.Server.GetPatients:1355593010",[]),function(_0){return _0.$==0?(X.Say("I got the patients"),K.Zero()):(X.Say(" I did not"),K.Zero());});})),null):void 0:void 0;};x.toArray=function(X){return P.map(a.id,Q.makeArray(X));};x.error=function(X){R.error(X);};x.info=function(X){R.info(X);};x.jserror=function(X){Q.error(X);};x["Terminal.Push"]=function(X,Y){var Z,_0;Z=Y.get_Text();_0=Y.get_Options();X.push(J.CreateFuncWithThis(Z),_0);};x["Terminal.EchoHtml'"]=function(X,Y){X.disable();X.echo(Y,x.rawOpt());X.enable();};x["Terminal.Echo'"]=function(X,Y){X.disable();X.echo(Y);X.enable();};x.rawOpt=function(){A.$cctor();return A.rawOpt;};y=f._Html=J.Class({toString:function(){return y.toString(this);}},null,y);y.toString=function(X){function Y(Z){return function(_0){var _1,_2,_3,_4,_5,_6,_7;_2=S.replicate(Z," ");switch(_0.$==0?_0.$1.$==1?_0.$1.$0.$==2?_0.$1.$1.$==0?(_1=[_0.$1.$0.$0,_0.$0],1):(_1=[_0.$1,_0.$0],2):(_1=[_0.$1,_0.$0],2):(_1=[_0.$1,_0.$0],2):_0.$==2?(_1=_0.$0,3):(_1=[_0.$0,_0.$1],0)){case 0:return _1[0]+"=\""+_1[1]+"\"";case 1:_3=_1[1];return _2+"<"+_3+">"+_1[0]+"</"+_3+">\r\n";case 2:_4=_1[1];_5=G.partition(function(_8){return _8.$==1;},_1[0]);_6=_5[1];_7=_5[0];return _6.$==0?_2+"<"+_4+(_7.$===0?"":" "+S.concat(" ",G.ofSeq(L.delay(function(){return L.map(function(_8){return(Y(0))(_8);},_7);}))))+"/>\r\n":_2+"<"+_4+(_7.$===0?"":" "+S.concat(" ",G.ofSeq(L.delay(function(){return L.map(function(_8){return(Y(0))(_8);},_7);}))))+">\r\n"+S.concat("",G.ofSeq(L.delay(function(){return L.map(function(_8){return(Y(Z+1))(_8);},_6);})))+_2+"</"+_4+">\r\n";case 3:return _2+_1+"\r\n";}};}return(Y(0))(X);};z.alt=function(X){return new y({$:1,$0:"alt",$1:X});};z.src=function(X){return new y({$:1,$0:"src",$1:X});};z.cls=function(X){return new y({$:1,$0:"class",$1:X});};z.str=function(X){return y.toString(X);};z.op_PercentEquals=function(X,Y){return new y({$:1,$0:X,$1:Y});};z.op_Splice=function(X){var Y;return G.ofArray([new y({$:2,$0:(Y=X,a.String(Y))})]);};z.strong=function(){A.$cctor();return A.strong;};z.h4=function(){A.$cctor();return A.h4;};z.h3=function(){A.$cctor();return A.h3;};z.h2=function(){A.$cctor();return A.h2;};z.h1=function(){A.$cctor();return A.h1;};z.li=function(){A.$cctor();return A.li;};z.ul=function(){A.$cctor();return A.ul;};z.th=function(){A.$cctor();return A.th;};z.td=function(){A.$cctor();return A.td;};z.tr=function(){A.$cctor();return A.tr;};z.a=function(){A.$cctor();return A.a;};z.p=function(){A.$cctor();return A.p;};z.area=function(){A.$cctor();return A.area;};z.map=function(){A.$cctor();return A.map;};z.img=function(){A.$cctor();return A.img;};z.tfoot=function(){A.$cctor();return A.tfoot;};z.tbody=function(){A.$cctor();return A.tbody;};z.thead=function(){A.$cctor();return A.thead;};z.table=function(){A.$cctor();return A.table;};z.span=function(){A.$cctor();return A.span;};z.section=function(){A.$cctor();return A.section;};z.br=function(){A.$cctor();return A.br;};z.div=function(){A.$cctor();return A.div;};z.body=function(){A.$cctor();return A.body;};z.style=function(){A.$cctor();return A.style;};z.title=function(){A.$cctor();return A.title;};z.head=function(){A.$cctor();return A.head;};z.html=function(){A.$cctor();return A.html;};z.elem=function(X,Y){return new y({$:0,$0:X,$1:Y});};A.$cctor=function(){var X;A.$cctor=a.ignore;A.rawOpt=(X={},X.raw=true,X);A.html=function(Y){return z.elem("html",Y);};A.head=function(Y){return z.elem("head",Y);};A.title=function(Y){return z.elem("title",Y);};A.style=function(Y){return z.elem("style",Y);};A.body=function(Y){return z.elem("body",Y);};A.div=function(Y){return z.elem("div",Y);};A.br=function(Y){return z.elem("br",Y);};A.section=function(Y){return z.elem("section",Y);};A.span=function(Y){return z.elem("span",Y);};A.table=function(Y){return z.elem("table",Y);};A.thead=function(Y){return z.elem("thead",Y);};A.tbody=function(Y){return z.elem("tbody",Y);};A.tfoot=function(Y){return z.elem("tfoot",Y);};A.img=function(Y){return z.elem("img",Y);};A.map=function(Y){return z.elem("map",Y);};A.area=function(Y){return z.elem("area",Y);};A.p=function(Y){return z.elem("p",Y);};A.a=function(Y){return z.elem("a",Y);};A.tr=function(Y){return z.elem("tr",Y);};A.td=function(Y){return z.elem("td",Y);};A.th=function(Y){return z.elem("th",Y);};A.ul=function(Y){return z.elem("ul",Y);};A.li=function(Y){return z.elem("li",Y);};A.h1=function(Y){return z.elem("h1",Y);};A.h2=function(Y){return z.elem("h1",Y);};A.h3=function(Y){return z.elem("h1",Y);};A.h4=function(Y){return z.elem("h1",Y);};A.strong=function(Y){return z.elem("strong",Y);};};B.run=function(){var X,Y;X=J.ThisFunc(function(Z,_0){return((B.Main().get_Text())(Z))(_0);});Y=B.Main().get_Options();a.$("#main").terminal(X,Y);return F.get_Empty();};B.Main=function(){C.$cctor();return C.Main;};B.container=function(){C.$cctor();return C.container;};B.wait=function(X){x["Terminal.Echo'"](B.CUI().Term,"please wait");B.CUI().Term.disable();X();B.CUI().Term.enable();};B.stopSpeaking=function(){C.$cctor();return C.stopSpeaking;};B.sayRandom=function(X){B.say(s.getRandomPhrase(X));};B.sayVoices=function(){var X,Y;X=a.speechSynthesis.getVoices();!(X==null)?(Y=x.toArray(X),B.say((function(Z){return function(_0){return Z("There are currently "+a.String(_0)+" voices installed on this computer or device.");};}(a.id))(P.length(Y))),P.iteri(function(Z,_0){return B.say(((((J.Curried(function(_1,_2,_3,_4){return _1("Voice "+a.String(_2)+". Name: "+T.toSafe(_3)+", Local: "+T.prettyPrint(_4)+".");},4))(a.id))(Z))(_0.name))(_0.localService));},Y)):void 0;};B.say=function(X){var Y,Z,_0;Y=B.CUI().Voice;Y!=null&&Y.$==1?(Z=Y.$0,K.Start((_0=null,K.Delay(function(){var _1;_1=new a.SpeechSynthesisUtterance(X);_1.voice=Z;a.speechSynthesis.speak(_1);return K.Zero();})),null),B.CUI().Caption?x["Terminal.Echo'"](B.CUI().Term,X):void 0):x["Terminal.Echo'"](B.CUI().Term,X);};B.initMic=function(X,Y){var Z,_0;B.set_CUI((Z={$:1,$0:new U.Microphone(V.getElementById("microphone"))},r.New(B.CUI().Voice,Z,B.CUI().Term,B.CUI().Debug,B.CUI().Caption)));_0=B.CUI().Mic.$0;_0.onconnecting=function(){B.set_MicState({$:1});return B.debugEcho("Mic connecting...");};_0.ondisconnected=function(){return B.debugEcho("Mic disconnected.");};_0.onaudiostart=function(){return B.debugEcho("Mic audio start...");};_0.onaudioend=function(){return B.debugEcho("Mic audio end.");};_0.onerror=function(_1){return B.debugEcho((function(_2){return function(_3){return _2("Mic error : "+T.toSafe(_3)+".");};}(a.id))(_1));};_0.onready=function(){return B.debugEcho("Mic ready.");};_0.onresult=function(_1,_2){return X(_0,[_1,_2]);};_0.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};B.initSpeech=function(){var X,Y;X=a.speechSynthesis.getVoices();!(X==null)?(Y=x.toArray(X),P.iter(function(Z){if(W.Equals(B.CUI().Voice,null)&&(Z.name.indexOf("Microsoft Zira")!=-1||Z.name.toLowerCase().indexOf("female")!=-1)){B.set_CUI(r.New({$:1,$0:Z},B.CUI().Mic,B.CUI().Term,B.CUI().Debug,B.CUI().Caption));x.info((function(_0){return function(_1){return _0("Using voice "+T.toSafe(_1)+".");};}(a.id))(B.CUI().Voice.$0.name));}},Y),W.Equals(B.CUI().Voice,null)&&P.length(Y)>0?(B.set_CUI(r.New({$:1,$0:P.find(function(Z){return Z["default"];},Y)},B.CUI().Mic,B.CUI().Term,B.CUI().Debug,B.CUI().Caption)),x.info((function(Z){return function(_0){return Z("Using default voice "+T.toSafe(_0)+".");};}(a.id))(B.CUI().Voice.$0.name))):void 0):void 0;W.Equals(B.CUI().Voice,null)?(x.error("No speech synthesis voice is available."),x["Terminal.Echo'"](B.CUI().Term,"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma.")):void 0;};B.debugEcho=function(X){if(B.CUI().Debug)x["Terminal.EchoHtml'"](B.CUI().Term,X);};B.echo=function(){C.$cctor();return C.echo;};B.updateCtx=function(X){B.set_context(G.append(G.ofArray([{$:0,$0:X}]),B.context()));return G.ofSeq(L.take(B.context().get_Length()>=5?5:B.context().get_Length(),B.context()));};B.context=function(){C.$cctor();return C.context;};B.set_context=function(X){C.$cctor();C.context=X;};B.MicState=function(){C.$cctor();return C.MicState;};B.set_MicState=function(X){C.$cctor();C.MicState=X;};B.CUI=function(){C.$cctor();return C.CUI;};B.set_CUI=function(X){C.$cctor();C.CUI=X;};C.$cctor=function(){var X,Y;C.$cctor=a.ignore;function Z(_1,_2){var _3,_4;_3=_2[1];x.info(_2[0]);x.info(_3);_4=k.Greetings(_3);return _4!=null&&_4.$==1?x.info(_4.$0):x.error(_3);}function _0(_1,_2){var _3,_4,_5,_6,_7,_8,_9,_;B.set_CUI(r.New(B.CUI().Voice,B.CUI().Mic,_1,B.CUI().Debug,B.CUI().Caption));W.Equals(B.CUI().Voice,null)?B.initSpeech():void 0;W.Equals(B.CUI().Mic,null)?B.initMic(Z,_1):void 0;return(_3=m.DebugOn(_2),_3!=null&&_3.$==1)?(B.set_CUI(r.New(B.CUI().Voice,B.CUI().Mic,B.CUI().Term,true,B.CUI().Caption)),B.say("Debug mode is now on.")):(_4=m.DebugOff(_2),_4!=null&&_4.$==1)?(B.set_CUI(r.New(B.CUI().Voice,B.CUI().Mic,B.CUI().Term,false,B.CUI().Caption)),B.say("Debug mode is now off.")):(_6=m.QuickHello(_2),_6!=null&&_6.$==1?(_5=_6.$0,true):(_7=m.QuickHelp(_2),_7!=null&&_7.$==1?(_5=_7.$0,true):(_8=m.QuickPrograms(_2),_8!=null&&_8.$==1&&(_5=_8.$0,true))))?(_9=B.updateCtx(new j({$:0,$0:_5,$1:null,$2:null})),w.update(B.CUI(),_9)):(x["Terminal.Echo'"](B.CUI().Term,"please wait"),K.Start((_=null,K.Delay(function(){return K.Bind((new O.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:1075237027",[_2]),function($){var ba;ba=m.HelloUser($);return ba!=null&&ba.$==1?(B.say((function(bb){return function(bc){return bb("This is the hello intent. The user name is "+T.toSafe(bc)+".");};}(a.id))(ba.$0.get_Value())),K.Zero()):(x["Terminal.Echo'"](_1,"This is the whatever intent"),K.Zero());});})),null));}C.CUI=r.New(null,null,null,false,false);C.MicState={$:0};C.context=G.T.Empty;C.echo=(X=B.CUI().Term,function(_1){x["Terminal.EchoHtml'"](X,_1);});C.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;C.container=d.Container;C.Main=new u({$:0,$0:function(_1){return function(_2){return Z(_1,_2);};},$1:[function(_1){return function(_2){return _0(_1,_2);};},(Y={},Y.name="Main",Y.greetings="Welcome to Selma. Type hello to begin or help for more assistance.",Y.prompt=">",Y)]});};}());
