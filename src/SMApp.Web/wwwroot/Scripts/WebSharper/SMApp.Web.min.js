(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=b.Bootstrap=b.Bootstrap||{};i=h.Controls=h.Controls||{};j=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};k=c.NLU=c.NLU||{};l=k.Intent=k.Intent||{};m=k.Trait=k.Trait||{};n=k.Entity=k.Entity||{};o=k.Meaning=k.Meaning||{};p=k.Voice=k.Voice||{};q=p["Entity'"]=p["Entity'"]||{};r=k.Text=k.Text||{};s=r["Meaning'"]=r["Meaning'"]||{};t=r["Intent'"]=r["Intent'"]||{};u=r["Entity'"]=r["Entity'"]||{};v=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};w=c.CUI=c.CUI||{};x=c.CUIModule=c.CUIModule||{};y=x.User=x.User||{};z=x.Interpreter=x.Interpreter||{};A=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};B=c.Main=c.Main||{};C=c.Client=c.Client||{};D=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};E=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};F=a.WebSharper;G=F&&F.Arrays;H=a.jQuery;I=F&&F.Utils;J=a.console;K=a.IntelliFactory;L=K&&K.Runtime;M=F&&F.Strings;N=F&&F.List;O=F&&F.Seq;P=F&&F.UI;Q=P&&P.Doc;R=P&&P.AttrModule;S=F&&F.Concurrency;T=F&&F.Random;U=a.Wit;V=a.document;W=F&&F.Unchecked;X=F&&F.Remoting;Y=X&&X.AjaxRemotingProvider;d.toLower=function(Z){return Z.toLowerCase();};d.toArray=function(Z){return G.map(a.id,H.makeArray(Z));};d.debug=function(Z){var _0;d.info((function(_1){return function(_2){return _1("DEBUG: "+I.toSafe(_2));};}(a.id))((_0=Z,a.String(_0))));};d.error=function(Z){J.error(Z);};d.info=function(Z){J.info(Z);};d.jserror=function(Z){H.error(Z);};d["Terminal.EchoHtml'"]=function(Z,_0){Z.disable();Z.echo(_0,d.rawOpt());Z.enable();};d["Terminal.Echo'"]=function(Z,_0){Z.disable();Z.echo(_0);Z.enable();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=L.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(Z){function _0(_1){return function(_2){var _3,_4,_5,_6,_7,_8,_9;_4=M.replicate(_1," ");switch(_2.$==0?_2.$1.$==1?_2.$1.$0.$==2?_2.$1.$1.$==0?(_3=[_2.$1.$0.$0,_2.$0],1):(_3=[_2.$1,_2.$0],2):(_3=[_2.$1,_2.$0],2):(_3=[_2.$1,_2.$0],2):_2.$==2?(_3=_2.$0,3):(_3=[_2.$0,_2.$1],0)){case 0:return _3[0]+"=\""+_3[1]+"\"";case 1:_5=_3[1];return _4+"<"+_5+">"+_3[0]+"</"+_5+">\r\n";case 2:_6=_3[1];_7=N.partition(function(_){return _.$==1;},_3[0]);_8=_7[1];_9=_7[0];return _8.$==0?_4+"<"+_6+(_9.$===0?"":" "+M.concat(" ",N.ofSeq(O.delay(function(){return O.map(function(_){return(_0(0))(_);},_9);}))))+"/>\r\n":_4+"<"+_6+(_9.$===0?"":" "+M.concat(" ",N.ofSeq(O.delay(function(){return O.map(function(_){return(_0(0))(_);},_9);}))))+">\r\n"+M.concat("",N.ofSeq(O.delay(function(){return O.map(function(_){return(_0(_1+1))(_);},_8);})))+_4+"</"+_6+">\r\n";case 3:return _4+_3+"\r\n";}};}return(_0(0))(Z);};f.alt=function(Z){return new e({$:1,$0:"alt",$1:Z});};f.src=function(Z){return new e({$:1,$0:"src",$1:Z});};f.cls=function(Z){return new e({$:1,$0:"class",$1:Z});};f.str=function(Z){return e.toString(Z);};f.op_PercentEquals=function(Z,_0){return new e({$:1,$0:Z,$1:_0});};f.op_Splice=function(Z){var _0;return N.ofArray([new e({$:2,$0:(_0=Z,a.String(_0))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(Z,_0){return new e({$:0,$0:Z,$1:_0});};g.$cctor=function(){var Z;g.$cctor=a.ignore;g.rawOpt=(Z={},Z.raw=true,Z);g.html=function(_0){return f.elem("html",_0);};g.head=function(_0){return f.elem("head",_0);};g.title=function(_0){return f.elem("title",_0);};g.style=function(_0){return f.elem("style",_0);};g.body=function(_0){return f.elem("body",_0);};g.div=function(_0){return f.elem("div",_0);};g.br=function(_0){return f.elem("br",_0);};g.section=function(_0){return f.elem("section",_0);};g.span=function(_0){return f.elem("span",_0);};g.table=function(_0){return f.elem("table",_0);};g.thead=function(_0){return f.elem("thead",_0);};g.tbody=function(_0){return f.elem("tbody",_0);};g.tfoot=function(_0){return f.elem("tfoot",_0);};g.img=function(_0){return f.elem("img",_0);};g.map=function(_0){return f.elem("map",_0);};g.area=function(_0){return f.elem("area",_0);};g.p=function(_0){return f.elem("p",_0);};g.a=function(_0){return f.elem("a",_0);};g.tr=function(_0){return f.elem("tr",_0);};g.td=function(_0){return f.elem("td",_0);};g.th=function(_0){return f.elem("th",_0);};g.ul=function(_0){return f.elem("ul",_0);};g.li=function(_0){return f.elem("li",_0);};g.h1=function(_0){return f.elem("h1",_0);};g.h2=function(_0){return f.elem("h1",_0);};g.h3=function(_0){return f.elem("h1",_0);};g.h4=function(_0){return f.elem("h1",_0);};g.strong=function(_0){return f.elem("strong",_0);};};i.Radio=function(Z,_0,_1,_2,_3){return Q.Element("div",new N.T({$:1,$0:(i.cls())("radio"),$1:_0}),[Q.Element("label",_2,[Q.Radio(_3,true,_1),Q.TextNode(Z)])]);};i.Checkbox=function(Z,_0,_1,_2,_3){return Q.Element("div",new N.T({$:1,$0:(i.cls())("checkbox"),$1:_0}),[Q.Element("label",_2,[Q.CheckBox(_3,_1),Q.TextNode(Z)])]);};i.TextArea=function(Z,_0,_1,_2,_3){return Q.Element("div",new N.T({$:1,$0:(i.cls())("form-group"),$1:_0}),[Q.Element("label",_2,[Q.TextNode(Z)]),Q.InputArea(new N.T({$:1,$0:(i.cls())("form-control"),$1:_3}),_1)]);};i.InputPassword=function(Z,_0,_1,_2,_3){return Q.Element("div",new N.T({$:1,$0:(i.cls())("form-group"),$1:_0}),[Q.Element("label",_2,[Q.TextNode(Z)]),Q.PasswordBox(new N.T({$:1,$0:(i.cls())("form-control"),$1:_3}),_1)]);};i.Input=function(Z,_0,_1,_2,_3){return Q.Element("div",new N.T({$:1,$0:(i.cls())("form-group"),$1:_0}),[Q.Element("label",_2,[Q.TextNode(Z)]),Q.Input(new N.T({$:1,$0:(i.cls())("form-control"),$1:_3}),_1)]);};i.Container=function(Z){return Q.Element("div",[(i.cls())("container")],Z);};i.Class=function(){j.$cctor();return j.Class;};i.cls=function(){j.$cctor();return j.cls;};j.$cctor=function(){j.$cctor=a.ignore;j.cls=R.Class;j.Class=R.Class;};l=k.Intent=L.Class({toString:function(){return(((L.Curried3(function(Z,_0,_1){return Z("Intent("+I.toSafe(_0)+", "+E.p$2(_1)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,l);m=k.Trait=L.Class({toString:function(){return(((L.Curried3(function(Z,_0,_1){return Z("Trait("+I.toSafe(_0)+", "+I.prettyPrint(_1)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,m);n=k.Entity=L.Class({toString:function(){return((((L.Curried(function(Z,_0,_1,_2){return Z("Entity("+I.toSafe(_0)+", "+I.toSafe(_1)+", "+E.p$2(_2)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[2];},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,n);o=k.Meaning=L.Class({toString:function(){return((((L.Curried(function(Z,_0,_1,_2){return Z(E.p(_0)+" "+E.p$5(_1)+". "+E.p$3(_2));},4))(a.id))(this.get_Intent()))(this.get_Trait()))(this.get_Entities());},get_Entities:function(){return(this.Unwrap())[2];},get_Trait:function(){return(this.Unwrap())[1];},get_Intent:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,o);q.New=function(Z,_0,_1,_2,_3){return{body:Z,end:_0,start:_1,suggested:_2,value:_3};};p["Intent'"]=function(Z,_0){return!(_0.intent==null)?{$:1,$0:new l({$:0,$0:d.toLower(_0.intent.value),$1:null})}:null;};p["Trait'"]=function(Z){return!(Z.greetings==null)?{$:1,$0:new m({$:0,$0:"greetings",$1:d.toLower(Z.contact.value)})}:null;};p["Entity'$1"]=function(Z){return!(Z.contact==null)?{$:1,$0:new n({$:0,$0:"contact",$1:d.toLower(Z.contact.value),$2:null})}:null;};s=r["Meaning'"]=L.Class({get_TopIntent:function(){return N.head(N.sortBy(function(Z){return Z.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,s);t=r["Intent'"]=L.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,t);u=r["Entity'"]=L.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,u);r["Intent'$1"]=function(Z){var _0,_1;return Z.$0.$==0&&Z.$1.get_Length()>0?{$:1,$0:new o({$:0,$0:null,$1:null,$2:{$:1,$0:N.map(function(_2){return new n({$:0,$0:d.toLower(_2.get_Name()),$1:d.toLower(_2.get_Value()),$2:{$:1,$0:_2.get_Confidence()}});},N.filter(function(_2){return _2.get_Confidence()>r.entityConfidenceThreshold();},Z.$1))}})}:Z.get_TopIntent().get_Confidence()>r.intentConfidenceThreshold()?(_1=N.map(function(_2){return new n({$:0,$0:d.toLower(_2.get_Name()),$1:d.toLower(_2.get_Value()),$2:{$:1,$0:_2.get_Confidence()}});},N.filter(function(_2){return _2.get_Confidence()>r.entityConfidenceThreshold();},Z.get_Entities())),{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(Z.get_TopIntent().get_Name()),$1:{$:1,$0:Z.get_TopIntent().get_Confidence()}})},$1:null,$2:_1.get_Length()===0?null:{$:1,$0:_1}})}):null;};r.entityConfidenceThreshold=function(){v.$cctor();return v.entityConfidenceThreshold;};r.set_entityConfidenceThreshold=function(Z){v.$cctor();v.entityConfidenceThreshold=Z;};r.intentConfidenceThreshold=function(){v.$cctor();return v.intentConfidenceThreshold;};r.set_intentConfidenceThreshold=function(Z){v.$cctor();v.intentConfidenceThreshold=Z;};r.QuickPrograms=function(Z){return Z==="programs"?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};r.QuickHelp=function(Z){var _0;return Z==="help"||(Z==="help me"||(Z==="what's this?"||Z==="huh"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"help",$1:null})},$1:null,$2:null})}:null;};r.QuickHello=function(Z){var _0;return Z==="hello"||(Z==="hey"||(Z==="yo"||Z==="hi"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"hello",$1:null})},$1:null,$2:null})}:null;};r.DebugOff=function(Z){return Z==="debug off"?{$:1,$0:null}:null;};r.DebugOn=function(Z){return Z==="debug on"?{$:1,$0:null}:null;};r.Blank=function(Z){return Z===""?{$:1,$0:null}:null;};v.$cctor=function(){v.$cctor=a.ignore;v.intentConfidenceThreshold=0.85;v.entityConfidenceThreshold=0.85;};w=c.CUI=L.Class({get_StopSpeaking:function(){if(a.speechSynthesis.speaking||a.speechSynthesis.pending)a.speechSynthesis.cancel();},SayVoices:function(){var Z,_0,_1;Z=this;_0=a.speechSynthesis.getVoices();!(_0==null)?(_1=d.toArray(_0),Z.Say((function(_2){return function(_3){return _2("There are currently "+a.String(_3)+" voices installed on this computer or device.");};}(a.id))(G.length(_1))),G.iteri(function(_2,_3){return Z.Say(((((L.Curried(function(_4,_5,_6,_7){return _4("Voice "+a.String(_5)+". Name: "+I.toSafe(_6)+", Local: "+I.prettyPrint(_7)+".");},4))(a.id))(_2))(_3.name))(_3.localService));},_1)):void 0;},Wait:function(Z){this.Wait$1(function(){S.Start(Z,null);});},Wait$1:function(Z){this["Echo'"]("please wait...");this.Term.disable();Z();this.Term.enable();},Say:function(Z){var _0,_1,_2;_0=this.Voice;_0!=null&&_0.$==1?(_1=_0.$0,S.Start((_2=null,S.Delay(function(){var _3;_3=new a.SpeechSynthesisUtterance(Z);_3.voice=_1;a.speechSynthesis.speak(_3);return S.Zero();})),null),this.Caption?this["Echo'"](Z):void 0):this["Echo'"](Z);},Debug:function(Z){d.debug(Z);this.DebugMode?this["EchoHtml'"](Z):void 0;},"EchoHtml'":function(Z){var _0,_1;_0=(_1={},_1.raw=true,_1);this.Term.disable();this.Term.echo(Z,_0);this.Term.enable();},"Echo'":function(Z){this.Term.disable();this.Term.echo(Z);this.Term.enable();}},null,w);w.New=function(Z,_0,_1,_2,_3){return new w({Voice:Z,Mic:_0,Term:_1,DebugMode:_2,Caption:_3});};y.New=function(Z){return{UserName:Z};};z=x.Interpreter=L.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,z);x.helloUserPhrases=function(){A.$cctor();return A.helloUserPhrases;};x.helloPhrases=function(){A.$cctor();return A.helloPhrases;};x.getRandomPhrase=function(Z){return O.nth(x.rng().Next(0,Z.get_Length()),Z);};x.rng=function(){A.$cctor();return A.rng;};A.$cctor=function(){A.$cctor=a.ignore;A.rng=new T.New();A.helloPhrases=N.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);A.helloUserPhrases=N.ofArray(["Hi $user, welcome back.","Welcome $user, nice to see you again..","Hello $user","Good to see you $user."]);};B.update=function(Z,_0){var _1,_2;B.debug((function(_3){return function(_4){return _3("Current contex: "+I.printList(function(_5){return E.p$7(_5);},_4)+".");};}(a.id))(_0));_0.$==1?(_1=_0.$0.$0,_1!=null&&_1.$==1)?_0.$0.$0.$0.$0==="hello"?_0.$0.$1==null?(_2=_0.$0.$2,_2!=null&&_2.$==1)?_0.$0.$2.$0.$==1?_0.$0.$2.$0.$1.$==0?_0.$1.$==0?Z.Say((function(_3){return function(_4){return _3("Hello "+I.toSafe(_4));};}(a.id))(_0.$0.$2.$0.$0.get_Name())):void 0:void 0:void 0:_0.$1.$==0?Z.Say(function(_3){return _3("Hello. My name is Selma. What's yours?");}(a.id)):void 0:void 0:void 0:void 0:void 0;};B.debug=function(Z){d.debug((function(_0){return function(_1){return _0("Main: "+I.prettyPrint(_1));};}(a.id))(Z));};C.run=function(){var Z,_0;Z=L.ThisFunc(function(_1,_2){return((C.Main().get_Text())(_1))(_2);});_0=C.Main().get_Options();a.$("#main").terminal(Z,_0);return Q.get_Empty();};C.Main=function(){D.$cctor();return D.Main;};C.container=function(){D.$cctor();return D.container;};C.wait=function(Z){d["Terminal.Echo'"](C.CUI().Term,"please wait");C.CUI().Term.disable();Z();C.CUI().Term.enable();};C.stopSpeaking=function(){D.$cctor();return D.stopSpeaking;};C.sayRandom=function(Z){C.say(x.getRandomPhrase(Z));};C.sayVoices=function(){var Z,_0;Z=a.speechSynthesis.getVoices();!(Z==null)?(_0=d.toArray(Z),C.say((function(_1){return function(_2){return _1("There are currently "+a.String(_2)+" voices installed on this computer or device.");};}(a.id))(G.length(_0))),G.iteri(function(_1,_2){return C.say(((((L.Curried(function(_3,_4,_5,_6){return _3("Voice "+a.String(_4)+". Name: "+I.toSafe(_5)+", Local: "+I.prettyPrint(_6)+".");},4))(a.id))(_1))(_2.name))(_2.localService));},_0)):void 0;};C.say=function(Z){var _0,_1,_2;_0=C.CUI().Voice;_0!=null&&_0.$==1?(_1=_0.$0,S.Start((_2=null,S.Delay(function(){var _3;_3=new a.SpeechSynthesisUtterance(Z);_3.voice=_1;a.speechSynthesis.speak(_3);return S.Zero();})),null),C.CUI().Caption?d["Terminal.Echo'"](C.CUI().Term,Z):void 0):d["Terminal.Echo'"](C.CUI().Term,Z);};C.initMic=function(Z){var _0,_1;C.set_CUI((_0={$:1,$0:new U.Microphone(V.getElementById("microphone"))},w.New(C.CUI().Voice,_0,C.CUI().Term,C.CUI().DebugMode,C.CUI().Caption)));_1=C.CUI().Mic.$0;_1.onconnecting=function(){C.set_MicState({$:1});return C.debug("Mic connecting...");};_1.ondisconnected=function(){C.set_MicState({$:2});return C.debug("Mic disconnected.");};_1.onaudiostart=function(){C.set_MicState({$:3});return C.debug("Mic audio start...");};_1.onaudioend=function(){C.set_MicState({$:4});return C.debug("Mic audio end.");};_1.onerror=function(_2){C.set_MicState({$:6,$0:_2});return C.debug((function(_3){return function(_4){return _3("Mic error : "+I.toSafe(_4)+".");};}(a.id))(_2));};_1.onready=function(){C.set_MicState({$:5});return C.debug("Mic ready.");};_1.onresult=function(_2,_3){return!(_2==null||_3==null)?(C.set_MicState({$:7,$0:_2,$1:_3}),C.debug((((L.Curried3(function(_4,_5,_6){return _4("Mic result: "+I.prettyPrint(_5)+" "+I.prettyPrint(_6)+".");}))(a.id))(_2))(_3)),Z(_1,[_2,_3])):C.debug("Mic: No result returned.");};_1.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};C.initSpeech=function(){var Z,_0;Z=a.speechSynthesis.getVoices();!(Z==null)?(_0=d.toArray(Z),G.iter(function(_1){if(W.Equals(C.CUI().Voice,null)&&(_1.name.indexOf("Microsoft Zira")!=-1||_1.name.toLowerCase().indexOf("female")!=-1)){C.set_CUI(w.New({$:1,$0:_1},C.CUI().Mic,C.CUI().Term,C.CUI().DebugMode,C.CUI().Caption));C.debug((function(_2){return function(_3){return _2("Using voice "+I.toSafe(_3)+".");};}(a.id))(C.CUI().Voice.$0.name));}},_0),W.Equals(C.CUI().Voice,null)&&G.length(_0)>0?(C.set_CUI(w.New({$:1,$0:G.find(function(_1){return _1["default"];},_0)},C.CUI().Mic,C.CUI().Term,C.CUI().DebugMode,C.CUI().Caption)),C.debug((function(_1){return function(_2){return _1("Using default voice "+I.toSafe(_2)+".");};}(a.id))(C.CUI().Voice.$0.name))):void 0):void 0;W.Equals(C.CUI().Voice,null)?(d.error("No speech synthesis voice is available."),d["Terminal.Echo'"](C.CUI().Term,"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma.")):void 0;};C.updateCtx=function(Z){var _0;_0=C.Context();_0.splice.apply(_0,[0,0,Z]);return N.ofSeq(O.take(G.length(C.Context())>=5?5:G.length(C.Context()),C.Context()));};C.Context=function(){D.$cctor();return D.Context;};C.MicState=function(){D.$cctor();return D.MicState;};C.set_MicState=function(Z){D.$cctor();D.MicState=Z;};C.debug=function(Z){var _0;_0=(function(_1){return function(_2){return _1("Client: "+I.prettyPrint(_2));};}(a.id))(Z);d.debug(_0);C.CUI().DebugMode?(C.echo())(_0):void 0;};C.echo=function(){D.$cctor();return D.echo;};C.CUI=function(){D.$cctor();return D.CUI;};C.set_CUI=function(Z){D.$cctor();D.CUI=Z;};D.$cctor=function(){var Z,_0;D.$cctor=a.ignore;function _1(_3,_4){var _5,_6,_7,_8,_9,_,$,ba,bb,bc;_5=_4[0];_6=_4[1];C.debug((((L.Curried3(function(bd,be,bf){return bd("Voice: "+I.prettyPrint(be)+" "+I.prettyPrint(bf));}))(a.id))(_5))(_6));_7=(_8=p["Intent'"](_5,_6),_8!=null&&_8.$==1?{$:1,$0:_8.$0}:null);_9=(_=p["Entity'$1"](_6),_!=null&&_.$==1?{$:1,$0:N.ofArray([_.$0])}:null);$=(ba=p["Trait'"](_6),ba!=null&&ba.$==1?{$:1,$0:ba.$0}:null);return _7==null&&(_9==null&&$==null)?null:(C.debug(((((L.Curried(function(bd,be,bf,bg){return bd("Voice: "+E.p(be)+" "+E.p$3(bf)+" "+E.p$5(bg));},4))(a.id))(_7))(_9))($)),bc=C.updateCtx(new o({$:0,$0:_7,$1:$,$2:_9})),B.update(C.CUI(),bc));}function _2(_3,_4){var _5,_6,_7,_8,_9,_,$,ba,bb;C.set_CUI(w.New(C.CUI().Voice,C.CUI().Mic,_3,C.CUI().DebugMode,C.CUI().Caption));W.Equals(C.CUI().Voice,null)?C.initSpeech():void 0;W.Equals(C.CUI().Mic,null)?C.initMic(_1):void 0;return(_5=r.Blank(_4),_5!=null&&_5.$==1)?C.say("Tell me what you want me to do or ask me a question."):(_6=r.DebugOn(_4),_6!=null&&_6.$==1)?(C.set_CUI(w.New(C.CUI().Voice,C.CUI().Mic,C.CUI().Term,true,C.CUI().Caption)),C.say("Debug mode is now on.")):(_7=r.DebugOff(_4),_7!=null&&_7.$==1)?(C.set_CUI(w.New(C.CUI().Voice,C.CUI().Mic,C.CUI().Term,false,C.CUI().Caption)),C.say("Debug mode is now off.")):(_9=r.QuickHello(_4),_9!=null&&_9.$==1?(_8=_9.$0,true):(_=r.QuickHelp(_4),_!=null&&_.$==1?(_8=_.$0,true):($=r.QuickPrograms(_4),$!=null&&$.$==1&&(_8=$.$0,true))))?(C.debug((function(bc){return function(bd){return bc("Quick Text: "+E.p$7(bd)+".");};}(a.id))(_8)),ba=C.updateCtx(_8),B.update(C.CUI(),ba)):C.CUI().Wait((bb=null,S.Delay(function(){return S.Bind((new Y.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:227617873",[_4]),function(bc){var bd,be,bf,bg,bh;return bc==null?(C.debug("Text: Did not receive a response from the server."),d["Terminal.Echo'"](_3,"Sorry I did not understand what you said."),S.Zero()):bc.$0.$0.$==0?bc.$0.$1.$==0?(C.debug(function(bi){return bi("Text: no intent.");}(a.id)),d["Terminal.Echo'"](_3,"Sorry I did not understand what you said."),S.Zero()):(C.debug((function(bi){return function(bj){return bi("Text: no intent. Entities: "+I.printList(function(bk){return E.p$8(bk);},bj)+".");};}(a.id))(bc.$0.$1)),S.Zero()):bc.$0.$1.$==0?(bd=bc.$0,(C.debug((function(bi){return function(bj){return bi("Text: Intents: "+I.printList(function(bk){return E.p$9(bk);},bj)+". No entities.");};}(a.id))(bc.$0.$0)),be=C.updateCtx(new o({$:0,$0:{$:1,$0:new l({$:0,$0:bd.get_TopIntent().get_Name(),$1:{$:1,$0:bd.get_TopIntent().get_Confidence()}})},$1:null,$2:null})),B.update(C.CUI(),be),S.Zero())):(bf=bc.$0.$1,(bg=bc.$0,(C.debug((((L.Curried3(function(bi,bj,bk){return bi("Text: intents: "+I.printList(function(bl){return E.p$9(bl);},bj)+". entities: "+I.printList(function(bl){return E.p$8(bl);},bk)+".");}))(a.id))(bc.$0.$0))(bf)),bh=C.updateCtx(new o({$:0,$0:{$:1,$0:new l({$:0,$0:bg.get_TopIntent().get_Name(),$1:{$:1,$0:bg.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:N.map(function(bi){return new n({$:0,$0:bi.get_Name(),$1:bi.get_Value(),$2:{$:1,$0:bi.get_Confidence()}});},bf)}})),B.update(C.CUI(),bh),S.Zero())));});})));}D.CUI=w.New(null,null,null,false,false);D.echo=(Z=C.CUI().Term,function(_3){d["Terminal.EchoHtml'"](Z,_3);});D.MicState={$:0};D.Context=[];D.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;D.container=i.Container;D.Main=new z({$:0,$0:function(_3){return function(_4){return _1(_3,_4);};},$1:[function(_3){return function(_4){return _2(_3,_4);};},(_0={},_0.name="Main",_0.greetings="Welcome to Selma. Type hello to begin or help for more assistance.",_0.prompt=">",_0)]});};E.p$2=function(Z){return Z==null?"null":"Some "+I.prettyPrint(Z.$0);};E.p$1=function(Z){return"Intent ("+I.prettyPrint(Z.$0)+", "+E.p$2(Z.$1)+")";};E.p=function(Z){return Z==null?"null":"Some "+E.p$1(Z.$0);};E.p$4=function(Z){return"Entity ("+I.prettyPrint(Z.$0)+", "+I.prettyPrint(Z.$1)+", "+E.p$2(Z.$2)+")";};E.p$3=function(Z){return Z==null?"null":"Some "+I.printList(function(_0){return E.p$4(_0);},Z.$0);};E.p$6=function(Z){return"Trait ("+I.prettyPrint(Z.$0)+", "+I.prettyPrint(Z.$1)+")";};E.p$5=function(Z){return Z==null?"null":"Some "+E.p$6(Z.$0);};E.p$7=function(Z){return"Meaning ("+E.p(Z.$0)+", "+E.p$5(Z.$1)+", "+E.p$3(Z.$2)+")";};E.p$8=function(Z){return"Entity' ("+I.prettyPrint(Z.$0)+", "+I.prettyPrint(Z.$1)+", "+I.prettyPrint(Z.$2)+", "+I.prettyPrint(Z.$3)+")";};E.p$9=function(Z){return"Intent' ("+I.prettyPrint(Z.$0)+", "+I.prettyPrint(Z.$1)+")";};}());
