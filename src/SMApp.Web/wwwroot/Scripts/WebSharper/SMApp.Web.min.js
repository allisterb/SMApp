(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=c.Bs=c.Bs||{};i=b.NLU=b.NLU||{};j=i.Babelfy=i.Babelfy||{};k=j.ApiResponse=j.ApiResponse||{};l=j.TokenFragment=j.TokenFragment||{};m=j.CharFragment=j.CharFragment||{};n=i.Witai=i.Witai||{};o=n.Utterance=n.Utterance||{};p=n.Intent=n.Intent||{};q=n.Entity=n.Entity||{};r=n.Trait=n.Trait||{};s=n["Utterance'"]=n["Utterance'"]||{};t=n["Value'"]=n["Value'"]||{};u=i.QnAMaker=i.QnAMaker||{};v=u.ITSQuestion=u.ITSQuestion||{};w=u.ITSAnswerContext=u.ITSAnswerContext||{};x=u.ITSAnswer=u.ITSAnswer||{};y=u.ITSAnswers=u.ITSAnswers||{};z=c.TypingDNA=c.TypingDNA||{};A=z.Response=z.Response||{};B=c.FacialRecognition=c.FacialRecognition||{};C=c.NLG=c.NLG||{};D=a.StartupCode$SMApp_Web$NLG=a.StartupCode$SMApp_Web$NLG||{};E=c.NLU=c.NLU||{};F=E.Intent=E.Intent||{};G=E.Trait=E.Trait||{};H=E.Entity=E.Entity||{};I=E.Utterance=E.Utterance||{};J=E.Question=E.Question||{};K=E.QuestionType=E.QuestionType||{};L=E.Voice=E.Voice||{};M=L["Entity'"]=L["Entity'"]||{};N=E.Text=E.Text||{};O=N["Utterance'"]=N["Utterance'"]||{};P=N["Intent'"]=N["Intent'"]||{};Q=N["Entity'"]=N["Entity'"]||{};R=N["Trait'"]=N["Trait'"]||{};S=E.Domain=E.Domain||{};T=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};U=c.CUI=c.CUI||{};V=U.MicState=U.MicState||{};W=U.ClientState=U.ClientState||{};X=U.Interpreter=U.Interpreter||{};Y=U.CUI=U.CUI||{};Z=c.Dialogue=c.Dialogue||{};_0=Z.Dialogue=Z.Dialogue||{};_1=c.User=c.User||{};_2=a.StartupCode$SMApp_Web$User=a.StartupCode$SMApp_Web$User||{};_3=c.Main=c.Main||{};_4=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};_5=c.Client=c.Client||{};_6=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};_7=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};_8=a.GeneratedPrintf=a.GeneratedPrintf||{};_9=a.WebSharper;_=_9&&_9.UI;$=_&&_.Doc;ba=_&&_.AttrProxy;bb=_&&_.Client;bc=bb&&bb.Templates;bd=_9&&_9.Arrays;be=a.IntelliFactory;bf=be&&be.Runtime;bg=_9&&_9.Utils;bh=a.console;bi=a.jQuery;bj=_9&&_9.Strings;bk=_9&&_9.List;bl=_9&&_9.Seq;bm=_&&_.AttrModule;bn=_9&&_9.Concurrency;bo=a.JSON;bp=_9&&_9.Random;bq=_9&&_9.Collections;br=bq&&bq.Map;bs=_9&&_9.JavaScript;bt=bs&&bs.Pervasives;bu=a.SDK;bv=_9&&_9.Operators;bw=_9&&_9.Remoting;bx=bw&&bw.AjaxRemotingProvider;by=a.Wit;bz=a.document;bA=_9&&_9.Unchecked;bB=bq&&bq.Dictionary;d.speechSynthesis=function(){return a.speechSynthesis;};d.lastMicData=function(){return a.lastMicData;};d.questionBox=function(bC,bD,bE){var bF,bG;(bF=a.Sweetalert2((bG={},bG.titleText=bC,bG.text=bD,bG.type="question",bG.input="text",bG.confirmButtonText="Ok",bG)),bF).then(bE);};d.createCanvas=function(bC,bD,bE,bF){var bG,bH;bG=self.document.createElement("canvas");bH=$.Element("canvas",[d.eid(bC),ba.Create("width",a.String(bD)),ba.Create("height",a.String(bE))],[]);bc.LoadLocalTemplates("");$.Run(bG,bH);bF.appendChild(bG);return bG;};d.elementHTML=function(bC){return bC.innerHTML;};d.createElement=function(bC){var bD;bD=self.document.createElement("div");self.document.appendChild(bD);bc.LoadLocalTemplates("");$.RunAppend(bD,bC);};d.container=function(bC){return $.Element("div",[d.cls("container")],bC);};d.dindex=function(bC){return ba.Create("data-index",a.String(bC));};d.cls=function(bC){return ba.Create("class",bC);};d.eid=function(bC){return ba.Create("id",bC);};d.termOutput=function(){return bd.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(bC){return bC.toLowerCase();};d.debug=function(bC,bD){d.info((((bf.Curried3(function(bE,bF,bG){return bE("DEBUG: "+bg.toSafe(bF)+": "+bg.prettyPrint(bG));}))(a.id))(bC.toUpperCase()))(bD));};d.error=function(bC){bh.error(bC);};d.info=function(bC){bh.info(bC);};d.jserror=function(bC){bi.error(bC);};d.toArray=function(bC){return bd.map(a.id,bi.makeArray(bC));};d["Terminal.EchoHtml'"]=function(bC,bD){bC.pause();bC.echo(bD,d.rawOpt());bC.resume();};d["Terminal.Echo'"]=function(bC,bD){bC.pause();bC.echo(bD);bC.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=bf.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(bC){function bD(bE){return function(bF){var bG,bH,bI,bJ,bK,bL,bM;bH=bj.replicate(bE," ");switch(bF.$==0?bF.$1.$==1?bF.$1.$0.$==2?bF.$1.$1.$==0?(bG=[bF.$1.$0.$0,bF.$0],1):(bG=[bF.$1,bF.$0],2):(bG=[bF.$1,bF.$0],2):(bG=[bF.$1,bF.$0],2):bF.$==2?(bG=bF.$0,3):(bG=[bF.$0,bF.$1],0)){case 0:return bG[0]+"=\""+bG[1]+"\"";case 1:bI=bG[1];return bH+"<"+bI+">"+bG[0]+"</"+bI+">\r\n";case 2:bJ=bG[1];bK=bk.partition(function(bN){return bN.$==1;},bG[0]);bL=bK[1];bM=bK[0];return bL.$==0?bH+"<"+bJ+(bM.$===0?"":" "+bj.concat(" ",bk.ofSeq(bl.delay(function(){return bl.map(function(bN){return(bD(0))(bN);},bM);}))))+"/>\r\n":bH+"<"+bJ+(bM.$===0?"":" "+bj.concat(" ",bk.ofSeq(bl.delay(function(){return bl.map(function(bN){return(bD(0))(bN);},bM);}))))+">\r\n"+bj.concat("",bk.ofSeq(bl.delay(function(){return bl.map(function(bN){return(bD(bE+1))(bN);},bL);})))+bH+"</"+bJ+">\r\n";case 3:return bH+bG+"\r\n";}};}return(bD(0))(bC);};f.alt=function(bC){return new e({$:1,$0:"alt",$1:bC});};f.src=function(bC){return new e({$:1,$0:"src",$1:bC});};f.cls=function(bC){return new e({$:1,$0:"class",$1:bC});};f.str=function(bC){return e.toString(bC);};f.op_PercentEquals=function(bC,bD){return new e({$:1,$0:bC,$1:bD});};f.op_Splice=function(bC){var bD;return bk.ofArray([new e({$:2,$0:(bD=bC,a.String(bD))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(bC,bD){return new e({$:0,$0:bC,$1:bD});};g.$cctor=function(){var bC;g.$cctor=a.ignore;g.rawOpt=(bC={},bC.raw=true,bC);g.html=function(bD){return f.elem("html",bD);};g.head=function(bD){return f.elem("head",bD);};g.title=function(bD){return f.elem("title",bD);};g.style=function(bD){return f.elem("style",bD);};g.body=function(bD){return f.elem("body",bD);};g.div=function(bD){return f.elem("div",bD);};g.br=function(bD){return f.elem("br",bD);};g.section=function(bD){return f.elem("section",bD);};g.span=function(bD){return f.elem("span",bD);};g.table=function(bD){return f.elem("table",bD);};g.thead=function(bD){return f.elem("thead",bD);};g.tbody=function(bD){return f.elem("tbody",bD);};g.tfoot=function(bD){return f.elem("tfoot",bD);};g.img=function(bD){return f.elem("img",bD);};g.map=function(bD){return f.elem("map",bD);};g.area=function(bD){return f.elem("area",bD);};g.p=function(bD){return f.elem("p",bD);};g.a=function(bD){return f.elem("a",bD);};g.tr=function(bD){return f.elem("tr",bD);};g.td=function(bD){return f.elem("td",bD);};g.th=function(bD){return f.elem("th",bD);};g.ul=function(bD){return f.elem("ul",bD);};g.li=function(bD){return f.elem("li",bD);};g.h1=function(bD){return f.elem("h1",bD);};g.h2=function(bD){return f.elem("h1",bD);};g.h3=function(bD){return f.elem("h1",bD);};g.h4=function(bD){return f.elem("h1",bD);};g.strong=function(bD){return f.elem("strong",bD);};};h.Radio=function(bC,bD,bE,bF,bG){return $.Element("div",new bk.T({$:1,$0:d.cls("radio"),$1:bD}),[$.Element("label",bF,[$.Radio(bG,true,bE),$.TextNode(bC)])]);};h.checkbox=function(bC,bD,bE,bF,bG){return $.Element("div",new bk.T({$:1,$0:d.cls("checkbox"),$1:bD}),[$.Element("label",bF,[$.CheckBox(bG,bE),$.TextNode(bC)])]);};h.textArea=function(bC,bD,bE,bF,bG){return $.Element("div",new bk.T({$:1,$0:d.cls("form-group"),$1:bD}),[$.Element("label",bF,[$.TextNode(bC)]),$.InputArea(new bk.T({$:1,$0:d.cls("form-control"),$1:bG}),bE)]);};h.inputPassword=function(bC,bD,bE,bF,bG){return $.Element("div",new bk.T({$:1,$0:d.cls("form-group"),$1:bD}),[$.Element("label",bF,[$.TextNode(bC)]),$.PasswordBox(new bk.T({$:1,$0:d.cls("form-control"),$1:bG}),bE)]);};h.input=function(bC,bD,bE,bF,bG){return $.Element("div",new bk.T({$:1,$0:d.cls("form-group"),$1:bD}),[$.Element("label",bF,[$.TextNode(bC)]),$.Input([d.cls("form-control"),bG],bE)]);};h.btnSecondary=function(bC,bD,bE){return $.Element("button",[d.eid(bC),d.cls("btn btn-secondary"),bm.Handler("click",bE)],[$.TextNode(bD)]);};h.btnPrimary=function(bC,bD,bE){return $.Element("button",[d.eid(bC),d.cls("btn btn-primary"),bm.Handler("click",bE)],[$.TextNode(bD)]);};k.New=function(bC,bD,bE,bF,bG,bH,bI,bJ,bK){return{tokenFragment:bC,charFragment:bD,babelSynsetID:bE,DBpediaURL:bF,BabelNetURL:bG,score:bH,cohrenceScore:bI,globalScore:bJ,source:bK};};l.New=function(bC,bD){return{start:bC,end:bD};};m.New=function(bC,bD){return{start:bC,end:bD};};j.disambiguate=function(bC){function bD(bE,bF){var bG;bi.ajax((bG={},bG.url=(function(bH){return function(bI){return bH("https://babelfy.io/v1/disambiguate?text="+bg.toSafe(bI)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bC),bG.type="GET",bG.success=function(bH){return bE(bH);},bG.error=function(bH){return bF(new a.Error(bH.responseText));},bG));}return bn.FromContinuations(function(bE,bF,bG){return bD.apply(null,[bE,bF,bG]);});};o.New=function(bC,bD,bE,bF){return{text:bC,intents:bD,entities:bE,traits:bF};};p.New=function(bC,bD,bE){return{id:bC,name:bD,confidence:bE};};q.New=function(bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM){return{id:bC,name:bD,role:bE,start:bF,end:bG,body:bH,confidence:bI,entities:bJ,suggested:bK,value:bL,type:bM};};r.New=function(bC,bD,bE){return{id:bC,value:bD,confidence:bE};};s.New=function(bC){return{intent:bC};};t.New=function(bC){return{value:bC};};n.getMeaning2=function(bC,bD){function bE(bF,bG){var bH;bi.ajax((bH={},bH.url=(function(bI){return function(bJ){return bI("https://api.wit.ai/message?q="+bg.toSafe(bJ));};}(a.id))(bD),bH.type="GET",bH.beforeSend=function(bI){return bI.setRequestHeader("Authorization","Bearer "+bC);},bH.success=function(bI){return bF(bI);},bH.error=function(bI){return bG(new a.Error(bI.responseText));},bH));}return bn.FromContinuations(function(bF,bG,bH){return bE.apply(null,[bF,bG,bH]);});};n.getMeaning=function(bC,bD,bE,bF){var bG;bi.ajax((bG={},bG.url=(function(bH){return function(bI){return bH("https://api.wit.ai/message?q="+bg.toSafe(bI));};}(a.id))(bD),bG.type="GET",bG.beforeSend=function(bH){return bH.setRequestHeader("Authorization","Bearer "+bC);},bG.success=bE,bG.error=bF,bG));};v.New=function(bC){return{question:bC};};w.New=function(bC,bD){return{isContextOnly:bC,prompts:bD};};x.New=function(bC,bD,bE,bF,bG,bH,bI){return{questions:bC,answer:bD,score:bE,id:bF,source:bG,metadata:bH,context:bI};};y.New=function(bC){return{answers:bC};};u.getAnswer=function(bC){function bD(bE,bF){var bG;bi.ajax((bG={},bG.url="https://lerna.azurewebsites.net/qnamaker/knowledgebases/13a6a026-942b-4612-a8cb-654086ec76ee/generateAnswer",bG.type="POST",bG.beforeSend=function(bH){return bH.setRequestHeader("Authorization","EndpointKey e5a55563-b1b0-4343-8796-bda5a0509385");},bG.contentType="application/json",bG.dataType="json",bG.data=bo.stringify(v.New(bC)),bG.success=function(bH){return bE(bH);},bG.error=function(bH){return bF(new a.Error(bH.responseText));},bG));}return bn.FromContinuations(function(bE,bF,bG){return bD.apply(null,[bE,bF,bG]);});};A.New=function(bC,bD,bE,bF){return{name:bC,message:bD,message_code:bE,status:bF};};z.getSameTextTypingPattern=function(bC,bD){var bE;return bD.getTypingPattern((bE={type:1},bE.text=bC,bE.caseSensitive=true,bE));};B.startCamera=function(bC,bD){return a.startCamera(bC,bD);};C.waitAddPhrases=function(){D.$cctor();return D.waitAddPhrases;};C.waitRetrievePhrases=function(){D.$cctor();return D.waitRetrievePhrases;};C.helpPhrases=function(){D.$cctor();return D.helpPhrases;};C.helloUserPhrases=function(){D.$cctor();return D.helloUserPhrases;};C.helloPhrases=function(){D.$cctor();return D.helloPhrases;};C["getRandomPhrase'"]=function(bC){return C.replace_tok("$0","",bl.nth(C.rng().Next(0,bC.get_Length()),bC));};C.getRandomPhrase=function(bC,bD){return C.replace_tok("$0",bD,bl.nth(C.rng().Next(0,bC.get_Length()),bC));};C.replace_tok=function(bC,bD,bE){return bj.Replace(bE,bC,bD);};C.rng=function(){D.$cctor();return D.rng;};D.$cctor=function(){D.$cctor=a.ignore;D.rng=new bp.New();D.helloPhrases=bk.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);D.helloUserPhrases=bk.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);D.helpPhrases=bk.ofArray(["What can I help you with $0?"]);D.waitRetrievePhrases=bk.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);D.waitAddPhrases=bk.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};F=E.Intent=bf.Class({toString:function(){return(((bf.Curried3(function(bC,bD,bE){return bC("Intent("+bg.toSafe(bD)+", "+_7.p$2(bE)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,F);G=E.Trait=bf.Class({toString:function(){return(((bf.Curried3(function(bC,bD,bE){return bC("Trait("+bg.toSafe(bD)+", "+bg.prettyPrint(bE)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);H=E.Entity=bf.Class({toString:function(){return(((((bf.Curried(function(bC,bD,bE,bF,bG){return bC("Entity("+bg.toSafe(bD)+", "+bg.toSafe(bE)+", "+bg.toSafe(bF)+", "+_7.p$2(bG)+")");},5))(a.id))(this.get_Name()))(this.get_Role()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$3;},get_Value:function(){return this.$2;},get_Role:function(){return this.$1;},get_Name:function(){return this.$0;}},null,H);I=E.Utterance=bf.Class({toString:function(){return((((bf.Curried(function(bC,bD,bE,bF){return bC(_7.p(bD)+" "+_7.p$3(bE)+" "+_7.p$5(bF));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bC;bC=this.$3;return bC!=null?{$:1,$0:bk.sortBy(function(bD){return bD.get_Name();},bC.$0)}:null;},get_Traits:function(){var bC;bC=this.$2;return bC!=null?{$:1,$0:bk.sortBy(function(bD){return bD.get_Name();},bC.$0)}:null;},get_Intent:function(){return this.$1;},get_Text:function(){return this.$0;}},null,I);J=E.Question=bf.Class({toString:function(){return(((((bf.Curried(function(bC,bD,bE,bF,bG){return bC("Name: "+bg.toSafe(bD)+" Text: "+bg.toSafe(bE)+" Type: "+_7.p$8(bF)+" Module: "+bg.toSafe(bG));},5))(a.id))(this.get_Name()))(this.get_Text()))(this.get_Type()))(this.get_Module());},get_Module:function(){return this.$3;},get_Type:function(){return this.$2;},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,J);K.ConceptCompletion={$:3};K.Disjunctive={$:2};K.Verification={$:1};K.UserData={$:0};M.New=function(bC,bD,bE,bF,bG){return{body:bC,end:bD,start:bE,suggested:bF,value:bG};};L["Intent'"]=function(bC,bD){return!(bD.intent==null)?{$:1,$0:new F({$:0,$0:d.toLower(bD.intent.value),$1:null})}:null;};L["Trait'"]=function(bC){return!(bC.domain==null)?{$:1,$0:new G({$:0,$0:"domain",$1:d.toLower(bC.domain.value),$2:null})}:!(bC.dialogue_act==null)?{$:1,$0:new G({$:0,$0:"dialogue_act",$1:d.toLower(bC.dialogue_act.value),$2:null})}:null;};L["Entity'$1"]=function(bC){return!(bC.contact==null)?{$:1,$0:new H({$:0,$0:"contact",$1:"",$2:d.toLower(bC.contact.value),$3:null})}:null;};O=N["Utterance'"]=bf.Class({get_TopIntent:function(){return bk.head(bk.sortBy(function(bC){return bC.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$3;},get_Entities:function(){return this.$2;},get_Intents:function(){return this.$1;},get_Text:function(){return this.$0;}},null,O);P=N["Intent'"]=bf.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,P);Q=N["Entity'"]=bf.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,Q);R=N["Trait'"]=bf.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,R);N.HasUtterance=function(bC){var bD,bE,bF,bG,bH,bI;return bC!=null&&bC.$==1&&(bC.$0.$2.get_Length()>0&&(bD=[bC.$0.$2,bC.$0.$1,bC,bC.$0.$0,bC.$0.$3],true))?(bE=bD[0],(bF=bD[2],(bG=bD[4],(bH=bD[1].$==0?null:{$:1,$0:new F({$:0,$0:bF.$0.get_TopIntent().get_Name(),$1:{$:1,$0:bF.$0.get_TopIntent().get_Confidence()}})},(bI=bE.$==0?null:{$:1,$0:bk.map(function(bJ){return new H({$:0,$0:bJ.get_Name(),$1:d.toLower(bJ.get_Role()),$2:bJ.get_Value(),$3:{$:1,$0:bJ.get_Confidence()}});},bk.filter(function(bJ){return bJ.get_Confidence()>N.entityConfidenceThreshold();},bE))},{$:1,$0:new I({$:0,$0:bD[3],$1:bH,$2:bG.$==0?null:{$:1,$0:bk.map(function(bJ){return new G({$:0,$0:d.toLower(bJ.get_Name()),$1:bJ.get_Value(),$2:{$:1,$0:bJ.get_Confidence()}});},bk.filter(function(bJ){return bJ.get_Confidence()>N.entityConfidenceThreshold();},bG))},$3:bI})}))))):null;};N.entityConfidenceThreshold=function(){T.$cctor();return T.entityConfidenceThreshold;};N.set_entityConfidenceThreshold=function(bC){T.$cctor();T.entityConfidenceThreshold=bC;};N.intentConfidenceThreshold=function(){T.$cctor();return T.intentConfidenceThreshold;};N.set_intentConfidenceThreshold=function(bC){T.$cctor();T.intentConfidenceThreshold=bC;};N.getUtterance2=function(bC){var bD;bD=null;return bn.Delay(function(){return bn.Bind(n.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bC),function(bE){d.debug("NLU",(function(bF){return function(bG){return bF("Wit.ai returned "+_8.p(bG)+" ");};}(a.id))(bE));return bn.Return(new O({$:0,$0:bC,$1:bk.ofArray(bd.map(function(bF){return new P({$:0,$0:bF.name,$1:bF.confidence});},bE.intents)),$2:bk.map(function(bF){return new Q({$:0,$0:bF.name,$1:bF.confidence,$2:bF.role,$3:bF.value});},bk.ofSeq(bl.concat(bl.map(function(bF){return bF[1];},br.ToSeq(bE.entities))))),$3:bk.ofSeq(bl.map(function(bF){var bG;bG=bF[1];return new R({$:0,$0:bF[0],$1:bd.get(bG,0).confidence,$2:bd.get(bG,0).value});},br.ToSeq(bE.traits)))}));});});};N.getUtterance=function(bC,bD){n.getMeaning("OOGDHEQL7JZRQASXN2N2GHFUKGO3SCNV",bC,function(bE){var bF,bG;d.debug("NLU",(function(bH){return function(bI){return bH("Wit.ai returned: "+bg.prettyPrint(bI));};}(a.id))(bE));bF=!(bE.intents==null)?bk.ofArray(bd.map(function(bH){return new P({$:0,$0:bH.name,$1:bH.confidence});},bE.intents)):bk.T.Empty;bG=!(bE.traits==null)?bk.ofSeq(bl.concat(bk.map(function(bH){return bd.map(function(bI){return new R({$:0,$0:bH,$1:bI.confidence,$2:bI.value});},bt.GetJS(bE.traits,[bH]));},bk.filter(function(bH){return!(bt.GetJS(bE.traits,[bH])==null);},N.trait_types())))):bk.T.Empty;return bD({$:1,$0:new O({$:0,$0:bC,$1:bF,$2:!(bE.entities==null)?bk.ofSeq(bl.concat(bk.map(function(bH){return bd.map(function(bI){return new Q({$:0,$0:bI.name,$1:bI.confidence,$2:bI.role,$3:bI.value});},bt.GetJS(bE.entities,[bH]));},bk.filter(function(bH){return!(bt.GetJS(bE.entities,[bH])==null);},N.entity_types())))):bk.T.Empty,$3:bG})});},function(bE,bF,bG){d.error((((bf.Curried3(function(bH,bI,bJ){return bH("Wit.ai returned: "+bg.prettyPrint(bI)+" "+bg.prettyPrint(bJ));}))(a.id))(bF))(bG));return bD(null);});};N.trait_types=function(){T.$cctor();return T.trait_types;};N.entity_types=function(){T.$cctor();return T.entity_types;};N.QuickNumber=function(bC){var bD,bE,bF;return(bE=N.One(bC),bE!=null&&bE.$==1?(bD=bE.$0,true):(bF=N.Two(bC),bF!=null&&bF.$==1&&(bD=bF.$0,true)))?{$:1,$0:bD}:null;};N.Three=function(bC){var bD;return bC==="3"||bC==="three"?{$:1,$0:new I({$:0,$0:"three",$1:{$:1,$0:new F({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bk.ofArray([new H({$:0,$0:"wit/ordinal",$1:"",$2:"three",$3:{$:1,$0:1}})])}})}:null;};N.Two=function(bC){var bD;return bC==="2"||bC==="two"?{$:1,$0:new I({$:0,$0:"two",$1:{$:1,$0:new F({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bk.ofArray([new H({$:0,$0:"wit/ordinal",$1:"",$2:"two",$3:{$:1,$0:1}})])}})}:null;};N.One=function(bC){var bD;return bC==="1"||bC==="one"?{$:1,$0:new I({$:0,$0:"one",$1:{$:1,$0:new F({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bk.ofArray([new H({$:0,$0:"wit/ordinal",$1:"",$2:"one",$3:{$:1,$0:1}})])}})}:null;};N.QuickNo=function(bC){var bD;return bC==="no"||(bC==="nope"||(bC==="no way"||(bC==="nah"||(bC==="don't do it"||bC==="stop"))))?{$:1,$0:new I({$:0,$0:"no",$1:{$:1,$0:new F({$:0,$0:"reject",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};N.QuickYes=function(bC){var bD;return bC==="yes"||(bC==="ok"||(bC==="sure"||(bC==="yeah"||(bC==="yep"||(bC==="uh huh"||(bC==="go ahead"||bC==="go"))))))?{$:1,$0:new I({$:0,$0:"yes",$1:{$:1,$0:new F({$:0,$0:"verify",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};N.QuickHelp=function(bC){var bD;return bC==="help"||(bC==="help me"||(bC==="what's this?"||bC==="huh"))?{$:1,$0:new I({$:0,$0:"help",$1:{$:1,$0:new F({$:0,$0:"help",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};N.QuickHello=function(bC){var bD;return bC==="hello"||(bC==="hey"||(bC==="yo"||bC==="hi"))?{$:1,$0:new I({$:0,$0:"hello",$1:{$:1,$0:new F({$:0,$0:"greet",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};N.Voices=function(bC){return bC==="voices"?{$:1,$0:null}:null;};N.Debug=function(bC){return bC==="debug"?{$:1,$0:null}:null;};N.Blank=function(bC){return bC===""?{$:1,$0:null}:null;};S.Study=function(bC){return bC.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};E.Str=function(bC){var bD;return bC!=null&&bC.$==1&&(typeof bC.$0=="string"&&(bD=bC.$0,true))?{$:1,$0:bD}:null;};E.No=function(bC){var bD,bE;return(bE=E.Intent$1("reject",bC),bE!=null&&bE.$==1&&(bE.$0[0]==null&&(bE.$0[1]==null&&(bD=bC,true))))?{$:1,$0:bD}:null;};E.Yes=function(bC){var bD,bE;return(bE=E.Intent$1("verify",bC),bE!=null&&bE.$==1&&(bE.$0[0]==null&&(bE.$0[1]==null&&(bD=bC,true))))?{$:1,$0:bD}:null;};E.EntityManyofMany=function(bC,bD){return{$:1,$0:br.OfArray(bd.ofSeq(bk.map(function(bE){return bk.exists(function(bF){return bF.get_Role()===bE;},bD)?[bE,{$:1,$0:bk.filter(function(bF){return bF.get_Role()===bE;},bD)}]:[bE,null];},bC)))};};E.EntityManyOf1=function(bC,bD){var bE;return bD!=null&&bD.$==1&&(bk.exists(function(bF){return bF.get_Role()===bC;},bD.$0)&&(bE=bD.$0,true))?{$:1,$0:bk.filter(function(bF){return bF.get_Role()===bC;},bE)}:null;};E.Entity1OfAny=function(bC,bD){var bE;return bD!=null&&bD.$==1&&(bk.exists(function(bF){return bF.get_Role()===bC;},bD.$0)&&(bE=bD.$0,true))?{$:1,$0:bk.head(bk.sortBy(function(bF){return bF.get_Role();},bk.filter(function(bF){return bF.get_Role()===bC;},bE)))}:null;};E.Entity1Of1=function(bC,bD){var bE;return bD!=null&&bD.$==1&&(bD.$0.$==1&&(bD.$0.$1.$==0&&(bD.$0.$0.get_Role()===bC&&(bE=bD.$0.$0,true))))?{$:1,$0:bE}:null;};E.Intent$1=function(bC,bD){return bD.get_Intent()!=null&&bD.get_Intent().$0.get_Name()===bC?{$:1,$0:[bD.get_Traits(),bD.get_Entities()]}:null;};T.$cctor=function(){T.$cctor=a.ignore;T.entity_types=bk.ofArray(["wit$contact:name","wit$datetime:datetime","term:subject","term:object","term:verb"]);T.trait_types=bk.ofArray(["domain","dialogue_act"]);T.intentConfidenceThreshold=0.85;T.entityConfidenceThreshold=0.85;};V.MicReady={$:5};V.MicAudioEnd={$:4};V.MicAudioStart={$:3};V.MicDisconnected={$:2};V.MicConnecting={$:1};V.MicNotInitialized={$:0};W.ClientUnderstand={$:2};W.ClientReady={$:1};W.ClientNotInitialzed={$:0};X=U.Interpreter=bf.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,X);Y=U.CUI=bf.Class({GetSameTextTypingPattern:function(bC){return z.getSameTextTypingPattern(bC,this.TypingDNA);},SayVoices:function(){var bC,bD,bE;bC=this;bD=a.speechSynthesis.getVoices();!(bD==null)?(bE=d.toArray(bD),bC.Say((function(bF){return function(bG){return bF("There are currently "+a.String(bG)+" voices installed on this computer or device.");};}(a.id))(bd.length(bE))),bd.iteri(function(bF,bG){return bC.Say(((((bf.Curried(function(bH,bI,bJ,bK){return bH("Voice "+a.String(bI)+". Name: "+bg.toSafe(bJ)+", Local: "+bg.prettyPrint(bK)+".");},4))(a.id))(bF))(bG.name))(bG.localService));},bE)):void 0;},Wait:function(bC){this.Wait$1(function(){bn.Start(bC,null);});},Wait$1:function(bC){this["Echo'"]("please wait...");this.Term.pause();bC();this.Term.resume();},sayRandom:function(bC,bD){this.Say(C.getRandomPhrase(bC,bD));},SayAngry:function(bC){var bD,bE;bD=this;bn.Start((bE=null,bn.Delay(function(){return bn.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bu.chime(),bn.Zero()):bn.Zero(),bn.Delay(function(){a.addMessage(bD.Avatar,bC,"","");bD.Avatar.processMessages(0);return bn.Zero();}));})),null);},SayDoc:function(bC){var bD,bE,bF;bD=bd.get(bi(".terminal-output").get(),0).childNodes.length;bE=$.Element("div",[d.cls("terminal-command"),d.dindex(bD+1)],[bC]);bF=d.termOutput();bc.LoadLocalTemplates("");$.RunAppend(bF,bE);},Say:function(bC){var bD,bE;bD=this;bn.Start((bE=null,bn.Delay(function(){return bn.Combine(a.speechSynthesis.speaking?(bu.chime(),bn.Zero()):bn.Zero(),bn.Delay(function(){bD.Avatar.addMessage(bC);bD.Avatar.processMessages(0);return bn.Zero();}));})),null);},Debug:function(bC,bD){d.debug(bC,bD);},"EchoHtml'":function(bC){var bD,bE;bD=(bE={},bE.raw=true,bE);this.Term.disable();this.Term.echo(bC,bD);this.Term.enable();},"Echo'":function(bC){this.Term.disable();this.Term.echo(bC);this.Term.enable();}},null,Y);Y.New=function(bC,bD,bE,bF,bG,bH,bI){return new Y({Voice:bC,Mic:bD,Term:bE,Avatar:bF,Caption:bG,TypingDNA:bH,AudioEnd:bI});};_0=Z.Dialogue=bf.Class({get_Utterances:function(){return this.$4;},get_Output:function(){return this.$3;},get_DialogueQuestions:function(){return this.$2;},get_Props:function(){return this.$1;},get_Cui:function(){return this.$0;}},null,_0);Z["Response'_"]=function(bC,bD,bE,bF){var bG,bH,bI;return(bH=Z.PropNotSet_(bC,"user",bF),bH!=null&&bH.$==1&&(Z.haveQuestion(bD,bE)&&bC.get_DialogueQuestions().length>0&&(bC.get_DialogueQuestions())[0].get_Name()===bE&&(bG=bH.$0,true)))?Z.have(bC,bE)?(bI=bC.get_Props().get_Item(bE),(Z["delete"](bC,bE),{$:1,$0:[bG,{$:1,$0:bI}]})):{$:1,$0:[bG,null]}:null;};Z.Response_=function(bC,bD,bE,bF){var bG,bH,bI;return(bH=Z.PropSet_(bC,"user",bF),bH!=null&&bH.$==1&&(Z.haveQuestion(bD,bE)&&bC.get_DialogueQuestions().length>0&&(bC.get_DialogueQuestions())[0].get_Name()===bE&&(bG=bH.$0,true)))?Z.have(bC,bE)?(bI=bC.get_Props().get_Item(bE),(Z["delete"](bC,bE),{$:1,$0:[bG,{$:1,$0:bI}]})):{$:1,$0:[bG,null]}:null;};Z["User'_"]=function(bC,bD){var bE,bF;return(bF=Z.PropNotSet_(bC,"user",bD),bF!=null&&bF.$==1&&(bC.get_DialogueQuestions().length===0&&(bE=bF.$0,true)))?{$:1,$0:bE}:null;};Z.User_=function(bC,bD){var bE,bF;return(bF=Z.PropSet_(bC,"user",bD),bF!=null&&bF.$==1&&(bC.get_DialogueQuestions().length===0&&(bE=bF.$0,true)))?{$:1,$0:bE}:null;};Z.PropNotSet_=function(bC,bD,bE){return!Z.have(bC,bD)?{$:1,$0:bE}:null;};Z.PropSet_=function(bC,bD,bE){return Z.have(bC,bD)?{$:1,$0:bE}:null;};Z.Agenda_=function(bC,bD,bE){return bC.get_DialogueQuestions().length>0&&(bC.get_DialogueQuestions())[0].get_Module()===bD?{$:1,$0:null}:null;};Z.didNotUnderstand=function(bC,bD,bE){var bF;bD((function(bG){return function(bH){return bG(bg.toSafe(bH)+" interpreter did not understand utterance.");};}(a.id))(bE));Z.say(bC,"Sorry I didn't understand what you meant.");bC.get_DialogueQuestions().length>0?(bF=bl.nth(0,bC.get_DialogueQuestions()),Z.have(bC,bF.get_Name())?Z.say(bC,C.replace_tok("$0",bC.get_Props().get_Item(bF.get_Name()),bF.get_Text())):Z.say(bC,bF.get_Text())):void 0;};Z.dispatch=function(bC,bD,bE,bF){bD(((((bf.Curried(function(bG,bH,bI,bJ){return bG("Dispatch to module "+bg.toSafe(bH)+" utterances: "+bg.prettyPrint(bI)+" questions: "+bg.prettyPrint(bJ)+".");},4))(a.id))(bE))(bC.get_Utterances()))(bC.get_DialogueQuestions()));bF(bC);};Z["handle'"]=function(bC,bD,bE,bF){Z.popt(bC);bD((function(bG){return function(bH){return bG("Turn end: "+bg.toSafe(bH)+".");};}(a.id))(bE));bF();};Z.handle=function(bC,bD,bE,bF){Z.popu(bC);bD((function(bG){return function(bH){return bG("Handle: "+bg.toSafe(bH)+".");};}(a.id))(bE));bF();};Z.ask=function(bC,bD,bE,bF,bG){var bH,bI;bH=Z.getQuestion(bD,bE).$0;Z.add(bC,bE,bF);Z.pushq(bC,bD,bE);bI=C.replace_tok("$0",bF,bH.get_Text());Z.say(bC,bI);bH.get_Type().$==0?d.questionBox("User Input",bI,function(bJ){Z.pushu(bC,new I({$:0,$0:bJ,$1:null,$2:null,$3:null}));bG(bC);}):void 0;};Z.popt=function(bC){Z.popu(bC);Z.popq(bC);};Z.pushq=function(bC,bD,bE){var bF;bF=Z.getQuestion(bD,bE);bF==null?(function(bG){return function(bH){return bG("No such question: "+bg.toSafe(bH));};}(bv.FailWith))(bE):bC.get_DialogueQuestions().unshift(bF.$0);};Z.popq=function(bC){bC.get_DialogueQuestions().shift();};Z.popu=function(bC){bC.get_Utterances().shift();};Z.pushu=function(bC,bD){bC.get_Utterances().unshift(bD);};Z.haveQuestion=function(bC,bD){return bk.exists(function(bE){return bE.get_Name()===bD;},bC);};Z.getQuestion=function(bC,bD){return bl.tryFind(function(bE){return bE.get_Name()===bD;},bC);};Z.prop=function(bC,bD){return bC.get_Props().get_Item(bD);};Z["delete"]=function(bC,bD){bC.get_Props().Remove(bD);};Z.add=function(bC,bD,bE){bC.get_Props().Add(bD,bE);};Z.have=function(bC,bD){return bC.get_Props().ContainsKey(bD);};Z.question=function(bC,bD,bE,bF){return new J({$:0,$0:bD,$1:bE,$2:bF,$3:bC});};Z["sayRandom'"]=function(bC,bD){Z.sayRandom(bC,bD,"");};Z.sayRandom=function(bC,bD,bE){var bF;bF=C.getRandomPhrase(bD,bE);bC.get_Output().unshift(bF);bC.get_Cui().Say(bF);};Z.say=function(bC,bD){bC.get_Output().unshift(bD);Z["say'"](bC,bD);};Z["say'"]=function(bC,bD){bC.get_Cui().Say(bD);};Z.echo=function(bC,bD){(bC.get_Cui())["EchoHtml'"](bD);};_1.update=function(bC){var bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu;function cv(cL){Z.echo(bC,cL);}function cw(cL){Z.say(bC,cL);}function cx(cL,cM){return Z.sayRandom(bC,cL,cM);}function cy(cL,cM){return Z.add(bC,cL,cM);}function cz(cL){return Z.prop(bC,cL);}function cA(){return cz("user");}function cB(cL,cM,cN){return Z.ask(bC,_1.moduleQuestions(),cL,cM,cN);}function cC(cL){_1.debug(cL);}function cD(cL){return Z.User_(bC,cL);}function cE(cL){return Z["User'_"](bC,cL);}function cF(cL,cM){return Z.Response_(bC,_1.moduleQuestions(),cL,cM);}function cG(cL,cM){return Z["Response'_"](bC,_1.moduleQuestions(),cL,cM);}function cH(cL){var cM;cx(C.waitRetrievePhrases(),"user name");bn.Start((cM=null,bn.Delay(function(){return bn.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-863027630",[cL]),function(cN){var cO;return cN==null?(cw((function(cP){return function(cQ){return cP("I did not find a user with the name "+bg.toSafe(cQ)+".");};}(a.id))(cL)),cB("addUser",cL,function(cP){_1.update(cP);}),bn.Zero()):(cO=cN.$0,bn.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:1220368753",[cO.Name]),function(){cy("user",cO);cx(C.helloUserPhrases(),(function(cP){return function(cQ){return cP(bg.prettyPrint(cQ));};}(a.id))(bE.get_Item("user")));return cO.LastLoggedIn!=null?bn.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:1038771280",[cO.LastLoggedIn.$0]),function(cP){cw((function(cQ){return function(cR){return cQ("You last logged in "+bg.toSafe(cR)+".");};}(a.id))(cP));return bn.Zero();}):bn.Zero();}));});})),null);}function cI(cL,cM){var cN;return bn.Start((cN=null,bn.Delay(function(){cx(C.waitAddPhrases(),"user");return bn.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:1220368753",[cL]),function(cO){return cO.$==1?(cw((function(cP){return function(cQ){return cP("Sorry I was not able to add the user "+bg.toSafe(cQ)+" to the system.");};}(a.id))(cL)),bn.Zero()):bn.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.addUserTypingPattern:-1474357268",[cL,cM]),function(cP){return cP.$==1?(cw((function(cQ){return function(cR){return cQ("Sorry I was not able to add the user "+bg.toSafe(cR)+" to the system.");};}(a.id))(cL)),bn.Zero()):(cy("user",cL),cw((function(cQ){return function(cR){return cQ("Hello "+bg.prettyPrint(cR)+", nice to meet you.");};}(a.id))(bE.get_Item("user"))),bn.Zero());});});})),null);}function cJ(cL,cM,cN){var cO;return bn.Start((cO=null,bn.Delay(function(){cx(C.waitAddPhrases(),"symptom entry");return bn.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:789165849",[cA().Name,cL,cM,cN]),function(cP){return cP.$==1?(cw(function(cQ){return cQ("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),bn.Zero()):(cw((function(cQ){return function(cR){return cQ("OK I added that "+bg.toSafe(cR)+" symptom to your journal.");};}(a.id))(cL)),bn.Zero());});})),null);}function cK(cL){_1.debug(cL);}bD=bC.$4;bE=bC.$1;bF=bC.$2;bG=bC.$0;_1.debug((((bf.Curried3(function(cL,cM,cN){return cL("Starting utterances:"+bg.prettyPrint(cM)+". Starting questions: "+bg.prettyPrint(cN)+".");}))(a.id))(bD))(bF));bH=bf.Curried(Z["handle'"],2,[bC,cC]);bI=bk.ofSeq(bl.take(bD.length>=5?5:bD.length,bD));bI.$==1&&(bK=cE(bI.$0),bK!=null&&bK.$==1&&(bL=E.Intent$1("greet",bK.$0),bL!=null&&bL.$==1&&(bM=E.Entity1Of1("name",bL.$0[1]),bM!=null&&bM.$==1&&(bI.$1.$==0&&(bJ=bM.$0,true)))))?((bf.Curried(Z.handle,2,[bC,cK]))("loginUser"))(function(){cH(bJ.get_Value());}):bI.$==1&&(bO=cG("inputPassPhrase",bI.$0),bO!=null&&bO.$==1&&(bP=E.Str(bO.$0[1]),bP!=null&&bP.$==1&&(bI.$1.$==0&&(bN=[bI.$0,bP.$0],true))))?(bQ=bN[0],bR=bN[1],(bH("addUser"))(function(){bG.TypingDNA.stop();cI(bR,bG.GetSameTextTypingPattern(bQ.get_Text()));})):bI.$==1&&(bT=E.Yes(bI.$0),bT!=null&&bT.$==1&&(bU=cG("addUser",bT.$0),bU!=null&&bU.$==1&&(bV=E.Str(bU.$0[1]),bV!=null&&bV.$==1&&(bI.$1.$==0&&(bS=bV.$0,true)))))?(bH("inputPassPhrase"))(function(){bG.TypingDNA.start();cB("inputPassPhrase",bS,function(cL){_1.update(cL);});}):bI.$==1&&(bX=E.No(bI.$0),bX!=null&&bX.$==1&&(bY=cG("addUser",bX.$0),bY!=null&&bY.$==1&&(bZ=E.Str(bY.$0[1]),bZ!=null&&bZ.$==1&&(bI.$1.$==0&&(bW=bZ.$0,true)))))?(bH("no"))(function(){cw((function(cL){return function(cM){return cL("Ok I did not add the user "+bg.toSafe(cM)+". But you must login for me to help you.");};}(a.id))(bW));}):bI.$==1&&(b1=cD(bI.$0),b1!=null&&b1.$==1&&(b2=E.Intent$1("hello",b1.$0),b2!=null&&b2.$==1&&(b2.$0[0]==null&&(b3=E.Entity1Of1("name",b2.$0[1]),b3!=null&&b3.$==1&&(bI.$1.$==0&&(b0=b3.$0,true))))))?bn.Start((b4=null,bn.Delay(function(){return bn.Bind((new bx.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-863027630",[b0.get_Value()]),function(cL){return cL==null?(cw((function(cM){return function(cN){return cM("Sorry, the user "+bg.toSafe(cN)+" does not exist.");};}(a.id))(b0.get_Value())),bn.Zero()):(cB("switchUser",cL.$0.Name,function(cM){_1.update(cM);}),bn.Zero());});})),null):bI.$==1&&(b6=E.Yes(bI.$0),b6!=null&&b6.$==1&&(b7=cF("switchUser",b6.$0),b7!=null&&b7.$==1&&(b8=E.Str(b7.$0[1]),b8!=null&&b8.$==1&&(bI.$1.$==0&&(b5=b8.$0,true)))))?(bE.set_Item("user",b5),cw((function(cL){return function(cM){return cL("Ok I switched to user "+bg.prettyPrint(cM)+".");};}(a.id))(b5))):bI.$==1&&(b_=E.No(bI.$0),b_!=null&&b_.$==1&&(b$=cF("switchUser",b_.$0),b$!=null&&b$.$==1&&(ca=E.Str(b$.$0[1]),ca!=null&&ca.$==1&&(bI.$1.$==0&&(b9=ca.$0,true)))))?cw((function(cL){return function(cM){return cL("Ok I did not switch to user "+bg.toSafe(cM)+".");};}(a.id))(b9)):bI.$==1&&(cc=cE(bI.$0),cc!=null&&cc.$==1?(cd=E.Intent$1("kbquery",cc.$0),cd!=null&&cd.$==1)?bI.$1.$==0&&(cb=cc.$0,true):(ce=cD(bI.$0),ce!=null&&ce.$==1&&((cf=E.Intent$1("kbquery",ce.$0),cf!=null&&cf.$==1)&&(bI.$1.$==0&&(cb=ce.$0,true)))):(cg=cD(bI.$0),cg!=null&&cg.$==1&&((ch=E.Intent$1("kbquery",cg.$0),ch!=null&&ch.$==1)&&(bI.$1.$==0&&(cb=cg.$0,true)))))?bn.Start((ci=null,bn.Delay(function(){return bn.Bind(u.getAnswer(cb.get_Text()),function(cL){var cM;return bn.Bind((cM=bd.get(cL.answers,0).answer,(new bx.New()).Async("SMApp.Web:SMApp.Web.Server.mdtohtml:-2143976427",[cM])),function(cN){var cO;return bn.Bind((cO=bd.get(cL.answers,0).answer,(new bx.New()).Async("SMApp.Web:SMApp.Web.Server.mdtotext:-2143976427",[cO])),function(cP){cv(cN);cw(cP);return bn.Zero();});});});})),null):bI.$==1&&(ck=cD(bI.$0),ck!=null&&ck.$==1&&(cl=E.Intent$1("symptom",ck.$0),cl!=null&&cl.$==1&&(cm=E.Entity1OfAny("symptom_name",cl.$0[1]),cm!=null&&cm.$==1&&(bI.$1.$==0&&(cj=cm.$0,true)))))?bn.Start((cn=null,bn.Delay(function(){cw("Ok I'll add that entry to your symptom journal");cJ(cj.get_Value(),null,null);return bn.Zero();})),null):bI.$==1&&(cp=E.Yes(bI.$0),cp!=null&&cp.$==1&&((cq=cF("painVideo",cp.$0),cq!=null&&cq.$==1)&&bI.$1.$==0))?bG["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bI.$==1&&(cs=cD(bI.$0),cs!=null&&cs.$==1&&(ct=E.Intent$1("medjournal",cs.$0),ct!=null&&ct.$==1&&((cu=ct.$0[1],cu!=null&&cu.$==1)&&(bI.$1.$==0&&(cr=ct.$0[1].$0,true)))))?(cw("ok I added that entry to your medication journal."),cw("You should be careful not to take too many painkillers over a short period of time.")):Z.didNotUnderstand(bC,function(cL){_1.debug(cL);},_1.name());_1.debug((((bf.Curried3(function(cL,cM,cN){return cL("Ending utterances: "+bg.prettyPrint(cM)+". Ending questions:"+bg.prettyPrint(cN)+".");}))(a.id))(bD))(bF));};_1.haveQuestion=function(bC){return function(bD){return Z.haveQuestion(_1.moduleQuestions(),bD);};};_1.getQuestion=function(bC){return function(bD){return Z.getQuestion(_1.moduleQuestions(),bD);};};_1.moduleQuestions=function(){_2.$cctor();return _2.moduleQuestions;};_1.debug=function(bC){d.debug(_1.name(),bC);};_1.name=function(){_2.$cctor();return _2.name;};_2.$cctor=function(){_2.$cctor=a.ignore;_2.name="User";_2.moduleQuestions=bk.ofArray([new J({$:0,$0:"inputPassPhrase",$1:"Please type the phrase My name is {firstname} {lastname}",$2:K.UserData,$3:_1.name()}),new J({$:0,$0:"addUser",$1:"Do you want me to add the user $0?",$2:K.Verification,$3:_1.name()}),new J({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?",$2:K.Verification,$3:_1.name()})]);};_3.update=function(bC){var bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT;function bU(bZ){Z.say(bC,bZ);}function bV(bZ){Z["sayRandom'"](bC,bZ);}function bW(bZ){_3.debug(bZ);}function bX(bZ){return Z["User'_"](bC,bZ);}function bY(bZ){_3.debug(bZ);}bD=bC.$4;bE=bC.$2;_3.debug((((bf.Curried3(function(bZ,b0,b1){return bZ("Starting utterances:"+bg.prettyPrint(b0)+". Starting questions: "+bg.prettyPrint(b1)+".");}))(a.id))(bD))(bE));bF=bf.Curried(Z.handle,2,[bC,bW]);bG=bk.ofSeq(bl.take(bD.length>=5?5:bD.length,bD));bH=Z.Agenda_(bC,_1.name(),bG);bH!=null&&bH.$==1?_1.update(bC):bG.$==1&&(bJ=(bK=Z.PropNotSet_(bC,"started",bG.$0),bK!=null&&bK.$==1?{$:1,$0:bK.$0}:null),bJ!=null&&bJ.$==1&&(bL=bX(bJ.$0),bL!=null&&bL.$==1&&(bM=E.Intent$1("greet",bL.$0),bM!=null&&bM.$==1&&(bM.$0[1]==null&&bG.$1.$==0))))?(Z.add(bC,"started",true),(bF("Hello"))(function(){bV(C.helloPhrases());})):bG.$==1&&(bO=bX(bG.$0),bO!=null&&bO.$==1&&(bP=E.Intent$1("greet",bO.$0),bP!=null&&bP.$==1&&(bP.$0[1]==null&&bG.$1.$==0)))?(bF("Hello"))(function(){bU("Hello, tell me your name to get started.");}):bG.$==1&&(bR=bX(bG.$0),bR!=null&&bR.$==1&&(bS=E.Intent$1("greet",bR.$0),bS!=null&&bS.$==1&&((bT=E.Entity1Of1("name",bS.$0[1]),bT!=null&&bT.$==1)&&bG.$1.$==0)))?((bf.Curried(Z.dispatch,2,[bC,bY]))(_1.name()))(function(bZ){_1.update(bZ);}):Z.didNotUnderstand(bC,function(bZ){_3.debug(bZ);},_3.name());_3.debug((((bf.Curried3(function(bZ,b0,b1){return bZ("Ending utterances: "+bg.prettyPrint(b0)+". Ending questions:"+bg.prettyPrint(b1)+".");}))(a.id))(bD))(bE));};_3.haveQuestion=function(bC){return bk.exists(function(bD){return bD.get_Name()===bC;},_3.moduleQuestions());};_3.getQuestion=function(bC){return bl.tryFind(function(bD){return bD.get_Name()===bC;},_3.moduleQuestions());};_3.moduleQuestions=function(){_4.$cctor();return _4.moduleQuestions;};_3.debug=function(bC){d.debug(_3.name(),bC);};_3.name=function(){_4.$cctor();return _4.name;};_4.$cctor=function(){_4.$cctor=a.ignore;_4.name="Main";_4.moduleQuestions=bk.T.Empty;};_5.run=function(){var bC,bD;bC=bf.ThisFunc(function(bE,bF){return((_5.Main().get_Text())(bE))(bF);});bD=_5.Main().get_Options();a.$("#term").terminal(bC,bD);return $.get_Empty();};_5.Main=function(){_6.$cctor();return _6.Main;};_5.initMic=function(bC){var bD,bE;_5.set_CUI((bD={$:1,$0:new by.Microphone(bz.getElementById("microphone"))},Y.New(_5.CUI().Voice,bD,_5.CUI().Term,_5.CUI().Avatar,_5.CUI().Caption,_5.CUI().TypingDNA,_5.CUI().AudioEnd)));bE=_5.CUI().Mic.$0;bE.onconnecting=function(){_5.set_MicState(V.MicConnecting);return _5.debug("Mic connecting...");};bE.ondisconnected=function(){_5.set_MicState(V.MicDisconnected);return _5.debug("Mic disconnected.");};bE.onaudiostart=function(){_5.set_MicState(V.MicAudioStart);return _5.debug("Mic audio start...");};bE.onaudioend=function(){_5.set_MicState(V.MicAudioEnd);_5.debug("Mic audio end.");return _5.debug(self.lastMicData);};bE.onerror=function(bF){_5.set_MicState({$:6,$0:bF});return _5.debug((function(bG){return function(bH){return bG("Mic error : "+bg.toSafe(bH)+".");};}(a.id))(bF));};bE.onready=function(){_5.set_MicState(V.MicReady);return _5.debug("Mic ready.");};bE.onresult=function(bF,bG){return _5.ClientState().$==2?_5.echo("I'm still trying to understand what you said before."):_5.ClientState().$==0?d.error("Client is not intialized."):!(bF==null||bG==null)?(_5.set_MicState({$:7,$0:bF,$1:bG}),_5.debug((((bf.Curried3(function(bH,bI,bJ){return bH("Mic result: "+bg.prettyPrint(bI)+" "+bg.prettyPrint(bJ)+".");}))(a.id))(bF))(bG)),bC(bF,bG)):_5.debug("Mic: No result returned.");};bE.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};_5.sayRandom=function(bC,bD){_5.say(C.getRandomPhrase(bD,bC));};_5.say=function(bC){_5.Output().unshift(bC);_5["say'"](bC);};_5["say'"]=function(bC){_5.CUI().Say(bC);};_5.initSpeech=function(){var bC;bC=d.toArray(_5.synth().getVoices());bd.length(bC)>0?(bd.iter(function(bD){if(bA.Equals(_5.CUI().Voice,null)&&(bD.name.indexOf("Microsoft Zira")!=-1||bD.name.toLowerCase().indexOf("female")!=-1)){_5.set_CUI(Y.New({$:1,$0:bD},_5.CUI().Mic,_5.CUI().Term,_5.CUI().Avatar,_5.CUI().Caption,_5.CUI().TypingDNA,_5.CUI().AudioEnd));_5.debug((function(bE){return function(bF){return bE("Using browser speech synthesis voice "+bg.toSafe(bF)+".");};}(a.id))(_5.CUI().Voice.$0.name));}},bC),!bA.Equals(_5.CUI().Voice,null)?(_5.CUI().Avatar.nativeVoice=true,_5.CUI().Avatar.nativeVoiceName=_5.CUI().Voice.$0.name,_5.debug((function(bD){return function(bE){return bD("Using browser speech synthesis voice "+bg.toSafe(bE)+".");};}(a.id))(_5.CUI().Voice.$0.name))):void 0):void 0;bA.Equals(_5.CUI().Voice,null)?_5.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};_5.synth=function(){_6.$cctor();return _6.synth;};_5.push=function(bC){_5.Utterances().unshift(bC);return _5.Dialogue();};_5.Dialogue=function(){_6.$cctor();return _6.Dialogue;};_5.Utterances=function(){_6.$cctor();return _6.Utterances;};_5.Questions=function(){_6.$cctor();return _6.Questions;};_5.Output=function(){_6.$cctor();return _6.Output;};_5.Props=function(){_6.$cctor();return _6.Props;};_5.wait=function(bC){d["Terminal.Echo'"](_5.CUI().Term,"please wait");_5.CUI().Term.pause();bC();_5.CUI().Term.resume();};_5.debug=function(bC){d.debug("CLIENT",bC);};_5.echo=function(bC){d["Terminal.EchoHtml'"](_5.CUI().Term,(function(bD){return function(bE){return bD(bg.prettyPrint(bE));};}(a.id))(bC));};_5.ClientState=function(){_6.$cctor();return _6.ClientState;};_5.set_ClientState=function(bC){_6.$cctor();_6.ClientState=bC;};_5.MicState=function(){_6.$cctor();return _6.MicState;};_5.set_MicState=function(bC){_6.$cctor();_6.MicState=bC;};_5.CUI=function(){_6.$cctor();return _6.CUI;};_5.set_CUI=function(bC){_6.$cctor();_6.CUI=bC;};_6.$cctor=function(){var bC,bD,bE,bF;_6.$cctor=a.ignore;function bG(bI,bJ){var bK,bL,bM,bN,bO,bP,bQ;_5.debug((((bf.Curried3(function(bR,bS,bT){return bR("Voice: "+bg.prettyPrint(bS)+" "+bg.prettyPrint(bT));}))(a.id))(bI))(bJ));bK=(bL=L["Intent'"](bI,bJ),bL!=null&&bL.$==1?{$:1,$0:bL.$0}:null);bM=(bN=L["Trait'"](bJ),bN!=null&&bN.$==1?{$:1,$0:bk.ofArray([bN.$0])}:null);bO=(bP=L["Entity'$1"](bJ),bP!=null&&bP.$==1?{$:1,$0:bk.ofArray([bP.$0])}:null);bK==null&&(bM==null&&bO==null)?void 0:(_5.debug(((((bf.Curried(function(bR,bS,bT,bU){return bR("Voice: "+_7.p(bS)+" "+_7.p$3(bT)+" "+_7.p$5(bU));},4))(a.id))(bK))(bM))(bO)),_3.update(_5.push(new I({$:0,$0:"",$1:bK,$2:bM,$3:bO}))));}function bH(bI,bJ){var bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU;_5.set_CUI(Y.New(_5.CUI().Voice,_5.CUI().Mic,bI,_5.CUI().Avatar,_5.CUI().Caption,_5.CUI().TypingDNA,_5.CUI().AudioEnd));bA.Equals(_5.CUI().Mic,null)?_5.initMic(bG):void 0;bA.Equals(_5.CUI().Voice,null)?_5.initSpeech():void 0;_5.ClientState().$===0?_5.set_ClientState(W.ClientReady):void 0;return(bK=N.Blank(bJ),bK!=null&&bK.$==1)?_5["say'"]("Tell me what you want me to do or ask me a question."):(bL=N.Debug(bJ),bL!=null&&bL.$==1)?(_5.debug((function(bV){return function(bW){return bV("Utterances: "+bg.prettyPrint(bW));};}(a.id))(_5.Utterances())),_5.debug((function(bV){return function(bW){return bV("Questions: "+bg.prettyPrint(bW));};}(a.id))(_5.Questions())),_5.debug(d.lastMicData())):(bM=N.Voices(bJ),bM!=null&&bM.$==1)?(bN=d.toArray(d.speechSynthesis().getVoices()),(_5["say'"]((function(bV){return function(bW){return bV("There are currently "+a.String(bW)+" voices installed on this computer or device.");};}(a.id))(bd.length(bN))),bd.iteri(function(bV,bW){return _5["say'"](((((bf.Curried(function(bX,bY,bZ,b0){return bX("Voice "+a.String(bY)+". Name: "+bg.toSafe(bZ)+", Local: "+bg.prettyPrint(b0)+".");},4))(a.id))(bV))(bW.name))(bW.localService));},bN))):_5.ClientState().$==1?(bP=N.QuickHello(bJ),bP!=null&&bP.$==1?(bO=bP.$0,true):(bQ=N.QuickHelp(bJ),bQ!=null&&bQ.$==1?(bO=bQ.$0,true):(bR=N.QuickYes(bJ),bR!=null&&bR.$==1?(bO=bR.$0,true):(bS=N.QuickNo(bJ),bS!=null&&bS.$==1?(bO=bS.$0,true):(bT=N.QuickNumber(bJ),bT!=null&&bT.$==1&&(bO=bT.$0,true))))))?(_5.debug((function(bV){return function(bW){return bV("Quick Text: "+_7.p$7(bW)+".");};}(a.id))(bO)),_3.update(_5.push(bO)),_5.set_ClientState(W.ClientReady)):_5.CUI().Wait((bU=null,bn.Delay(function(){_5.set_ClientState(W.ClientUnderstand);N.getUtterance(bJ,function(bV){var bW,bX;bW=N.HasUtterance(bV);bW!=null&&bW.$==1?(bX=bW.$0,_5.debug(((((bf.Curried(function(bY,bZ,b0,b1){return bY("Text: Intent: "+_7.p(bZ)+", Traits: "+_7.p$3(b0)+", Entities: "+_7.p$5(b1)+".");},4))(a.id))(bX.get_Intent()))(bX.get_Traits()))(bX.get_Entities())),_3.update(_5.push(bX))):(_5.debug("Text: Did not receive a meaning from the server."),_5["say'"]("Sorry I did not understand what you said."));});_5.set_ClientState(W.ClientReady);return bn.Zero();}))):_5.ClientState().$==0?d.error("Client is not initialized."):_5["say'"]("I'm still trying to understand what you said before.");}_6.CUI=Y.New(null,null,null,(bu.applicationId="4277115329081938617",bC=new a.SDKConnection(),bD=new a.WebAvatar(),bD.version=8.5,bD.connection=bC,bD.avatar="20926186",bD.voice="cmu-slt",bD.voiceMod="default",bD.width=175,bD.createBox(),bD.addMessage(""),bD.processMessages(0),bD),false,(bE=new a.TypingDNA(),(bE.stop(),bE)),[]);_6.MicState=V.MicNotInitialized;_6.ClientState=W.ClientNotInitialzed;_6.Props=new bB.New$5();_6.Output=[];_6.Questions=[];_6.Utterances=[];_6.Dialogue=new _0({$:0,$0:_5.CUI(),$1:_5.Props(),$2:_5.Questions(),$3:_5.Output(),$4:_5.Utterances()});_6.synth=a.speechSynthesis;_6.Main=new X({$:0,$0:function(bI){return bG(bI[0],bI[1]);},$1:[function(bI){return function(bJ){return bH(bI,bJ);};},(bF={},bF.name="Main",bF.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bF.prompt=">",bF)]});};_7.p$8=function(bC){return bC.$==3?"ConceptCompletion":bC.$==2?"Disjunctive":bC.$==1?"Verification":"UserData";};_8.p=function(bC){return"{"+("text = "+bg.prettyPrint(bC.text))+"; "+("intents = "+bg.printArray(function(bD){return _8.p$1(bD);},bC.intents))+"; "+("entities = "+bg.prettyPrint(bC.entities))+"; "+("traits = "+bg.prettyPrint(bC.traits))+"}";};_8.p$1=function(bC){return"{"+("id = "+bg.prettyPrint(bC.id))+"; "+("name = "+bg.prettyPrint(bC.name))+"; "+("confidence = "+bg.prettyPrint(bC.confidence))+"}";};_7.p$2=function(bC){return bC==null?"null":"Some "+bg.prettyPrint(bC.$0);};_7.p$1=function(bC){return"Intent ("+bg.prettyPrint(bC.$0)+", "+_7.p$2(bC.$1)+")";};_7.p=function(bC){return bC==null?"null":"Some "+_7.p$1(bC.$0);};_7.p$4=function(bC){return"Trait ("+bg.prettyPrint(bC.$0)+", "+bg.prettyPrint(bC.$1)+", "+_7.p$2(bC.$2)+")";};_7.p$3=function(bC){return bC==null?"null":"Some "+bg.printList(function(bD){return _7.p$4(bD);},bC.$0);};_7.p$6=function(bC){return"Entity ("+bg.prettyPrint(bC.$0)+", "+bg.prettyPrint(bC.$1)+", "+bg.prettyPrint(bC.$2)+", "+_7.p$2(bC.$3)+")";};_7.p$5=function(bC){return bC==null?"null":"Some "+bg.printList(function(bD){return _7.p$6(bD);},bC.$0);};_7.p$7=function(bC){return"Utterance ("+bg.prettyPrint(bC.$0)+", "+_7.p(bC.$1)+", "+_7.p$3(bC.$2)+", "+_7.p$5(bC.$3)+")";};}());
