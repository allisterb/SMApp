(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.User=c.User||{};e=c.Meaning=c.Meaning||{};f=c.Intent=c.Intent||{};g=c.Entity=c.Entity||{};h=c.Interpreter=c.Interpreter||{};i=c.Resource=c.Resource||{};j=c.NLU=c.NLU||{};k=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};l=c.CUI=c.CUI||{};m=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};n=c.ClientExtensions=c.ClientExtensions||{};o=c.Client=c.Client||{};p=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};q=a.IntelliFactory;r=q&&q.Runtime;s=a.WebSharper;t=s&&s.List;u=s&&s.Seq;v=s&&s.Random;w=s&&s.Arrays;x=a.jQuery;y=s&&s.UI;z=y&&y.Doc;A=s&&s.Utils;B=s&&s.Concurrency;C=s&&s.Remoting;D=C&&C.AjaxRemotingProvider;d.New=function(E){return{UserName:E};};e=c.Meaning=r.Class({get_TopIntent:function(){return t.head(t.sortBy(function(E){return E.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,e);f=c.Intent=r.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,f);g=c.Entity=r.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,g);h=c.Interpreter=r.Class({get_Options:function(){return(this.get_Unwrap())[1];},get_Func:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0[0],this.$0[1]];}},null,h);i.New=function(E,F,G){return{Name:E,Description:F,Url:G};};j.HelloUser=function(E){var F,G;return(G=j.Hello(E),G!=null&&G.$==1&&(G.$0.$==1&&(G.$0.$1.$==0&&(G.$0.$0.get_Role()==="contact"&&(F=G.$0.$0,true)))))?{$:1,$0:F}:null;};j.Hello=function(E){var F,G;return E!=null&&E.$==1&&(G=j.Intent("Hello",E.$0),G!=null&&G.$==1&&(F=G.$0,true))?{$:1,$0:F}:null;};j.QuickHelp=function(E){return E==="help"?{$:0,$0:null}:E==="voices"?{$:1,$0:null}:E==="debug on"?{$:2,$0:null}:E==="debug off"?{$:3,$0:null}:E==="voice 1"?{$:4,$0:null}:E==="voice 2"?{$:5,$0:null}:{$:6,$0:null};};j.Intent=function(E,F){return F.get_TopIntent().get_Name()===E&&F.get_TopIntent().get_Confidence()>j.intentConfidenceThreshold()?{$:1,$0:t.filter(function(G){return G.get_Confidence()>j.entityConfidenceThreshold();},F.get_Entities())}:null;};j.entityConfidenceThreshold=function(){k.$cctor();return k.entityConfidenceThreshold;};j.set_entityConfidenceThreshold=function(E){k.$cctor();k.entityConfidenceThreshold=E;};j.intentConfidenceThreshold=function(){k.$cctor();return k.intentConfidenceThreshold;};j.set_intentConfidenceThreshold=function(E){k.$cctor();k.intentConfidenceThreshold=E;};k.$cctor=function(){k.$cctor=a.ignore;k.intentConfidenceThreshold=0.85;k.entityConfidenceThreshold=0.85;};l.helloUserPhrases=function(){m.$cctor();return m.helloUserPhrases;};l.helloPhrases=function(){m.$cctor();return m.helloPhrases;};l.getRandomPhrase=function(E){return u.nth(l.rng().Next(0,E.get_Length()),E);};l.rng=function(){m.$cctor();return m.rng;};m.$cctor=function(){m.$cctor=a.ignore;m.rng=new v.New();m.helloPhrases=t.ofArray(["Welcome!","Welcome to Selma","I am Selma. How can I help?","Hi I'm Selma, how can I help?","Hello I'm Selma, how can I help?","My name is Selma."]);m.helloUserPhrases=t.ofArray(["Hi $user, welcome back.","Welcome $user, nice to see you again..","Hello $user","Good to see you $user."]);};n.toArray=function(E){return w.map(a.id,x.makeArray(E));};n.error=function(E){x.error(E);};n["Terminal.Push"]=function(E,F){var G,H;G=F.get_Func();H=F.get_Options();E.push(r.CreateFuncWithThis(G),H);};n["Terminal.Echo'"]=function(E,F){E.disable();E.echo(F);E.enable();};o.Term=function(){var E,F;E=r.ThisFunc(function(G,H){return((o.Main().get_Func())(G))(H);});F=o.Main().get_Options();a.$("#main").terminal(E,F);o.context().unshift({$:0,$0:o.Main()});return z.get_Empty();};o.Main=function(){p.$cctor();return p.Main;};o.stopSpeaking=function(){p.$cctor();return p.stopSpeaking;};o.sayRandom=function(E){o.say(l.getRandomPhrase(E));};o.sayVoices=function(){var E,F,G,H;E=n.toArray(a.speechSynthesis.getVoices());o.say((function(I){return function(J){return I("There are currently "+a.String(J)+" voices installed on this computer or device.");};}(a.id))(w.length(E)));for(F=0,G=w.length(E)-1;F<=G;F++){H=w.get(E,F);o.say(((((r.Curried(function(I,J,K,L){return I("Voice "+a.String(J)+": Name: "+A.toSafe(K)+" Local: "+A.prettyPrint(L)+".");},4))(a.id))(F))(H.name))(H.localService));}};o.say=function(E){var F;B.Start((F=null,B.Delay(function(){var G;G=new a.SpeechSynthesisUtterance(E);G.voiceURI=o.currentVoiceURI();a.speechSynthesis.speak(G);return B.Zero();})),null);};o.initSpeech=function(){var E,F,G,H,I,J;H=n.toArray(a.speechSynthesis.getVoices());for(I=0,J=w.length(H)-1;I<=J;I++)(function(){var K,L,M;K=w.get(H,I);return o.currentVoice()===""&&(K.name.indexOf("Microsoft Zira")!=-1||K.name.indexOf("English Female")!=-1)?(o.set_currentVoice(K.name),o.set_currentVoiceURI(K.voiceURI),L=new a.SpeechSynthesisUtterance((function(N){return function(O){return N("Using voice "+A.toSafe(O)+".");};}(a.id))(o.currentVoice())),B.Start((M=null,B.Delay(function(){a.speechSynthesis.speak(L);return B.Zero();})),null)):null;}());o.currentVoice()===""&&w.length(H)>0?(E=w.get(H,0),o.set_currentVoice(E.name),o.set_currentVoiceURI(E.voiceURI),F=new a.SpeechSynthesisUtterance(function(K){return K("Using the default speech synthesis voice.");}(a.id)),B.Start((G=null,B.Delay(function(){a.speechSynthesis.speak(F);return B.Zero();})),null)):o.currentVoice()===""?n.error("No speech synthesis voice is available. In order to use Selma you must install a speech synthesis voice on this device or computer."):void 0;};o.context=function(){p.$cctor();return p.context;};o.transcribe=function(){p.$cctor();return p.transcribe;};o.set_transcribe=function(E){p.$cctor();p.transcribe=E;};o.debugMode=function(){p.$cctor();return p.debugMode;};o.set_debugMode=function(E){p.$cctor();p.debugMode=E;};o.currentVoiceURI=function(){p.$cctor();return p.currentVoiceURI;};o.set_currentVoiceURI=function(E){p.$cctor();p.currentVoiceURI=E;};o.currentVoice=function(){p.$cctor();return p.currentVoice;};o.set_currentVoice=function(E){p.$cctor();p.currentVoice=E;};p.$cctor=function(){var E;p.$cctor=a.ignore;function F(G,H){var I,J;o.currentVoice()===""?(o.initSpeech(),n["Terminal.Echo'"](G,(function(K){return function(L){return K("Using voice :"+A.toSafe(L)+".");};}(a.id))(o.currentVoice()))):void 0;I=j.QuickHelp(H);return I.$==1?o.sayVoices():I.$==2?(o.set_debugMode(true),o.say(function(K){return K("Debug mode is now on.");}(a.id))):I.$==3?(o.set_debugMode(false),o.say(function(K){return K("Debug mode is now off.");}(a.id))):I.$==4?o.say("Quick voice 1"):I.$==5?o.say("Quick voice 2"):I.$==6?(G.disable(),B.Start((J=null,B.Delay(function(){return B.Combine(B.Bind((new D.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:-1677929787",[H]),function(K){var L,M;L=j.HelloUser(K);return L!=null&&L.$==1?(G.echo((function(N){return function(O){return N("This is the hello intent. The user name is "+A.toSafe(O)+".");};}(a.id))(L.$0.get_Value())),B.Zero()):(M=j.Hello(K),M!=null&&M.$==1)?(o.sayRandom(l.helloPhrases()),B.Zero()):(G.echo("This is the whatever intent"),B.Zero());}),B.Delay(function(){G.enable();return B.Zero();}));})),null)):o.say("This is the quick help command");}p.currentVoice="";p.currentVoiceURI="";p.debugMode=false;p.transcribe=false;p.context=[];p.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;p.Main=new h({$:0,$0:[function(G){return function(H){return F(G,H);};},(E={},E.name="Main",E.greetings="Welcome to Selma. Type hello to begin or help for more assistance.",E.prompt=">",E)]});};}());
