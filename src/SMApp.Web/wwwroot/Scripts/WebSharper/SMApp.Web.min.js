(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=b.Bootstrap=b.Bootstrap||{};i=h.Controls=h.Controls||{};j=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};k=c.NLU=c.NLU||{};l=k.Intent=k.Intent||{};m=k.Trait=k.Trait||{};n=k.Entity=k.Entity||{};o=k.Meaning=k.Meaning||{};p=k.Question=k.Question||{};q=k.Voice=k.Voice||{};r=q["Entity'"]=q["Entity'"]||{};s=k.Text=k.Text||{};t=s["Meaning'"]=s["Meaning'"]||{};u=s["Intent'"]=s["Intent'"]||{};v=s["Entity'"]=s["Entity'"]||{};w=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};x=c.CUI=c.CUI||{};y=x.User=x.User||{};z=x.Interpreter=x.Interpreter||{};A=x.CUI=x.CUI||{};B=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};C=c.Main=c.Main||{};D=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};E=c.Client=c.Client||{};F=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};G=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};H=a.WebSharper;I=H&&H.Strings;J=H&&H.Arrays;K=a.jQuery;L=H&&H.Utils;M=a.console;N=a.IntelliFactory;O=N&&N.Runtime;P=H&&H.List;Q=H&&H.Seq;R=H&&H.UI;S=R&&R.Doc;T=R&&R.AttrModule;U=H&&H.Concurrency;V=H&&H.Random;W=H&&H.Unchecked;X=H&&H.Remoting;Y=X&&X.AjaxRemotingProvider;Z=a.Wit;_0=a.document;_1=H&&H.Collections;_2=_1&&_1.Dictionary;d.replace_tok=function(_3,_4,_5){return I.Replace(_5,_3,_4);};d.toLower=function(_3){return _3.toLowerCase();};d.toArray=function(_3){return J.map(a.id,K.makeArray(_3));};d.debug=function(_3){var _4;d.info((function(_5){return function(_6){return _5("DEBUG: "+L.toSafe(_6));};}(a.id))((_4=_3,a.String(_4))));};d.error=function(_3){M.error(_3);};d.info=function(_3){M.info(_3);};d.jserror=function(_3){K.error(_3);};d["Terminal.EchoHtml'"]=function(_3,_4){_3.disable();_3.echo(_4,d.rawOpt());_3.enable();};d["Terminal.Echo'"]=function(_3,_4){_3.disable();_3.echo(_4);_3.enable();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=O.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(_3){function _4(_5){return function(_6){var _7,_8,_9,_,$,ba,bb;_8=I.replicate(_5," ");switch(_6.$==0?_6.$1.$==1?_6.$1.$0.$==2?_6.$1.$1.$==0?(_7=[_6.$1.$0.$0,_6.$0],1):(_7=[_6.$1,_6.$0],2):(_7=[_6.$1,_6.$0],2):(_7=[_6.$1,_6.$0],2):_6.$==2?(_7=_6.$0,3):(_7=[_6.$0,_6.$1],0)){case 0:return _7[0]+"=\""+_7[1]+"\"";case 1:_9=_7[1];return _8+"<"+_9+">"+_7[0]+"</"+_9+">\r\n";case 2:_=_7[1];$=P.partition(function(bc){return bc.$==1;},_7[0]);ba=$[1];bb=$[0];return ba.$==0?_8+"<"+_+(bb.$===0?"":" "+I.concat(" ",P.ofSeq(Q.delay(function(){return Q.map(function(bc){return(_4(0))(bc);},bb);}))))+"/>\r\n":_8+"<"+_+(bb.$===0?"":" "+I.concat(" ",P.ofSeq(Q.delay(function(){return Q.map(function(bc){return(_4(0))(bc);},bb);}))))+">\r\n"+I.concat("",P.ofSeq(Q.delay(function(){return Q.map(function(bc){return(_4(_5+1))(bc);},ba);})))+_8+"</"+_+">\r\n";case 3:return _8+_7+"\r\n";}};}return(_4(0))(_3);};f.alt=function(_3){return new e({$:1,$0:"alt",$1:_3});};f.src=function(_3){return new e({$:1,$0:"src",$1:_3});};f.cls=function(_3){return new e({$:1,$0:"class",$1:_3});};f.str=function(_3){return e.toString(_3);};f.op_PercentEquals=function(_3,_4){return new e({$:1,$0:_3,$1:_4});};f.op_Splice=function(_3){var _4;return P.ofArray([new e({$:2,$0:(_4=_3,a.String(_4))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(_3,_4){return new e({$:0,$0:_3,$1:_4});};g.$cctor=function(){var _3;g.$cctor=a.ignore;g.rawOpt=(_3={},_3.raw=true,_3);g.html=function(_4){return f.elem("html",_4);};g.head=function(_4){return f.elem("head",_4);};g.title=function(_4){return f.elem("title",_4);};g.style=function(_4){return f.elem("style",_4);};g.body=function(_4){return f.elem("body",_4);};g.div=function(_4){return f.elem("div",_4);};g.br=function(_4){return f.elem("br",_4);};g.section=function(_4){return f.elem("section",_4);};g.span=function(_4){return f.elem("span",_4);};g.table=function(_4){return f.elem("table",_4);};g.thead=function(_4){return f.elem("thead",_4);};g.tbody=function(_4){return f.elem("tbody",_4);};g.tfoot=function(_4){return f.elem("tfoot",_4);};g.img=function(_4){return f.elem("img",_4);};g.map=function(_4){return f.elem("map",_4);};g.area=function(_4){return f.elem("area",_4);};g.p=function(_4){return f.elem("p",_4);};g.a=function(_4){return f.elem("a",_4);};g.tr=function(_4){return f.elem("tr",_4);};g.td=function(_4){return f.elem("td",_4);};g.th=function(_4){return f.elem("th",_4);};g.ul=function(_4){return f.elem("ul",_4);};g.li=function(_4){return f.elem("li",_4);};g.h1=function(_4){return f.elem("h1",_4);};g.h2=function(_4){return f.elem("h1",_4);};g.h3=function(_4){return f.elem("h1",_4);};g.h4=function(_4){return f.elem("h1",_4);};g.strong=function(_4){return f.elem("strong",_4);};};i.Radio=function(_3,_4,_5,_6,_7){return S.Element("div",new P.T({$:1,$0:(i.cls())("radio"),$1:_4}),[S.Element("label",_6,[S.Radio(_7,true,_5),S.TextNode(_3)])]);};i.Checkbox=function(_3,_4,_5,_6,_7){return S.Element("div",new P.T({$:1,$0:(i.cls())("checkbox"),$1:_4}),[S.Element("label",_6,[S.CheckBox(_7,_5),S.TextNode(_3)])]);};i.TextArea=function(_3,_4,_5,_6,_7){return S.Element("div",new P.T({$:1,$0:(i.cls())("form-group"),$1:_4}),[S.Element("label",_6,[S.TextNode(_3)]),S.InputArea(new P.T({$:1,$0:(i.cls())("form-control"),$1:_7}),_5)]);};i.InputPassword=function(_3,_4,_5,_6,_7){return S.Element("div",new P.T({$:1,$0:(i.cls())("form-group"),$1:_4}),[S.Element("label",_6,[S.TextNode(_3)]),S.PasswordBox(new P.T({$:1,$0:(i.cls())("form-control"),$1:_7}),_5)]);};i.Input=function(_3,_4,_5,_6,_7){return S.Element("div",new P.T({$:1,$0:(i.cls())("form-group"),$1:_4}),[S.Element("label",_6,[S.TextNode(_3)]),S.Input(new P.T({$:1,$0:(i.cls())("form-control"),$1:_7}),_5)]);};i.Container=function(_3){return S.Element("div",[(i.cls())("container")],_3);};i.Class=function(){j.$cctor();return j.Class;};i.cls=function(){j.$cctor();return j.cls;};j.$cctor=function(){j.$cctor=a.ignore;j.cls=T.Class;j.Class=T.Class;};l=k.Intent=O.Class({toString:function(){return(((O.Curried3(function(_3,_4,_5){return _3("Intent("+L.toSafe(_4)+", "+G.p$2(_5)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,l);m=k.Trait=O.Class({toString:function(){return(((O.Curried3(function(_3,_4,_5){return _3("Trait("+L.toSafe(_4)+", "+L.prettyPrint(_5)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,m);n=k.Entity=O.Class({toString:function(){return((((O.Curried(function(_3,_4,_5,_6){return _3("Entity("+L.toSafe(_4)+", "+L.toSafe(_5)+", "+G.p$2(_6)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[2];},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,n);o=k.Meaning=O.Class({toString:function(){return((((O.Curried(function(_3,_4,_5,_6){return _3(G.p(_4)+" "+G.p$3(_5)+". "+G.p$5(_6));},4))(a.id))(this.get_Intent()))(this.get_Trait()))(this.get_Entities());},get_Entities:function(){return(this.Unwrap())[2];},get_Trait:function(){return(this.Unwrap())[1];},get_Intent:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,o);p=k.Question=O.Class({get_Response:function(){return(this.Unwrap())[1];},get_Meaning:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1];}},null,p);r.New=function(_3,_4,_5,_6,_7){return{body:_3,end:_4,start:_5,suggested:_6,value:_7};};q["Intent'"]=function(_3,_4){return!(_4.intent==null)?{$:1,$0:new l({$:0,$0:d.toLower(_4.intent.value),$1:null})}:null;};q["Trait'"]=function(_3){return!(_3.greetings==null)?{$:1,$0:new m({$:0,$0:"greetings",$1:d.toLower(_3.contact.value)})}:null;};q["Entity'$1"]=function(_3){return!(_3.contact==null)?{$:1,$0:new n({$:0,$0:"contact",$1:d.toLower(_3.contact.value),$2:null})}:null;};t=s["Meaning'"]=O.Class({get_TopIntent:function(){return P.head(P.sortBy(function(_3){return _3.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,t);u=s["Intent'"]=O.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,u);v=s["Entity'"]=O.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,v);s.HasMeaning=function(_3){var _4,_5,_6,_7,_8,_9;return _3!=null&&_3.$==1&&(_3.$0.$0.$==0&&(_3.$0.$1.get_Length()>0&&(_4=_3.$0.$1,true)))?{$:1,$0:new o({$:0,$0:null,$1:null,$2:{$:1,$0:P.map(function(_){return new n({$:0,$0:d.toLower(_.get_Role()),$1:_.get_Value(),$2:{$:1,$0:_.get_Confidence()}});},P.filter(function(_){return _.get_Confidence()>s.entityConfidenceThreshold();},_4))}})}:_3!=null&&_3.$==1&&(_3.$0.$1.$==0&&(_3.$0.get_TopIntent().get_Confidence()>s.intentConfidenceThreshold()&&(_5=[_3.$0.$0,_3],true)))?(_6=_5[1],{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(_6.$0.get_TopIntent().get_Name()),$1:{$:1,$0:_6.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):_3!=null&&_3.$==1&&(_3.$0.get_TopIntent().get_Confidence()>s.intentConfidenceThreshold()&&(_7=[_3.$0.$1,_3.$0.$0,_3],true))?(_8=_7[2],(_9=P.map(function(_){return new n({$:0,$0:d.toLower(_.get_Role()),$1:_.get_Value(),$2:{$:1,$0:_.get_Confidence()}});},P.filter(function(_){return _.get_Confidence()>s.entityConfidenceThreshold();},_8.$0.get_Entities())),{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(_8.$0.get_TopIntent().get_Name()),$1:{$:1,$0:_8.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:_9}})})):null;};s.entityConfidenceThreshold=function(){w.$cctor();return w.entityConfidenceThreshold;};s.set_entityConfidenceThreshold=function(_3){w.$cctor();w.entityConfidenceThreshold=_3;};s.intentConfidenceThreshold=function(){w.$cctor();return w.intentConfidenceThreshold;};s.set_intentConfidenceThreshold=function(_3){w.$cctor();w.intentConfidenceThreshold=_3;};s.QuickPrograms=function(_3){return _3==="programs"?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};s.QuickNo=function(_3){var _4;return _3==="no"||(_3==="NO"||(_3==="No"||(_3==="nope"||(_3==="no way"||(_3==="nah"||(_3==="don't do it"||_3==="stop"))))))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"yes",$1:null})},$1:null,$2:null})}:null;};s.QuickYes=function(_3){var _4;return _3==="yes"||(_3==="YES"||(_3==="Yes"||(_3==="YEs"||(_3==="ok"||(_3==="sure"||(_3==="yeah"||(_3==="yep"||(_3==="uh huh"||(_3==="go ahead"||_3==="go")))))))))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"yes",$1:null})},$1:null,$2:null})}:null;};s.QuickHelp=function(_3){var _4;return _3==="help"||(_3==="help me"||(_3==="what's this?"||_3==="huh"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"help",$1:null})},$1:null,$2:null})}:null;};s.QuickHello=function(_3){var _4;return _3==="hello"||(_3==="hey"||(_3==="yo"||_3==="hi"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"hello",$1:null})},$1:null,$2:null})}:null;};s.DebugOff=function(_3){return _3==="debug off"?{$:1,$0:null}:null;};s.DebugOn=function(_3){return _3==="debug on"?{$:1,$0:null}:null;};s.Blank=function(_3){return _3===""?{$:1,$0:null}:null;};k.Yes=function(_3){var _4,_5;return(_5=k.Intent$1("yes",_3.$0),_5!=null&&_5.$==1)&&(_3.$1==null&&_3.$2==null)?{$:1,$0:null}:null;};k.Entity$1=function(_3,_4){return _4.get_Name()===_3?{$:1,$0:_4.get_Value()}:null;};k.Intent$1=function(_3,_4){var _5;return _4!=null&&_4.$==1&&(_4.$0.$0===_3&&(_5=_4.$0.$0,true))?{$:1,$0:null}:null;};w.$cctor=function(){w.$cctor=a.ignore;w.intentConfidenceThreshold=0.85;w.entityConfidenceThreshold=0.85;};y=x.User=O.Class({toString:function(){return this.Name;}},null,y);y.New=function(_3){return new y({Name:_3});};z=x.Interpreter=O.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,z);A=x.CUI=O.Class({get_StopSpeaking:function(){if(a.speechSynthesis.speaking||a.speechSynthesis.pending)a.speechSynthesis.cancel();},SayVoices:function(){var _3,_4,_5;_3=this;_4=a.speechSynthesis.getVoices();!(_4==null)?(_5=d.toArray(_4),_3.Say((function(_6){return function(_7){return _6("There are currently "+a.String(_7)+" voices installed on this computer or device.");};}(a.id))(J.length(_5))),J.iteri(function(_6,_7){return _3.Say(((((O.Curried(function(_8,_9,_,$){return _8("Voice "+a.String(_9)+". Name: "+L.toSafe(_)+", Local: "+L.prettyPrint($)+".");},4))(a.id))(_6))(_7.name))(_7.localService));},_5)):void 0;},Wait:function(_3){this.Wait$1(function(){U.Start(_3,null);});},Wait$1:function(_3){this["Echo'"]("please wait...");this.Term.pause();_3();this.Term.resume();},sayRandom:function(_3,_4){this.Say(x.getRandomPhrase(_3,_4));},Say:function(_3){var _4,_5,_6;_4=this.Voice;_4!=null&&_4.$==1?(_5=_4.$0,U.Start((_6=null,U.Delay(function(){var _7;_7=new a.SpeechSynthesisUtterance(_3);_7.voice=_5;a.speechSynthesis.speak(_7);return U.Zero();})),null),this.Caption?this["Echo'"](_3):void 0):this["Echo'"](_3);},Debug:function(_3){d.debug(_3);this.DebugMode?this["EchoHtml'"](_3):void 0;},"EchoHtml'":function(_3){var _4,_5;_4=(_5={},_5.raw=true,_5);this.Term.disable();this.Term.echo(_3,_4);this.Term.enable();},"Echo'":function(_3){this.Term.disable();this.Term.echo(_3);this.Term.enable();}},null,A);A.New=function(_3,_4,_5,_6,_7){return new A({Voice:_3,Mic:_4,Term:_5,DebugMode:_6,Caption:_7});};x.helpPhrases=function(){B.$cctor();return B.helpPhrases;};x.helloUserPhrases=function(){B.$cctor();return B.helloUserPhrases;};x.helloPhrases=function(){B.$cctor();return B.helloPhrases;};x.waitRetrievePhrases=function(){B.$cctor();return B.waitRetrievePhrases;};x["getRandomPhrase'"]=function(_3){return d.replace_tok("$0","",Q.nth(x.rng().Next(0,_3.get_Length()),_3));};x.getRandomPhrase=function(_3,_4){return d.replace_tok("$0",_4,Q.nth(x.rng().Next(0,_3.get_Length()),_3));};x.rng=function(){B.$cctor();return B.rng;};B.$cctor=function(){B.$cctor=a.ignore;B.rng=new V.New();B.waitRetrievePhrases=P.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);B.helloPhrases=P.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);B.helloUserPhrases=P.ofArray(["Hi $0, welcome back.","Welcome $0, nice to see you again..","Hello $0","Good to see you $0."]);B.helpPhrases=P.ofArray(["What can I help you with $0?"]);};C.update=function(_3,_4,_5,_6){var _7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ;function bR(bZ){return _4.ContainsKey(bZ);}function bS(bZ){return!bR("user")?{$:1,$0:bZ.Unwrap()}:null;}function bT(bZ){return bR("user")?{$:1,$0:bZ.Unwrap()}:null;}function bU(bZ){return W.Equals(bZ,(C.questions())[0].$0);}function bV(bZ){var b0;_5.unshift((b0=bZ,a.String(b0)));_3.Say(bZ);}function bW(bZ,b0){var b1;b1=x.getRandomPhrase(bZ,b0);_5.unshift(b1);return _3.Say(b1);}function bX(bZ){var b0;U.Start((b0=null,U.Delay(function(){bW(x.waitRetrievePhrases(),"user name");return U.Bind((new Y.New()).Async("SMApp.Web:SMApp.Web.Server.GetUser2:-51455750",[bZ]),function(b1){return b1==null?(bV((function(b2){return function(b3){return b2("Sorry I did not find the user name "+L.toSafe(b3)+".");};}(a.id))(bZ)),U.Zero()):(_4.Add("user",b1.$0),bW(x.helloUserPhrases(),(function(b2){return function(b3){return b2(L.prettyPrint(b3));};}(a.id))(_4.get_Item("user"))),U.Zero());});})),null);}function bY(bZ){var b0,b1;for(b0=1,b1=bZ;b0<=b1;b0++)_6.shift();}_7=function(bZ){return C.questions().length>0&&bU(new o({$:0,$0:bZ[0],$1:bZ[1],$2:bZ[2]}))?{$:1,$0:bZ}:null;};_8=_6.length>=5?5:_6.length;C.questions().shift();C.debug((function(bZ){return function(b0){return bZ("Current context: "+L.prettyPrint(b0)+".");};}(a.id))(_6));_9=P.ofSeq(Q.take(_8,_6));_9.$==1&&($=bS(_9.$0),$!=null&&$.$==1&&((ba=k.Intent$1("hello",$.$0[0]),ba!=null&&ba.$==1)&&($.$0[1]==null&&($.$0[2]==null&&_9.$1.$==0))))?bW(x.helloPhrases(),""):_9.$==1&&(bc=bT(_9.$0),bc!=null&&bc.$==1&&((bd=k.Intent$1("hello",bc.$0[0]),bd!=null&&bd.$==1)&&(bc.$0[1]==null&&(bc.$0[2]==null&&_9.$1.$==0))))?(bW(x.helloUserPhrases(),(function(bZ){return function(b0){return bZ(L.prettyPrint(b0));};}(a.id))(_4.get_Item("user"))),bY(1)):_9.$==1&&(bf=bS(_9.$0),bf!=null&&bf.$==1&&((bg=k.Intent$1("hello",bf.$0[0]),bg!=null&&bg.$==1)&&(bf.$0[1]==null&&((bh=bf.$0[2],bh!=null&&bh.$==1)&&(bf.$0[2].$0.$==1&&(bi=k.Entity$1("contact",bf.$0[2].$0.$0),bi!=null&&bi.$==1&&(bf.$0[2].$0.$1.$==0&&(_9.$1.$==0&&(be=bi.$0,true)))))))))?(bX(be),bY(1)):_9.$==1&&(bk=bS(_9.$0),bk!=null&&bk.$==1&&(bk.$0[0]==null&&(bk.$0[1]==null&&((bl=bk.$0[2],bl!=null&&bl.$==1)&&(bk.$0[2].$0.$==1&&(bm=k.Entity$1("contact",bk.$0[2].$0.$0),bm!=null&&bm.$==1&&(bk.$0[2].$0.$1.$==0&&(_9.$1.$==1&&(bn=bS(_9.$1.$0),bn!=null&&bn.$==1&&((bo=k.Intent$1("hello",bn.$0[0]),bo!=null&&bo.$==1)&&(bn.$0[1]==null&&(bn.$0[2]==null&&(_9.$1.$1.$==0&&(bj=bm.$0,true))))))))))))))?(bX(bj),bY(2)):_9.$==1&&(bq=bS(_9.$0),bq!=null&&bq.$==1&&((br=k.Intent$1("hello",bq.$0[0]),br!=null&&br.$==1)&&(bq.$0[1]==null&&((bs=bq.$0[2],bs!=null&&bs.$==1)&&(bq.$0[2].$0.$==1&&(bt=k.Entity$1("contact",bq.$0[2].$0.$0),bt!=null&&bt.$==1&&(bq.$0[2].$0.$1.$==0&&(_9.$1.$==1&&(bu=bS(_9.$1.$0),bu!=null&&bu.$==1&&((bv=k.Intent$1("hello",bu.$0[0]),bv!=null&&bv.$==1)&&(bu.$0[1]==null&&(bu.$0[2]==null&&(_9.$1.$1.$==0&&(bp=bt.$0,true))))))))))))))?(bX(bp),bY(2)):_9.$==1&&(bx=bT(_9.$0),bx!=null&&bx.$==1&&((by=k.Intent$1("hello",bx.$0[0]),by!=null&&by.$==1)&&(bx.$0[1]==null&&((bz=bx.$0[2],bz!=null&&bz.$==1)&&(bx.$0[2].$0.$==1&&(bA=k.Entity$1("contact",bx.$0[2].$0.$0),bA!=null&&bA.$==1&&(bx.$0[2].$0.$1.$==0&&(_9.$1.$==0&&(bw=[_9,bA.$0],true)))))))))?(bV("Are you sure you want to switch users?"),C.questions().unshift(new p({$:0,$0:P.head(bw[0]),$1:"Are you sure you want to switch users?"}))):_9.$==1&&(bC=bT(_9.$0),bC!=null&&bC.$==1&&((bD=k.Intent$1("yes",bC.$0[0]),bD!=null&&bD.$==1)&&(bC.$0[1]==null&&(bC.$0[2]==null&&(_9.$1.$==1&&(bE=bT(_9.$1.$0),bE!=null&&bE.$==1&&(bF=_7(bE.$0),bF!=null&&bF.$==1&&((bG=k.Intent$1("hello",bF.$0[0]),bG!=null&&bG.$==1)&&(bF.$0[1]==null&&((bH=bF.$0[2],bH!=null&&bH.$==1)&&(bF.$0[2].$0.$==1&&(bI=k.Entity$1("contact",bF.$0[2].$0.$0),bI!=null&&bI.$==1&&(bF.$0[2].$0.$1.$==0&&(_9.$1.$1.$==0&&(bB=bI.$0,true)))))))))))))))?(bX(bB),bY(2)):_9.$==1&&(bK=bT(_9.$0),bK!=null&&bK.$==1&&((bL=k.Intent$1("no",bK.$0[0]),bL!=null&&bL.$==1)&&(bK.$0[1]==null&&(bK.$0[2]==null&&(_9.$1.$==1&&(bM=bT(_9.$1.$0),bM!=null&&bM.$==1&&(bN=_7(bM.$0),bN!=null&&bN.$==1&&((bO=k.Intent$1("hello",bN.$0[0]),bO!=null&&bO.$==1)&&(bN.$0[1]==null&&((bP=bN.$0[2],bP!=null&&bP.$==1)&&(bN.$0[2].$0.$==1&&((bQ=k.Entity$1("contact",bN.$0[2].$0.$0),bQ!=null&&bQ.$==1)&&(bN.$0[2].$0.$1.$==0&&_9.$1.$1.$==0)))))))))))))?bY(2):(bY(1),bV("Sorry I didn't understand what you meant."),C.questions().length>0?bV((C.questions())[0].get_Response()):void 0);};C.questions=function(){D.$cctor();return D.questions;};C.debug=function(_3){d.debug((function(_4){return function(_5){return _4("Main: "+L.prettyPrint(_5));};}(a.id))(_3));};D.$cctor=function(){D.$cctor=a.ignore;D.questions=[];};E.run=function(){var _3,_4;_3=O.ThisFunc(function(_5,_6){return((E.Main().get_Text())(_5))(_6);});_4=E.Main().get_Options();a.$("#main").terminal(_3,_4);return S.get_Empty();};E.Main=function(){F.$cctor();return F.Main;};E.container=function(){F.$cctor();return F.container;};E.wait=function(_3){d["Terminal.Echo'"](E.CUI().Term,"please wait");E.CUI().Term.disable();_3();E.CUI().Term.enable();};E.sayRandom=function(_3,_4){E.say(x.getRandomPhrase(_4,_3));};E.sayVoices=function(){var _3,_4;_3=a.speechSynthesis.getVoices();!(_3==null)?(_4=d.toArray(_3),E.say((function(_5){return function(_6){return _5("There are currently "+a.String(_6)+" voices installed on this computer or device.");};}(a.id))(J.length(_4))),J.iteri(function(_5,_6){return E.say(((((O.Curried(function(_7,_8,_9,_){return _7("Voice "+a.String(_8)+". Name: "+L.toSafe(_9)+", Local: "+L.prettyPrint(_)+".");},4))(a.id))(_5))(_6.name))(_6.localService));},_4)):void 0;};E.say=function(_3){var _4,_5,_6;E.Responses().unshift(_3);_4=E.CUI().Voice;_4!=null&&_4.$==1?(_5=_4.$0,U.Start((_6=null,U.Delay(function(){var _7;_7=new a.SpeechSynthesisUtterance(_3);_7.voice=_5;a.speechSynthesis.speak(_7);E.CUI().Caption?d["Terminal.Echo'"](E.CUI().Term,_3):void 0;return U.Zero();})),null)):d["Terminal.Echo'"](E.CUI().Term,_3);};E.initMic=function(_3){var _4,_5;E.set_CUI((_4={$:1,$0:new Z.Microphone(_0.getElementById("microphone"))},A.New(E.CUI().Voice,_4,E.CUI().Term,E.CUI().DebugMode,E.CUI().Caption)));_5=E.CUI().Mic.$0;_5.onconnecting=function(){E.set_MicState({$:1});return E.debug("Mic connecting...");};_5.ondisconnected=function(){E.set_MicState({$:2});return E.debug("Mic disconnected.");};_5.onaudiostart=function(){E.set_MicState({$:3});return E.debug("Mic audio start...");};_5.onaudioend=function(){E.set_MicState({$:4});return E.debug("Mic audio end.");};_5.onerror=function(_6){E.set_MicState({$:6,$0:_6});return E.debug((function(_7){return function(_8){return _7("Mic error : "+L.toSafe(_8)+".");};}(a.id))(_6));};_5.onready=function(){E.set_MicState({$:5});return E.debug("Mic ready.");};_5.onresult=function(_6,_7){return!(_6==null||_7==null)?(E.set_MicState({$:7,$0:_6,$1:_7}),E.debug((((O.Curried3(function(_8,_9,_){return _8("Mic result: "+L.prettyPrint(_9)+" "+L.prettyPrint(_)+".");}))(a.id))(_6))(_7)),_3(_5,[_6,_7])):E.debug("Mic: No result returned.");};_5.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};E.initSpeech=function(){var _3,_4;_3=a.speechSynthesis.getVoices();!(_3==null)?(_4=d.toArray(_3),J.iter(function(_5){if(W.Equals(E.CUI().Voice,null)&&(_5.name.indexOf("Microsoft Zira")!=-1||_5.name.toLowerCase().indexOf("female")!=-1)){E.set_CUI(A.New({$:1,$0:_5},E.CUI().Mic,E.CUI().Term,E.CUI().DebugMode,E.CUI().Caption));E.debug((function(_6){return function(_7){return _6("Using voice "+L.toSafe(_7)+".");};}(a.id))(E.CUI().Voice.$0.name));}},_4),W.Equals(E.CUI().Voice,null)&&J.length(_4)>0?(E.set_CUI(A.New({$:1,$0:J.find(function(_5){return _5["default"];},_4)},E.CUI().Mic,E.CUI().Term,E.CUI().DebugMode,E.CUI().Caption)),E.debug((function(_5){return function(_6){return _5("Using default voice "+L.toSafe(_6)+".");};}(a.id))(E.CUI().Voice.$0.name))):void 0):void 0;W.Equals(E.CUI().Voice,null)?(d.error("No speech synthesis voice is available."),d["Terminal.Echo'"](E.CUI().Term,"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma.")):void 0;};E.pushCtx=function(_3){E.Context().unshift(_3);return E.Context();};E.Responses=function(){F.$cctor();return F.Responses;};E.Context=function(){F.$cctor();return F.Context;};E.debug=function(_3){var _4;_4=(function(_5){return function(_6){return _5("Client: "+L.prettyPrint(_6));};}(a.id))(_3);d.debug(_4);E.CUI().DebugMode?d["Terminal.EchoHtml'"](E.CUI().Term,_4):void 0;};E.Props=function(){F.$cctor();return F.Props;};E.OpState=function(){F.$cctor();return F.OpState;};E.set_OpState=function(_3){F.$cctor();F.OpState=_3;};E.MicState=function(){F.$cctor();return F.MicState;};E.set_MicState=function(_3){F.$cctor();F.MicState=_3;};E.CUI=function(){F.$cctor();return F.CUI;};E.set_CUI=function(_3){F.$cctor();F.CUI=_3;};F.$cctor=function(){var _3;F.$cctor=a.ignore;function _4(_6,_7){var _8,_9,_,$,ba,bb,bc,bd,be,bf,bg;_8=_7[0];_9=_7[1];E.debug((((O.Curried3(function(bh,bi,bj){return bh("Voice: "+L.prettyPrint(bi)+" "+L.prettyPrint(bj));}))(a.id))(_8))(_9));_=($=q["Intent'"](_8,_9),$!=null&&$.$==1?{$:1,$0:$.$0}:null);ba=(bb=q["Trait'"](_9),bb!=null&&bb.$==1?{$:1,$0:bb.$0}:null);bc=(bd=q["Entity'$1"](_9),bd!=null&&bd.$==1?{$:1,$0:P.ofArray([bd.$0])}:null);return _==null&&(ba==null&&bc==null)?null:(E.debug(((((O.Curried(function(bh,bi,bj,bk){return bh("Voice: "+G.p(bi)+" "+G.p$3(bj)+" "+G.p$5(bk));},4))(a.id))(_))(ba))(bc)),(E.OpState()==null?false:E.OpState().$0.$==0)?E.say("I'm still working on understanding your last message."):(bg=E.pushCtx(new o({$:0,$0:_,$1:ba,$2:bc})),C.update(E.CUI(),E.Props(),E.Responses(),bg)));}function _5(_6,_7){var _8,_9,_,$,ba,bb,bc,bd,be,bf;E.set_CUI(A.New(E.CUI().Voice,E.CUI().Mic,_6,E.CUI().DebugMode,E.CUI().Caption));W.Equals(E.CUI().Voice,null)?E.initSpeech():void 0;W.Equals(E.CUI().Mic,null)?E.initMic(_4):void 0;return(_8=s.Blank(_7),_8!=null&&_8.$==1)?E.say("Tell me what you want me to do or ask me a question."):(_9=s.DebugOn(_7),_9!=null&&_9.$==1)?(E.set_CUI(A.New(E.CUI().Voice,E.CUI().Mic,E.CUI().Term,true,E.CUI().Caption)),E.say("Debug mode is now on.")):(_=s.DebugOff(_7),_!=null&&_.$==1)?(E.set_CUI(A.New(E.CUI().Voice,E.CUI().Mic,E.CUI().Term,false,E.CUI().Caption)),E.say("Debug mode is now off.")):(E.OpState()==null?false:E.OpState().$0.$==0)?E.say("I'm still working on understanding your last message."):(bb=s.QuickHello(_7),bb!=null&&bb.$==1?(ba=bb.$0,true):(bc=s.QuickHelp(_7),bc!=null&&bc.$==1?(ba=bc.$0,true):(bd=s.QuickPrograms(_7),bd!=null&&bd.$==1&&(ba=bd.$0,true))))?(E.debug((function(bg){return function(bh){return bg("Quick Text: "+G.p$7(bh)+".");};}(a.id))(ba)),be=E.pushCtx(ba),C.update(E.CUI(),E.Props(),E.Responses(),be)):E.CUI().Wait((bf=null,U.Delay(function(){E.set_OpState({$:1,$0:{$:0}});return U.Combine(U.Bind((new Y.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:781279769",[_7]),function(bg){var bh,bi,bj;bh=s.HasMeaning(bg);return bh!=null&&bh.$==1?(bi=bh.$0,(E.debug(((((O.Curried(function(bk,bl,bm,bn){return bk("Text: "+G.p(bl)+" "+G.p$3(bm)+" "+G.p$5(bn));},4))(a.id))(bi.get_Intent()))(bi.get_Trait()))(bi.get_Entities())),bj=E.pushCtx(bi),C.update(E.CUI(),E.Props(),E.Responses(),bj),U.Zero())):(E.debug("Text: Did not receive a response from the server."),d["Terminal.Echo'"](_6,"Sorry I did not understand what you said."),U.Zero());}),U.Delay(function(){E.set_OpState(null);return U.Zero();}));})));}F.CUI=A.New(null,null,null,false,false);F.MicState={$:0};F.OpState=null;F.Props=new _2.New$5();F.Context=[];F.Responses=[];F.container=i.Container;F.Main=new z({$:0,$0:function(_6){return function(_7){return _4(_6,_7);};},$1:[function(_6){return function(_7){return _5(_6,_7);};},(_3={},_3.name="Main",_3.greetings="Welcome to Selma. Enter 'hello my name is...(you)' to begin and initialize speech or help for more assistance.",_3.prompt=">",_3)]});};G.p$2=function(_3){return _3==null?"null":"Some "+L.prettyPrint(_3.$0);};G.p$1=function(_3){return"Intent ("+L.prettyPrint(_3.$0)+", "+G.p$2(_3.$1)+")";};G.p=function(_3){return _3==null?"null":"Some "+G.p$1(_3.$0);};G.p$4=function(_3){return"Trait ("+L.prettyPrint(_3.$0)+", "+L.prettyPrint(_3.$1)+")";};G.p$3=function(_3){return _3==null?"null":"Some "+G.p$4(_3.$0);};G.p$6=function(_3){return"Entity ("+L.prettyPrint(_3.$0)+", "+L.prettyPrint(_3.$1)+", "+G.p$2(_3.$2)+")";};G.p$5=function(_3){return _3==null?"null":"Some "+L.printList(function(_4){return G.p$6(_4);},_3.$0);};G.p$7=function(_3){return"Meaning ("+G.p(_3.$0)+", "+G.p$3(_3.$1)+", "+G.p$5(_3.$2)+")";};}());
