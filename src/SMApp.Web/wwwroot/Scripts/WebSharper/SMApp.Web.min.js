(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=c.TypingDNA=c.TypingDNA||{};i=h.SaveResponse=h.SaveResponse||{};j=h.UserResponse=h.UserResponse||{};k=h.VerifyResponse=h.VerifyResponse||{};l=c.Bs=c.Bs||{};m=b.NLU=b.NLU||{};n=m.Babelfy=m.Babelfy||{};o=n.ApiResponse=n.ApiResponse||{};p=n.TokenFragment=n.TokenFragment||{};q=n.CharFragment=n.CharFragment||{};r=m.Witai=m.Witai||{};s=r.Utterance=r.Utterance||{};t=r.Intent=r.Intent||{};u=r.Entity=r.Entity||{};v=r.Trait=r.Trait||{};w=r["Utterance'"]=r["Utterance'"]||{};x=r["Value'"]=r["Value'"]||{};y=m.QnAMaker=m.QnAMaker||{};z=y.ITSQuestion=y.ITSQuestion||{};A=y.ITSAnswerContext=y.ITSAnswerContext||{};B=y.ITSAnswer=y.ITSAnswer||{};C=y.ITSAnswers=y.ITSAnswers||{};D=c.NLG=c.NLG||{};E=a.StartupCode$SMApp_Web$NLG=a.StartupCode$SMApp_Web$NLG||{};F=c.NLU=c.NLU||{};G=F.Intent=F.Intent||{};H=F.Trait=F.Trait||{};I=F.Entity=F.Entity||{};J=F.Utterance=F.Utterance||{};K=F.Voice=F.Voice||{};L=K["Entity'"]=K["Entity'"]||{};M=F.Text=F.Text||{};N=M["Utterance'"]=M["Utterance'"]||{};O=M["Intent'"]=M["Intent'"]||{};P=M["Entity'"]=M["Entity'"]||{};Q=M["Trait'"]=M["Trait'"]||{};R=F.Domain=F.Domain||{};S=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};T=c.CUI=c.CUI||{};U=T.MicState=T.MicState||{};V=T.ClientState=T.ClientState||{};W=T.Interpreter=T.Interpreter||{};X=T.CUI=T.CUI||{};Y=c.Dialogue=c.Dialogue||{};Z=c.Question=c.Question||{};_0=c.QuestionType=c.QuestionType||{};_1=c.DialogueModule=c.DialogueModule||{};_2=c.Questions=c.Questions||{};_3=c.User=c.User||{};_4=a.StartupCode$SMApp_Web$User=a.StartupCode$SMApp_Web$User||{};_5=c.Symptoms=c.Symptoms||{};_6=a.StartupCode$SMApp_Web$Symptoms=a.StartupCode$SMApp_Web$Symptoms||{};_7=c.Main=c.Main||{};_8=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};_9=c.Client=c.Client||{};_=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};$=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};ba=a.GeneratedPrintf=a.GeneratedPrintf||{};bb=a.SweetAlert;bc=a.IntelliFactory;bd=bc&&bc.Runtime;be=a.WebSharper;bf=be&&be.Arrays;bg=be&&be.UI;bh=bg&&bg.Doc;bi=bg&&bg.AttrProxy;bj=bg&&bg.Client;bk=bj&&bj.Templates;bl=be&&be.Utils;bm=a.console;bn=a.jQuery;bo=be&&be.Strings;bp=be&&be.List;bq=be&&be.Seq;br=bg&&bg.AttrModule;bs=be&&be.Concurrency;bt=a.JSON;bu=be&&be.Random;bv=be&&be.Collections;bw=bv&&bv.Map;bx=be&&be.JavaScript;by=bx&&bx.Pervasives;bz=be&&be.ClientSideJson;bA=bz&&bz.Provider;bB=a.SDK;bC=be&&be.Unchecked;bD=be&&be.Operators;bE=be&&be.Remoting;bF=bE&&bE.AjaxRemotingProvider;bG=a.Wit;bH=a.document;bI=bv&&bv.Dictionary;d.getCameraCanvas=function(){return a.getCameraCanvas();};d.stopCamera=function(){return a.stopCamera();};d.startCamera=function(bJ,bK){return a.startCamera(bJ,bK);};d.speechSynthesis=function(){return a.speechSynthesis;};d.lastMicData=function(){return a.lastMicData;};d.Terminal=function(){return a.$("#term").terminal();};d.enableTerminal=function(){return a.$("#term").terminal().enable();};d.disableTerminal=function(){return a.$("#term").terminal().disable();};d.confirmQuestionBox=function(){bb.clickConfirm();};d.questionBox=function(bJ,bK,bL,bM,bN,bO){var bP,bQ,bR,bS,bT;bP=(bQ=bL==null?(bR={},bR.titleText=bJ,bR.text=bK,bR.icon="question",bR.html="<div></div>",bR.allowOutsideClick=false,bR):(bS=bL.$0[0],(bT={},bT.titleText=bJ,bT.text=bK,bT.icon="question",bT.width=a.String(bS),bT.html=(((bd.Curried3(function(bU,bV,bW){return bU("<div class=\"swal2-content-custom\" style=\"width:"+a.String(bV)+"px;height:"+a.String(bW)+"px\"></div>");}))(a.id))(bS))(bL.$0[1]),bT.allowOutsideClick=false,bT)),(d.Terminal().disable(),bM!=null?bM.$0(bQ):void 0,bb.fire(bQ)));bN!=null?bN.$0():void 0;bP.then(bO);};d.getDialogueBoxInput=function(){return bf.get(a.jQuery(".swal2-input").get(),0);};d.getDialogueBoxCanvas=function(){return bf.get(a.jQuery("canvas.swal2-content").get(),0);};d.getDialogueBoxContent=function(){return bf.get(a.jQuery("#swal2-content").get(),0).firstChild;};d.createDialogueBoxCanvas=function(){return d.createCanvas("camera","640","480",bf.get(a.jQuery("#swal2-content").get(),0).firstChild);};d.createCanvas=function(bJ,bK,bL,bM){var bN;bN=bh.Element("canvas",[d.eid(bJ),bi.Create("width",bK),bi.Create("height",bL)],[]);bk.LoadLocalTemplates("");bh.Run(bM,bN);return bM.firstChild;};d.elementHTML=function(bJ){return bJ.innerHTML;};d.createElement=function(bJ){var bK;bK=self.document.createElement("div");self.document.appendChild(bK);bk.LoadLocalTemplates("");bh.RunAppend(bK,bJ);};d.getContainer=function(){return bf.get(a.jQuery("#container").get(),0).firstChild;};d.container=function(bJ){return bh.Element("div",[d.cls("container")],bJ);};d.dindex=function(bJ){return bi.Create("data-index",a.String(bJ));};d.cls=function(bJ){return bi.Create("class",bJ);};d.eid=function(bJ){return bi.Create("id",bJ);};d.getMic=function(){return bf.get(a.jQuery("#microphone").get(),0);};d.terminalOutput=function(){return bf.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(bJ){return bJ.toLowerCase();};d.debug=function(bJ,bK){d.info((((bd.Curried3(function(bL,bM,bN){return bL("DEBUG: "+bl.toSafe(bM)+": "+bl.prettyPrint(bN));}))(a.id))(bJ.toUpperCase()))(bK));};d.error=function(bJ){bm.error(bJ);};d.info=function(bJ){bm.info(bJ);};d.jserror=function(bJ){bn.error(bJ);};d.toArray=function(bJ){return bf.map(a.id,bn.makeArray(bJ));};d["Terminal.EchoHtml'"]=function(bJ,bK){bJ.pause();bJ.echo(bK,d.rawOpt());bJ.resume();};d["Terminal.Echo'"]=function(bJ,bK){bJ.pause();bJ.echo(bK);bJ.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=bd.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(bJ){function bK(bL){return function(bM){var bN,bO,bP,bQ,bR,bS,bT;bO=bo.replicate(bL," ");switch(bM.$==0?bM.$1.$==1?bM.$1.$0.$==2?bM.$1.$1.$==0?(bN=[bM.$1.$0.$0,bM.$0],1):(bN=[bM.$1,bM.$0],2):(bN=[bM.$1,bM.$0],2):(bN=[bM.$1,bM.$0],2):bM.$==2?(bN=bM.$0,3):(bN=[bM.$0,bM.$1],0)){case 0:return bN[0]+"=\""+bN[1]+"\"";case 1:bP=bN[1];return bO+"<"+bP+">"+bN[0]+"</"+bP+">\r\n";case 2:bQ=bN[1];bR=bp.partition(function(bU){return bU.$==1;},bN[0]);bS=bR[1];bT=bR[0];return bS.$==0?bO+"<"+bQ+(bT.$===0?"":" "+bo.concat(" ",bp.ofSeq(bq.delay(function(){return bq.map(function(bU){return(bK(0))(bU);},bT);}))))+"/>\r\n":bO+"<"+bQ+(bT.$===0?"":" "+bo.concat(" ",bp.ofSeq(bq.delay(function(){return bq.map(function(bU){return(bK(0))(bU);},bT);}))))+">\r\n"+bo.concat("",bp.ofSeq(bq.delay(function(){return bq.map(function(bU){return(bK(bL+1))(bU);},bS);})))+bO+"</"+bQ+">\r\n";case 3:return bO+bN+"\r\n";}};}return(bK(0))(bJ);};f.alt=function(bJ){return new e({$:1,$0:"alt",$1:bJ});};f.src=function(bJ){return new e({$:1,$0:"src",$1:bJ});};f.cls=function(bJ){return new e({$:1,$0:"class",$1:bJ});};f.str=function(bJ){return e.toString(bJ);};f.op_PercentEquals=function(bJ,bK){return new e({$:1,$0:bJ,$1:bK});};f.op_Splice=function(bJ){var bK;return bp.ofArray([new e({$:2,$0:(bK=bJ,a.String(bK))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(bJ,bK){return new e({$:0,$0:bJ,$1:bK});};g.$cctor=function(){var bJ;g.$cctor=a.ignore;g.rawOpt=(bJ={},bJ.raw=true,bJ);g.html=function(bK){return f.elem("html",bK);};g.head=function(bK){return f.elem("head",bK);};g.title=function(bK){return f.elem("title",bK);};g.style=function(bK){return f.elem("style",bK);};g.body=function(bK){return f.elem("body",bK);};g.div=function(bK){return f.elem("div",bK);};g.br=function(bK){return f.elem("br",bK);};g.section=function(bK){return f.elem("section",bK);};g.span=function(bK){return f.elem("span",bK);};g.table=function(bK){return f.elem("table",bK);};g.thead=function(bK){return f.elem("thead",bK);};g.tbody=function(bK){return f.elem("tbody",bK);};g.tfoot=function(bK){return f.elem("tfoot",bK);};g.img=function(bK){return f.elem("img",bK);};g.map=function(bK){return f.elem("map",bK);};g.area=function(bK){return f.elem("area",bK);};g.p=function(bK){return f.elem("p",bK);};g.a=function(bK){return f.elem("a",bK);};g.tr=function(bK){return f.elem("tr",bK);};g.td=function(bK){return f.elem("td",bK);};g.th=function(bK){return f.elem("th",bK);};g.ul=function(bK){return f.elem("ul",bK);};g.li=function(bK){return f.elem("li",bK);};g.h1=function(bK){return f.elem("h1",bK);};g.h2=function(bK){return f.elem("h1",bK);};g.h3=function(bK){return f.elem("h1",bK);};g.h4=function(bK){return f.elem("h1",bK);};g.strong=function(bK){return f.elem("strong",bK);};};i.New=function(bJ,bK,bL,bM){return{name:bJ,message:bK,message_code:bL,status:bM};};j.New=function(bJ,bK,bL,bM,bN){return{message:bJ,message_code:bK,success:bL,count:bM,status:bN};};k.New=function(bJ,bK,bL,bM,bN,bO){return{message:bJ,message_code:bK,success:bL,result:bM,score:bN,confidence:bO};};h.getSameTextTypingPattern=function(bJ,bK){var bL;return bK.getTypingPattern((bL={type:1},bL.text=bJ,bL.caseSensitive=true,bL));};l.Radio=function(bJ,bK,bL,bM,bN){return bh.Element("div",new bp.T({$:1,$0:d.cls("radio"),$1:bK}),[bh.Element("label",bM,[bh.Radio(bN,true,bL),bh.TextNode(bJ)])]);};l.checkbox=function(bJ,bK,bL,bM,bN){return bh.Element("div",new bp.T({$:1,$0:d.cls("checkbox"),$1:bK}),[bh.Element("label",bM,[bh.CheckBox(bN,bL),bh.TextNode(bJ)])]);};l.textArea=function(bJ,bK,bL,bM,bN){return bh.Element("div",new bp.T({$:1,$0:d.cls("form-group"),$1:bK}),[bh.Element("label",bM,[bh.TextNode(bJ)]),bh.InputArea(new bp.T({$:1,$0:d.cls("form-control"),$1:bN}),bL)]);};l.inputPassword=function(bJ,bK,bL,bM,bN){return bh.Element("div",new bp.T({$:1,$0:d.cls("form-group"),$1:bK}),[bh.Element("label",bM,[bh.TextNode(bJ)]),bh.PasswordBox(new bp.T({$:1,$0:d.cls("form-control"),$1:bN}),bL)]);};l.input=function(bJ,bK,bL,bM,bN){return bh.Element("div",new bp.T({$:1,$0:d.cls("form-group"),$1:bK}),[bh.Element("label",bM,[bh.TextNode(bJ)]),bh.Input([d.cls("form-control"),bN],bL)]);};l.btnSecondary=function(bJ,bK,bL){return bh.Element("button",[d.eid(bJ),d.cls("btn btn-secondary"),br.Handler("click",bL)],[bh.TextNode(bK)]);};l.btnPrimary=function(bJ,bK,bL){return bh.Element("button",[d.eid(bJ),d.cls("btn btn-primary"),br.Handler("click",bL)],[bh.TextNode(bK)]);};o.New=function(bJ,bK,bL,bM,bN,bO,bP,bQ,bR){return{tokenFragment:bJ,charFragment:bK,babelSynsetID:bL,DBpediaURL:bM,BabelNetURL:bN,score:bO,cohrenceScore:bP,globalScore:bQ,source:bR};};p.New=function(bJ,bK){return{start:bJ,end:bK};};q.New=function(bJ,bK){return{start:bJ,end:bK};};n.disambiguate=function(bJ){function bK(bL,bM){var bN;bn.ajax((bN={},bN.url=(function(bO){return function(bP){return bO("https://babelfy.io/v1/disambiguate?text="+bl.toSafe(bP)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bJ),bN.type="GET",bN.success=function(bO){return bL(bO);},bN.error=function(bO){return bM(new a.Error(bO.responseText));},bN));}return bs.FromContinuations(function(bL,bM,bN){return bK.apply(null,[bL,bM,bN]);});};s.New=function(bJ,bK,bL,bM){return{text:bJ,intents:bK,entities:bL,traits:bM};};t.New=function(bJ,bK,bL){return{id:bJ,name:bK,confidence:bL};};u.New=function(bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT){return{id:bJ,name:bK,role:bL,start:bM,end:bN,body:bO,confidence:bP,entities:bQ,suggested:bR,value:bS,type:bT};};v.New=function(bJ,bK,bL){return{id:bJ,value:bK,confidence:bL};};w.New=function(bJ){return{intent:bJ};};x.New=function(bJ){return{value:bJ};};r.getMeaning2=function(bJ,bK){function bL(bM,bN){var bO;bn.ajax((bO={},bO.url=(function(bP){return function(bQ){return bP("https://api.wit.ai/message?q="+bl.toSafe(bQ));};}(a.id))(bK),bO.type="GET",bO.beforeSend=function(bP){return bP.setRequestHeader("Authorization","Bearer "+bJ);},bO.success=function(bP){return bM(bP);},bO.error=function(bP){return bN(new a.Error(bP.responseText));},bO));}return bs.FromContinuations(function(bM,bN,bO){return bL.apply(null,[bM,bN,bO]);});};r.getMeaning=function(bJ,bK,bL,bM){var bN;bn.ajax((bN={},bN.url=(function(bO){return function(bP){return bO("https://api.wit.ai/message?q="+bl.toSafe(bP));};}(a.id))(bK),bN.type="GET",bN.beforeSend=function(bO){return bO.setRequestHeader("Authorization","Bearer "+bJ);},bN.success=bL,bN.error=bM,bN));};z.New=function(bJ){return{question:bJ};};A.New=function(bJ,bK){return{isContextOnly:bJ,prompts:bK};};B.New=function(bJ,bK,bL,bM,bN,bO,bP){return{questions:bJ,answer:bK,score:bL,id:bM,source:bN,metadata:bO,context:bP};};C.New=function(bJ){return{answers:bJ};};y.getAnswer=function(bJ){function bK(bL,bM){var bN;bn.ajax((bN={},bN.url="https://lerna.azurewebsites.net/qnamaker/knowledgebases/13a6a026-942b-4612-a8cb-654086ec76ee/generateAnswer",bN.type="POST",bN.beforeSend=function(bO){return bO.setRequestHeader("Authorization","EndpointKey e5a55563-b1b0-4343-8796-bda5a0509385");},bN.contentType="application/json",bN.dataType="json",bN.data=bt.stringify(z.New(bJ)),bN.success=function(bO){return bL(bO);},bN.error=function(bO){return bM(new a.Error(bO.responseText));},bN));}return bs.FromContinuations(function(bL,bM,bN){return bK.apply(null,[bL,bM,bN]);});};D.waitAddPhrases=function(){E.$cctor();return E.waitAddPhrases;};D.waitRetrievePhrases=function(){E.$cctor();return E.waitRetrievePhrases;};D.helpPhrases=function(){E.$cctor();return E.helpPhrases;};D.helloUserPhrases=function(){E.$cctor();return E.helloUserPhrases;};D.helloPhrases=function(){E.$cctor();return E.helloPhrases;};D["getRandomPhrase'"]=function(bJ){return D.replace_tok("$0","",bq.nth(D.rng().Next(0,bJ.get_Length()),bJ));};D.getRandomPhrase=function(bJ,bK){return D.replace_tok("$0",bK,bq.nth(D.rng().Next(0,bJ.get_Length()),bJ));};D.replace_tok=function(bJ,bK,bL){return bo.Replace(bL,bJ,bK);};D.rng=function(){E.$cctor();return E.rng;};E.$cctor=function(){E.$cctor=a.ignore;E.rng=new bu.New();E.helloPhrases=bp.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);E.helloUserPhrases=bp.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);E.helpPhrases=bp.ofArray(["What can I help you with $0?"]);E.waitRetrievePhrases=bp.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);E.waitAddPhrases=bp.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};G=F.Intent=bd.Class({toString:function(){return(((bd.Curried3(function(bJ,bK,bL){return bJ("Intent("+bl.toSafe(bK)+", "+$.p$2(bL)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);H=F.Trait=bd.Class({toString:function(){return(((bd.Curried3(function(bJ,bK,bL){return bJ("Trait("+bl.toSafe(bK)+", "+bl.prettyPrint(bL)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,H);I=F.Entity=bd.Class({toString:function(){return(((((bd.Curried(function(bJ,bK,bL,bM,bN){return bJ("Entity("+bl.toSafe(bK)+", "+bl.toSafe(bL)+", "+bl.toSafe(bM)+", "+$.p$2(bN)+")");},5))(a.id))(this.get_Name()))(this.get_Role()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$3;},get_Value:function(){return this.$2;},get_Role:function(){return this.$1;},get_Name:function(){return this.$0;}},null,I);J=F.Utterance=bd.Class({toString:function(){return((((bd.Curried(function(bJ,bK,bL,bM){return bJ($.p(bK)+" "+$.p$3(bL)+" "+$.p$5(bM));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bJ;bJ=this.$3;return bJ!=null?{$:1,$0:bp.sortBy(function(bK){return bK.get_Name();},bJ.$0)}:null;},get_Traits:function(){var bJ;bJ=this.$2;return bJ!=null?{$:1,$0:bp.sortBy(function(bK){return bK.get_Name();},bJ.$0)}:null;},get_Intent:function(){return this.$1;},get_Text:function(){return this.$0;}},null,J);L.New=function(bJ,bK,bL,bM,bN){return{body:bJ,end:bK,start:bL,suggested:bM,value:bN};};K["Intent'"]=function(bJ,bK){return!(bK.intent==null)?{$:1,$0:new G({$:0,$0:d.toLower(bK.intent.value),$1:null})}:null;};K["Trait'"]=function(bJ){return!(bJ.domain==null)?{$:1,$0:new H({$:0,$0:"domain",$1:d.toLower(bJ.domain.value),$2:null})}:!(bJ.dialogue_act==null)?{$:1,$0:new H({$:0,$0:"dialogue_act",$1:d.toLower(bJ.dialogue_act.value),$2:null})}:null;};K["Entity'$1"]=function(bJ){return!(bJ.contact==null)?{$:1,$0:new I({$:0,$0:"contact",$1:"",$2:d.toLower(bJ.contact.value),$3:null})}:null;};N=M["Utterance'"]=bd.Class({get_TopIntent:function(){return bp.head(bp.sortBy(function(bJ){return bJ.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$3;},get_Entities:function(){return this.$2;},get_Intents:function(){return this.$1;},get_Text:function(){return this.$0;}},null,N);O=M["Intent'"]=bd.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,O);P=M["Entity'"]=bd.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,P);Q=M["Trait'"]=bd.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,Q);M.HasUtterance=function(bJ){var bK,bL,bM,bN,bO,bP;return bJ!=null&&bJ.$==1&&(bJ.$0.$2.get_Length()>0&&(bK=[bJ.$0.$2,bJ.$0.$1,bJ,bJ.$0.$0,bJ.$0.$3],true))?(bL=bK[0],(bM=bK[2],(bN=bK[4],(bO=bK[1].$==0?null:{$:1,$0:new G({$:0,$0:bM.$0.get_TopIntent().get_Name(),$1:{$:1,$0:bM.$0.get_TopIntent().get_Confidence()}})},(bP=bL.$==0?null:{$:1,$0:bp.map(function(bQ){return new I({$:0,$0:bQ.get_Name(),$1:d.toLower(bQ.get_Role()),$2:bQ.get_Value(),$3:{$:1,$0:bQ.get_Confidence()}});},bp.filter(function(bQ){return bQ.get_Confidence()>M.entityConfidenceThreshold();},bL))},{$:1,$0:new J({$:0,$0:bK[3],$1:bO,$2:bN.$==0?null:{$:1,$0:bp.map(function(bQ){return new H({$:0,$0:d.toLower(bQ.get_Name()),$1:bQ.get_Value(),$2:{$:1,$0:bQ.get_Confidence()}});},bp.filter(function(bQ){return bQ.get_Confidence()>M.entityConfidenceThreshold();},bN))},$3:bP})}))))):null;};M.entityConfidenceThreshold=function(){S.$cctor();return S.entityConfidenceThreshold;};M.set_entityConfidenceThreshold=function(bJ){S.$cctor();S.entityConfidenceThreshold=bJ;};M.intentConfidenceThreshold=function(){S.$cctor();return S.intentConfidenceThreshold;};M.set_intentConfidenceThreshold=function(bJ){S.$cctor();S.intentConfidenceThreshold=bJ;};M.getUtterance2=function(bJ){var bK;bK=null;return bs.Delay(function(){return bs.Bind(r.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bJ),function(bL){d.debug("NLU",(function(bM){return function(bN){return bM("Wit.ai returned "+ba.p(bN)+" ");};}(a.id))(bL));return bs.Return(new N({$:0,$0:bJ,$1:bp.ofArray(bf.map(function(bM){return new O({$:0,$0:bM.name,$1:bM.confidence});},bL.intents)),$2:bp.map(function(bM){return new P({$:0,$0:bM.name,$1:bM.confidence,$2:bM.role,$3:bM.value});},bp.ofSeq(bq.concat(bq.map(function(bM){return bM[1];},bw.ToSeq(bL.entities))))),$3:bp.ofSeq(bq.map(function(bM){var bN;bN=bM[1];return new Q({$:0,$0:bM[0],$1:bf.get(bN,0).confidence,$2:bf.get(bN,0).value});},bw.ToSeq(bL.traits)))}));});});};M.getUtterance=function(bJ,bK){r.getMeaning("OOGDHEQL7JZRQASXN2N2GHFUKGO3SCNV",bJ,function(bL){var bM,bN;d.debug("NLU",(function(bO){return function(bP){return bO("Wit.ai returned: "+bl.prettyPrint(bP));};}(a.id))(bL));bM=!(bL.intents==null)?bp.ofArray(bf.map(function(bO){return new O({$:0,$0:bO.name,$1:bO.confidence});},bL.intents)):bp.T.Empty;bN=!(bL.traits==null)?bp.ofSeq(bq.concat(bp.map(function(bO){return bf.map(function(bP){return new Q({$:0,$0:bO,$1:bP.confidence,$2:bP.value});},by.GetJS(bL.traits,[bO]));},bp.filter(function(bO){return!(by.GetJS(bL.traits,[bO])==null);},M.trait_types())))):bp.T.Empty;return bK({$:1,$0:new N({$:0,$0:bJ,$1:bM,$2:!(bL.entities==null)?bp.ofSeq(bq.concat(bp.map(function(bO){return bf.map(function(bP){return new P({$:0,$0:bP.name,$1:bP.confidence,$2:bP.role,$3:bP.value});},by.GetJS(bL.entities,[bO]));},bp.filter(function(bO){return!(by.GetJS(bL.entities,[bO])==null);},M.entity_types())))):bp.T.Empty,$3:bN})});},function(bL,bM,bN){d.error((((bd.Curried3(function(bO,bP,bQ){return bO("Wit.ai returned: "+bl.prettyPrint(bP)+" "+bl.prettyPrint(bQ));}))(a.id))(bM))(bN));return bK(null);});};M.trait_types=function(){S.$cctor();return S.trait_types;};M.entity_types=function(){S.$cctor();return S.entity_types;};M.QuickNumber=function(bJ){var bK,bL,bM;return(bL=M.One(bJ),bL!=null&&bL.$==1?(bK=bL.$0,true):(bM=M.Two(bJ),bM!=null&&bM.$==1&&(bK=bM.$0,true)))?{$:1,$0:bK}:null;};M.Three=function(bJ){var bK;return bJ==="3"||bJ==="three"?{$:1,$0:new J({$:0,$0:"three",$1:{$:1,$0:new G({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bp.ofArray([new I({$:0,$0:"wit/ordinal",$1:"",$2:"three",$3:{$:1,$0:1}})])}})}:null;};M.Two=function(bJ){var bK;return bJ==="2"||bJ==="two"?{$:1,$0:new J({$:0,$0:"two",$1:{$:1,$0:new G({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bp.ofArray([new I({$:0,$0:"wit/ordinal",$1:"",$2:"two",$3:{$:1,$0:1}})])}})}:null;};M.One=function(bJ){var bK;return bJ==="1"||bJ==="one"?{$:1,$0:new J({$:0,$0:"one",$1:{$:1,$0:new G({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bp.ofArray([new I({$:0,$0:"wit/ordinal",$1:"",$2:"one",$3:{$:1,$0:1}})])}})}:null;};M.QuickNo=function(bJ){var bK;return bJ==="no"||(bJ==="nope"||(bJ==="no way"||(bJ==="nah"||(bJ==="don't do it"||bJ==="stop"))))?{$:1,$0:new J({$:0,$0:"no",$1:{$:1,$0:new G({$:0,$0:"reject",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};M.QuickYes=function(bJ){var bK;return bJ==="yes"||(bJ==="ok"||(bJ==="sure"||(bJ==="yeah"||(bJ==="yep"||(bJ==="uh huh"||(bJ==="go ahead"||bJ==="go"))))))?{$:1,$0:new J({$:0,$0:"yes",$1:{$:1,$0:new G({$:0,$0:"verify",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};M.QuickHelp=function(bJ){var bK;return bJ==="help"||(bJ==="help me"||(bJ==="what's this?"||bJ==="huh"))?{$:1,$0:new J({$:0,$0:"help",$1:{$:1,$0:new G({$:0,$0:"help",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};M.QuickHello=function(bJ){var bK;return bJ==="hello"||(bJ==="hey"||(bJ==="yo"||bJ==="hi"))?{$:1,$0:new J({$:0,$0:"hello",$1:{$:1,$0:new G({$:0,$0:"greet",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};M.Voices=function(bJ){return bJ==="voices"?{$:1,$0:null}:null;};M.Debug=function(bJ){return bJ==="debug"?{$:1,$0:null}:null;};M.Blank=function(bJ){return bJ===""?{$:1,$0:null}:null;};R.Study=function(bJ){return bJ.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};F.StrA=function(bJ){if(bJ!=null&&bJ.$==1)try{return{$:1,$0:((bA.DecodeArray(bA.Id()))())(bt.parse(bJ.$0))};}catch(bK){return null;}else return null;};F.PStr=function(bJ){var bK;return bJ!=null&&bJ.$==1&&(typeof bJ.$0=="string"&&(bK=bJ.$0,true))?{$:1,$0:bK}:null;};F.No=function(bJ){var bK,bL;return(bL=F.Intent$1("reject",bJ),bL!=null&&bL.$==1&&(bL.$0[0]==null&&(bL.$0[1]==null&&(bK=bJ,true))))?{$:1,$0:bK}:null;};F.Yes=function(bJ){var bK,bL;return(bL=F.Intent$1("verify",bJ),bL!=null&&bL.$==1&&(bL.$0[0]==null&&(bL.$0[1]==null&&(bK=bJ,true))))?{$:1,$0:bK}:null;};F.EntityManyofMany=function(bJ,bK){return{$:1,$0:bw.OfArray(bf.ofSeq(bp.map(function(bL){return bp.exists(function(bM){return bM.get_Role()===bL;},bK)?[bL,{$:1,$0:bp.filter(function(bM){return bM.get_Role()===bL;},bK)}]:[bL,null];},bJ)))};};F.EntityManyOf1=function(bJ,bK){var bL;return bK!=null&&bK.$==1&&(bp.exists(function(bM){return bM.get_Role()===bJ;},bK.$0)&&(bL=bK.$0,true))?{$:1,$0:bp.filter(function(bM){return bM.get_Role()===bJ;},bL)}:null;};F.Entity1OfAny=function(bJ,bK){var bL;return bK!=null&&bK.$==1&&(bp.exists(function(bM){return bM.get_Role()===bJ;},bK.$0)&&(bL=bK.$0,true))?{$:1,$0:bp.head(bp.sortBy(function(bM){return bM.get_Role();},bp.filter(function(bM){return bM.get_Role()===bJ;},bL)))}:null;};F.Entity1Of1=function(bJ,bK){var bL,bM;return bK!=null&&bK.$==1&&(bK.$0.$==1&&(bK.$0.$1.$==0&&((bM=bK.$0.$0,bM.get_Role()===bJ||bM.get_Name()===bJ)&&(bL=bK.$0.$0,true))))?{$:1,$0:bL}:null;};F.Intent$1=function(bJ,bK){return bK.get_Intent()!=null&&bK.get_Intent().$0.get_Name()===bJ?{$:1,$0:[bK.get_Traits(),bK.get_Entities()]}:null;};S.$cctor=function(){S.$cctor=a.ignore;S.entity_types=bp.ofArray(["wit$contact:name","wit$datetime:datetime","term:subject","term:object","term:verb"]);S.trait_types=bp.ofArray(["domain","dialogue_act"]);S.intentConfidenceThreshold=0.85;S.entityConfidenceThreshold=0.85;};U.MicReady={$:5};U.MicAudioEnd={$:4};U.MicAudioStart={$:3};U.MicDisconnected={$:2};U.MicConnecting={$:1};U.MicNotInitialized={$:0};V.ClientUnderstand={$:2};V.ClientReady={$:1};V.ClientNotInitialzed={$:0};W=T.Interpreter=bd.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,W);X=T.CUI=bd.Class({GetSameTextTypingPattern:function(bJ,bK){var bL,bM;return this.TypingDNA.getTypingPattern(bK==null?(bL={type:1},bL.text=bJ,bL.caseSensitive=false,bL):(bM={type:1},bM.text=bJ,bM.caseSensitive=false,bM.targetId=bK.$0,bM));},MonitorTypingPattern:function(bJ){this.TypingDNA.reset();bJ!=null?this.TypingDNA.addTarget(bJ.$0):void 0;this.TypingDNA.start();},SayVoices:function(){var bJ,bK,bL;bJ=this;bK=a.speechSynthesis.getVoices();!(bK==null)?(bL=d.toArray(bK),bJ.Say((function(bM){return function(bN){return bM("There are currently "+a.String(bN)+" voices installed on this computer or device.");};}(a.id))(bf.length(bL))),bf.iteri(function(bM,bN){return bJ.Say(((((bd.Curried(function(bO,bP,bQ,bR){return bO("Voice "+a.String(bP)+". Name: "+bl.toSafe(bQ)+", Local: "+bl.prettyPrint(bR)+".");},4))(a.id))(bM))(bN.name))(bN.localService));},bL)):void 0;},Wait:function(bJ){this.Wait$1(function(){bs.Start(bJ,null);});},Wait$1:function(bJ){this["Echo'"]("please wait...");this.Term.pause();bJ();this.Term.resume();},sayRandom:function(bJ,bK){this.Say(D.getRandomPhrase(bJ,bK));},SayAngry:function(bJ){var bK,bL;bK=this;bs.Start((bL=null,bs.Delay(function(){return bs.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bB.chime(),bs.Zero()):bs.Zero(),bs.Delay(function(){a.addMessage(bK.Avatar,bJ,"","");bK.Avatar.processMessages(0);return bs.Zero();}));})),null);},SayDoc:function(bJ){var bK,bL,bM;bK=bf.get(bn(".terminal-output").get(),0).childNodes.length;bL=bh.Element("div",[d.cls("terminal-command"),d.dindex(bK+1)],[bJ]);bM=d.terminalOutput();bk.LoadLocalTemplates("");bh.RunAppend(bM,bL);},Say:function(bJ){var bK,bL;bK=this;bs.Start((bL=null,bs.Delay(function(){return bs.Combine(a.speechSynthesis.speaking?(bB.chime(),bs.Zero()):bs.Zero(),bs.Delay(function(){bK.Avatar.addMessage(bJ);bK.Avatar.processMessages(0);return bs.Zero();}));})),null);},Debug:function(bJ,bK){d.debug(bJ,bK);},"EchoHtml'":function(bJ){var bK,bL;bK=(bL={},bL.raw=true,bL);this.Term.disable();this.Term.echo(bJ,bK);this.Term.enable();},"Echo'":function(bJ){this.Term.disable();this.Term.echo(bJ);this.Term.enable();}},null,X);X.New=function(bJ,bK,bL,bM,bN,bO,bP){return new X({Voice:bJ,Mic:bK,Term:bL,Avatar:bM,Caption:bN,TypingDNA:bO,AudioHandlers:bP});};Y=c.Dialogue=bd.Class({get_Utterances:function(){return this.$4;},get_Output:function(){return this.$3;},get_DialogueQuestions:function(){return this.$2;},get_Props:function(){return this.$1;},get_Cui:function(){return this.$0;}},null,Y);Z=c.Question=bd.Class({toString:function(){return((((bd.Curried(function(bJ,bK,bL,bM){return bJ("Name: "+bl.toSafe(bK)+" Module: "+bl.toSafe(bL)+" Type: "+$.p$8(bM)+" ");},4))(a.id))(this.get_Name()))(this.get_Module()))(this.get_Type());},get_Target:function(){return this.$4;},get_Params:function(){return this.$3;},get_Type:function(){return this.$2;},get_Module:function(){return this.$1;},get_Name:function(){return this.$0;}},null,Z);_0.ConceptCompletion={$:3};_0.Disjunctive={$:2};_0.Verification={$:1};_1["Response'_"]=function(bJ,bK,bL){var bM,bN,bO,bP,bQ,bR,bS,bT;return(bN=_1.PropNotSet_(bJ,"user",bL),bN!=null&&bN.$==1?(bO=_1.Form(bJ,bK,bN.$0),bO!=null&&bO.$==1?(bM=bO.$0,true):(bP=_1.PropNotSet_(bJ,"user",bL),bP!=null&&bP.$==1&&(bQ=_1.NotForm(bJ,bK,bP.$0),bQ!=null&&bQ.$==1&&(bM=bQ.$0,true)))):(bR=_1.PropNotSet_(bJ,"user",bL),bR!=null&&bR.$==1&&(bS=_1.NotForm(bJ,bK,bR.$0),bS!=null&&bS.$==1&&(bM=bS.$0,true))))?(bT=_1.have(bJ,bK)?{$:1,$0:_1.prop(bJ,bK)}:null,bM.get_Text()!==""?{$:1,$0:[bM,{$:1,$0:bM.get_Text()},bT]}:{$:1,$0:[bM,null,bT]}):null;};_1.Response_=function(bJ,bK,bL){var bM,bN,bO,bP,bQ,bR,bS,bT;return(bN=_1.PropSet_(bJ,"user",bL),bN!=null&&bN.$==1?(bO=_1.Form(bJ,bK,bN.$0),bO!=null&&bO.$==1?(bM=bO.$0,true):(bP=_1.PropSet_(bJ,"user",bL),bP!=null&&bP.$==1&&(bQ=_1.NotForm(bJ,bK,bP.$0),bQ!=null&&bQ.$==1&&(bM=bQ.$0,true)))):(bR=_1.PropSet_(bJ,"user",bL),bR!=null&&bR.$==1&&(bS=_1.NotForm(bJ,bK,bR.$0),bS!=null&&bS.$==1&&(bM=bS.$0,true))))?(bT=_1.have(bJ,bK)?{$:1,$0:_1.prop(bJ,bK)}:null,bM.get_Text()!==""?{$:1,$0:[bM,{$:1,$0:bM.get_Text()},bT]}:{$:1,$0:[bM,null,bT]}):null;};_1.NotForm=function(bJ,bK,bL){return bJ.get_DialogueQuestions().length>0&&(bJ.get_DialogueQuestions())[0].get_Name()===bK&&bL.get_Text()!==""?{$:1,$0:bL}:null;};_1.Form=function(bJ,bK,bL){return bJ.get_DialogueQuestions().length>0&&(bJ.get_DialogueQuestions())[0].get_Name()===bK&&bL.get_Intent()!=null&&bL.get_Intent().$0.get_Name()===bK&&bC.Equals(bL.get_Intent().$0.get_Confidence(),{$:1,$0:1})&&bC.Equals(bL.get_Traits(),null)&&bC.Equals(bL.get_Entities(),null)?{$:1,$0:bL}:null;};_1["User'_"]=function(bJ,bK){var bL,bM;return(bM=_1.PropNotSet_(bJ,"user",bK),bM!=null&&bM.$==1&&(bJ.get_DialogueQuestions().length===0&&(bL=bM.$0,true)))?{$:1,$0:bL}:null;};_1.User_=function(bJ,bK){var bL,bM;return(bM=_1.PropSet_(bJ,"user",bK),bM!=null&&bM.$==1&&(bJ.get_DialogueQuestions().length===0&&(bL=bM.$0,true)))?{$:1,$0:bL}:null;};_1.PropNotSet_=function(bJ,bK,bL){return!_1.have(bJ,bK)?{$:1,$0:bL}:null;};_1.PropSet_=function(bJ,bK,bL){return _1.have(bJ,bK)?{$:1,$0:bL}:null;};_1.Agenda_=function(bJ,bK,bL,bM){return bJ.get_DialogueQuestions().length>0&&(bJ.get_DialogueQuestions())[0].get_Module()===bL?{$:1,$0:null}:null;};_1.debugInterpreterEnd=function(bJ,bK,bL){bK(((((bd.Curried(function(bM,bN,bO,bP){return bM(bl.toSafe(bN)+" ending utterances:"+bl.prettyPrint(bO)+", questions: "+bl.prettyPrint(bP)+".");},4))(a.id))(bL))(bJ.get_Utterances()))(bJ.get_DialogueQuestions()));};_1.debugInterpreterStart=function(bJ,bK,bL){bK(((((bd.Curried(function(bM,bN,bO,bP){return bM(bl.toSafe(bN)+" starting utterances:"+bl.prettyPrint(bO)+", questions: "+bl.prettyPrint(bP)+".");},4))(a.id))(bL))(bJ.get_Utterances()))(bJ.get_DialogueQuestions()));};_1.frame=function(bJ){return bp.ofSeq(bq.take(bJ.length>=5?5:bJ.length,bJ));};_1.didNotUnderstand=function(bJ,bK,bL){bK((function(bM){return function(bN){return bM(bl.toSafe(bN)+" interpreter did not understand utterance.");};}(a.id))(bL));_1.popu(bJ,bK);_1.say(bJ,"Sorry I didn't understand what you meant.");};_1.endt=function(bJ,bK,bL,bM){_1.popu(bJ,bK);_1.popq(bJ,bK);_1.have(bJ,bL)?_1.remove(bJ,bK,bL):void 0;bK((function(bN){return function(bO){return bN("End turn "+bl.toSafe(bO)+".");};}(a.id))(bL));bM();};_1.cancel=function(bJ,bK,bL){var bM;bM=(bJ.get_DialogueQuestions())[0];bM.get_Name()!==bL?(((bd.Curried3(function(bN,bO,bP){return bN($.p$9(bO)+" at the top of the stack does not have the name "+bl.toSafe(bP)+".");}))(bD.FailWith))(bM))(bL):void 0;_1.popq(bJ,bK);bK((function(bN){return function(bO){return bN("Cancel "+$.p$9(bO)+".");};}(a.id))(bM));};_1.trigger=function(bJ,bK,bL,bM,bN){_1.pushu(bJ,bK,new J({$:0,$0:bt.stringify(bN),$1:{$:1,$0:new G({$:0,$0:bM,$1:{$:1,$0:1}})},$2:null,$3:null}));bL(bJ);};_1.handle=function(bJ,bK,bL,bM){_1.popu(bJ,bK);bK((function(bN){return function(bO){return bN("Handle utterance "+bl.toSafe(bO)+".");};}(a.id))(bL));bM();};_1.dispatch=function(bJ,bK,bL,bM){bK(((((bd.Curried(function(bN,bO,bP,bQ){return bN("Dispatch to module "+bl.toSafe(bO)+" utterances: "+bl.prettyPrint(bP)+" questions: "+bl.prettyPrint(bQ)+".");},4))(a.id))(bL))(bJ.get_Utterances()))(bJ.get_DialogueQuestions()));bM(bJ);};_1.popq=function(bJ,bK){var bL;bL=bJ.get_DialogueQuestions().shift();bK((function(bM){return function(bN){return bM("Pop "+$.p$9(bN)+".");};}(a.id))(bL));};_1.pushq=function(bJ,bK,bL){bJ.get_DialogueQuestions().unshift(bL);bK((function(bM){return function(bN){return bM("Push "+$.p$9(bN)+".");};}(a.id))(bL));};_1.popu=function(bJ,bK){var bL;bL=bJ.get_Utterances().shift();bK((function(bM){return function(bN){return bM("Pop "+$.p$7(bN)+".");};}(a.id))(bL));};_1.pushu=function(bJ,bK,bL){bK((function(bM){return function(bN){return bM("Push "+$.p$7(bN)+".");};}(a.id))(bL));bJ.get_Utterances().unshift(bL);};_1.remove=function(bJ,bK,bL){bK((function(bM){return function(bN){return bM("Remove property "+bl.toSafe(bN)+".");};}(a.id))(bL));bJ.get_Props().Remove(bL);};_1.add=function(bJ,bK,bL,bM){bJ.get_Props().Add(bL,bM);bK((((bd.Curried3(function(bN,bO,bP){return bN("Add property "+bl.toSafe(bO)+":"+bl.prettyPrint(bP)+".");}))(a.id))(bL))(bM));};_1.prop=function(bJ,bK){return bJ.get_Props().ContainsKey(bK)?bJ.get_Props().get_Item(bK):(function(bL){return function(bM){return bL("The "+bl.toSafe(bM)+" dialogue property does not exist.");};}(bD.FailWith))(bK);};_1.have=function(bJ,bK){return bJ.get_Props().ContainsKey(bK);};_1["sayRandom'"]=function(bJ,bK){_1.sayRandom(bJ,bK,"");};_1.sayRandom=function(bJ,bK,bL){var bM;bM=D.getRandomPhrase(bK,bL);bJ.get_Output().unshift(bM);bJ.get_Cui().Say(bM);};_1.say=function(bJ,bK){bJ.get_Output().unshift(bK);_1["say'"](bJ,bK);};_1["say'"]=function(bJ,bK){bJ.get_Cui().Say(bK);};_1.echo=function(bJ,bK){(bJ.get_Cui())["EchoHtml'"](bK);};_2.ask=function(bJ,bK,bL){var bM,bN,bO,bP,bQ,bR;function bS(bU){_1.say(bJ,bU);}function bT(){function bU(bV){bV.confirmButtonClass="invisible";bV.showCancelButton=true;}d.questionBox("Biometric Authentication","",{$:1,$0:[640,480]},{$:1,$0:function(bV){bV.input="text";bV.showCancelButton=true;bV.confirmButtonText="Ok";}},{$:1,$0:function(){var bV;bJ.get_Cui().MonitorTypingPattern(null);bV=d.createDialogueBoxCanvas();d.startCamera(self.document.body,bV);}},function(bV){var bW,bX,bY;bV.isConfirmed?(bW=bV.value,bX=d.getCameraCanvas().toDataURL(),bK((function(bZ){return function(b0){return bZ("User image is "+bl.toSafe(b0)+"...");};}(a.id))(bo.Substring(bX,0,10))),d.stopCamera(),bY=bJ.get_Cui().GetSameTextTypingPattern(bR,null),bK((((bd.Curried3(function(bZ,b0,b1){return bZ("User entered typing pattern "+bl.toSafe(b0)+" for text "+bl.toSafe(b1));}))(a.id))(bY))(bW)),bW.toLowerCase()!==bR.toLowerCase()?(bS("Sorry you did not enter the passphrase correctly. Please try again."),bT()):d.questionBox("Biometric Authentication","",null,{$:1,$0:bU},{$:1,$0:function(){var bZ;bZ=[bN,bY,bX];d.getDialogueBoxContent().appendChild(d.getMic());bJ.get_Cui().AudioHandlers.Add("VoiceAuthentication",function(b0){var b1;b1=bt.stringify(((bA.Id())())(b0));d.confirmQuestionBox();bO(bZ.concat([b1]));});}},function(bZ){if(!bZ.isConfirmed){bJ.get_Cui().AudioHandlers.Remove("VoiceAuthentication");bS("OK but you must login for me to help you.");}})):bS("OK but you must login for me to help you.");});}_1.pushq(bJ,bK,bL);bM=bL.get_Type();bM.$==0?(bN=bM.$0,bO=(bP=bL.get_Target(),(bQ=bL.get_Name(),function(bU){_1.trigger(bJ,bK,bP,bQ,bU);})),bR=(function(bU){return function(bV){return bU("Hello my name is "+bl.toSafe(bV)+" and I am an administrator");};}(a.id))(bN),bS((function(bU){return function(bV){return bU("Enter the phrase "+bl.toSafe(bV)+".");};}(a.id))(bR)),bT()):bD.FailWith("Not implemented");};_3.update=function(bJ){var bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck;function cl(cw){_1.say(bJ,cw);}function cm(cw,cx){return _1.sayRandom(bJ,cw,cx);}function cn(cw,cx){return _1.add(bJ,function(cy){_3.debug(cy);},cw,cx);}function co(cw){_3.debug(cw);}function cp(cw){_3.debug(cw);}function cq(cw){_3.debug(cw);}function cr(cw){return _1["User'_"](bJ,cw);}function cs(cw,cx){return _1.Response_(bJ,cw,cx);}function ct(cw,cx){return _1["Response'_"](bJ,cw,cx);}function cu(cw){var cx;cm(D.waitRetrievePhrases(),"user name");bs.Start((cx=null,bs.Delay(function(){return bs.Bind((new bF.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:1828852235",[cw]),function(cy){var cz;return cy==null?(cl((function(cA){return function(cB){return cA("I did not find a user with the name "+bl.toSafe(cB)+".");};}(a.id))(cw)),bM(new Z({$:0,$0:"addUser",$1:_3.name(),$2:_0.Verification,$3:null,$4:function(){cn("addUser",cw);cl((function(cA){return function(cB){return cA("Do you want me to add the user "+bl.toSafe(cB)+"?");};}(a.id))(cw));}})),bs.Zero()):(cz=cy.$0,bs.Bind((new bF.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:227402264",[cz.Name]),function(){cm(D.helloUserPhrases(),(function(cA){return function(cB){return cA(bl.prettyPrint(cB));};}(a.id))(cz.Name));return cz.LastLoggedIn!=null?bs.Bind((new bF.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:168689316",[cz.LastLoggedIn.$0]),function(cA){cl((function(cB){return function(cC){return cB("You last logged in "+bl.toSafe(cC)+".");};}(a.id))(cA));bM(new Z({$:0,$0:"authenticateUser",$1:_3.name(),$2:{$:0,$0:cw},$3:null,$4:function(cB){_3.update(cB);}}));return bs.Zero();}):bs.Zero();}));});})),null);}function cv(cw){return new Z({$:0,$0:"switchUser",$1:_3.name(),$2:_0.Verification,$3:null,$4:function(){cl((function(cx){return function(cy){return cx("Do you want me to switch to the user "+bl.toSafe(cy));};}(a.id))(cw));}});}_1.debugInterpreterStart(bJ,function(cw){_3.debug(cw);},_3.name());bK=bd.Curried(_1.handle,2,[bJ,co]);bL=bd.Curried(_1.endt,2,[bJ,cp]);bM=function(cw){_2.ask(bJ,cq,cw);};bN=_1.frame(bJ.$4);bN.$==1&&(bP=cr(bN.$0),bP!=null&&bP.$==1&&(bQ=F.Intent$1("greet",bP.$0),bQ!=null&&bQ.$==1&&(bR=F.Entity1Of1("name",bQ.$0[1]),bR!=null&&bR.$==1&&(bN.$1.$==0&&(bO=bR.$0,true)))))?(bK("loginUser"))(function(){cu(bO.get_Value());}):bN.$==1&&(bT=cr(bN.$0),bT!=null&&bT.$==1&&(bU=F.Intent$1("hello",bT.$0),bU!=null&&bU.$==1&&(bV=F.Entity1Of1("contact",bU.$0[1]),bV!=null&&bV.$==1&&(bN.$1.$==0&&(bS=bV.$0,true)))))?(bK("loginUser"))(function(){cu(bS.get_Value());}):bN.$==1&&(bX=ct("authenticateUser",bN.$0),bX!=null&&bX.$==1&&(bY=F.StrA(bX.$0[1]),bY!=null&&bY.$==1&&(bN.$1.$==0&&(bW=bY.$0,true))))?(bL("authenticateUser"))(function(){var cw;_3.debug(bW);bs.Start((cw=null,bs.Delay(function(){return bs.Bind((new bF.New()).Async("SMApp.Web:SMApp.Web.Server.hasFace:1405770658",[bf.get(bW,2)]),function(cx){return cx?(cl("Face detected"),bs.Zero()):(cl(function(cy){return cy("Sorry I did not detect a face in the camera image. Make sure you can see the red square around your face in the camera window when you click the OK button.");}(a.id)),bs.Zero());});})),null);}):bN.$==1&&(b0=F.No(bN.$0),b0!=null&&b0.$==1&&(b1=ct("addUser",b0.$0),b1!=null&&b1.$==1&&(b2=F.PStr(b1.$0[2]),b2!=null&&b2.$==1&&(bN.$1.$==0&&(bZ=b2.$0,true)))))?(bL("addUser"))(function(){cl((function(cw){return function(cx){return cw("Ok I did not add the user "+bl.toSafe(cx)+". But you must login for me to help you.");};}(a.id))(bZ));}):bN.$==1&&(b4=F.Yes(bN.$0),b4!=null&&b4.$==1&&(b5=ct("addUser",b4.$0),b5!=null&&b5.$==1&&(b6=F.PStr(b5.$0[2]),b6!=null&&b6.$==1&&(bN.$1.$==0&&(b3=b6.$0,true)))))?(bL("addUser"))(function(){bM(new Z({$:0,$0:"authenticateNewUser1",$1:_3.name(),$2:{$:0,$0:b3},$3:null,$4:function(cw){_3.update(cw);}}));}):bN.$==1&&(b8=ct("authenticateNewUser1",bN.$0),b8!=null&&b8.$==1&&(b9=F.StrA(b8.$0[1]),b9!=null&&b9.$==1&&(bN.$1.$==0&&(b7=b9.$0,true))))?(bL("authenticateNewUser1"))(function(){cl((function(cw){return function(cx){return cw("Authenticate new user "+bl.toSafe(cx)+".");};}(a.id))(bf.get(b7,0)));}):bN.$==1&&(b$=_1.User_(bJ,bN.$0),b$!=null&&b$.$==1&&(ca=F.Intent$1("hello",b$.$0),ca!=null&&ca.$==1&&(ca.$0[0]==null&&(cb=F.Entity1Of1("name",ca.$0[1]),cb!=null&&cb.$==1&&(bN.$1.$==0&&(b_=cb.$0,true))))))?bs.Start((cc=null,bs.Delay(function(){return bs.Bind((new bF.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:1828852235",[b_.get_Value()]),function(cw){return cw==null?(cl((function(cx){return function(cy){return cx("Sorry, the user "+bl.toSafe(cy)+" does not exist.");};}(a.id))(b_.get_Value())),bs.Zero()):(bM(cv(cw.$0.Name)),bs.Zero());});})),null):bN.$==1&&(ce=F.Yes(bN.$0),ce!=null&&ce.$==1&&(cf=cs("switchUser",ce.$0),cf!=null&&cf.$==1&&(cg=F.PStr(cf.$0[2]),cg!=null&&cg.$==1&&(bN.$1.$==0&&(cd=cg.$0,true)))))?(bJ.$1.set_Item("user",cd),cl((function(cw){return function(cx){return cw("Ok I switched to user "+bl.prettyPrint(cx)+".");};}(a.id))(cd))):bN.$==1&&(ci=F.No(bN.$0),ci!=null&&ci.$==1&&(cj=cs("switchUser",ci.$0),cj!=null&&cj.$==1&&(ck=F.PStr(cj.$0[2]),ck!=null&&ck.$==1&&(bN.$1.$==0&&(ch=ck.$0,true)))))?cl((function(cw){return function(cx){return cw("Ok I did not switch to user "+bl.toSafe(cx)+".");};}(a.id))(ch)):_1.didNotUnderstand(bJ,function(cw){_3.debug(cw);},_3.name());_1.debugInterpreterEnd(bJ,function(cw){_3.debug(cw);},_3.name());};_3.debug=function(bJ){d.debug(_3.name(),bJ);};_3.name=function(){_4.$cctor();return _4.name;};_4.$cctor=function(){_4.$cctor=a.ignore;_4.name="User";};_5.update=function(bJ){var bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0;function b1(b8){_1.echo(bJ,b8);}function b2(b8){_1.say(bJ,b8);}function b3(b8,b9){return _1.sayRandom(bJ,b8,b9);}function b4(b8){return _1.prop(bJ,b8);}function b5(b8){return _1.User_(bJ,b8);}function b6(){return b4("user");}function b7(b8,b9,b_){var b$;return bs.Start((b$=null,bs.Delay(function(){b3(D.waitAddPhrases(),"symptom entry");return bs.Bind((new bF.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:29242270",[b6().Name,b8,b9,b_]),function(ca){return ca.$==1?(b2(function(cb){return cb("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),bs.Zero()):(b2((function(cb){return function(cc){return cb("OK I added that "+bl.toSafe(cc)+" symptom to your journal.");};}(a.id))(b8)),bs.Zero());});})),null);}_1.debugInterpreterStart(bJ,function(b8){_5.debug(b8);},_5.name());bK=_1.frame(bJ.$4);bK.$==1&&(bM=b5(bK.$0),bM!=null&&bM.$==1&&(bN=F.Intent$1("symptom",bM.$0),bN!=null&&bN.$==1&&(bO=F.Entity1OfAny("symptom_name",bN.$0[1]),bO!=null&&bO.$==1&&(bK.$1.$==0&&(bL=bO.$0,true)))))?bs.Start((bP=null,bs.Delay(function(){b2("Ok I'll add that entry to your symptom journal");b7(bL.get_Value(),null,null);return bs.Zero();})),null):bK.$==1&&(bR=F.Yes(bK.$0),bR!=null&&bR.$==1&&((bS=_1.Response_(bJ,"painVideo",bR.$0),bS!=null&&bS.$==1)&&bK.$1.$==0))?bJ.$0["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bK.$==1&&(bU=b5(bK.$0),bU!=null&&bU.$==1&&(bV=F.Intent$1("medjournal",bU.$0),bV!=null&&bV.$==1&&((bW=bV.$0[1],bW!=null&&bW.$==1)&&(bK.$1.$==0&&(bT=bV.$0[1].$0,true)))))?(b2("ok I added that entry to your medication journal."),b2("You should be careful not to take too many painkillers over a short period of time.")):bK.$==1&&(bY=b5(bK.$0),bY!=null&&bY.$==1&&((bZ=F.Intent$1("kbquery",bY.$0),bZ!=null&&bZ.$==1)&&(bK.$1.$==0&&(bX=bY.$0,true))))?bs.Start((b0=null,bs.Delay(function(){return bs.Bind(y.getAnswer(bX.get_Text()),function(b8){var b9;return bs.Bind((b9=bf.get(b8.answers,0).answer,(new bF.New()).Async("SMApp.Web:SMApp.Web.Server.mdtohtml:-295888464",[b9])),function(b_){var b$;return bs.Bind((b$=bf.get(b8.answers,0).answer,(new bF.New()).Async("SMApp.Web:SMApp.Web.Server.mdtotext:-295888464",[b$])),function(ca){b1(b_);b2(ca);return bs.Zero();});});});})),null):_1.didNotUnderstand(bJ,function(b8){_5.debug(b8);},_5.name());_1.debugInterpreterEnd(bJ,function(b8){_5.debug(b8);},_5.name());};_5.debug=function(bJ){d.debug(_5.name(),bJ);};_5.name=function(){_6.$cctor();return _6.name;};_6.$cctor=function(){_6.$cctor=a.ignore;_6.name="Symptoms";};_7.update=function(bJ){var bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4;function b5(b_){_1.say(bJ,b_);}function b6(b_){_1["sayRandom'"](bJ,b_);}function b7(b_){_7.debug(b_);}function b8(b_){_7.debug(b_);}function b9(b_){return _1["User'_"](bJ,b_);}bK=bJ.$4;_7.debug(((((bd.Curried(function(b_,b$,ca,cb){return b_("Module "+bl.toSafe(b$)+" starting utterances:"+bl.prettyPrint(ca)+", questions: "+bl.prettyPrint(cb)+".");},4))(a.id))(_7.name()))(bK))(bJ.$2));bL=bd.Curried(_1.dispatch,2,[bJ,b7]);bM=bd.Curried(_1.handle,2,[bJ,b8]);bN=_1.frame(bK);bO=_1.Agenda_(bJ,function(b_){_7.debug(b_);},_3.name(),bN);bO!=null&&bO.$==1?(_7.debug((function(b_){return function(b$){return b_("Agenda is "+$.p$9(b$)+".");};}(a.id))((bJ.get_DialogueQuestions())[0])),_3.update(bJ)):bN.$==1&&(bQ=(bR=_1.PropNotSet_(bJ,"started",bN.$0),bR!=null&&bR.$==1?{$:1,$0:bR.$0}:null),bQ!=null&&bQ.$==1&&(bS=b9(bQ.$0),bS!=null&&bS.$==1&&(bT=F.Intent$1("greet",bS.$0),bT!=null&&bT.$==1&&(bT.$0[1]==null&&bN.$1.$==0))))?(_1.add(bJ,function(b_){_7.debug(b_);},"started",true),(bM("greet"))(function(){b6(D.helloPhrases());})):bN.$==1&&(bV=b9(bN.$0),bV!=null&&bV.$==1&&(bW=F.Intent$1("greet",bV.$0),bW!=null&&bW.$==1&&(bW.$0[1]==null&&bN.$1.$==0)))?(bM("greet"))(function(){b5("Hello, tell me your name to get started.");}):bN.$==1&&(bY=b9(bN.$0),bY!=null&&bY.$==1&&(bZ=F.Intent$1("greet",bY.$0),bZ!=null&&bZ.$==1&&((b0=F.Entity1Of1("name",bZ.$0[1]),b0!=null&&b0.$==1)&&bN.$1.$==0)))?(bL(_3.name()))(function(b_){_3.update(b_);}):bN.$==1&&(b2=b9(bN.$0),b2!=null&&b2.$==1&&(b3=F.Intent$1("hello",b2.$0),b3!=null&&b3.$==1&&((b4=F.Entity1Of1("contact",b3.$0[1]),b4!=null&&b4.$==1)&&bN.$1.$==0)))?(bL(_3.name()))(function(b_){_3.update(b_);}):_1.didNotUnderstand(bJ,function(b_){_7.debug(b_);},_7.name());_1.debugInterpreterEnd(bJ,function(b_){_7.debug(b_);},_7.name());};_7.debug=function(bJ){d.debug(_7.name(),bJ);};_7.name=function(){_8.$cctor();return _8.name;};_8.$cctor=function(){_8.$cctor=a.ignore;_8.name="Main";};_9.run=function(){var bJ,bK;bJ=bd.ThisFunc(function(bL,bM){return((_9.Main().get_Text())(bL))(bM);});bK=_9.Main().get_Options();a.$("#term").terminal(bJ,bK);return bh.get_Empty();};_9.Main=function(){_.$cctor();return _.Main;};_9.initMic=function(bJ){var bK,bL;_9.set_CUI((bK={$:1,$0:new bG.Microphone(bH.getElementById("microphone"))},X.New(_9.CUI().Voice,bK,_9.CUI().Term,_9.CUI().Avatar,_9.CUI().Caption,_9.CUI().TypingDNA,_9.CUI().AudioHandlers)));bL=_9.CUI().Mic.$0;bL.onconnecting=function(){_9.set_MicState(U.MicConnecting);return _9.debug("Mic connecting...");};bL.ondisconnected=function(){_9.set_MicState(U.MicDisconnected);return _9.debug("Mic disconnected.");};bL.onaudiostart=function(){_9.set_MicState(U.MicAudioStart);return _9.debug("Mic audio start...");};bL.onaudioend=function(){var bM,bN,bO,bP;_9.debug("Mic audio end.");bN=_9.CUI().AudioHandlers;bM=bN.GetEnumerator$1();try{while(bM.MoveNext()){bO=bM.Current();_9.debug((function(bQ){return function(bR){return bQ("Executing audio handler "+bl.toSafe(bR)+".");};}(a.id))(bO.K));_9.set_MicState({$:7,$0:bO.K});bP=bO.V;_9.CUI().AudioHandlers.Remove(bO.K);bP(d.lastMicData());}return;}finally{bM.Dispose();}};bL.onerror=function(bM){_9.set_MicState({$:6,$0:bM});return _9.debug((function(bN){return function(bO){return bN("Mic error : "+bl.toSafe(bO)+".");};}(a.id))(bM));};bL.onready=function(){_9.set_MicState(U.MicReady);return _9.debug("Mic ready.");};bL.onresult=function(bM,bN){return _9.ClientState().$==2?_9.echo("I'm still trying to understand what you said before."):_9.ClientState().$==0?d.error("Client is not intialized."):_9.MicState().$==7?null:!(bM==null||bN==null)?(_9.set_MicState({$:8,$0:bM,$1:bN}),_9.debug((((bd.Curried3(function(bO,bP,bQ){return bO("Mic result: "+bl.prettyPrint(bP)+" "+bl.prettyPrint(bQ)+".");}))(a.id))(bM))(bN)),bJ(bM,bN)):_9.debug("Mic: No result returned.");};bL.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};_9.sayRandom=function(bJ,bK){_9.say(D.getRandomPhrase(bK,bJ));};_9.say=function(bJ){_9.Output().unshift(bJ);_9["say'"](bJ);};_9["say'"]=function(bJ){_9.CUI().Say(bJ);};_9.initSpeech=function(){var bJ;bJ=d.toArray(_9.synth().getVoices());bf.length(bJ)>0?(bf.iter(function(bK){if(bC.Equals(_9.CUI().Voice,null)&&(bK.name.indexOf("Microsoft Zira")!=-1||bK.name.toLowerCase().indexOf("female")!=-1)){_9.set_CUI(X.New({$:1,$0:bK},_9.CUI().Mic,_9.CUI().Term,_9.CUI().Avatar,_9.CUI().Caption,_9.CUI().TypingDNA,_9.CUI().AudioHandlers));_9.debug((function(bL){return function(bM){return bL("Using browser speech synthesis voice "+bl.toSafe(bM)+".");};}(a.id))(_9.CUI().Voice.$0.name));}},bJ),!bC.Equals(_9.CUI().Voice,null)?(_9.CUI().Avatar.nativeVoice=true,_9.CUI().Avatar.nativeVoiceName=_9.CUI().Voice.$0.name,_9.debug((function(bK){return function(bL){return bK("Using browser speech synthesis voice "+bl.toSafe(bL)+".");};}(a.id))(_9.CUI().Voice.$0.name))):void 0):void 0;bC.Equals(_9.CUI().Voice,null)?_9.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};_9.synth=function(){_.$cctor();return _.synth;};_9.push=function(bJ){_9.Utterances().unshift(bJ);return _9.Dialogue();};_9.Dialogue=function(){_.$cctor();return _.Dialogue;};_9.Utterances=function(){_.$cctor();return _.Utterances;};_9.Questions=function(){_.$cctor();return _.Questions;};_9.Output=function(){_.$cctor();return _.Output;};_9.Props=function(){_.$cctor();return _.Props;};_9.wait=function(bJ){d["Terminal.Echo'"](_9.CUI().Term,"please wait");_9.CUI().Term.pause();bJ();_9.CUI().Term.resume();};_9.debug=function(bJ){d.debug("CLIENT",bJ);};_9.echo=function(bJ){d["Terminal.EchoHtml'"](_9.CUI().Term,(function(bK){return function(bL){return bK(bl.prettyPrint(bL));};}(a.id))(bJ));};_9.ClientState=function(){_.$cctor();return _.ClientState;};_9.set_ClientState=function(bJ){_.$cctor();_.ClientState=bJ;};_9.MicState=function(){_.$cctor();return _.MicState;};_9.set_MicState=function(bJ){_.$cctor();_.MicState=bJ;};_9.CUI=function(){_.$cctor();return _.CUI;};_9.set_CUI=function(bJ){_.$cctor();_.CUI=bJ;};_.$cctor=function(){var bJ,bK,bL,bM;_.$cctor=a.ignore;function bN(bP,bQ){var bR,bS,bT,bU,bV,bW,bX;_9.debug((((bd.Curried3(function(bY,bZ,b0){return bY("Voice: "+bl.prettyPrint(bZ)+" "+bl.prettyPrint(b0));}))(a.id))(bP))(bQ));bR=(bS=K["Intent'"](bP,bQ),bS!=null&&bS.$==1?{$:1,$0:bS.$0}:null);bT=(bU=K["Trait'"](bQ),bU!=null&&bU.$==1?{$:1,$0:bp.ofArray([bU.$0])}:null);bV=(bW=K["Entity'$1"](bQ),bW!=null&&bW.$==1?{$:1,$0:bp.ofArray([bW.$0])}:null);bR==null&&(bT==null&&bV==null)?void 0:(_9.debug(((((bd.Curried(function(bY,bZ,b0,b1){return bY("Voice: "+$.p(bZ)+" "+$.p$3(b0)+" "+$.p$5(b1));},4))(a.id))(bR))(bT))(bV)),_7.update(_9.push(new J({$:0,$0:"",$1:bR,$2:bT,$3:bV}))));}function bO(bP,bQ){var bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6;_9.set_CUI(X.New(_9.CUI().Voice,_9.CUI().Mic,bP,_9.CUI().Avatar,_9.CUI().Caption,_9.CUI().TypingDNA,_9.CUI().AudioHandlers));if(bC.Equals(_9.CUI().Mic,null))_9.initMic(bN);if(bC.Equals(_9.CUI().Voice,null))_9.initSpeech();if(_9.ClientState().$===0)_9.set_ClientState(V.ClientReady);b4=M.Blank(bQ);if(b4!=null&&b4.$==1)return _9["say'"]("Tell me what you want me to do or ask me a question.");else{b5=M.Debug(bQ);if(b5!=null&&b5.$==1){_9.debug((function(b7){return function(b8){return b7("Utterances: "+bl.prettyPrint(b8));};}(a.id))(_9.Utterances()));_9.debug((function(b7){return function(b8){return b7("Questions: "+bl.prettyPrint(b8));};}(a.id))(_9.Questions()));bR=_9.Props().GetEnumerator$1();try{while(bR.MoveNext()){b6=bR.Current();_9.debug((((bd.Curried3(function(b7,b8,b9){return b7(bl.toSafe(b8)+": "+bl.prettyPrint(b9));}))(a.id))(b6.K))(b6.V));}}finally{bR.Dispose();}bb.mixin((bS={},bS.titleText="tEST",bS.text="TEST",bS.icon="question",bS.allowOutsideClick=false,bS.progressSteps=[1,2,3],bS)).queue([(bT={},bT.titleText="2",bT),(bU={},bU.titleText="3",bU)]);return;}else{bV=M.Voices(bQ);return bV!=null&&bV.$==1?(bW=d.toArray(d.speechSynthesis().getVoices()),_9["say'"]((function(b7){return function(b8){return b7("There are currently "+a.String(b8)+" voices installed on this computer or device.");};}(a.id))(bf.length(bW))),bf.iteri(function(b7,b8){return _9["say'"](((((bd.Curried(function(b9,b_,b$,ca){return b9("Voice "+a.String(b_)+". Name: "+bl.toSafe(b$)+", Local: "+bl.prettyPrint(ca)+".");},4))(a.id))(b7))(b8.name))(b8.localService));},bW)):_9.ClientState().$==1?(bY=M.QuickHello(bQ),(bY!=null&&bY.$==1?(bX=bY.$0,true):(bZ=M.QuickHelp(bQ),bZ!=null&&bZ.$==1?(bX=bZ.$0,true):(b0=M.QuickYes(bQ),b0!=null&&b0.$==1?(bX=b0.$0,true):(b1=M.QuickNo(bQ),b1!=null&&b1.$==1?(bX=b1.$0,true):(b2=M.QuickNumber(bQ),b2!=null&&b2.$==1&&(bX=b2.$0,true))))))?(_9.debug((function(b7){return function(b8){return b7("Quick Text: "+$.p$7(b8)+".");};}(a.id))(bX)),_7.update(_9.push(bX)),_9.set_ClientState(V.ClientReady)):_9.CUI().Wait((b3=null,bs.Delay(function(){_9.set_ClientState(V.ClientUnderstand);M.getUtterance(bQ,function(b7){var b8,b9;b8=M.HasUtterance(b7);b8!=null&&b8.$==1?(b9=b8.$0,_9.debug(((((bd.Curried(function(b_,b$,ca,cb){return b_("Text: Intent: "+$.p(b$)+", Traits: "+$.p$3(ca)+", Entities: "+$.p$5(cb)+".");},4))(a.id))(b9.get_Intent()))(b9.get_Traits()))(b9.get_Entities())),_7.update(_9.push(b9))):(_9.debug("Text: Did not receive a meaning from the server."),_9["say'"]("Sorry I did not understand what you said."));});_9.set_ClientState(V.ClientReady);return bs.Zero();})))):_9.ClientState().$==0?d.error("Client is not initialized."):_9["say'"]("I'm still trying to understand what you said before.");}}}_.CUI=X.New(null,null,null,(bB.applicationId="4277115329081938617",bJ=new a.SDKConnection(),bK=new a.WebAvatar(),bK.version=8.5,bK.connection=bJ,bK.avatar="20926186",bK.voice="cmu-slt",bK.voiceMod="default",bK.width=175,bK.createBox(),bK.addMessage(""),bK.processMessages(0),bK),false,(bL=new a.TypingDNA(),(bL.stop(),bL)),new bI.New$5());_.MicState=U.MicNotInitialized;_.ClientState=V.ClientNotInitialzed;_.Props=new bI.New$5();_.Output=[];_.Questions=[];_.Utterances=[];_.Dialogue=new Y({$:0,$0:_9.CUI(),$1:_9.Props(),$2:_9.Questions(),$3:_9.Output(),$4:_9.Utterances()});_.synth=a.speechSynthesis;_.Main=new W({$:0,$0:function(bP){return bN(bP[0],bP[1]);},$1:[function(bP){return function(bQ){return bO(bP,bQ);};},(bM={},bM.name="Main",bM.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bM.prompt=">",bM)]});};$.p$8=function(bJ){return bJ.$==3?"ConceptCompletion":bJ.$==2?"Disjunctive":bJ.$==1?"Verification":"UserAuthentication "+bl.prettyPrint(bJ.$0);};ba.p=function(bJ){return"{"+("text = "+bl.prettyPrint(bJ.text))+"; "+("intents = "+bl.printArray(function(bK){return ba.p$1(bK);},bJ.intents))+"; "+("entities = "+bl.prettyPrint(bJ.entities))+"; "+("traits = "+bl.prettyPrint(bJ.traits))+"}";};ba.p$1=function(bJ){return"{"+("id = "+bl.prettyPrint(bJ.id))+"; "+("name = "+bl.prettyPrint(bJ.name))+"; "+("confidence = "+bl.prettyPrint(bJ.confidence))+"}";};$.p$9=function(bJ){return"Question ("+bl.prettyPrint(bJ.$0)+", "+bl.prettyPrint(bJ.$1)+", "+$.p$8(bJ.$2)+", "+$.p$10(bJ.$3)+", "+"<fun>"+")";};$.p$10=function(bJ){return bJ==null?"null":"Some "+bl.printArray(bl.prettyPrint,bJ.$0);};$.p$2=function(bJ){return bJ==null?"null":"Some "+bl.prettyPrint(bJ.$0);};$.p$1=function(bJ){return"Intent ("+bl.prettyPrint(bJ.$0)+", "+$.p$2(bJ.$1)+")";};$.p=function(bJ){return bJ==null?"null":"Some "+$.p$1(bJ.$0);};$.p$4=function(bJ){return"Trait ("+bl.prettyPrint(bJ.$0)+", "+bl.prettyPrint(bJ.$1)+", "+$.p$2(bJ.$2)+")";};$.p$3=function(bJ){return bJ==null?"null":"Some "+bl.printList(function(bK){return $.p$4(bK);},bJ.$0);};$.p$6=function(bJ){return"Entity ("+bl.prettyPrint(bJ.$0)+", "+bl.prettyPrint(bJ.$1)+", "+bl.prettyPrint(bJ.$2)+", "+$.p$2(bJ.$3)+")";};$.p$5=function(bJ){return bJ==null?"null":"Some "+bl.printList(function(bK){return $.p$6(bK);},bJ.$0);};$.p$7=function(bJ){return"Utterance ("+bl.prettyPrint(bJ.$0)+", "+$.p(bJ.$1)+", "+$.p$3(bJ.$2)+", "+$.p$5(bJ.$3)+")";};}());
