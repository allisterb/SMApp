(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=c.Bs=c.Bs||{};i=c.NLU=c.NLU||{};j=i.Intent=i.Intent||{};k=i.Trait=i.Trait||{};l=i.Entity=i.Entity||{};m=i.Utterance=i.Utterance||{};n=i.Question=i.Question||{};o=i.Voice=i.Voice||{};p=o["Entity'"]=o["Entity'"]||{};q=i.Text=i.Text||{};r=q["Utterance'"]=q["Utterance'"]||{};s=q["Intent'"]=q["Intent'"]||{};t=q["Entity'"]=q["Entity'"]||{};u=q["Trait'"]=q["Trait'"]||{};v=i.Domain=i.Domain||{};w=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};x=c.CUI=c.CUI||{};y=x.MicState=x.MicState||{};z=x.ClientState=x.ClientState||{};A=x.Interpreter=x.Interpreter||{};B=x.CUI=x.CUI||{};C=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};D=c.Main=c.Main||{};E=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};F=c.Client=c.Client||{};G=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};H=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};I=a.WebSharper;J=I&&I.UI;K=J&&J.Client;L=K&&K.Templates;M=J&&J.Doc;N=I&&I.Strings;O=a.IntelliFactory;P=O&&O.Runtime;Q=I&&I.Utils;R=a.console;S=a.jQuery;T=I&&I.Arrays;U=I&&I.List;V=I&&I.Seq;W=J&&J.AttrProxy;X=I&&I.JavaScript;Y=X&&X.Pervasives;Z=I&&I.Collections;_0=Z&&Z.Map;_1=b&&b.NLU;_2=_1&&_1.Wit;_3=_2&&_2.WitApi;_4=I&&I.Concurrency;_5=a.SDK;_6=I&&I.Random;_7=I&&I.Operators;_8=I&&I.Remoting;_9=_8&&_8.AjaxRemotingProvider;_=a.Wit;$=a.document;ba=I&&I.Unchecked;bb=Z&&Z.Dictionary;d.speechSynthesis=function(){return a.speechSynthesis;};d.elementHTML=function(bc){return bc.innerHTML;};d.createElement=function(bc,bd){var be;be=self.document.createElement(bc);L.LoadLocalTemplates("");M.RunAppend(be,bd);return be;};d.replace_tok=function(bc,bd,be){return N.Replace(be,bc,bd);};d.toLower=function(bc){return bc.toLowerCase();};d.debug=function(bc,bd){d.info((((P.Curried3(function(be,bf,bg){return be("DEBUG: "+Q.toSafe(bf)+": "+Q.prettyPrint(bg));}))(a.id))(bc.toUpperCase()))(bd));};d.error=function(bc){R.error(bc);};d.info=function(bc){R.info(bc);};d.jserror=function(bc){S.error(bc);};d.toArray=function(bc){return T.map(a.id,S.makeArray(bc));};d["Terminal.EchoHtml'"]=function(bc,bd){bc.pause();bc.echo(bd,d.rawOpt());bc.resume();};d["Terminal.Echo'"]=function(bc,bd){bc.pause();bc.echo(bd);bc.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=P.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(bc){function bd(be){return function(bf){var bg,bh,bi,bj,bk,bl,bm;bh=N.replicate(be," ");switch(bf.$==0?bf.$1.$==1?bf.$1.$0.$==2?bf.$1.$1.$==0?(bg=[bf.$1.$0.$0,bf.$0],1):(bg=[bf.$1,bf.$0],2):(bg=[bf.$1,bf.$0],2):(bg=[bf.$1,bf.$0],2):bf.$==2?(bg=bf.$0,3):(bg=[bf.$0,bf.$1],0)){case 0:return bg[0]+"=\""+bg[1]+"\"";case 1:bi=bg[1];return bh+"<"+bi+">"+bg[0]+"</"+bi+">\r\n";case 2:bj=bg[1];bk=U.partition(function(bn){return bn.$==1;},bg[0]);bl=bk[1];bm=bk[0];return bl.$==0?bh+"<"+bj+(bm.$===0?"":" "+N.concat(" ",U.ofSeq(V.delay(function(){return V.map(function(bn){return(bd(0))(bn);},bm);}))))+"/>\r\n":bh+"<"+bj+(bm.$===0?"":" "+N.concat(" ",U.ofSeq(V.delay(function(){return V.map(function(bn){return(bd(0))(bn);},bm);}))))+">\r\n"+N.concat("",U.ofSeq(V.delay(function(){return V.map(function(bn){return(bd(be+1))(bn);},bl);})))+bh+"</"+bj+">\r\n";case 3:return bh+bg+"\r\n";}};}return(bd(0))(bc);};f.alt=function(bc){return new e({$:1,$0:"alt",$1:bc});};f.src=function(bc){return new e({$:1,$0:"src",$1:bc});};f.cls=function(bc){return new e({$:1,$0:"class",$1:bc});};f.str=function(bc){return e.toString(bc);};f.op_PercentEquals=function(bc,bd){return new e({$:1,$0:bc,$1:bd});};f.op_Splice=function(bc){var bd;return U.ofArray([new e({$:2,$0:(bd=bc,a.String(bd))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(bc,bd){return new e({$:0,$0:bc,$1:bd});};g.$cctor=function(){var bc;g.$cctor=a.ignore;g.rawOpt=(bc={},bc.raw=true,bc);g.html=function(bd){return f.elem("html",bd);};g.head=function(bd){return f.elem("head",bd);};g.title=function(bd){return f.elem("title",bd);};g.style=function(bd){return f.elem("style",bd);};g.body=function(bd){return f.elem("body",bd);};g.div=function(bd){return f.elem("div",bd);};g.br=function(bd){return f.elem("br",bd);};g.section=function(bd){return f.elem("section",bd);};g.span=function(bd){return f.elem("span",bd);};g.table=function(bd){return f.elem("table",bd);};g.thead=function(bd){return f.elem("thead",bd);};g.tbody=function(bd){return f.elem("tbody",bd);};g.tfoot=function(bd){return f.elem("tfoot",bd);};g.img=function(bd){return f.elem("img",bd);};g.map=function(bd){return f.elem("map",bd);};g.area=function(bd){return f.elem("area",bd);};g.p=function(bd){return f.elem("p",bd);};g.a=function(bd){return f.elem("a",bd);};g.tr=function(bd){return f.elem("tr",bd);};g.td=function(bd){return f.elem("td",bd);};g.th=function(bd){return f.elem("th",bd);};g.ul=function(bd){return f.elem("ul",bd);};g.li=function(bd){return f.elem("li",bd);};g.h1=function(bd){return f.elem("h1",bd);};g.h2=function(bd){return f.elem("h1",bd);};g.h3=function(bd){return f.elem("h1",bd);};g.h4=function(bd){return f.elem("h1",bd);};g.strong=function(bd){return f.elem("strong",bd);};};h.Radio=function(bc,bd,be,bf,bg){return M.Element("div",new U.T({$:1,$0:h.cls("radio"),$1:bd}),[M.Element("label",bf,[M.Radio(bg,true,be),M.TextNode(bc)])]);};h.checkbox=function(bc,bd,be,bf,bg){return M.Element("div",new U.T({$:1,$0:h.cls("checkbox"),$1:bd}),[M.Element("label",bf,[M.CheckBox(bg,be),M.TextNode(bc)])]);};h.textArea=function(bc,bd,be,bf,bg){return M.Element("div",new U.T({$:1,$0:h.cls("form-group"),$1:bd}),[M.Element("label",bf,[M.TextNode(bc)]),M.InputArea(new U.T({$:1,$0:h.cls("form-control"),$1:bg}),be)]);};h.inputPassword=function(bc,bd,be,bf,bg){return M.Element("div",new U.T({$:1,$0:h.cls("form-group"),$1:bd}),[M.Element("label",bf,[M.TextNode(bc)]),M.PasswordBox(new U.T({$:1,$0:h.cls("form-control"),$1:bg}),be)]);};h.input=function(bc,bd,be,bf,bg){return M.Element("div",new U.T({$:1,$0:h.cls("form-group"),$1:bd}),[M.Element("label",bf,[M.TextNode(bc)]),M.Input([h.cls("form-control"),bg],be)]);};h.btn=function(bc){return M.Element("button",[h.eid(bc),h.cls("btn")],[]);};h.container=function(bc){return M.Element("div",[h.cls("container")],bc);};h.cls=function(bc){return W.Create("class",bc);};h.eid=function(bc){return W.Create("id",bc);};j=i.Intent=P.Class({toString:function(){return(((P.Curried3(function(bc,bd,be){return bc("Intent("+Q.toSafe(bd)+", "+H.p$2(be)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,j);k=i.Trait=P.Class({toString:function(){return(((P.Curried3(function(bc,bd,be){return bc("Trait("+Q.toSafe(bd)+", "+Q.prettyPrint(be)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,k);l=i.Entity=P.Class({toString:function(){return((((P.Curried(function(bc,bd,be,bf){return bc("Entity("+Q.toSafe(bd)+", "+Q.toSafe(be)+", "+H.p$2(bf)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,l);m=i.Utterance=P.Class({toString:function(){return((((P.Curried(function(bc,bd,be,bf){return bc(H.p(bd)+" "+H.p$3(be)+" "+H.p$5(bf));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bc;bc=this.$2;return bc!=null?{$:1,$0:U.sortBy(function(bd){return bd.get_Name();},bc.$0)}:null;},get_Traits:function(){var bc;bc=this.$1;return bc!=null?{$:1,$0:U.sortBy(function(bd){return bd.get_Name();},bc.$0)}:null;},get_Intent:function(){return this.$0;}},null,m);n=i.Question=P.Class({toString:function(){return(((P.Curried3(function(bc,bd,be){return bc("Name: "+Q.toSafe(bd)+" Text: "+Q.toSafe(be));}))(a.id))(this.get_Name()))(this.get_Text());},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,n);p.New=function(bc,bd,be,bf,bg){return{body:bc,end:bd,start:be,suggested:bf,value:bg};};o["Intent'"]=function(bc,bd){return!(bd.intent==null)?{$:1,$0:new j({$:0,$0:d.toLower(bd.intent.value),$1:null})}:null;};o["Trait'"]=function(bc){return!(bc.domain==null)?{$:1,$0:new k({$:0,$0:"domain",$1:d.toLower(bc.domain.value),$2:null})}:!(bc.dialogue_act==null)?{$:1,$0:new k({$:0,$0:"dialogue_act",$1:d.toLower(bc.dialogue_act.value),$2:null})}:null;};o["Entity'$1"]=function(bc){return!(bc.contact==null)?{$:1,$0:new l({$:0,$0:"contact",$1:d.toLower(bc.contact.value),$2:null})}:null;};r=q["Utterance'"]=P.Class({get_TopIntent:function(){return U.head(U.sortBy(function(bc){return bc.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$2;},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,r);s=q["Intent'"]=P.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,s);t=q["Entity'"]=P.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,t);u=q["Trait'"]=P.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,u);q.HasUtterance=function(bc){var bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq;return bc!=null&&bc.$==1&&(bc.$0.$0.$==0&&(bc.$0.$1.get_Length()>0&&(bd=[bc.$0.$1,bc.$0.$2],true)))?(be=U.map(function(br){return new l({$:0,$0:d.toLower(br.get_Role()),$1:br.get_Value(),$2:{$:1,$0:br.get_Confidence()}});},U.filter(function(br){return br.get_Confidence()>q.entityConfidenceThreshold();},bd[0])),{$:1,$0:new m({$:0,$0:null,$1:{$:1,$0:U.map(function(br){return new k({$:0,$0:d.toLower(br.get_Name()),$1:br.get_Value(),$2:{$:1,$0:br.get_Confidence()}});},U.filter(function(br){return br.get_Confidence()>q.entityConfidenceThreshold();},bd[1]))},$2:{$:1,$0:be}})}):bc!=null&&bc.$==1&&(bc.$0.$1.$==0&&(bc.$0.$2.$==0&&(bc.$0.$0.get_Length()>0&&bc.$0.get_TopIntent().get_Confidence()>q.intentConfidenceThreshold()&&(bf=[bc.$0.$0,bc],true))))?(bg=bf[1],{$:1,$0:new m({$:0,$0:{$:1,$0:new j({$:0,$0:d.toLower(bg.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bg.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):bc!=null&&bc.$==1&&(bc.$0.$2.$==0&&(bc.$0.$0.get_Length()>0&&bc.$0.get_TopIntent().get_Confidence()>q.intentConfidenceThreshold()&&(bh=[bc.$0.$0,bc],true)))?(bi=bh[1],(bj=U.map(function(br){return new l({$:0,$0:d.toLower(br.get_Role()),$1:br.get_Value(),$2:{$:1,$0:br.get_Confidence()}});},U.filter(function(br){return br.get_Confidence()>q.entityConfidenceThreshold();},bi.$0.get_Entities())),{$:1,$0:new m({$:0,$0:{$:1,$0:new j({$:0,$0:d.toLower(bi.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bi.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:bj}})})):bc!=null&&bc.$==1&&(bc.$0.$1.$==0&&(bc.$0.$0.get_Length()>0&&bc.$0.get_TopIntent().get_Confidence()>q.intentConfidenceThreshold()&&(bk=[bc.$0.$0,bc],true)))?(bl=bk[1],(bm=U.map(function(br){return new k({$:0,$0:d.toLower(br.get_Name()),$1:br.get_Value(),$2:{$:1,$0:br.get_Confidence()}});},U.filter(function(br){return br.get_Confidence()>q.entityConfidenceThreshold();},bl.$0.get_Traits())),{$:1,$0:new m({$:0,$0:{$:1,$0:new j({$:0,$0:d.toLower(bl.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bl.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bm},$2:null})})):bc!=null&&bc.$==1&&(bc.$0.$0.get_Length()>0&&bc.$0.get_TopIntent().get_Confidence()>q.intentConfidenceThreshold()&&(bn=[bc.$0.$0,bc],true))?(bo=bn[1],(bp=U.map(function(br){return new l({$:0,$0:d.toLower(br.get_Role()),$1:br.get_Value(),$2:{$:1,$0:br.get_Confidence()}});},U.filter(function(br){return br.get_Confidence()>q.entityConfidenceThreshold();},bo.$0.get_Entities())),(bq=U.map(function(br){return new k({$:0,$0:d.toLower(br.get_Name()),$1:br.get_Value(),$2:{$:1,$0:br.get_Confidence()}});},U.filter(function(br){return br.get_Confidence()>q.entityConfidenceThreshold();},bo.$0.get_Traits())),{$:1,$0:new m({$:0,$0:{$:1,$0:new j({$:0,$0:d.toLower(bo.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bo.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bq},$2:{$:1,$0:bp}})}))):null;};q.entityConfidenceThreshold=function(){w.$cctor();return w.entityConfidenceThreshold;};q.set_entityConfidenceThreshold=function(bc){w.$cctor();w.entityConfidenceThreshold=bc;};q.intentConfidenceThreshold=function(){w.$cctor();return w.intentConfidenceThreshold;};q.set_intentConfidenceThreshold=function(bc){w.$cctor();w.intentConfidenceThreshold=bc;};q.getUtterance=function(bc,bd){q.witapi().getMeaning(bc,function(be){var bf,bg;d.debug("NLU",(function(bh){return function(bi){return bh("Wit.ai returned: "+Q.prettyPrint(bi));};}(a.id))(be));bf=!(be.intents==null)?U.ofArray(T.map(function(bh){return new s({$:0,$0:bh.name,$1:bh.confidence});},be.intents)):U.T.Empty;bg=!(be.traits==null)?U.ofSeq(V.concat(U.map(function(bh){return T.map(function(bi){return new u({$:0,$0:bh,$1:bi.confidence,$2:bi.value});},Y.GetJS(be.traits,[bh]));},U.filter(function(bh){return!(Y.GetJS(be.traits,[bh])==null);},q.trait_types())))):U.T.Empty;return bd({$:1,$0:new r({$:0,$0:bf,$1:!(be.intents==null)?U.ofSeq(V.concat(U.map(function(bh){return T.map(function(bi){return new t({$:0,$0:bi.name,$1:bi.confidence,$2:bi.role,$3:bi.value});},Y.GetJS(be.entities,[bh]));},U.filter(function(bh){return!(Y.GetJS(be.entities,[bh])==null);},q.entity_types())))):U.T.Empty,$2:bg})});},function(be,bf,bg){d.error((((P.Curried3(function(bh,bi,bj){return bh("Wit.ai returned: "+Q.prettyPrint(bi)+" "+Q.prettyPrint(bj));}))(a.id))(bf))(bg));return bd(null);});};q.trait_types=function(){w.$cctor();return w.trait_types;};q.entity_types=function(){w.$cctor();return w.entity_types;};q.witapi=function(){w.$cctor();return w.witapi;};q.QuickPrograms=function(bc){return bc==="programs"?{$:1,$0:new m({$:0,$0:{$:1,$0:new j({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};q.QuickNumber=function(bc){var bd,be,bf;return(be=q.One(bc),be!=null&&be.$==1?(bd=be.$0,true):(bf=q.Two(bc),bf!=null&&bf.$==1&&(bd=bf.$0,true)))?{$:1,$0:bd}:null;};q.Three=function(bc){var bd;return bc==="3"||bc==="three"?{$:1,$0:new m({$:0,$0:{$:1,$0:new j({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:U.ofArray([new l({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};q.Two=function(bc){var bd;return bc==="2"||bc==="two"?{$:1,$0:new m({$:0,$0:{$:1,$0:new j({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:U.ofArray([new l({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};q.One=function(bc){var bd;return bc==="1"||bc==="one"?{$:1,$0:new m({$:0,$0:{$:1,$0:new j({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:U.ofArray([new l({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};q.QuickNo=function(bc){var bd;return bc==="no"||(bc==="NO"||(bc==="No"||(bc==="nope"||(bc==="no way"||(bc==="nah"||(bc==="don't do it"||bc==="stop"))))))?{$:1,$0:new m({$:0,$0:{$:1,$0:new j({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};q.QuickYes=function(bc){var bd;return bc==="yes"||(bc==="YES"||(bc==="Yes"||(bc==="YEs"||(bc==="ok"||(bc==="sure"||(bc==="yeah"||(bc==="yep"||(bc==="uh huh"||(bc==="go ahead"||bc==="go")))))))))?{$:1,$0:new m({$:0,$0:{$:1,$0:new j({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};q.QuickHelp=function(bc){var bd;return bc==="help"||(bc==="help me"||(bc==="what's this?"||bc==="huh"))?{$:1,$0:new m({$:0,$0:{$:1,$0:new j({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};q.QuickHello=function(bc){var bd;return bc==="hello"||(bc==="hey"||(bc==="yo"||bc==="hi"))?{$:1,$0:new m({$:0,$0:{$:1,$0:new j({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};q.Voices=function(bc){return bc==="voices"?{$:1,$0:null}:null;};q.Debug=function(bc){return bc==="debug"?{$:1,$0:null}:null;};q.Blank=function(bc){return bc===""?{$:1,$0:null}:null;};v.Study=function(bc){return bc.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};i.No=function(bc){var bd,be,bf,bg,bh,bi;return(be=i.Intent$1("no",bc),be!=null&&be.$==1&&(be.$0[0]==null&&(be.$0[1]==null&&(bd=bc,true))))?{$:1,$0:bd}:(bg=i.Intent$1("noresponse",bc),bg!=null&&bg.$==1&&(bg.$0[0]==null&&(bg.$0[1]==null&&(bf=bc,true))))?{$:1,$0:bf}:(bi=i.Intent$1("NoResponse",bc),bi!=null&&bi.$==1&&(bi.$0[0]==null&&(bi.$0[1]==null&&(bh=bc,true))))?{$:1,$0:bh}:null;};i.Yes=function(bc){var bd,be,bf,bg,bh,bi;return(be=i.Intent$1("yes",bc),be!=null&&be.$==1&&(be.$0[0]==null&&(be.$0[1]==null&&(bd=bc,true))))?{$:1,$0:bd}:(bg=i.Intent$1("yesresponse",bc),bg!=null&&bg.$==1&&(bg.$0[0]==null&&(bg.$0[1]==null&&(bf=bc,true))))?{$:1,$0:bf}:(bi=i.Intent$1("YesResponse",bc),bi!=null&&bi.$==1&&(bi.$0[0]==null&&(bi.$0[1]==null&&(bh=bc,true))))?{$:1,$0:bh}:null;};i.EntityManyofMany=function(bc,bd){return{$:1,$0:_0.OfArray(T.ofSeq(U.map(function(be){return U.exists(function(bf){return bf.get_Name()===be;},bd)?[be,{$:1,$0:U.filter(function(bf){return bf.get_Name()===be;},bd)}]:[be,null];},bc)))};};i.EntityManyOf1=function(bc,bd){var be;return bd!=null&&bd.$==1&&(U.exists(function(bf){return bf.get_Name()===bc;},bd.$0)&&(be=bd.$0,true))?{$:1,$0:U.filter(function(bf){return bf.get_Name()===bc;},be)}:null;};i.Entity1OfAny=function(bc,bd){var be;return bd!=null&&bd.$==1&&(U.exists(function(bf){return bf.get_Name()===bc;},bd.$0)&&(be=bd.$0,true))?{$:1,$0:U.head(U.sortBy(function(bf){return bf.get_Name();},U.filter(function(bf){return bf.get_Name()===bc;},be)))}:null;};i.Entity1Of1=function(bc,bd){var be;return bd!=null&&bd.$==1&&(bd.$0.$==1&&(bd.$0.$1.$==0&&(bd.$0.$0.get_Name()===bc&&(be=bd.$0.$0,true))))?{$:1,$0:be}:null;};i.Intent$1=function(bc,bd){return bd.get_Intent()!=null&&bd.get_Intent().$0.get_Name()===bc?{$:1,$0:[bd.get_Traits(),bd.get_Entities()]}:null;};w.$cctor=function(){w.$cctor=a.ignore;w.witapi=new _3.New("MROJG5PKG6G7Q4SVXN7HSIGSIZZ5DI6W");w.entity_types=U.ofArray(["wit$contact:contact","wit$datetime:datetime","subject:subject","term:term"]);w.trait_types=U.ofArray(["domain","dialogue_act"]);w.intentConfidenceThreshold=0.85;w.entityConfidenceThreshold=0.85;};y.MicReady={$:5};y.MicAudioEnd={$:4};y.MicAudioStart={$:3};y.MicDisconnected={$:2};y.MicConnecting={$:1};y.MicNotInitialized={$:0};z.ClientUnderstand={$:2};z.ClientReady={$:1};z.ClientNotInitialzed={$:0};A=x.Interpreter=P.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,A);B=x.CUI=P.Class({SayVoices:function(){var bc,bd,be;bc=this;bd=a.speechSynthesis.getVoices();!(bd==null)?(be=d.toArray(bd),bc.Say((function(bf){return function(bg){return bf("There are currently "+a.String(bg)+" voices installed on this computer or device.");};}(a.id))(T.length(be))),T.iteri(function(bf,bg){return bc.Say(((((P.Curried(function(bh,bi,bj,bk){return bh("Voice "+a.String(bi)+". Name: "+Q.toSafe(bj)+", Local: "+Q.prettyPrint(bk)+".");},4))(a.id))(bf))(bg.name))(bg.localService));},be)):void 0;},Wait:function(bc){this.Wait$1(function(){_4.Start(bc,null);});},Wait$1:function(bc){this["Echo'"]("please wait...");this.Term.pause();bc();this.Term.resume();},sayRandom:function(bc,bd){this.Say(x.getRandomPhrase(bc,bd));},SayAngry:function(bc){var bd,be;bd=this;_4.Start((be=null,_4.Delay(function(){return _4.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),_5.chime(),_4.Zero()):_4.Zero(),_4.Delay(function(){a.addMessage(bd.Avatar,bc,"","");bd.Avatar.processMessages(0);return _4.Zero();}));})),null);},Say:function(bc){var bd,be;bd=this;_4.Start((be=null,_4.Delay(function(){return _4.Combine(a.speechSynthesis.speaking?(_5.chime(),_4.Zero()):_4.Zero(),_4.Delay(function(){bd.Avatar.addMessage(bc);bd.Avatar.processMessages(0);return _4.Zero();}));})),null);},Debug:function(bc,bd){d.debug(bc,bd);},"EchoHtml'":function(bc){var bd,be;bd=(be={},be.raw=true,be);this.Term.disable();this.Term.echo(bc,bd);this.Term.enable();},"Echo'":function(bc){this.Term.disable();this.Term.echo(bc);this.Term.enable();}},null,B);B.New=function(bc,bd,be,bf,bg){return new B({Voice:bc,Mic:bd,Term:be,Avatar:bf,Caption:bg});};x.waitAddPhrases=function(){C.$cctor();return C.waitAddPhrases;};x.waitRetrievePhrases=function(){C.$cctor();return C.waitRetrievePhrases;};x.helpPhrases=function(){C.$cctor();return C.helpPhrases;};x.helloUserPhrases=function(){C.$cctor();return C.helloUserPhrases;};x.helloPhrases=function(){C.$cctor();return C.helloPhrases;};x["getRandomPhrase'"]=function(bc){return d.replace_tok("$0","",V.nth(x.rng().Next(0,bc.get_Length()),bc));};x.getRandomPhrase=function(bc,bd){return d.replace_tok("$0",bd,V.nth(x.rng().Next(0,bc.get_Length()),bc));};x.rng=function(){C.$cctor();return C.rng;};C.$cctor=function(){C.$cctor=a.ignore;C.rng=new _6.New();C.helloPhrases=U.ofArray(["Welcome!","Welcome, my name is SMApp.","Welcome to SMApp. How can I help?","Hello this is SMApp, how can I help?","Hello, I am SMApp. How can I help?","Hello, I am SMApp. How may I help you now?","I'm SMApp. Tell me your name so we can get started."]);C.helloUserPhrases=U.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);C.helpPhrases=U.ofArray(["What can I help you with $0?"]);C.waitRetrievePhrases=U.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);C.waitAddPhrases=U.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};D.update=function(bc,bd,be,bf,bg){var bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6;function b7(cp){bc.Say(cp);}function b8(cp){bf.unshift(cp);b7(cp);}function b9(cp,cq){var cr;cr=x.getRandomPhrase(cp,cq);bf.unshift(cr);return bc.Say(cr);}function b_(cp){return bd.ContainsKey(cp);}function b$(cp,cq){return bd.Add(cp,cq);}function ca(cp){bd.Remove(cp);}function cb(){return bd.get_Item("user");}function cc(){bg.shift();}function cd(){be.shift();}function ce(cp){var cq;cq=D.getQuestion(cp);cq==null?(function(cr){return function(cs){return cr("No such question: "+Q.toSafe(cs));};}(_7.FailWith))(cp):be.unshift(cq.$0);}function cf(cp,cq){b$(cp,cq);ce(cp);D.debug((function(cr){return function(cs){return cr("Added question: "+H.p$8(cs)+".");};}(a.id))(be[0]));return b8(d.replace_tok("$0",cq,D.getQuestion(cp).$0.get_Text()));}function cg(cp,cq){return b_(cp)?{$:1,$0:cq}:null;}function ch(cp,cq){return!b_(cp)?{$:1,$0:cq}:null;}function ci(cp){var cq,cr;return(cr=cg("user",cp),cr!=null&&cr.$==1&&(be.length===0&&(cq=cr.$0,true)))?(cc(),{$:1,$0:cq}):null;}function cj(cp,cq){var cr,cs,ct;return(cs=cg("user",cq),cs!=null&&cs.$==1&&(D.haveQuestion(cp)&&be.length>0&&be[0].get_Name()===cp&&(cr=cs.$0,true)))?(cc(),cd(),b_(cp)?(ct=bd.get_Item(cp),(ca(cp),{$:1,$0:[cr,{$:1,$0:ct}]})):{$:1,$0:[cr,null]}):null;}function ck(cp,cq){var cr,cs,ct;return(cs=ch("user",cq),cs!=null&&cs.$==1&&(D.haveQuestion(cp)&&be.length>0&&be[0].get_Name()===cp&&(cr=cs.$0,true)))?(cc(),cd(),b_(cp)?(ct=bd.get_Item(cp),(ca(cp),{$:1,$0:[cr,{$:1,$0:ct}]})):{$:1,$0:[cr,null]}):null;}function cl(cp){var cq,cr;return(cr=ch("user",cp),cr!=null&&cr.$==1&&(be.length===0&&(cq=cr.$0,true)))?(cc(),{$:1,$0:cq}):null;}function cm(cp){var cq;return cp!=null&&cp.$==1&&(typeof cp.$0=="string"&&(cq=cp.$0,true))?{$:1,$0:cq}:null;}function cn(cp,cq,cr){var cs;return _4.Start((cs=null,_4.Delay(function(){b9(x.waitAddPhrases(),"symptom entry");return _4.Bind((new _9.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:-890470465",[cb().Name,cp,cq,cr]),function(ct){return ct==null?(b8(function(cu){return cu("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),_4.Zero()):(b8((function(cu){return function(cv){return cu("OK I added that "+Q.toSafe(cv)+" symptom to your journal.");};}(a.id))(cp)),_4.Zero());});})),null);}function co(cp){var cq;cq=null;return _4.Delay(function(){b9(x.waitRetrievePhrases(),"symptom journal");return(new _9.New()).Async("SMApp.Web:SMApp.Web.Server.getSymptomJournal:-1761137731",[cp]);});}D.debug((((P.Curried3(function(cp,cq,cr){return cp("Starting utterances:"+Q.prettyPrint(cq)+". Starting questions: "+Q.prettyPrint(cr)+".");}))(a.id))(bg))(be));bh=U.ofSeq(V.take(bg.length>=5?5:bg.length,bg));bh.$==1&&(bj=(bk=ch("started",bh.$0),bk!=null&&bk.$==1?{$:1,$0:bk.$0}:null),bj!=null&&bj.$==1&&(bl=cl(bj.$0),bl!=null&&bl.$==1&&(bm=i.Intent$1("hello",bl.$0),bm!=null&&bm.$==1&&(bm.$0[1]==null&&bh.$1.$==0))))?(bd.Add("started",true),b9(x.helloPhrases(),"")):bh.$==1&&(bo=cl(bh.$0),bo!=null&&bo.$==1&&(bp=i.Intent$1("hello",bo.$0),bp!=null&&bp.$==1&&(bp.$0[1]==null&&bh.$1.$==0)))?b8("Hello, tell me your name to get started."):bh.$==1&&(br=cl(bh.$0),br!=null&&br.$==1&&(bs=i.Intent$1("hello",br.$0),bs!=null&&bs.$==1&&(bt=i.Entity1Of1("contact",bs.$0[1]),bt!=null&&bt.$==1&&(bh.$1.$==0&&(bq=bt.$0,true)))))?(bu=bq.get_Value(),b9(x.waitRetrievePhrases(),"user name"),_4.Start((bv=null,_4.Delay(function(){return _4.Bind((new _9.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-491767581",[bu]),function(cp){var cq;return cp==null?(b8((function(cr){return function(cs){return cr("I did not find a user with the name "+Q.toSafe(cs)+".");};}(a.id))(bu)),cf("addUser",bu),_4.Zero()):(cq=cp.$0,_4.Bind((new _9.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:-1358860327",[cq.Name]),function(){bd.Add("user",cq);b9(x.helloUserPhrases(),(function(cr){return function(cs){return cr(Q.prettyPrint(cs));};}(a.id))(bd.get_Item("user")));return cq.LastLoggedIn!=null?_4.Bind((new _9.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:-458977748",[cq.LastLoggedIn.$0]),function(cr){b8((function(cs){return function(ct){return cs("You last logged in "+Q.toSafe(ct)+".");};}(a.id))(cr));return _4.Zero();}):_4.Zero();}));});})),null)):bh.$==1&&(bx=i.Yes(bh.$0),bx!=null&&bx.$==1&&(by=ck("addUser",bx.$0),by!=null&&by.$==1&&(bz=cm(by.$0[1]),bz!=null&&bz.$==1&&(bh.$1.$==0&&(bw=bz.$0,true)))))?_4.Start((bA=null,_4.Delay(function(){b9(x.waitAddPhrases(),"user");return _4.Bind((new _9.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:-1358860327",[bw]),function(cp){return cp==null?(b8((function(cq){return function(cr){return cq("Sorry I was not able to add the user "+Q.toSafe(cr)+" to the system.");};}(a.id))(bw)),_4.Zero()):(b$("user",bw),b8((function(cq){return function(cr){return cq("Hello "+Q.prettyPrint(cr)+", nice to meet you.");};}(a.id))(bd.get_Item("user"))),_4.Zero());});})),null):bh.$==1&&(bC=i.No(bh.$0),bC!=null&&bC.$==1&&(bD=ck("addUser",bC.$0),bD!=null&&bD.$==1&&(bE=cm(bD.$0[1]),bE!=null&&bE.$==1&&(bh.$1.$==0&&(bB=bE.$0,true)))))?b8((function(cp){return function(cq){return cp("Ok I did not add the user "+Q.toSafe(cq)+". But you must login for me to help you.");};}(a.id))(bB)):bh.$==1&&((bG=cl(bh.$0),bG!=null&&bG.$==1)&&bh.$1.$==0)?b8("Could you introduce yourself so we can get started?"):bh.$==1&&(bI=ci(bh.$0),bI!=null&&bI.$==1&&(bJ=i.Intent$1("hello",bI.$0),bJ!=null&&bJ.$==1&&(bJ.$0[0]==null&&(bK=i.Entity1Of1("contact",bJ.$0[1]),bK!=null&&bK.$==1&&(bh.$1.$==0&&(bH=bK.$0,true))))))?_4.Start((bL=null,_4.Delay(function(){return _4.Bind((new _9.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-491767581",[bH.get_Value()]),function(cp){return cp==null?(b8((function(cq){return function(cr){return cq("Sorry, the user "+Q.toSafe(cr)+" does not exist.");};}(a.id))(bH.get_Value())),_4.Zero()):(cf("switchUser",cp.$0.Name),_4.Zero());});})),null):bh.$==1&&(bN=i.Yes(bh.$0),bN!=null&&bN.$==1&&(bO=cj("switchUser",bN.$0),bO!=null&&bO.$==1&&(bP=cm(bO.$0[1]),bP!=null&&bP.$==1&&(bh.$1.$==0&&(bM=bP.$0,true)))))?(bd.set_Item("user",bM),b8((function(cp){return function(cq){return cp("Ok I switched to user "+Q.prettyPrint(cq)+".");};}(a.id))(bM))):bh.$==1&&(bR=i.No(bh.$0),bR!=null&&bR.$==1&&(bS=cj("switchUser",bR.$0),bS!=null&&bS.$==1&&(bT=cm(bS.$0[1]),bT!=null&&bT.$==1&&(bh.$1.$==0&&(bQ=bT.$0,true)))))?b8((function(cp){return function(cq){return cp("Ok I did not switch to user "+Q.toSafe(cq)+".");};}(a.id))(bQ)):bh.$==1&&(bV=ci(bh.$0),bV!=null&&bV.$==1&&(bW=i.Intent$1("symptom",bV.$0),bW!=null&&bW.$==1&&(bX=i.Entity1OfAny("symptom_name",bW.$0[1]),bX!=null&&bX.$==1&&(bh.$1.$==0&&(bU=bX.$0,true)))))?_4.Start((bY=null,_4.Delay(function(){b8("Ok I'll add that entry to your symptom journal");cn(bU.get_Value(),null,null);return _4.Bind(co(cb().Name),function(){cf("painVideo","");return _4.Zero();});})),null):bh.$==1&&(b0=i.Yes(bh.$0),b0!=null&&b0.$==1&&((b1=cj("painVideo",b0.$0),b1!=null&&b1.$==1)&&bh.$1.$==0))?bc["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bh.$==1&&(b3=ci(bh.$0),b3!=null&&b3.$==1&&(b4=i.Intent$1("medjournal",b3.$0),b4!=null&&b4.$==1&&((b5=b4.$0[1],b5!=null&&b5.$==1)&&(bh.$1.$==0&&(b2=b4.$0[1].$0,true)))))?(b8("ok I added that entry to your medication journal."),b8("You should be careful not to take too many painkillers over a short period of time.")):(cc(),D.debug("Main interpreter did not understand utterance."),b8("Sorry I didn't understand what you meant."),be.length>0?(b6=V.nth(0,be),b_(b6.get_Name())?b8(d.replace_tok("$0",bd.get_Item(b6.get_Name()),b6.get_Text())):b8(b6.get_Text())):void 0);D.debug((((P.Curried3(function(cp,cq,cr){return cp("Ending utterances: "+Q.prettyPrint(cq)+". Ending questions:"+Q.prettyPrint(cr)+".");}))(a.id))(bg))(be));};D.haveQuestion=function(bc){return U.exists(function(bd){return bd.get_Name()===bc;},D.questions());};D.getQuestion=function(bc){return V.tryFind(function(bd){return bd.get_Name()===bc;},D.questions());};D.questions=function(){E.$cctor();return E.questions;};D.debug=function(bc){d.debug("Main",bc);};E.$cctor=function(){E.$cctor=a.ignore;E.questions=U.ofArray([new n({$:0,$0:"addUser",$1:"Do you want me to add the user $0?"}),new n({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?"}),new n({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new n({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new n({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};F.run=function(){var bc,bd;bc=P.ThisFunc(function(be,bf){return((F.Main().get_Text())(be))(bf);});bd=F.Main().get_Options();a.$("#term").terminal(bc,bd);return M.get_Empty();};F.Main=function(){G.$cctor();return G.Main;};F.initMic=function(bc,bd){var be,bf;bc[0]=(be=bc[0],B.New(be.Voice,{$:1,$0:new _.Microphone($.getElementById("microphone"))},be.Term,be.Avatar,be.Caption));bf=bc[0].Mic.$0;bf.onconnecting=function(){F.set_MicState(y.MicConnecting);return F.debug("Mic connecting...");};bf.ondisconnected=function(){F.set_MicState(y.MicDisconnected);return F.debug("Mic disconnected.");};bf.onaudiostart=function(){F.set_MicState(y.MicAudioStart);return F.debug("Mic audio start...");};bf.onaudioend=function(){F.set_MicState(y.MicAudioEnd);return F.debug("Mic audio end.");};bf.onerror=function(bg){F.set_MicState({$:6,$0:bg});return F.debug((function(bh){return function(bi){return bh("Mic error : "+Q.toSafe(bi)+".");};}(a.id))(bg));};bf.onready=function(){F.set_MicState(y.MicReady);return F.debug("Mic ready.");};bf.onresult=function(bg,bh){return F.ClientState().$==2?F.echo("I'm still trying to understand what you said before."):F.ClientState().$==0?d.error("Client is not intialized."):!(bg==null||bh==null)?(F.set_MicState({$:7,$0:bg,$1:bh}),F.debug((((P.Curried3(function(bi,bj,bk){return bi("Mic result: "+Q.prettyPrint(bj)+" "+Q.prettyPrint(bk)+".");}))(a.id))(bg))(bh)),bd(bc,bf,[bg,bh])):F.debug("Mic: No result returned.");};bf.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};F.sayRandom=function(bc,bd){F.say(x.getRandomPhrase(bd,bc));};F.sayVoices=function(){var bc;bc=d.toArray(d.speechSynthesis().getVoices());F["say'"]((function(bd){return function(be){return bd("There are currently "+a.String(be)+" voices installed on this computer or device.");};}(a.id))(T.length(bc)));T.iteri(function(bd,be){return F["say'"](((((P.Curried(function(bf,bg,bh,bi){return bf("Voice "+a.String(bg)+". Name: "+Q.toSafe(bh)+", Local: "+Q.prettyPrint(bi)+".");},4))(a.id))(bd))(be.name))(be.localService));},bc);};F.say=function(bc){F.Responses().unshift(bc);F["say'"](bc);};F["say'"]=function(bc){F.CUI().Say(bc);};F.initSpeech=function(bc){var bd,be,bf,bg;bd=d.toArray(F.synth().getVoices());T.length(bd)>0?(be=T.find(function(bh){return bh["default"];},bd),bc[0]=(bf=bc[0],B.New({$:1,$0:be},bf.Mic,bf.Term,bf.Avatar,bf.Caption)),bg=bc[0],F.debug((function(bh){return function(bi){return bh("Using browser speech synthesis voice "+Q.toSafe(bi)+".");};}(a.id))(bg.Voice.$0.name)),bg.Avatar.nativeVoice=true,bg.Avatar.nativeVoiceName=be.name):F.echo("No browser speech synthesis voice is available. Falling back to CMU TTS.");};F.synth=function(){G.$cctor();return G.synth;};F.push=function(bc){F.Utterances().unshift(bc);return F.Utterances();};F.Props=function(){G.$cctor();return G.Props;};F.Responses=function(){G.$cctor();return G.Responses;};F.Questions=function(){G.$cctor();return G.Questions;};F.Utterances=function(){G.$cctor();return G.Utterances;};F.wait=function(bc){d["Terminal.Echo'"](F.CUI().Term,"please wait");F.CUI().Term.pause();bc();F.CUI().Term.resume();};F.debug=function(bc){d.debug("CLIENT",bc);};F.echo=function(bc){d["Terminal.EchoHtml'"](F.CUI().Term,(function(bd){return function(be){return bd(Q.prettyPrint(be));};}(a.id))(bc));};F.ClientState=function(){G.$cctor();return G.ClientState;};F.set_ClientState=function(bc){G.$cctor();G.ClientState=bc;};F.MicState=function(){G.$cctor();return G.MicState;};F.set_MicState=function(bc){G.$cctor();G.MicState=bc;};F.CUI=function(){G.$cctor();return G.CUI;};F.set_CUI=function(bc){G.$cctor();G.CUI=bc;};G.$cctor=function(){var bc,bd,be,bf,bg,bh;G.$cctor=a.ignore;function bi(bk,bl,bm){var bn,bo,bp,bq,br,bs,bt,bu,bv,bw;bn=bm[0];bo=bm[1];F.debug((((P.Curried3(function(bx,by,bz){return bx("Voice: "+Q.prettyPrint(by)+" "+Q.prettyPrint(bz));}))(a.id))(bn))(bo));bp=(bq=o["Intent'"](bn,bo),bq!=null&&bq.$==1?{$:1,$0:bq.$0}:null);br=(bs=o["Trait'"](bo),bs!=null&&bs.$==1?{$:1,$0:U.ofArray([bs.$0])}:null);bt=(bu=o["Entity'$1"](bo),bu!=null&&bu.$==1?{$:1,$0:U.ofArray([bu.$0])}:null);return bp==null&&(br==null&&bt==null)?null:(F.debug(((((P.Curried(function(bx,by,bz,bA){return bx("Voice: "+H.p(by)+" "+H.p$3(bz)+" "+H.p$5(bA));},4))(a.id))(bp))(br))(bt)),bw=F.push(new m({$:0,$0:bp,$1:br,$2:bt})),D.update(bk[0],F.Props(),F.Questions(),F.Responses(),bw));}function bj(bk,bl,bm){var bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz;bk[0]=B.New(F.CUI().Voice,F.CUI().Mic,bl,F.CUI().Avatar,F.CUI().Caption);ba.Equals(bk[0].Mic,null)?F.initMic(bk,bi):void 0;ba.Equals(bk[0].Voice,null)?F.initSpeech(bk):void 0;bn=bk[0];F.ClientState().$===0?F.set_ClientState(z.ClientReady):void 0;return(bo=q.Blank(bm),bo!=null&&bo.$==1)?F["say'"]("Tell me what you want me to do or ask me a question."):(bp=q.Debug(bm),bp!=null&&bp.$==1)?(F.debug((function(bA){return function(bB){return bA("Utterances: "+Q.prettyPrint(bB));};}(a.id))(F.Utterances())),F.debug((function(bA){return function(bB){return bA("Questions: "+Q.prettyPrint(bB));};}(a.id))(F.Questions())),bq=self.document.createElement("insert"),br=M.Element("div",[W.Create("id","bar")],[]),L.LoadLocalTemplates(""),M.RunAppend(bq,br),F.debug(bq.innerHTML)):(bs=q.Voices(bm),bs!=null&&bs.$==1)?F.sayVoices():F.ClientState().$==1?(bu=q.QuickHello(bm),bu!=null&&bu.$==1?(bt=bu.$0,true):(bv=q.QuickHelp(bm),bv!=null&&bv.$==1?(bt=bv.$0,true):(bw=q.QuickYes(bm),bw!=null&&bw.$==1?(bt=bw.$0,true):(bx=q.QuickNo(bm),bx!=null&&bx.$==1&&(bt=bx.$0,true)))))?(F.debug((function(bA){return function(bB){return bA("Quick Text: "+H.p$7(bB)+".");};}(a.id))(bt)),by=F.push(bt),D.update(bn,F.Props(),F.Questions(),F.Responses(),by),F.set_ClientState(z.ClientReady)):bn.Wait((bz=null,_4.Delay(function(){F.set_ClientState(z.ClientUnderstand);q.getUtterance(bm,function(bA){var bB,bC,bD;bB=q.HasUtterance(bA);bB!=null&&bB.$==1?(bC=bB.$0,F.debug(((((P.Curried(function(bE,bF,bG,bH){return bE("Text: Intent: "+H.p(bF)+", Traits: "+H.p$3(bG)+", Entities: "+H.p$5(bH));},4))(a.id))(bC.get_Intent()))(bC.get_Traits()))(bC.get_Entities())),bD=F.push(bC),D.update(bn,F.Props(),F.Questions(),F.Responses(),bD)):(F.debug("Text: Did not receive a meaning from the server."),F["say'"]("Sorry I did not understand what you said."));});F.set_ClientState(z.ClientReady);return _4.Zero();}))):F.ClientState().$==0?d.error("Client is not initialized."):F["say'"]("I'm still trying to understand what you said before.");}G.CUI=B.New(null,null,null,(_5.applicationId="4277115329081938617",bc=new a.SDKConnection(),bd=new a.WebAvatar(),bd.version=8.5,bd.connection=bc,bd.avatar="22225225",bd.voice="cmu-slt",bd.voiceMod="default",bd.nativeVoice=true,bd.nativeVoiceName="Microsoft David Desktop - English (United States)",bd.width=300,bd.createBox(),bd.addMessage(""),bd.processMessages(0),bd),false);G.MicState=y.MicNotInitialized;G.ClientState=z.ClientNotInitialzed;G.Utterances=[];G.Questions=[];G.Responses=[];G.Props=new bb.New$5();G.synth=a.speechSynthesis;G.Main=(be=(bf={},bf.name="Main",bf.greetings="Welcome to SMApp. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bf.prompt=">",bf),new A({$:0,$0:(bg=[F.CUI()],(P.Curried3(bi))(bg)),$1:[(bh=[F.CUI()],(P.Curried3(bj))(bh)),be]}));};H.p$8=function(bc){return"Question ("+Q.prettyPrint(bc.$0)+", "+Q.prettyPrint(bc.$1)+")";};H.p$2=function(bc){return bc==null?"null":"Some "+Q.prettyPrint(bc.$0);};H.p$1=function(bc){return"Intent ("+Q.prettyPrint(bc.$0)+", "+H.p$2(bc.$1)+")";};H.p=function(bc){return bc==null?"null":"Some "+H.p$1(bc.$0);};H.p$4=function(bc){return"Trait ("+Q.prettyPrint(bc.$0)+", "+Q.prettyPrint(bc.$1)+", "+H.p$2(bc.$2)+")";};H.p$3=function(bc){return bc==null?"null":"Some "+Q.printList(function(bd){return H.p$4(bd);},bc.$0);};H.p$6=function(bc){return"Entity ("+Q.prettyPrint(bc.$0)+", "+Q.prettyPrint(bc.$1)+", "+H.p$2(bc.$2)+")";};H.p$5=function(bc){return bc==null?"null":"Some "+Q.printList(function(bd){return H.p$6(bd);},bc.$0);};H.p$7=function(bc){return"Utterance ("+H.p(bc.$0)+", "+H.p$3(bc.$1)+", "+H.p$5(bc.$2)+")";};}());
