(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=c.Bs=c.Bs||{};i=b.NLU=b.NLU||{};j=i.Babelfy=i.Babelfy||{};k=j.ApiResponse=j.ApiResponse||{};l=j.TokenFragment=j.TokenFragment||{};m=j.CharFragment=j.CharFragment||{};n=i.Witai=i.Witai||{};o=c.NLU=c.NLU||{};p=o.Intent=o.Intent||{};q=o.Trait=o.Trait||{};r=o.Entity=o.Entity||{};s=o.Utterance=o.Utterance||{};t=o.Question=o.Question||{};u=o.Voice=o.Voice||{};v=u["Entity'"]=u["Entity'"]||{};w=o.Text=o.Text||{};x=w["Utterance'"]=w["Utterance'"]||{};y=w["Intent'"]=w["Intent'"]||{};z=w["Entity'"]=w["Entity'"]||{};A=w["Trait'"]=w["Trait'"]||{};B=o.Domain=o.Domain||{};C=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};D=c.CUI=c.CUI||{};E=D.MicState=D.MicState||{};F=D.ClientState=D.ClientState||{};G=D.Interpreter=D.Interpreter||{};H=D.CUI=D.CUI||{};I=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};J=c.Main=c.Main||{};K=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};L=c.Client=c.Client||{};M=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};N=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};O=a.WebSharper;P=O&&O.UI;Q=P&&P.Client;R=Q&&Q.Templates;S=P&&P.Doc;T=O&&O.Strings;U=a.IntelliFactory;V=U&&U.Runtime;W=O&&O.Utils;X=a.console;Y=a.jQuery;Z=O&&O.Arrays;_0=O&&O.List;_1=O&&O.Seq;_2=P&&P.AttrProxy;_3=O&&O.Concurrency;_4=O&&O.JavaScript;_5=_4&&_4.Pervasives;_6=O&&O.Collections;_7=_6&&_6.Map;_8=a.SDK;_9=O&&O.Random;_=O&&O.Operators;$=O&&O.Remoting;ba=$&&$.AjaxRemotingProvider;bb=a.Wit;bc=a.document;bd=O&&O.Unchecked;be=_6&&_6.Dictionary;d.speechSynthesis=function(){return a.speechSynthesis;};d.elementHTML=function(bf){return bf.innerHTML;};d.createElement=function(bf,bg){var bh;bh=self.document.createElement(bf);R.LoadLocalTemplates("");S.RunAppend(bh,bg);return bh;};d.replace_tok=function(bf,bg,bh){return T.Replace(bh,bf,bg);};d.toLower=function(bf){return bf.toLowerCase();};d.debug=function(bf,bg){d.info((((V.Curried3(function(bh,bi,bj){return bh("DEBUG: "+W.toSafe(bi)+": "+W.prettyPrint(bj));}))(a.id))(bf.toUpperCase()))(bg));};d.error=function(bf){X.error(bf);};d.info=function(bf){X.info(bf);};d.jserror=function(bf){Y.error(bf);};d.toArray=function(bf){return Z.map(a.id,Y.makeArray(bf));};d["Terminal.EchoHtml'"]=function(bf,bg){bf.pause();bf.echo(bg,d.rawOpt());bf.resume();};d["Terminal.Echo'"]=function(bf,bg){bf.pause();bf.echo(bg);bf.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=V.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(bf){function bg(bh){return function(bi){var bj,bk,bl,bm,bn,bo,bp;bk=T.replicate(bh," ");switch(bi.$==0?bi.$1.$==1?bi.$1.$0.$==2?bi.$1.$1.$==0?(bj=[bi.$1.$0.$0,bi.$0],1):(bj=[bi.$1,bi.$0],2):(bj=[bi.$1,bi.$0],2):(bj=[bi.$1,bi.$0],2):bi.$==2?(bj=bi.$0,3):(bj=[bi.$0,bi.$1],0)){case 0:return bj[0]+"=\""+bj[1]+"\"";case 1:bl=bj[1];return bk+"<"+bl+">"+bj[0]+"</"+bl+">\r\n";case 2:bm=bj[1];bn=_0.partition(function(bq){return bq.$==1;},bj[0]);bo=bn[1];bp=bn[0];return bo.$==0?bk+"<"+bm+(bp.$===0?"":" "+T.concat(" ",_0.ofSeq(_1.delay(function(){return _1.map(function(bq){return(bg(0))(bq);},bp);}))))+"/>\r\n":bk+"<"+bm+(bp.$===0?"":" "+T.concat(" ",_0.ofSeq(_1.delay(function(){return _1.map(function(bq){return(bg(0))(bq);},bp);}))))+">\r\n"+T.concat("",_0.ofSeq(_1.delay(function(){return _1.map(function(bq){return(bg(bh+1))(bq);},bo);})))+bk+"</"+bm+">\r\n";case 3:return bk+bj+"\r\n";}};}return(bg(0))(bf);};f.alt=function(bf){return new e({$:1,$0:"alt",$1:bf});};f.src=function(bf){return new e({$:1,$0:"src",$1:bf});};f.cls=function(bf){return new e({$:1,$0:"class",$1:bf});};f.str=function(bf){return e.toString(bf);};f.op_PercentEquals=function(bf,bg){return new e({$:1,$0:bf,$1:bg});};f.op_Splice=function(bf){var bg;return _0.ofArray([new e({$:2,$0:(bg=bf,a.String(bg))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(bf,bg){return new e({$:0,$0:bf,$1:bg});};g.$cctor=function(){var bf;g.$cctor=a.ignore;g.rawOpt=(bf={},bf.raw=true,bf);g.html=function(bg){return f.elem("html",bg);};g.head=function(bg){return f.elem("head",bg);};g.title=function(bg){return f.elem("title",bg);};g.style=function(bg){return f.elem("style",bg);};g.body=function(bg){return f.elem("body",bg);};g.div=function(bg){return f.elem("div",bg);};g.br=function(bg){return f.elem("br",bg);};g.section=function(bg){return f.elem("section",bg);};g.span=function(bg){return f.elem("span",bg);};g.table=function(bg){return f.elem("table",bg);};g.thead=function(bg){return f.elem("thead",bg);};g.tbody=function(bg){return f.elem("tbody",bg);};g.tfoot=function(bg){return f.elem("tfoot",bg);};g.img=function(bg){return f.elem("img",bg);};g.map=function(bg){return f.elem("map",bg);};g.area=function(bg){return f.elem("area",bg);};g.p=function(bg){return f.elem("p",bg);};g.a=function(bg){return f.elem("a",bg);};g.tr=function(bg){return f.elem("tr",bg);};g.td=function(bg){return f.elem("td",bg);};g.th=function(bg){return f.elem("th",bg);};g.ul=function(bg){return f.elem("ul",bg);};g.li=function(bg){return f.elem("li",bg);};g.h1=function(bg){return f.elem("h1",bg);};g.h2=function(bg){return f.elem("h1",bg);};g.h3=function(bg){return f.elem("h1",bg);};g.h4=function(bg){return f.elem("h1",bg);};g.strong=function(bg){return f.elem("strong",bg);};};h.Radio=function(bf,bg,bh,bi,bj){return S.Element("div",new _0.T({$:1,$0:h.cls("radio"),$1:bg}),[S.Element("label",bi,[S.Radio(bj,true,bh),S.TextNode(bf)])]);};h.checkbox=function(bf,bg,bh,bi,bj){return S.Element("div",new _0.T({$:1,$0:h.cls("checkbox"),$1:bg}),[S.Element("label",bi,[S.CheckBox(bj,bh),S.TextNode(bf)])]);};h.textArea=function(bf,bg,bh,bi,bj){return S.Element("div",new _0.T({$:1,$0:h.cls("form-group"),$1:bg}),[S.Element("label",bi,[S.TextNode(bf)]),S.InputArea(new _0.T({$:1,$0:h.cls("form-control"),$1:bj}),bh)]);};h.inputPassword=function(bf,bg,bh,bi,bj){return S.Element("div",new _0.T({$:1,$0:h.cls("form-group"),$1:bg}),[S.Element("label",bi,[S.TextNode(bf)]),S.PasswordBox(new _0.T({$:1,$0:h.cls("form-control"),$1:bj}),bh)]);};h.input=function(bf,bg,bh,bi,bj){return S.Element("div",new _0.T({$:1,$0:h.cls("form-group"),$1:bg}),[S.Element("label",bi,[S.TextNode(bf)]),S.Input([h.cls("form-control"),bj],bh)]);};h.btn=function(bf){return S.Element("button",[h.eid(bf),h.cls("btn")],[]);};h.container=function(bf){return S.Element("div",[h.cls("container")],bf);};h.cls=function(bf){return _2.Create("class",bf);};h.eid=function(bf){return _2.Create("id",bf);};k.New=function(bf,bg,bh,bi,bj,bk,bl,bm,bn){return{tokenFragment:bf,charFragment:bg,babelSynsetID:bh,DBpediaURL:bi,BabelNetURL:bj,score:bk,cohrenceScore:bl,globalScore:bm,source:bn};};l.New=function(bf,bg){return{start:bf,end:bg};};m.New=function(bf,bg){return{start:bf,end:bg};};j.disambiguate=function(bf){function bg(bh,bi){var bj;Y.ajax((bj={},bj.url=(function(bk){return function(bl){return bk("https://babelfy.io/v1/disambiguate?text="+W.toSafe(bl)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bf),bj.type="GET",bj.success=function(bk){return bh(bk);},bj.error=function(bk){return bi(new a.Error(bk.responseText));},bj));}return _3.FromContinuations(function(bh,bi,bj){return bg.apply(null,[bh,bi,bj]);});};n.getMeaning=function(bf,bg,bh,bi){var bj;Y.ajax((bj={},bj.url=(function(bk){return function(bl){return bk("https://api.wit.ai/message?q="+W.toSafe(bl));};}(a.id))(bg),bj.type="GET",bj.beforeSend=function(bk){return bk.setRequestHeader("Authorization","Bearer "+bf);},bj.success=bh,bj.error=bi,bj));};p=o.Intent=V.Class({toString:function(){return(((V.Curried3(function(bf,bg,bh){return bf("Intent("+W.toSafe(bg)+", "+N.p$2(bh)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,p);q=o.Trait=V.Class({toString:function(){return(((V.Curried3(function(bf,bg,bh){return bf("Trait("+W.toSafe(bg)+", "+W.prettyPrint(bh)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,q);r=o.Entity=V.Class({toString:function(){return((((V.Curried(function(bf,bg,bh,bi){return bf("Entity("+W.toSafe(bg)+", "+W.toSafe(bh)+", "+N.p$2(bi)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,r);s=o.Utterance=V.Class({toString:function(){return((((V.Curried(function(bf,bg,bh,bi){return bf(N.p(bg)+" "+N.p$3(bh)+" "+N.p$5(bi));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bf;bf=this.$2;return bf!=null?{$:1,$0:_0.sortBy(function(bg){return bg.get_Name();},bf.$0)}:null;},get_Traits:function(){var bf;bf=this.$1;return bf!=null?{$:1,$0:_0.sortBy(function(bg){return bg.get_Name();},bf.$0)}:null;},get_Intent:function(){return this.$0;}},null,s);t=o.Question=V.Class({toString:function(){return(((V.Curried3(function(bf,bg,bh){return bf("Name: "+W.toSafe(bg)+" Text: "+W.toSafe(bh));}))(a.id))(this.get_Name()))(this.get_Text());},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,t);v.New=function(bf,bg,bh,bi,bj){return{body:bf,end:bg,start:bh,suggested:bi,value:bj};};u["Intent'"]=function(bf,bg){return!(bg.intent==null)?{$:1,$0:new p({$:0,$0:d.toLower(bg.intent.value),$1:null})}:null;};u["Trait'"]=function(bf){return!(bf.domain==null)?{$:1,$0:new q({$:0,$0:"domain",$1:d.toLower(bf.domain.value),$2:null})}:!(bf.dialogue_act==null)?{$:1,$0:new q({$:0,$0:"dialogue_act",$1:d.toLower(bf.dialogue_act.value),$2:null})}:null;};u["Entity'$1"]=function(bf){return!(bf.contact==null)?{$:1,$0:new r({$:0,$0:"contact",$1:d.toLower(bf.contact.value),$2:null})}:null;};x=w["Utterance'"]=V.Class({get_TopIntent:function(){return _0.head(_0.sortBy(function(bf){return bf.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$2;},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,x);y=w["Intent'"]=V.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,y);z=w["Entity'"]=V.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,z);A=w["Trait'"]=V.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,A);w.HasUtterance=function(bf){var bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt;return bf!=null&&bf.$==1&&(bf.$0.$0.$==0&&(bf.$0.$1.get_Length()>0&&(bg=[bf.$0.$1,bf.$0.$2],true)))?(bh=_0.map(function(bu){return new r({$:0,$0:d.toLower(bu.get_Role()),$1:bu.get_Value(),$2:{$:1,$0:bu.get_Confidence()}});},_0.filter(function(bu){return bu.get_Confidence()>w.entityConfidenceThreshold();},bg[0])),{$:1,$0:new s({$:0,$0:null,$1:{$:1,$0:_0.map(function(bu){return new q({$:0,$0:d.toLower(bu.get_Name()),$1:bu.get_Value(),$2:{$:1,$0:bu.get_Confidence()}});},_0.filter(function(bu){return bu.get_Confidence()>w.entityConfidenceThreshold();},bg[1]))},$2:{$:1,$0:bh}})}):bf!=null&&bf.$==1&&(bf.$0.$1.$==0&&(bf.$0.$2.$==0&&(bf.$0.$0.get_Length()>0&&bf.$0.get_TopIntent().get_Confidence()>w.intentConfidenceThreshold()&&(bi=[bf.$0.$0,bf],true))))?(bj=bi[1],{$:1,$0:new s({$:0,$0:{$:1,$0:new p({$:0,$0:d.toLower(bj.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bj.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):bf!=null&&bf.$==1&&(bf.$0.$2.$==0&&(bf.$0.$0.get_Length()>0&&bf.$0.get_TopIntent().get_Confidence()>w.intentConfidenceThreshold()&&(bk=[bf.$0.$0,bf],true)))?(bl=bk[1],(bm=_0.map(function(bu){return new r({$:0,$0:d.toLower(bu.get_Role()),$1:bu.get_Value(),$2:{$:1,$0:bu.get_Confidence()}});},_0.filter(function(bu){return bu.get_Confidence()>w.entityConfidenceThreshold();},bl.$0.get_Entities())),{$:1,$0:new s({$:0,$0:{$:1,$0:new p({$:0,$0:d.toLower(bl.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bl.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:bm}})})):bf!=null&&bf.$==1&&(bf.$0.$1.$==0&&(bf.$0.$0.get_Length()>0&&bf.$0.get_TopIntent().get_Confidence()>w.intentConfidenceThreshold()&&(bn=[bf.$0.$0,bf],true)))?(bo=bn[1],(bp=_0.map(function(bu){return new q({$:0,$0:d.toLower(bu.get_Name()),$1:bu.get_Value(),$2:{$:1,$0:bu.get_Confidence()}});},_0.filter(function(bu){return bu.get_Confidence()>w.entityConfidenceThreshold();},bo.$0.get_Traits())),{$:1,$0:new s({$:0,$0:{$:1,$0:new p({$:0,$0:d.toLower(bo.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bo.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bp},$2:null})})):bf!=null&&bf.$==1&&(bf.$0.$0.get_Length()>0&&bf.$0.get_TopIntent().get_Confidence()>w.intentConfidenceThreshold()&&(bq=[bf.$0.$0,bf],true))?(br=bq[1],(bs=_0.map(function(bu){return new r({$:0,$0:d.toLower(bu.get_Role()),$1:bu.get_Value(),$2:{$:1,$0:bu.get_Confidence()}});},_0.filter(function(bu){return bu.get_Confidence()>w.entityConfidenceThreshold();},br.$0.get_Entities())),(bt=_0.map(function(bu){return new q({$:0,$0:d.toLower(bu.get_Name()),$1:bu.get_Value(),$2:{$:1,$0:bu.get_Confidence()}});},_0.filter(function(bu){return bu.get_Confidence()>w.entityConfidenceThreshold();},br.$0.get_Traits())),{$:1,$0:new s({$:0,$0:{$:1,$0:new p({$:0,$0:d.toLower(br.$0.get_TopIntent().get_Name()),$1:{$:1,$0:br.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bt},$2:{$:1,$0:bs}})}))):null;};w.entityConfidenceThreshold=function(){C.$cctor();return C.entityConfidenceThreshold;};w.set_entityConfidenceThreshold=function(bf){C.$cctor();C.entityConfidenceThreshold=bf;};w.intentConfidenceThreshold=function(){C.$cctor();return C.intentConfidenceThreshold;};w.set_intentConfidenceThreshold=function(bf){C.$cctor();C.intentConfidenceThreshold=bf;};w.getUtterance=function(bf,bg){n.getMeaning("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bf,function(bh){var bi,bj;d.debug("NLU",(function(bk){return function(bl){return bk("Wit.ai returned: "+W.prettyPrint(bl));};}(a.id))(bh));bi=!(bh.intents==null)?_0.ofArray(Z.map(function(bk){return new y({$:0,$0:bk.name,$1:bk.confidence});},bh.intents)):_0.T.Empty;bj=!(bh.traits==null)?_0.ofSeq(_1.concat(_0.map(function(bk){return Z.map(function(bl){return new A({$:0,$0:bk,$1:bl.confidence,$2:bl.value});},_5.GetJS(bh.traits,[bk]));},_0.filter(function(bk){return!(_5.GetJS(bh.traits,[bk])==null);},w.trait_types())))):_0.T.Empty;return bg({$:1,$0:new x({$:0,$0:bi,$1:!(bh.intents==null)?_0.ofSeq(_1.concat(_0.map(function(bk){return Z.map(function(bl){return new z({$:0,$0:bl.name,$1:bl.confidence,$2:bl.role,$3:bl.value});},_5.GetJS(bh.entities,[bk]));},_0.filter(function(bk){return!(_5.GetJS(bh.entities,[bk])==null);},w.entity_types())))):_0.T.Empty,$2:bj})});},function(bh,bi,bj){d.error((((V.Curried3(function(bk,bl,bm){return bk("Wit.ai returned: "+W.prettyPrint(bl)+" "+W.prettyPrint(bm));}))(a.id))(bi))(bj));return bg(null);});};w.trait_types=function(){C.$cctor();return C.trait_types;};w.entity_types=function(){C.$cctor();return C.entity_types;};w.QuickPrograms=function(bf){return bf==="programs"?{$:1,$0:new s({$:0,$0:{$:1,$0:new p({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};w.QuickNumber=function(bf){var bg,bh,bi;return(bh=w.One(bf),bh!=null&&bh.$==1?(bg=bh.$0,true):(bi=w.Two(bf),bi!=null&&bi.$==1&&(bg=bi.$0,true)))?{$:1,$0:bg}:null;};w.Three=function(bf){var bg;return bf==="3"||bf==="three"?{$:1,$0:new s({$:0,$0:{$:1,$0:new p({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_0.ofArray([new r({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};w.Two=function(bf){var bg;return bf==="2"||bf==="two"?{$:1,$0:new s({$:0,$0:{$:1,$0:new p({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_0.ofArray([new r({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};w.One=function(bf){var bg;return bf==="1"||bf==="one"?{$:1,$0:new s({$:0,$0:{$:1,$0:new p({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_0.ofArray([new r({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};w.QuickNo=function(bf){var bg;return bf==="no"||(bf==="NO"||(bf==="No"||(bf==="nope"||(bf==="no way"||(bf==="nah"||(bf==="don't do it"||bf==="stop"))))))?{$:1,$0:new s({$:0,$0:{$:1,$0:new p({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};w.QuickYes=function(bf){var bg;return bf==="yes"||(bf==="YES"||(bf==="Yes"||(bf==="YEs"||(bf==="ok"||(bf==="sure"||(bf==="yeah"||(bf==="yep"||(bf==="uh huh"||(bf==="go ahead"||bf==="go")))))))))?{$:1,$0:new s({$:0,$0:{$:1,$0:new p({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};w.QuickHelp=function(bf){var bg;return bf==="help"||(bf==="help me"||(bf==="what's this?"||bf==="huh"))?{$:1,$0:new s({$:0,$0:{$:1,$0:new p({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};w.QuickHello=function(bf){var bg;return bf==="hello"||(bf==="hey"||(bf==="yo"||bf==="hi"))?{$:1,$0:new s({$:0,$0:{$:1,$0:new p({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};w.Voices=function(bf){return bf==="voices"?{$:1,$0:null}:null;};w.Debug=function(bf){return bf==="debug"?{$:1,$0:null}:null;};w.Blank=function(bf){return bf===""?{$:1,$0:null}:null;};B.Study=function(bf){return bf.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};o.No=function(bf){var bg,bh,bi,bj,bk,bl;return(bh=o.Intent$1("no",bf),bh!=null&&bh.$==1&&(bh.$0[0]==null&&(bh.$0[1]==null&&(bg=bf,true))))?{$:1,$0:bg}:(bj=o.Intent$1("noresponse",bf),bj!=null&&bj.$==1&&(bj.$0[0]==null&&(bj.$0[1]==null&&(bi=bf,true))))?{$:1,$0:bi}:(bl=o.Intent$1("NoResponse",bf),bl!=null&&bl.$==1&&(bl.$0[0]==null&&(bl.$0[1]==null&&(bk=bf,true))))?{$:1,$0:bk}:null;};o.Yes=function(bf){var bg,bh,bi,bj,bk,bl;return(bh=o.Intent$1("yes",bf),bh!=null&&bh.$==1&&(bh.$0[0]==null&&(bh.$0[1]==null&&(bg=bf,true))))?{$:1,$0:bg}:(bj=o.Intent$1("yesresponse",bf),bj!=null&&bj.$==1&&(bj.$0[0]==null&&(bj.$0[1]==null&&(bi=bf,true))))?{$:1,$0:bi}:(bl=o.Intent$1("YesResponse",bf),bl!=null&&bl.$==1&&(bl.$0[0]==null&&(bl.$0[1]==null&&(bk=bf,true))))?{$:1,$0:bk}:null;};o.EntityManyofMany=function(bf,bg){return{$:1,$0:_7.OfArray(Z.ofSeq(_0.map(function(bh){return _0.exists(function(bi){return bi.get_Name()===bh;},bg)?[bh,{$:1,$0:_0.filter(function(bi){return bi.get_Name()===bh;},bg)}]:[bh,null];},bf)))};};o.EntityManyOf1=function(bf,bg){var bh;return bg!=null&&bg.$==1&&(_0.exists(function(bi){return bi.get_Name()===bf;},bg.$0)&&(bh=bg.$0,true))?{$:1,$0:_0.filter(function(bi){return bi.get_Name()===bf;},bh)}:null;};o.Entity1OfAny=function(bf,bg){var bh;return bg!=null&&bg.$==1&&(_0.exists(function(bi){return bi.get_Name()===bf;},bg.$0)&&(bh=bg.$0,true))?{$:1,$0:_0.head(_0.sortBy(function(bi){return bi.get_Name();},_0.filter(function(bi){return bi.get_Name()===bf;},bh)))}:null;};o.Entity1Of1=function(bf,bg){var bh;return bg!=null&&bg.$==1&&(bg.$0.$==1&&(bg.$0.$1.$==0&&(bg.$0.$0.get_Name()===bf&&(bh=bg.$0.$0,true))))?{$:1,$0:bh}:null;};o.Intent$1=function(bf,bg){return bg.get_Intent()!=null&&bg.get_Intent().$0.get_Name()===bf?{$:1,$0:[bg.get_Traits(),bg.get_Entities()]}:null;};C.$cctor=function(){C.$cctor=a.ignore;C.entity_types=_0.ofArray(["wit$contact:contact","wit$datetime:datetime","subject:subject","term:term"]);C.trait_types=_0.ofArray(["domain","dialogue_act"]);C.intentConfidenceThreshold=0.85;C.entityConfidenceThreshold=0.85;};E.MicReady={$:5};E.MicAudioEnd={$:4};E.MicAudioStart={$:3};E.MicDisconnected={$:2};E.MicConnecting={$:1};E.MicNotInitialized={$:0};F.ClientUnderstand={$:2};F.ClientReady={$:1};F.ClientNotInitialzed={$:0};G=D.Interpreter=V.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,G);H=D.CUI=V.Class({SayVoices:function(){var bf,bg,bh;bf=this;bg=a.speechSynthesis.getVoices();!(bg==null)?(bh=d.toArray(bg),bf.Say((function(bi){return function(bj){return bi("There are currently "+a.String(bj)+" voices installed on this computer or device.");};}(a.id))(Z.length(bh))),Z.iteri(function(bi,bj){return bf.Say(((((V.Curried(function(bk,bl,bm,bn){return bk("Voice "+a.String(bl)+". Name: "+W.toSafe(bm)+", Local: "+W.prettyPrint(bn)+".");},4))(a.id))(bi))(bj.name))(bj.localService));},bh)):void 0;},Wait:function(bf){this.Wait$1(function(){_3.Start(bf,null);});},Wait$1:function(bf){this["Echo'"]("please wait...");this.Term.pause();bf();this.Term.resume();},sayRandom:function(bf,bg){this.Say(D.getRandomPhrase(bf,bg));},SayAngry:function(bf){var bg,bh;bg=this;_3.Start((bh=null,_3.Delay(function(){return _3.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),_8.chime(),_3.Zero()):_3.Zero(),_3.Delay(function(){a.addMessage(bg.Avatar,bf,"","");bg.Avatar.processMessages(0);return _3.Zero();}));})),null);},Say:function(bf){var bg,bh;bg=this;_3.Start((bh=null,_3.Delay(function(){return _3.Combine(a.speechSynthesis.speaking?(_8.chime(),_3.Zero()):_3.Zero(),_3.Delay(function(){bg.Avatar.addMessage(bf);bg.Avatar.processMessages(0);return _3.Zero();}));})),null);},Debug:function(bf,bg){d.debug(bf,bg);},"EchoHtml'":function(bf){var bg,bh;bg=(bh={},bh.raw=true,bh);this.Term.disable();this.Term.echo(bf,bg);this.Term.enable();},"Echo'":function(bf){this.Term.disable();this.Term.echo(bf);this.Term.enable();}},null,H);H.New=function(bf,bg,bh,bi,bj){return new H({Voice:bf,Mic:bg,Term:bh,Avatar:bi,Caption:bj});};D.waitAddPhrases=function(){I.$cctor();return I.waitAddPhrases;};D.waitRetrievePhrases=function(){I.$cctor();return I.waitRetrievePhrases;};D.helpPhrases=function(){I.$cctor();return I.helpPhrases;};D.helloUserPhrases=function(){I.$cctor();return I.helloUserPhrases;};D.helloPhrases=function(){I.$cctor();return I.helloPhrases;};D["getRandomPhrase'"]=function(bf){return d.replace_tok("$0","",_1.nth(D.rng().Next(0,bf.get_Length()),bf));};D.getRandomPhrase=function(bf,bg){return d.replace_tok("$0",bg,_1.nth(D.rng().Next(0,bf.get_Length()),bf));};D.rng=function(){I.$cctor();return I.rng;};I.$cctor=function(){I.$cctor=a.ignore;I.rng=new _9.New();I.helloPhrases=_0.ofArray(["Welcome!","Welcome, my name is SMApp.","Welcome to SMApp. How can I help?","Hello this is SMApp, how can I help?","Hello, I am SMApp. How can I help?","Hello, I am SMApp. How may I help you now?","I'm SMApp. Tell me your name so we can get started."]);I.helloUserPhrases=_0.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);I.helpPhrases=_0.ofArray(["What can I help you with $0?"]);I.waitRetrievePhrases=_0.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);I.waitAddPhrases=_0.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};J.update=function(bf,bg,bh,bi,bj){var bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9;function b_(cs){bf.Say(cs);}function b$(cs){bi.unshift(cs);b_(cs);}function ca(cs,ct){var cu;cu=D.getRandomPhrase(cs,ct);bi.unshift(cu);return bf.Say(cu);}function cb(cs){return bg.ContainsKey(cs);}function cc(cs,ct){return bg.Add(cs,ct);}function cd(cs){bg.Remove(cs);}function ce(){return bg.get_Item("user");}function cf(){bj.shift();}function cg(){bh.shift();}function ch(cs){var ct;ct=J.getQuestion(cs);ct==null?(function(cu){return function(cv){return cu("No such question: "+W.toSafe(cv));};}(_.FailWith))(cs):bh.unshift(ct.$0);}function ci(cs,ct){cc(cs,ct);ch(cs);J.debug((function(cu){return function(cv){return cu("Added question: "+N.p$8(cv)+".");};}(a.id))(bh[0]));return b$(d.replace_tok("$0",ct,J.getQuestion(cs).$0.get_Text()));}function cj(cs,ct){return cb(cs)?{$:1,$0:ct}:null;}function ck(cs,ct){return!cb(cs)?{$:1,$0:ct}:null;}function cl(cs){var ct,cu;return(cu=cj("user",cs),cu!=null&&cu.$==1&&(bh.length===0&&(ct=cu.$0,true)))?(cf(),{$:1,$0:ct}):null;}function cm(cs,ct){var cu,cv,cw;return(cv=cj("user",ct),cv!=null&&cv.$==1&&(J.haveQuestion(cs)&&bh.length>0&&bh[0].get_Name()===cs&&(cu=cv.$0,true)))?(cf(),cg(),cb(cs)?(cw=bg.get_Item(cs),(cd(cs),{$:1,$0:[cu,{$:1,$0:cw}]})):{$:1,$0:[cu,null]}):null;}function cn(cs,ct){var cu,cv,cw;return(cv=ck("user",ct),cv!=null&&cv.$==1&&(J.haveQuestion(cs)&&bh.length>0&&bh[0].get_Name()===cs&&(cu=cv.$0,true)))?(cf(),cg(),cb(cs)?(cw=bg.get_Item(cs),(cd(cs),{$:1,$0:[cu,{$:1,$0:cw}]})):{$:1,$0:[cu,null]}):null;}function co(cs){var ct,cu;return(cu=ck("user",cs),cu!=null&&cu.$==1&&(bh.length===0&&(ct=cu.$0,true)))?(cf(),{$:1,$0:ct}):null;}function cp(cs){var ct;return cs!=null&&cs.$==1&&(typeof cs.$0=="string"&&(ct=cs.$0,true))?{$:1,$0:ct}:null;}function cq(cs,ct,cu){var cv;return _3.Start((cv=null,_3.Delay(function(){ca(D.waitAddPhrases(),"symptom entry");return _3.Bind((new ba.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:-1265180699",[ce().Name,cs,ct,cu]),function(cw){return cw==null?(b$(function(cx){return cx("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),_3.Zero()):(b$((function(cx){return function(cy){return cx("OK I added that "+W.toSafe(cy)+" symptom to your journal.");};}(a.id))(cs)),_3.Zero());});})),null);}function cr(cs){var ct;ct=null;return _3.Delay(function(){ca(D.waitRetrievePhrases(),"symptom journal");return(new ba.New()).Async("SMApp.Web:SMApp.Web.Server.getSymptomJournal:-1789573153",[cs]);});}J.debug((((V.Curried3(function(cs,ct,cu){return cs("Starting utterances:"+W.prettyPrint(ct)+". Starting questions: "+W.prettyPrint(cu)+".");}))(a.id))(bj))(bh));bk=_0.ofSeq(_1.take(bj.length>=5?5:bj.length,bj));bk.$==1&&(bm=(bn=ck("started",bk.$0),bn!=null&&bn.$==1?{$:1,$0:bn.$0}:null),bm!=null&&bm.$==1&&(bo=co(bm.$0),bo!=null&&bo.$==1&&(bp=o.Intent$1("hello",bo.$0),bp!=null&&bp.$==1&&(bp.$0[1]==null&&bk.$1.$==0))))?(bg.Add("started",true),ca(D.helloPhrases(),"")):bk.$==1&&(br=co(bk.$0),br!=null&&br.$==1&&(bs=o.Intent$1("hello",br.$0),bs!=null&&bs.$==1&&(bs.$0[1]==null&&bk.$1.$==0)))?b$("Hello, tell me your name to get started."):bk.$==1&&(bu=co(bk.$0),bu!=null&&bu.$==1&&(bv=o.Intent$1("hello",bu.$0),bv!=null&&bv.$==1&&(bw=o.Entity1Of1("contact",bv.$0[1]),bw!=null&&bw.$==1&&(bk.$1.$==0&&(bt=bw.$0,true)))))?(bx=bt.get_Value(),ca(D.waitRetrievePhrases(),"user name"),_3.Start((by=null,_3.Delay(function(){return _3.Bind((new ba.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:310748805",[bx]),function(cs){var ct;return cs==null?(b$((function(cu){return function(cv){return cu("I did not find a user with the name "+W.toSafe(cv)+".");};}(a.id))(bx)),ci("addUser",bx),_3.Zero()):(ct=cs.$0,_3.Bind((new ba.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:-1135318433",[ct.Name]),function(){bg.Add("user",ct);ca(D.helloUserPhrases(),(function(cu){return function(cv){return cu(W.prettyPrint(cv));};}(a.id))(bg.get_Item("user")));return ct.LastLoggedIn!=null?_3.Bind((new ba.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:-836764497",[ct.LastLoggedIn.$0]),function(cu){b$((function(cv){return function(cw){return cv("You last logged in "+W.toSafe(cw)+".");};}(a.id))(cu));return _3.Zero();}):_3.Zero();}));});})),null)):bk.$==1&&(bA=o.Yes(bk.$0),bA!=null&&bA.$==1&&(bB=cn("addUser",bA.$0),bB!=null&&bB.$==1&&(bC=cp(bB.$0[1]),bC!=null&&bC.$==1&&(bk.$1.$==0&&(bz=bC.$0,true)))))?_3.Start((bD=null,_3.Delay(function(){ca(D.waitAddPhrases(),"user");return _3.Bind((new ba.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:-1135318433",[bz]),function(cs){return cs==null?(b$((function(ct){return function(cu){return ct("Sorry I was not able to add the user "+W.toSafe(cu)+" to the system.");};}(a.id))(bz)),_3.Zero()):(cc("user",bz),b$((function(ct){return function(cu){return ct("Hello "+W.prettyPrint(cu)+", nice to meet you.");};}(a.id))(bg.get_Item("user"))),_3.Zero());});})),null):bk.$==1&&(bF=o.No(bk.$0),bF!=null&&bF.$==1&&(bG=cn("addUser",bF.$0),bG!=null&&bG.$==1&&(bH=cp(bG.$0[1]),bH!=null&&bH.$==1&&(bk.$1.$==0&&(bE=bH.$0,true)))))?b$((function(cs){return function(ct){return cs("Ok I did not add the user "+W.toSafe(ct)+". But you must login for me to help you.");};}(a.id))(bE)):bk.$==1&&((bJ=co(bk.$0),bJ!=null&&bJ.$==1)&&bk.$1.$==0)?b$("Could you introduce yourself so we can get started?"):bk.$==1&&(bL=cl(bk.$0),bL!=null&&bL.$==1&&(bM=o.Intent$1("hello",bL.$0),bM!=null&&bM.$==1&&(bM.$0[0]==null&&(bN=o.Entity1Of1("contact",bM.$0[1]),bN!=null&&bN.$==1&&(bk.$1.$==0&&(bK=bN.$0,true))))))?_3.Start((bO=null,_3.Delay(function(){return _3.Bind((new ba.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:310748805",[bK.get_Value()]),function(cs){return cs==null?(b$((function(ct){return function(cu){return ct("Sorry, the user "+W.toSafe(cu)+" does not exist.");};}(a.id))(bK.get_Value())),_3.Zero()):(ci("switchUser",cs.$0.Name),_3.Zero());});})),null):bk.$==1&&(bQ=o.Yes(bk.$0),bQ!=null&&bQ.$==1&&(bR=cm("switchUser",bQ.$0),bR!=null&&bR.$==1&&(bS=cp(bR.$0[1]),bS!=null&&bS.$==1&&(bk.$1.$==0&&(bP=bS.$0,true)))))?(bg.set_Item("user",bP),b$((function(cs){return function(ct){return cs("Ok I switched to user "+W.prettyPrint(ct)+".");};}(a.id))(bP))):bk.$==1&&(bU=o.No(bk.$0),bU!=null&&bU.$==1&&(bV=cm("switchUser",bU.$0),bV!=null&&bV.$==1&&(bW=cp(bV.$0[1]),bW!=null&&bW.$==1&&(bk.$1.$==0&&(bT=bW.$0,true)))))?b$((function(cs){return function(ct){return cs("Ok I did not switch to user "+W.toSafe(ct)+".");};}(a.id))(bT)):bk.$==1&&(bY=cl(bk.$0),bY!=null&&bY.$==1&&(bZ=o.Intent$1("symptom",bY.$0),bZ!=null&&bZ.$==1&&(b0=o.Entity1OfAny("symptom_name",bZ.$0[1]),b0!=null&&b0.$==1&&(bk.$1.$==0&&(bX=b0.$0,true)))))?_3.Start((b1=null,_3.Delay(function(){b$("Ok I'll add that entry to your symptom journal");cq(bX.get_Value(),null,null);return _3.Bind(cr(ce().Name),function(){ci("painVideo","");return _3.Zero();});})),null):bk.$==1&&(b3=o.Yes(bk.$0),b3!=null&&b3.$==1&&((b4=cm("painVideo",b3.$0),b4!=null&&b4.$==1)&&bk.$1.$==0))?bf["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bk.$==1&&(b6=cl(bk.$0),b6!=null&&b6.$==1&&(b7=o.Intent$1("medjournal",b6.$0),b7!=null&&b7.$==1&&((b8=b7.$0[1],b8!=null&&b8.$==1)&&(bk.$1.$==0&&(b5=b7.$0[1].$0,true)))))?(b$("ok I added that entry to your medication journal."),b$("You should be careful not to take too many painkillers over a short period of time.")):(cf(),J.debug("Main interpreter did not understand utterance."),b$("Sorry I didn't understand what you meant."),bh.length>0?(b9=_1.nth(0,bh),cb(b9.get_Name())?b$(d.replace_tok("$0",bg.get_Item(b9.get_Name()),b9.get_Text())):b$(b9.get_Text())):void 0);J.debug((((V.Curried3(function(cs,ct,cu){return cs("Ending utterances: "+W.prettyPrint(ct)+". Ending questions:"+W.prettyPrint(cu)+".");}))(a.id))(bj))(bh));};J.haveQuestion=function(bf){return _0.exists(function(bg){return bg.get_Name()===bf;},J.questions());};J.getQuestion=function(bf){return _1.tryFind(function(bg){return bg.get_Name()===bf;},J.questions());};J.questions=function(){K.$cctor();return K.questions;};J.debug=function(bf){d.debug("Main",bf);};K.$cctor=function(){K.$cctor=a.ignore;K.questions=_0.ofArray([new t({$:0,$0:"addUser",$1:"Do you want me to add the user $0?"}),new t({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?"}),new t({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new t({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new t({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};L.run=function(){var bf,bg;bf=V.ThisFunc(function(bh,bi){return((L.Main().get_Text())(bh))(bi);});bg=L.Main().get_Options();a.$("#term").terminal(bf,bg);return S.get_Empty();};L.Main=function(){M.$cctor();return M.Main;};L.initMic=function(bf,bg){var bh,bi;bf[0]=(bh=bf[0],H.New(bh.Voice,{$:1,$0:new bb.Microphone(bc.getElementById("microphone"))},bh.Term,bh.Avatar,bh.Caption));bi=bf[0].Mic.$0;bi.onconnecting=function(){L.set_MicState(E.MicConnecting);return L.debug("Mic connecting...");};bi.ondisconnected=function(){L.set_MicState(E.MicDisconnected);return L.debug("Mic disconnected.");};bi.onaudiostart=function(){L.set_MicState(E.MicAudioStart);return L.debug("Mic audio start...");};bi.onaudioend=function(){L.set_MicState(E.MicAudioEnd);return L.debug("Mic audio end.");};bi.onerror=function(bj){L.set_MicState({$:6,$0:bj});return L.debug((function(bk){return function(bl){return bk("Mic error : "+W.toSafe(bl)+".");};}(a.id))(bj));};bi.onready=function(){L.set_MicState(E.MicReady);return L.debug("Mic ready.");};bi.onresult=function(bj,bk){return L.ClientState().$==2?L.echo("I'm still trying to understand what you said before."):L.ClientState().$==0?d.error("Client is not intialized."):!(bj==null||bk==null)?(L.set_MicState({$:7,$0:bj,$1:bk}),L.debug((((V.Curried3(function(bl,bm,bn){return bl("Mic result: "+W.prettyPrint(bm)+" "+W.prettyPrint(bn)+".");}))(a.id))(bj))(bk)),bg(bf,bi,[bj,bk])):L.debug("Mic: No result returned.");};bi.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};L.sayRandom=function(bf,bg){L.say(D.getRandomPhrase(bg,bf));};L.sayVoices=function(){var bf;bf=d.toArray(d.speechSynthesis().getVoices());L["say'"]((function(bg){return function(bh){return bg("There are currently "+a.String(bh)+" voices installed on this computer or device.");};}(a.id))(Z.length(bf)));Z.iteri(function(bg,bh){return L["say'"](((((V.Curried(function(bi,bj,bk,bl){return bi("Voice "+a.String(bj)+". Name: "+W.toSafe(bk)+", Local: "+W.prettyPrint(bl)+".");},4))(a.id))(bg))(bh.name))(bh.localService));},bf);};L.say=function(bf){L.Responses().unshift(bf);L["say'"](bf);};L["say'"]=function(bf){L.CUI().Say(bf);};L.initSpeech=function(bf){var bg,bh,bi,bj;bg=d.toArray(L.synth().getVoices());Z.length(bg)>0?(bh=Z.find(function(bk){return bk["default"];},bg),bf[0]=(bi=bf[0],H.New({$:1,$0:bh},bi.Mic,bi.Term,bi.Avatar,bi.Caption)),bj=bf[0],L.debug((function(bk){return function(bl){return bk("Using browser speech synthesis voice "+W.toSafe(bl)+".");};}(a.id))(bj.Voice.$0.name)),bj.Avatar.nativeVoice=true,bj.Avatar.nativeVoiceName=bh.name):L.echo("No browser speech synthesis voice is available. Falling back to CMU TTS.");};L.synth=function(){M.$cctor();return M.synth;};L.push=function(bf){L.Utterances().unshift(bf);return L.Utterances();};L.Props=function(){M.$cctor();return M.Props;};L.Responses=function(){M.$cctor();return M.Responses;};L.Questions=function(){M.$cctor();return M.Questions;};L.Utterances=function(){M.$cctor();return M.Utterances;};L.wait=function(bf){d["Terminal.Echo'"](L.CUI().Term,"please wait");L.CUI().Term.pause();bf();L.CUI().Term.resume();};L.debug=function(bf){d.debug("CLIENT",bf);};L.echo=function(bf){d["Terminal.EchoHtml'"](L.CUI().Term,(function(bg){return function(bh){return bg(W.prettyPrint(bh));};}(a.id))(bf));};L.ClientState=function(){M.$cctor();return M.ClientState;};L.set_ClientState=function(bf){M.$cctor();M.ClientState=bf;};L.MicState=function(){M.$cctor();return M.MicState;};L.set_MicState=function(bf){M.$cctor();M.MicState=bf;};L.CUI=function(){M.$cctor();return M.CUI;};L.set_CUI=function(bf){M.$cctor();M.CUI=bf;};M.$cctor=function(){var bf,bg,bh,bi,bj,bk;M.$cctor=a.ignore;function bl(bn,bo,bp){var bq,br,bs,bt,bu,bv,bw,bx,by,bz;bq=bp[0];br=bp[1];L.debug((((V.Curried3(function(bA,bB,bC){return bA("Voice: "+W.prettyPrint(bB)+" "+W.prettyPrint(bC));}))(a.id))(bq))(br));bs=(bt=u["Intent'"](bq,br),bt!=null&&bt.$==1?{$:1,$0:bt.$0}:null);bu=(bv=u["Trait'"](br),bv!=null&&bv.$==1?{$:1,$0:_0.ofArray([bv.$0])}:null);bw=(bx=u["Entity'$1"](br),bx!=null&&bx.$==1?{$:1,$0:_0.ofArray([bx.$0])}:null);return bs==null&&(bu==null&&bw==null)?null:(L.debug(((((V.Curried(function(bA,bB,bC,bD){return bA("Voice: "+N.p(bB)+" "+N.p$3(bC)+" "+N.p$5(bD));},4))(a.id))(bs))(bu))(bw)),bz=L.push(new s({$:0,$0:bs,$1:bu,$2:bw})),J.update(bn[0],L.Props(),L.Questions(),L.Responses(),bz));}function bm(bn,bo,bp){var bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC;bn[0]=H.New(L.CUI().Voice,L.CUI().Mic,bo,L.CUI().Avatar,L.CUI().Caption);bd.Equals(bn[0].Mic,null)?L.initMic(bn,bl):void 0;bd.Equals(bn[0].Voice,null)?L.initSpeech(bn):void 0;bq=bn[0];L.ClientState().$===0?L.set_ClientState(F.ClientReady):void 0;return(br=w.Blank(bp),br!=null&&br.$==1)?L["say'"]("Tell me what you want me to do or ask me a question."):(bs=w.Debug(bp),bs!=null&&bs.$==1)?(L.debug((function(bD){return function(bE){return bD("Utterances: "+W.prettyPrint(bE));};}(a.id))(L.Utterances())),L.debug((function(bD){return function(bE){return bD("Questions: "+W.prettyPrint(bE));};}(a.id))(L.Questions())),bt=self.document.createElement("insert"),bu=S.Element("div",[_2.Create("id","bar")],[]),R.LoadLocalTemplates(""),S.RunAppend(bt,bu),L.debug(bt.innerHTML)):(bv=w.Voices(bp),bv!=null&&bv.$==1)?L.sayVoices():L.ClientState().$==1?(bx=w.QuickHello(bp),bx!=null&&bx.$==1?(bw=bx.$0,true):(by=w.QuickHelp(bp),by!=null&&by.$==1?(bw=by.$0,true):(bz=w.QuickYes(bp),bz!=null&&bz.$==1?(bw=bz.$0,true):(bA=w.QuickNo(bp),bA!=null&&bA.$==1&&(bw=bA.$0,true)))))?(L.debug((function(bD){return function(bE){return bD("Quick Text: "+N.p$7(bE)+".");};}(a.id))(bw)),bB=L.push(bw),J.update(bq,L.Props(),L.Questions(),L.Responses(),bB),L.set_ClientState(F.ClientReady)):bq.Wait((bC=null,_3.Delay(function(){L.set_ClientState(F.ClientUnderstand);w.getUtterance(bp,function(bD){var bE,bF,bG;bE=w.HasUtterance(bD);bE!=null&&bE.$==1?(bF=bE.$0,L.debug(((((V.Curried(function(bH,bI,bJ,bK){return bH("Text: Intent: "+N.p(bI)+", Traits: "+N.p$3(bJ)+", Entities: "+N.p$5(bK));},4))(a.id))(bF.get_Intent()))(bF.get_Traits()))(bF.get_Entities())),bG=L.push(bF),J.update(bq,L.Props(),L.Questions(),L.Responses(),bG)):(L.debug("Text: Did not receive a meaning from the server."),L["say'"]("Sorry I did not understand what you said."));});L.set_ClientState(F.ClientReady);return _3.Zero();}))):L.ClientState().$==0?d.error("Client is not initialized."):L["say'"]("I'm still trying to understand what you said before.");}M.CUI=H.New(null,null,null,(_8.applicationId="4277115329081938617",bf=new a.SDKConnection(),bg=new a.WebAvatar(),bg.version=8.5,bg.connection=bf,bg.avatar="22225225",bg.voice="cmu-slt",bg.voiceMod="default",bg.nativeVoice=true,bg.nativeVoiceName="Microsoft David Desktop - English (United States)",bg.width=300,bg.createBox(),bg.addMessage(""),bg.processMessages(0),bg),false);M.MicState=E.MicNotInitialized;M.ClientState=F.ClientNotInitialzed;M.Utterances=[];M.Questions=[];M.Responses=[];M.Props=new be.New$5();M.synth=a.speechSynthesis;M.Main=(bh=(bi={},bi.name="Main",bi.greetings="Welcome to SMApp. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bi.prompt=">",bi),new G({$:0,$0:(bj=[L.CUI()],(V.Curried3(bl))(bj)),$1:[(bk=[L.CUI()],(V.Curried3(bm))(bk)),bh]}));};N.p$8=function(bf){return"Question ("+W.prettyPrint(bf.$0)+", "+W.prettyPrint(bf.$1)+")";};N.p$2=function(bf){return bf==null?"null":"Some "+W.prettyPrint(bf.$0);};N.p$1=function(bf){return"Intent ("+W.prettyPrint(bf.$0)+", "+N.p$2(bf.$1)+")";};N.p=function(bf){return bf==null?"null":"Some "+N.p$1(bf.$0);};N.p$4=function(bf){return"Trait ("+W.prettyPrint(bf.$0)+", "+W.prettyPrint(bf.$1)+", "+N.p$2(bf.$2)+")";};N.p$3=function(bf){return bf==null?"null":"Some "+W.printList(function(bg){return N.p$4(bg);},bf.$0);};N.p$6=function(bf){return"Entity ("+W.prettyPrint(bf.$0)+", "+W.prettyPrint(bf.$1)+", "+N.p$2(bf.$2)+")";};N.p$5=function(bf){return bf==null?"null":"Some "+W.printList(function(bg){return N.p$6(bg);},bf.$0);};N.p$7=function(bf){return"Utterance ("+N.p(bf.$0)+", "+N.p$3(bf.$1)+", "+N.p$5(bf.$2)+")";};}());
