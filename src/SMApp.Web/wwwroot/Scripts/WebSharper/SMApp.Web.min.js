(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V;a=self;b=a.SMApp=a.SMApp||{};c=b.Bootstrap=b.Bootstrap||{};d=c.Controls=c.Controls||{};e=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};f=b.Web=b.Web||{};g=f.NLU=f.NLU||{};h=g.Intent=g.Intent||{};i=g.Trait=g.Trait||{};j=g.Voice=g.Voice||{};k=j["Entity'"]=j["Entity'"]||{};l=g.Text=g.Text||{};m=l.Meaning=l.Meaning||{};n=l.Intent=l.Intent||{};o=l.Entity=l.Entity||{};p=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};q=f.CUI=f.CUI||{};r=f.CUIModule=f.CUIModule||{};s=r.User=r.User||{};t=r.Interpreter=r.Interpreter||{};u=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};v=f.Main=f.Main||{};w=f.ClientExtensions=f.ClientExtensions||{};x=f._Html=f._Html||{};y=f.htmModule=f.htmModule||{};z=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};A=f.Client=f.Client||{};B=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};C=a.WebSharper;D=C&&C.UI;E=D&&D.Doc;F=C&&C.List;G=D&&D.AttrModule;H=a.IntelliFactory;I=H&&H.Runtime;J=C&&C.Concurrency;K=C&&C.Seq;L=C&&C.Random;M=C&&C.Arrays;N=a.jQuery;O=a.console;P=C&&C.Strings;Q=C&&C.Utils;R=a.Wit;S=a.document;T=C&&C.Unchecked;U=C&&C.Remoting;V=U&&U.AjaxRemotingProvider;d.Radio=function(W,X,Y,Z,_0){return E.Element("div",new F.T({$:1,$0:(d.cls())("radio"),$1:X}),[E.Element("label",Z,[E.Radio(_0,true,Y),E.TextNode(W)])]);};d.Checkbox=function(W,X,Y,Z,_0){return E.Element("div",new F.T({$:1,$0:(d.cls())("checkbox"),$1:X}),[E.Element("label",Z,[E.CheckBox(_0,Y),E.TextNode(W)])]);};d.TextArea=function(W,X,Y,Z,_0){return E.Element("div",new F.T({$:1,$0:(d.cls())("form-group"),$1:X}),[E.Element("label",Z,[E.TextNode(W)]),E.InputArea(new F.T({$:1,$0:(d.cls())("form-control"),$1:_0}),Y)]);};d.InputPassword=function(W,X,Y,Z,_0){return E.Element("div",new F.T({$:1,$0:(d.cls())("form-group"),$1:X}),[E.Element("label",Z,[E.TextNode(W)]),E.PasswordBox(new F.T({$:1,$0:(d.cls())("form-control"),$1:_0}),Y)]);};d.Input=function(W,X,Y,Z,_0){return E.Element("div",new F.T({$:1,$0:(d.cls())("form-group"),$1:X}),[E.Element("label",Z,[E.TextNode(W)]),E.Input(new F.T({$:1,$0:(d.cls())("form-control"),$1:_0}),Y)]);};d.Container=function(W){return E.Element("div",[(d.cls())("container")],W);};d.Class=function(){e.$cctor();return e.Class;};d.cls=function(){e.$cctor();return e.cls;};e.$cctor=function(){e.$cctor=a.ignore;e.cls=G.Class;e.Class=G.Class;};h.Patient={$:3};h.Onboard={$:2};h.Help={$:1};h.Hello={$:0};i.Greetings={$:0};k.New=function(W,X,Y,Z,_0){return{body:W,end:X,start:Y,suggested:Z,value:_0};};j.Contact=function(W){return!(W.contact==null)?{$:1,$0:{$:0,$0:k.New(W.body,W.end,W.start,W.ff,W.value).value}}:null;};j.Greetings=function(W){return!(W.greetings==null)&&!(W.greetings.value==null)?{$:1,$0:i.Greetings}:null;};j.Hello=function(W){return typeof W=="string"&&W.toLowerCase()==="default_intent"?{$:1,$0:h.Hello}:null;};m=l.Meaning=I.Class({get_TopIntent:function(){return F.head(F.sortBy(function(W){return W.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,m);n=l.Intent=I.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,n);o=l.Entity=I.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,o);l.HelloUser=function(W){var X,Y;return(Y=l.Hello(W),Y!=null&&Y.$==1&&(Y.$0.$==1&&(Y.$0.$1.$==0&&(Y.$0.$0.get_Role()==="contact"&&(X=Y.$0.$0,true)))))?{$:1,$0:X}:null;};l.Hello=function(W){var X,Y;return W!=null&&W.$==1&&(Y=l.Intent$1("Hello",W.$0),Y!=null&&Y.$==1&&(X=Y.$0,true))?{$:1,$0:X}:null;};l.DebugOff=function(W){return W==="debug off"?{$:1,$0:null}:null;};l.DebugOn=function(W){return W==="debug on"?{$:1,$0:null}:null;};l.QuickHelp=function(W){var X;return W==="help"||(W==="help me"||(W==="what's this?"||W==="huh"))?{$:1,$0:h.Help}:null;};l.QuickHello=function(W){var X;return W==="hello"||(W==="hey"||(W==="yo"||W==="hi"))?{$:1,$0:h.Hello}:null;};l.Intent$1=function(W,X){return X.get_TopIntent().get_Name()===W&&X.get_TopIntent().get_Confidence()>l.intentConfidenceThreshold()?{$:1,$0:F.filter(function(Y){return Y.get_Confidence()>l.entityConfidenceThreshold();},X.get_Entities())}:null;};l.entityConfidenceThreshold=function(){p.$cctor();return p.entityConfidenceThreshold;};l.set_entityConfidenceThreshold=function(W){p.$cctor();p.entityConfidenceThreshold=W;};l.intentConfidenceThreshold=function(){p.$cctor();return p.intentConfidenceThreshold;};l.set_intentConfidenceThreshold=function(W){p.$cctor();p.intentConfidenceThreshold=W;};p.$cctor=function(){p.$cctor=a.ignore;p.intentConfidenceThreshold=0.85;p.entityConfidenceThreshold=0.85;};q=f.CUI=I.Class({Say:function(W){var X,Y,Z;X=this.Voice;X!=null&&X.$==1?(Y=X.$0,J.Start((Z=null,J.Delay(function(){var _0;_0=new a.SpeechSynthesisUtterance(W);_0.voice=Y;a.speechSynthesis.speak(_0);return J.Zero();})),null),this.Caption?this["Echo'"](W):void 0):this["Echo'"](W);},"EchoHtml'":function(W){var X,Y;X=(Y={},Y.raw=true,Y);this.Term.disable();this.Term.echo(W,X);this.Term.enable();},"Echo'":function(W){this.Term.disable();this.Term.echo(W);this.Term.enable();}},null,q);q.New=function(W,X,Y,Z,_0,_1){return new q({Voice:W,Mic:X,MicState:Y,Term:Z,Debug:_0,Caption:_1});};s.New=function(W){return{UserName:W};};t=r.Interpreter=I.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,t);r.helloUserPhrases=function(){u.$cctor();return u.helloUserPhrases;};r.helloPhrases=function(){u.$cctor();return u.helloPhrases;};r.getRandomPhrase=function(W){return K.nth(r.rng().Next(0,W.get_Length()),W);};r.rng=function(){u.$cctor();return u.rng;};u.$cctor=function(){u.$cctor=a.ignore;u.rng=new L.New();u.helloPhrases=F.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);u.helloUserPhrases=F.ofArray(["Hi $user, welcome back.","Welcome $user, nice to see you again..","Hello $user","Good to see you $user."]);};v.update=function(W,X){W.Say("I'm in the Main module.");};w.toArray=function(W){return M.map(a.id,N.makeArray(W));};w.error=function(W){O.error(W);};w.info=function(W){O.info(W);};w.jserror=function(W){N.error(W);};w["Terminal.Push"]=function(W,X){var Y,Z;Y=X.get_Text();Z=X.get_Options();W.push(I.CreateFuncWithThis(Y),Z);};w["Terminal.EchoHtml'"]=function(W,X){W.disable();W.echo(X,w.rawOpt());W.enable();};w["Terminal.Echo'"]=function(W,X){W.disable();W.echo(X);W.enable();};w.rawOpt=function(){z.$cctor();return z.rawOpt;};x=f._Html=I.Class({toString:function(){return x.toString(this);}},null,x);x.toString=function(W){function X(Y){return function(Z){var _0,_1,_2,_3,_4,_5,_6;_1=P.replicate(Y," ");switch(Z.$==0?Z.$1.$==1?Z.$1.$0.$==2?Z.$1.$1.$==0?(_0=[Z.$1.$0.$0,Z.$0],1):(_0=[Z.$1,Z.$0],2):(_0=[Z.$1,Z.$0],2):(_0=[Z.$1,Z.$0],2):Z.$==2?(_0=Z.$0,3):(_0=[Z.$0,Z.$1],0)){case 0:return _0[0]+"=\""+_0[1]+"\"";case 1:_2=_0[1];return _1+"<"+_2+">"+_0[0]+"</"+_2+">\r\n";case 2:_3=_0[1];_4=F.partition(function(_7){return _7.$==1;},_0[0]);_5=_4[1];_6=_4[0];return _5.$==0?_1+"<"+_3+(_6.$===0?"":" "+P.concat(" ",F.ofSeq(K.delay(function(){return K.map(function(_7){return(X(0))(_7);},_6);}))))+"/>\r\n":_1+"<"+_3+(_6.$===0?"":" "+P.concat(" ",F.ofSeq(K.delay(function(){return K.map(function(_7){return(X(0))(_7);},_6);}))))+">\r\n"+P.concat("",F.ofSeq(K.delay(function(){return K.map(function(_7){return(X(Y+1))(_7);},_5);})))+_1+"</"+_3+">\r\n";case 3:return _1+_0+"\r\n";}};}return(X(0))(W);};y.alt=function(W){return new x({$:1,$0:"alt",$1:W});};y.src=function(W){return new x({$:1,$0:"src",$1:W});};y.cls=function(W){return new x({$:1,$0:"class",$1:W});};y.str=function(W){return x.toString(W);};y.op_PercentEquals=function(W,X){return new x({$:1,$0:W,$1:X});};y.op_Splice=function(W){var X;return F.ofArray([new x({$:2,$0:(X=W,a.String(X))})]);};y.strong=function(){z.$cctor();return z.strong;};y.h4=function(){z.$cctor();return z.h4;};y.h3=function(){z.$cctor();return z.h3;};y.h2=function(){z.$cctor();return z.h2;};y.h1=function(){z.$cctor();return z.h1;};y.li=function(){z.$cctor();return z.li;};y.ul=function(){z.$cctor();return z.ul;};y.th=function(){z.$cctor();return z.th;};y.td=function(){z.$cctor();return z.td;};y.tr=function(){z.$cctor();return z.tr;};y.a=function(){z.$cctor();return z.a;};y.p=function(){z.$cctor();return z.p;};y.area=function(){z.$cctor();return z.area;};y.map=function(){z.$cctor();return z.map;};y.img=function(){z.$cctor();return z.img;};y.tfoot=function(){z.$cctor();return z.tfoot;};y.tbody=function(){z.$cctor();return z.tbody;};y.thead=function(){z.$cctor();return z.thead;};y.table=function(){z.$cctor();return z.table;};y.span=function(){z.$cctor();return z.span;};y.section=function(){z.$cctor();return z.section;};y.br=function(){z.$cctor();return z.br;};y.div=function(){z.$cctor();return z.div;};y.body=function(){z.$cctor();return z.body;};y.style=function(){z.$cctor();return z.style;};y.title=function(){z.$cctor();return z.title;};y.head=function(){z.$cctor();return z.head;};y.html=function(){z.$cctor();return z.html;};y.elem=function(W,X){return new x({$:0,$0:W,$1:X});};z.$cctor=function(){var W;z.$cctor=a.ignore;z.rawOpt=(W={},W.raw=true,W);z.html=function(X){return y.elem("html",X);};z.head=function(X){return y.elem("head",X);};z.title=function(X){return y.elem("title",X);};z.style=function(X){return y.elem("style",X);};z.body=function(X){return y.elem("body",X);};z.div=function(X){return y.elem("div",X);};z.br=function(X){return y.elem("br",X);};z.section=function(X){return y.elem("section",X);};z.span=function(X){return y.elem("span",X);};z.table=function(X){return y.elem("table",X);};z.thead=function(X){return y.elem("thead",X);};z.tbody=function(X){return y.elem("tbody",X);};z.tfoot=function(X){return y.elem("tfoot",X);};z.img=function(X){return y.elem("img",X);};z.map=function(X){return y.elem("map",X);};z.area=function(X){return y.elem("area",X);};z.p=function(X){return y.elem("p",X);};z.a=function(X){return y.elem("a",X);};z.tr=function(X){return y.elem("tr",X);};z.td=function(X){return y.elem("td",X);};z.th=function(X){return y.elem("th",X);};z.ul=function(X){return y.elem("ul",X);};z.li=function(X){return y.elem("li",X);};z.h1=function(X){return y.elem("h1",X);};z.h2=function(X){return y.elem("h1",X);};z.h3=function(X){return y.elem("h1",X);};z.h4=function(X){return y.elem("h1",X);};z.strong=function(X){return y.elem("strong",X);};};A.CUI=function(){var W,X;W=I.ThisFunc(function(Y,Z){return((A.Main().get_Text())(Y))(Z);});X=A.Main().get_Options();a.$("#main").terminal(W,X);return E.get_Empty();};A.Main=function(){B.$cctor();return B.Main;};A.container=function(){B.$cctor();return B.container;};A.wait=function(W){w["Terminal.Echo'"](A.currentTerm(),"please wait");A.currentTerm().disable();W();A.currentTerm().enable();};A.stopSpeaking=function(){B.$cctor();return B.stopSpeaking;};A.sayRandom=function(W){A.say(r.getRandomPhrase(W));};A.sayVoices=function(){var W,X;W=a.speechSynthesis.getVoices();!(W==null)?(X=w.toArray(W),A.say((function(Y){return function(Z){return Y("There are currently "+a.String(Z)+" voices installed on this computer or device.");};}(a.id))(M.length(X))),M.iteri(function(Y,Z){return A.say(((((I.Curried(function(_0,_1,_2,_3){return _0("Voice "+a.String(_1)+". Name: "+Q.toSafe(_2)+", Local: "+Q.prettyPrint(_3)+".");},4))(a.id))(Y))(Z.name))(Z.localService));},X)):void 0;};A.say=function(W){var X,Y,Z;if(X=A.currentVoice(),X!=null&&X.$==1){Y=A.currentVoice().$0;J.Start((Z=null,J.Delay(function(){var _0;_0=new a.SpeechSynthesisUtterance(W);_0.voice=Y;a.speechSynthesis.speak(_0);return J.Zero();})),null);A.caption()?w["Terminal.Echo'"](A.currentTerm(),W):void 0;}else w["Terminal.Echo'"](A.currentTerm(),W);};A.initMic=function(W,X){var Y;A.set_currentMic({$:1,$0:new R.Microphone(S.getElementById("microphone"))});Y=A.currentMic().$0;Y.onconnecting=function(){A.set_currentMicState({$:1});return A.debugEcho("Mic connecting...");};Y.ondisconnected=function(){return A.debugEcho("Mic disconnected.");};Y.onaudiostart=function(){return A.debugEcho("Mic audio start...");};Y.onaudioend=function(){return A.debugEcho("Mic audio end.");};Y.onerror=function(Z){return A.debugEcho((function(_0){return function(_1){return _0("Mic error : "+Q.toSafe(_1)+".");};}(a.id))(Z));};Y.onready=function(){return A.debugEcho("Mic ready.");};Y.onresult=function(Z,_0){return W(Y,[Z,_0]);};Y.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};A.initSpeech=function(){var W,X;W=a.speechSynthesis.getVoices();!(W==null)?(X=w.toArray(W),M.iter(function(Y){if(T.Equals(A.currentVoice(),null)&&(Y.name.indexOf("Microsoft Zira")!=-1||Y.name.toLowerCase().indexOf("female")!=-1)){A.set_currentVoice({$:1,$0:Y});w.info((function(Z){return function(_0){return Z("Using voice "+Q.toSafe(_0)+".");};}(a.id))(A.currentVoice().$0.name));}},X),T.Equals(A.currentVoice(),null)&&M.length(X)>0?(A.set_currentVoice({$:1,$0:M.find(function(Y){return Y["default"];},X)}),w.info((function(Y){return function(Z){return Y("Using default voice "+Q.toSafe(Z)+".");};}(a.id))(A.currentVoice().$0.name))):void 0):void 0;T.Equals(A.currentVoice(),null)?(w.error("No speech synthesis voice is available."),w["Terminal.Echo'"](A.currentTerm(),"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma.")):void 0;};A.debugEcho=function(W){if(A.debugMode())w["Terminal.EchoHtml'"](A.currentTerm(),W);};A.echo=function(){B.$cctor();return B.echo;};A.update=function(W){A.set_context(F.append(F.ofArray([{$:0,$0:W}]),A.context()));return F.ofSeq(K.take(A.context().get_Length()>=5?5:A.context().get_Length(),A.context()));};A.context=function(){B.$cctor();return B.context;};A.set_context=function(W){B.$cctor();B.context=W;};A.state=function(){return q.New(A.currentVoice(),A.currentMic(),A.currentMicState(),A.currentTerm(),A.debugMode(),A.caption());};A.caption=function(){B.$cctor();return B.caption;};A.set_caption=function(W){B.$cctor();B.caption=W;};A.debugMode=function(){B.$cctor();return B.debugMode;};A.set_debugMode=function(W){B.$cctor();B.debugMode=W;};A.currentInterpreter=function(){B.$cctor();return B.currentInterpreter;};A.set_currentInterpreter=function(W){B.$cctor();B.currentInterpreter=W;};A.currentTerm=function(){B.$cctor();return B.currentTerm;};A.set_currentTerm=function(W){B.$cctor();B.currentTerm=W;};A.currentMicState=function(){B.$cctor();return B.currentMicState;};A.set_currentMicState=function(W){B.$cctor();B.currentMicState=W;};A.currentMic=function(){B.$cctor();return B.currentMic;};A.set_currentMic=function(W){B.$cctor();B.currentMic=W;};A.currentVoice=function(){B.$cctor();return B.currentVoice;};A.set_currentVoice=function(W){B.$cctor();B.currentVoice=W;};B.$cctor=function(){var W;B.$cctor=a.ignore;function X(Z,_0){var _1,_2;_1=_0[1];w.info(_0[0]);w.info(_1);_2=j.Greetings(_1);return _2!=null&&_2.$==1?w.info(_2.$0):w.error(_1);}function Y(Z,_0){var _1,_2,_3,_4,_5,_6,_7;A.set_currentTerm(Z);T.Equals(A.currentVoice(),null)?A.initSpeech():void 0;T.Equals(A.currentMic(),null)?A.initMic(X,Z):void 0;return(_1=l.DebugOn(_0),_1!=null&&_1.$==1)?(A.set_debugMode(true),A.say("Debug mode is now on.")):(_2=l.DebugOff(_0),_2!=null&&_2.$==1)?(A.set_debugMode(false),A.say("Debug mode is now off.")):(_4=l.QuickHello(_0),_4!=null&&_4.$==1?(_3=_4.$0,true):(_5=l.QuickHelp(_0),_5!=null&&_5.$==1&&(_3=_5.$0,true)))?(N("$microphone").hide(),_6=A.update({$:0,$0:_3,$1:null,$2:null}),v.update(A.state(),_6),N("#microphone").show(),A.sayRandom(r.helloPhrases())):(w["Terminal.Echo'"](A.currentTerm(),"please wait"),J.Start((_7=null,J.Delay(function(){return J.Bind((new V.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:331037262",[_0]),function(_8){var _9;_9=l.HelloUser(_8);return _9!=null&&_9.$==1?(A.say((function(_){return function($){return _("This is the hello intent. The user name is "+Q.toSafe($)+".");};}(a.id))(_9.$0.get_Value())),J.Zero()):(w["Terminal.Echo'"](Z,"This is the whatever intent"),J.Zero());});})),null));}B.currentVoice=null;B.currentMic=null;B.currentMicState={$:0};B.currentTerm=null;B.currentInterpreter=null;B.debugMode=false;B.caption=false;B.context=F.T.Empty;B.echo=function(Z){w["Terminal.EchoHtml'"](A.currentTerm(),Z);};B.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;B.container=d.Container;B.Main=new t({$:0,$0:function(Z){return function(_0){return X(Z,_0);};},$1:[function(Z){return function(_0){return Y(Z,_0);};},(W={},W.name="Main",W.greetings="Welcome to Selma. Type hello to begin or help for more assistance.",W.prompt=">",W)]});};}());
