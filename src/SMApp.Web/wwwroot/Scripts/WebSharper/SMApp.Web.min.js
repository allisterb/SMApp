(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=b.Bootstrap=b.Bootstrap||{};i=h.Controls=h.Controls||{};j=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};k=c.NLU=c.NLU||{};l=k.Intent=k.Intent||{};m=k.Trait=k.Trait||{};n=k.Entity=k.Entity||{};o=k.Meaning=k.Meaning||{};p=k.Question=k.Question||{};q=k.Voice=k.Voice||{};r=q["Entity'"]=q["Entity'"]||{};s=k.Text=k.Text||{};t=s["Meaning'"]=s["Meaning'"]||{};u=s["Intent'"]=s["Intent'"]||{};v=s["Entity'"]=s["Entity'"]||{};w=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};x=c.CUI=c.CUI||{};y=x.User=x.User||{};z=x.MicState=x.MicState||{};A=x.ClientState=x.ClientState||{};B=x.Interpreter=x.Interpreter||{};C=x.CUI=x.CUI||{};D=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};E=c.Main=c.Main||{};F=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};G=c.Client=c.Client||{};H=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};I=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};J=a.WebSharper;K=J&&J.Strings;L=a.IntelliFactory;M=L&&L.Runtime;N=J&&J.Utils;O=a.console;P=a.jQuery;Q=J&&J.Arrays;R=J&&J.List;S=J&&J.Seq;T=J&&J.UI;U=T&&T.Doc;V=T&&T.AttrModule;W=J&&J.Concurrency;X=J&&J.Random;Y=J&&J.Operators;Z=J&&J.Remoting;_0=Z&&Z.AjaxRemotingProvider;_1=a.Wit;_2=a.document;_3=J&&J.Unchecked;_4=J&&J.Collections;_5=_4&&_4.Dictionary;d.replace_tok=function(_6,_7,_8){return K.Replace(_8,_6,_7);};d.toLower=function(_6){return _6.toLowerCase();};d.debug=function(_6,_7){d.info((((M.Curried3(function(_8,_9,_){return _8("DEBUG: "+N.toSafe(_9)+": "+N.prettyPrint(_));}))(a.id))(_6.toUpperCase()))(_7));};d.error=function(_6){O.error(_6);};d.info=function(_6){O.info(_6);};d.jserror=function(_6){P.error(_6);};d.toArray=function(_6){return Q.map(a.id,P.makeArray(_6));};d["Terminal.EchoHtml'"]=function(_6,_7){_6.pause();_6.echo(_7,d.rawOpt());_6.resume();};d["Terminal.Echo'"]=function(_6,_7){_6.pause();_6.echo(_7);_6.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=M.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(_6){function _7(_8){return function(_9){var _,$,ba,bb,bc,bd,be;$=K.replicate(_8," ");switch(_9.$==0?_9.$1.$==1?_9.$1.$0.$==2?_9.$1.$1.$==0?(_=[_9.$1.$0.$0,_9.$0],1):(_=[_9.$1,_9.$0],2):(_=[_9.$1,_9.$0],2):(_=[_9.$1,_9.$0],2):_9.$==2?(_=_9.$0,3):(_=[_9.$0,_9.$1],0)){case 0:return _[0]+"=\""+_[1]+"\"";case 1:ba=_[1];return $+"<"+ba+">"+_[0]+"</"+ba+">\r\n";case 2:bb=_[1];bc=R.partition(function(bf){return bf.$==1;},_[0]);bd=bc[1];be=bc[0];return bd.$==0?$+"<"+bb+(be.$===0?"":" "+K.concat(" ",R.ofSeq(S.delay(function(){return S.map(function(bf){return(_7(0))(bf);},be);}))))+"/>\r\n":$+"<"+bb+(be.$===0?"":" "+K.concat(" ",R.ofSeq(S.delay(function(){return S.map(function(bf){return(_7(0))(bf);},be);}))))+">\r\n"+K.concat("",R.ofSeq(S.delay(function(){return S.map(function(bf){return(_7(_8+1))(bf);},bd);})))+$+"</"+bb+">\r\n";case 3:return $+_+"\r\n";}};}return(_7(0))(_6);};f.alt=function(_6){return new e({$:1,$0:"alt",$1:_6});};f.src=function(_6){return new e({$:1,$0:"src",$1:_6});};f.cls=function(_6){return new e({$:1,$0:"class",$1:_6});};f.str=function(_6){return e.toString(_6);};f.op_PercentEquals=function(_6,_7){return new e({$:1,$0:_6,$1:_7});};f.op_Splice=function(_6){var _7;return R.ofArray([new e({$:2,$0:(_7=_6,a.String(_7))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(_6,_7){return new e({$:0,$0:_6,$1:_7});};g.$cctor=function(){var _6;g.$cctor=a.ignore;g.rawOpt=(_6={},_6.raw=true,_6);g.html=function(_7){return f.elem("html",_7);};g.head=function(_7){return f.elem("head",_7);};g.title=function(_7){return f.elem("title",_7);};g.style=function(_7){return f.elem("style",_7);};g.body=function(_7){return f.elem("body",_7);};g.div=function(_7){return f.elem("div",_7);};g.br=function(_7){return f.elem("br",_7);};g.section=function(_7){return f.elem("section",_7);};g.span=function(_7){return f.elem("span",_7);};g.table=function(_7){return f.elem("table",_7);};g.thead=function(_7){return f.elem("thead",_7);};g.tbody=function(_7){return f.elem("tbody",_7);};g.tfoot=function(_7){return f.elem("tfoot",_7);};g.img=function(_7){return f.elem("img",_7);};g.map=function(_7){return f.elem("map",_7);};g.area=function(_7){return f.elem("area",_7);};g.p=function(_7){return f.elem("p",_7);};g.a=function(_7){return f.elem("a",_7);};g.tr=function(_7){return f.elem("tr",_7);};g.td=function(_7){return f.elem("td",_7);};g.th=function(_7){return f.elem("th",_7);};g.ul=function(_7){return f.elem("ul",_7);};g.li=function(_7){return f.elem("li",_7);};g.h1=function(_7){return f.elem("h1",_7);};g.h2=function(_7){return f.elem("h1",_7);};g.h3=function(_7){return f.elem("h1",_7);};g.h4=function(_7){return f.elem("h1",_7);};g.strong=function(_7){return f.elem("strong",_7);};};i.Radio=function(_6,_7,_8,_9,_){return U.Element("div",new R.T({$:1,$0:(i.cls())("radio"),$1:_7}),[U.Element("label",_9,[U.Radio(_,true,_8),U.TextNode(_6)])]);};i.Checkbox=function(_6,_7,_8,_9,_){return U.Element("div",new R.T({$:1,$0:(i.cls())("checkbox"),$1:_7}),[U.Element("label",_9,[U.CheckBox(_,_8),U.TextNode(_6)])]);};i.TextArea=function(_6,_7,_8,_9,_){return U.Element("div",new R.T({$:1,$0:(i.cls())("form-group"),$1:_7}),[U.Element("label",_9,[U.TextNode(_6)]),U.InputArea(new R.T({$:1,$0:(i.cls())("form-control"),$1:_}),_8)]);};i.InputPassword=function(_6,_7,_8,_9,_){return U.Element("div",new R.T({$:1,$0:(i.cls())("form-group"),$1:_7}),[U.Element("label",_9,[U.TextNode(_6)]),U.PasswordBox(new R.T({$:1,$0:(i.cls())("form-control"),$1:_}),_8)]);};i.Input=function(_6,_7,_8,_9,_){return U.Element("div",new R.T({$:1,$0:(i.cls())("form-group"),$1:_7}),[U.Element("label",_9,[U.TextNode(_6)]),U.Input(new R.T({$:1,$0:(i.cls())("form-control"),$1:_}),_8)]);};i.Container=function(_6){return U.Element("div",[(i.cls())("container")],_6);};i.Class=function(){j.$cctor();return j.Class;};i.cls=function(){j.$cctor();return j.cls;};j.$cctor=function(){j.$cctor=a.ignore;j.cls=V.Class;j.Class=V.Class;};l=k.Intent=M.Class({toString:function(){return(((M.Curried3(function(_6,_7,_8){return _6("Intent("+N.toSafe(_7)+", "+I.p$2(_8)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,l);m=k.Trait=M.Class({toString:function(){return(((M.Curried3(function(_6,_7,_8){return _6("Trait("+N.toSafe(_7)+", "+N.prettyPrint(_8)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,m);n=k.Entity=M.Class({toString:function(){return((((M.Curried(function(_6,_7,_8,_9){return _6("Entity("+N.toSafe(_7)+", "+N.toSafe(_8)+", "+I.p$2(_9)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[2];},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,n);o=k.Meaning=M.Class({toString:function(){return((((M.Curried(function(_6,_7,_8,_9){return _6(I.p(_7)+" "+I.p$3(_8)+" "+I.p$5(_9));},4))(a.id))(this.get_Intent()))(this.get_Trait()))(this.get_Entities());},get_Entities:function(){return(this.Unwrap())[2];},get_Trait:function(){return(this.Unwrap())[1];},get_Intent:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,o);p=k.Question=M.Class({toString:function(){return(((M.Curried3(function(_6,_7,_8){return _6("Name: "+N.toSafe(_7)+" Text: "+N.toSafe(_8));}))(a.id))(this.get_Name()))(this.get_Text());},get_Text:function(){return(this.Unwrap())[1];},get_Name:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1];}},null,p);r.New=function(_6,_7,_8,_9,_){return{body:_6,end:_7,start:_8,suggested:_9,value:_};};q["Intent'"]=function(_6,_7){return!(_7.intent==null)?{$:1,$0:new l({$:0,$0:d.toLower(_7.intent.value),$1:null})}:null;};q["Trait'"]=function(_6){return!(_6.greetings==null)?{$:1,$0:new m({$:0,$0:"greetings",$1:d.toLower(_6.contact.value)})}:null;};q["Entity'$1"]=function(_6){return!(_6.contact==null)?{$:1,$0:new n({$:0,$0:"contact",$1:d.toLower(_6.contact.value),$2:null})}:null;};t=s["Meaning'"]=M.Class({get_TopIntent:function(){return R.head(R.sortBy(function(_6){return _6.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,t);u=s["Intent'"]=M.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,u);v=s["Entity'"]=M.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,v);s.HasMeaning=function(_6){var _7,_8,_9,_,$,ba;return _6!=null&&_6.$==1&&(_6.$0.$0.$==0&&(_6.$0.$1.get_Length()>0&&(_7=_6.$0.$1,true)))?{$:1,$0:new o({$:0,$0:null,$1:null,$2:{$:1,$0:R.map(function(bb){return new n({$:0,$0:d.toLower(bb.get_Role()),$1:bb.get_Value(),$2:{$:1,$0:bb.get_Confidence()}});},R.filter(function(bb){return bb.get_Confidence()>s.entityConfidenceThreshold();},_7))}})}:_6!=null&&_6.$==1&&(_6.$0.$1.$==0&&(_6.$0.$0.get_Length()>0&&_6.$0.get_TopIntent().get_Confidence()>s.intentConfidenceThreshold()&&(_8=[_6.$0.$0,_6],true)))?(_9=_8[1],{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(_9.$0.get_TopIntent().get_Name()),$1:{$:1,$0:_9.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):_6!=null&&_6.$==1&&(_6.$0.$0.get_Length()>0&&_6.$0.$1.get_Length()>0&&_6.$0.get_TopIntent().get_Confidence()>s.intentConfidenceThreshold()&&(_=[_6.$0.$1,_6.$0.$0,_6],true))?($=_[2],(ba=R.map(function(bb){return new n({$:0,$0:d.toLower(bb.get_Role()),$1:bb.get_Value(),$2:{$:1,$0:bb.get_Confidence()}});},R.filter(function(bb){return bb.get_Confidence()>s.entityConfidenceThreshold();},$.$0.get_Entities())),{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower($.$0.get_TopIntent().get_Name()),$1:{$:1,$0:$.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:ba}})})):null;};s.entityConfidenceThreshold=function(){w.$cctor();return w.entityConfidenceThreshold;};s.set_entityConfidenceThreshold=function(_6){w.$cctor();w.entityConfidenceThreshold=_6;};s.intentConfidenceThreshold=function(){w.$cctor();return w.intentConfidenceThreshold;};s.set_intentConfidenceThreshold=function(_6){w.$cctor();w.intentConfidenceThreshold=_6;};s.QuickPrograms=function(_6){return _6==="programs"?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};s.QuickNo=function(_6){var _7;return _6==="no"||(_6==="NO"||(_6==="No"||(_6==="nope"||(_6==="no way"||(_6==="nah"||(_6==="don't do it"||_6==="stop"))))))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};s.QuickYes=function(_6){var _7;return _6==="yes"||(_6==="YES"||(_6==="Yes"||(_6==="YEs"||(_6==="ok"||(_6==="sure"||(_6==="yeah"||(_6==="yep"||(_6==="uh huh"||(_6==="go ahead"||_6==="go")))))))))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};s.QuickHelp=function(_6){var _7;return _6==="help"||(_6==="help me"||(_6==="what's this?"||_6==="huh"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};s.QuickHello=function(_6){var _7;return _6==="hello"||(_6==="hey"||(_6==="yo"||_6==="hi"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};s.Voices=function(_6){return _6==="voices"?{$:1,$0:null}:null;};s.Debug=function(_6){return _6==="debug"?{$:1,$0:null}:null;};s.Blank=function(_6){return _6===""?{$:1,$0:null}:null;};k.No=function(_6){var _7,_8;return(_8=k.Intent$1("no",_6),_8!=null&&_8.$==1&&(_8.$0[0]==null&&(_8.$0[1]==null&&(_7=_6,true))))?{$:1,$0:_7}:null;};k.Yes=function(_6){var _7,_8;return(_8=k.Intent$1("yes",_6),_8!=null&&_8.$==1&&(_8.$0[0]==null&&(_8.$0[1]==null&&(_7=_6,true))))?{$:1,$0:_7}:null;};k.Entity$1=function(_6,_7){return _7.get_Name()===_6?{$:1,$0:_7.get_Value()}:null;};k.Intent$1=function(_6,_7){var _8;return _7.get_Intent()!=null&&_7.get_Intent().$0.get_Name()===_6?(_8=_7.Unwrap(),{$:1,$0:[_8[1],_8[2]]}):null;};w.$cctor=function(){w.$cctor=a.ignore;w.intentConfidenceThreshold=0.85;w.entityConfidenceThreshold=0.85;};y=x.User=M.Class({toString:function(){return this.Name;}},null,y);y.New=function(_6){return new y({Name:_6});};z.MicReady={$:5};z.MicAudioEnd={$:4};z.MicAudioStart={$:3};z.MicDisconnected={$:2};z.MicConnecting={$:1};z.MicNotInitialized={$:0};A.ClientUnderstand={$:2};A.ClientReady={$:1};A.ClientNotInitialzed={$:0};B=x.Interpreter=M.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,B);C=x.CUI=M.Class({SayVoices:function(){var _6,_7,_8;_6=this;_7=a.speechSynthesis.getVoices();!(_7==null)?(_8=d.toArray(_7),_6.Say((function(_9){return function(_){return _9("There are currently "+a.String(_)+" voices installed on this computer or device.");};}(a.id))(Q.length(_8))),Q.iteri(function(_9,_){return _6.Say(((((M.Curried(function($,ba,bb,bc){return $("Voice "+a.String(ba)+". Name: "+N.toSafe(bb)+", Local: "+N.prettyPrint(bc)+".");},4))(a.id))(_9))(_.name))(_.localService));},_8)):void 0;},Wait:function(_6){this.Wait$1(function(){W.Start(_6,null);});},Wait$1:function(_6){this["Echo'"]("please wait...");this.Term.pause();_6();this.Term.resume();},sayRandom:function(_6,_7){this.Say(x.getRandomPhrase(_6,_7));},Say:function(_6){var _7,_8,_9;_7=this.Voice;_7!=null&&_7.$==1?(_8=_7.$0,W.Start((_9=null,W.Delay(function(){var _;_=new a.SpeechSynthesisUtterance(_6);_.voice=_8;a.speechSynthesis.speak(_);return W.Zero();})),null),this.Caption?this["Echo'"](_6):void 0):this["Echo'"](_6);},Debug:function(_6,_7){d.debug(_6,_7);},"EchoHtml'":function(_6){var _7,_8;_7=(_8={},_8.raw=true,_8);this.Term.disable();this.Term.echo(_6,_7);this.Term.enable();},"Echo'":function(_6){this.Term.disable();this.Term.echo(_6);this.Term.enable();}},null,C);C.New=function(_6,_7,_8,_9){return new C({Voice:_6,Mic:_7,Term:_8,Caption:_9});};x.helpPhrases=function(){D.$cctor();return D.helpPhrases;};x.helloUserPhrases=function(){D.$cctor();return D.helloUserPhrases;};x.helloPhrases=function(){D.$cctor();return D.helloPhrases;};x.waitRetrievePhrases=function(){D.$cctor();return D.waitRetrievePhrases;};x["getRandomPhrase'"]=function(_6){return d.replace_tok("$0","",S.nth(x.rng().Next(0,_6.get_Length()),_6));};x.getRandomPhrase=function(_6,_7){return d.replace_tok("$0",_7,S.nth(x.rng().Next(0,_6.get_Length()),_6));};x.rng=function(){D.$cctor();return D.rng;};D.$cctor=function(){D.$cctor=a.ignore;D.rng=new X.New();D.waitRetrievePhrases=R.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);D.helloPhrases=R.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);D.helloUserPhrases=R.ofArray(["Hi $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0."]);D.helpPhrases=R.ofArray(["What can I help you with $0?"]);};E.update=function(_6,_7,_8,_9,_){var $,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV;function bW(cc){return _7.ContainsKey(cc);}function bX(cc,cd){return _7.Add(cc,cd);}function bY(cc){_7.Remove(cc);}function bZ(){_.shift();}function b0(){_8.shift();}function b1(cc){var cd;cd=E.getQuestion(cc);cd==null?(function(ce){return function(cf){return ce("No such question: "+N.toSafe(cf));};}(Y.FailWith))(cc):_8.unshift(cd.$0);}function b2(cc){_6.Say(cc);}function b3(cc){_9.unshift(cc);b2(cc);}function b4(cc,cd){var ce;ce=x.getRandomPhrase(cc,cd);_9.unshift(ce);return _6.Say(ce);}function b5(cc,cd){bX(cc,cd);b1(cc);E.debug((function(ce){return function(cf){return ce("Added question: "+I.p$8(cf)+".");};}(a.id))(_8[0]));return b3(d.replace_tok("$0",cd,E.getQuestion(cc).$0.get_Text()));}function b6(cc,cd){return bW(cc)?{$:1,$0:cd}:null;}function b7(cc,cd){return!bW(cc)?{$:1,$0:cd}:null;}function b8(cc){var cd;cd=b7("user",cc);return cd!=null&&cd.$==1?{$:1,$0:cd.$0}:null;}function b9(cc){var cd;cd=b6("user",cc);return cd!=null&&cd.$==1?{$:1,$0:cd.$0}:null;}function b_(cc){return _8.length===0?(bZ(),{$:1,$0:cc}):null;}function b$(cc,cd){return E.haveQuestion(cc)&&_8.length>0&&_8[0].get_Name()===cc?(bZ(),b0(),{$:1,$0:cd}):null;}function ca(cc){var cd;cd=b7("started",cc);return cd!=null&&cd.$==1?{$:1,$0:cd.$0}:null;}function cb(cc){var cd;W.Start((cd=null,W.Delay(function(){b4(x.waitRetrievePhrases(),"user name");return W.Bind((new _0.New()).Async("SMApp.Web:SMApp.Web.Server.GetUser:1345941124",[cc]),function(ce){return ce==null?(b3((function(cf){return function(cg){return cf("Sorry I did not find the user name "+N.toSafe(cg)+".");};}(a.id))(cc)),b5("addUser",cc),W.Zero()):(_7.Add("user",ce.$0),b4(x.helloUserPhrases(),(function(cf){return function(cg){return cf(N.prettyPrint(cg));};}(a.id))(_7.get_Item("user"))),W.Zero());});})),null);}E.debug((function(cc){return function(cd){return cc("Begin context: "+N.prettyPrint(cd)+".");};}(a.id))(_));E.debug((function(cc){return function(cd){return cc("Begin questions: "+N.prettyPrint(cd)+".");};}(a.id))(_8));$=R.ofSeq(S.take(_.length>=5?5:_.length,_));$.$==1&&(bb=b8($.$0),bb!=null&&bb.$==1&&(bc=ca(bb.$0),bc!=null&&bc.$==1&&(bd=b_(bc.$0),bd!=null&&bd.$==1&&(be=k.Intent$1("hello",bd.$0),be!=null&&be.$==1&&(be.$0[0]==null&&(be.$0[1]==null&&$.$1.$==0))))))?(_7.Add("started",true),b4(x.helloPhrases(),"")):$.$==1&&(bg=b8($.$0),bg!=null&&bg.$==1&&(bh=b_(bg.$0),bh!=null&&bh.$==1&&(bi=k.Intent$1("hello",bh.$0),bi!=null&&bi.$==1&&(bi.$0[0]==null&&(bi.$0[1]==null&&$.$1.$==0)))))?b3("Hello, tell me your user name to get started."):$.$==1&&(bk=b8($.$0),bk!=null&&bk.$==1&&(bl=b_(bk.$0),bl!=null&&bl.$==1&&(bm=k.Intent$1("hello",bl.$0),bm!=null&&bm.$==1&&(bm.$0[0]==null&&((bn=bm.$0[1],bn!=null&&bn.$==1)&&(bm.$0[1].$0.$==1&&(bo=k.Entity$1("contact",bm.$0[1].$0.$0),bo!=null&&bo.$==1&&(bm.$0[1].$0.$1.$==0&&($.$1.$==0&&(bj=bo.$0,true))))))))))?cb(bj):$.$==1&&(bq=b8($.$0),bq!=null&&bq.$==1&&(br=ca(bq.$0),br!=null&&br.$==1&&(br.$0.$0==null&&(br.$0.$1==null&&((bs=br.$0.$2,bs!=null&&bs.$==1)&&(br.$0.$2.$0.$==1&&(bt=k.Entity$1("contact",br.$0.$2.$0.$0),bt!=null&&bt.$==1&&(br.$0.$2.$0.$1.$==0&&($.$1.$==0&&(bp=bt.$0,true))))))))))?(_7.Add("started",true),b3("Hello I'm Selma."),cb(bp)):$.$==1&&(bv=b9($.$0),bv!=null&&bv.$==1&&(bw=b_(bv.$0),bw!=null&&bw.$==1?(bx=k.Intent$1("hello",bw.$0),bx!=null&&bx.$==1?bx.$0[0]==null?(by=bx.$0[1],by!=null&&by.$==1)?bx.$0[1].$0.$==1?(bz=k.Entity$1("contact",bx.$0[1].$0.$0),bz!=null&&bz.$==1?bx.$0[1].$0.$1.$==0?$.$1.$==0&&(bu=bz.$0,true):bv.$0.$0==null&&(bv.$0.$1==null&&((bA=bv.$0.$2,bA!=null&&bA.$==1)&&(bv.$0.$2.$0.$==1&&(bB=k.Entity$1("contact",bv.$0.$2.$0.$0),bB!=null&&bB.$==1&&(bv.$0.$2.$0.$1.$==0&&($.$1.$==0&&(bu=bB.$0,true))))))):bv.$0.$0==null&&(bv.$0.$1==null&&((bC=bv.$0.$2,bC!=null&&bC.$==1)&&(bv.$0.$2.$0.$==1&&(bD=k.Entity$1("contact",bv.$0.$2.$0.$0),bD!=null&&bD.$==1&&(bv.$0.$2.$0.$1.$==0&&($.$1.$==0&&(bu=bD.$0,true)))))))):bv.$0.$0==null&&(bv.$0.$1==null&&((bE=bv.$0.$2,bE!=null&&bE.$==1)&&(bv.$0.$2.$0.$==1&&(bF=k.Entity$1("contact",bv.$0.$2.$0.$0),bF!=null&&bF.$==1&&(bv.$0.$2.$0.$1.$==0&&($.$1.$==0&&(bu=bF.$0,true))))))):bv.$0.$0==null&&(bv.$0.$1==null&&((bG=bv.$0.$2,bG!=null&&bG.$==1)&&(bv.$0.$2.$0.$==1&&(bH=k.Entity$1("contact",bv.$0.$2.$0.$0),bH!=null&&bH.$==1&&(bv.$0.$2.$0.$1.$==0&&($.$1.$==0&&(bu=bH.$0,true))))))):bv.$0.$0==null&&(bv.$0.$1==null&&((bI=bv.$0.$2,bI!=null&&bI.$==1)&&(bv.$0.$2.$0.$==1&&(bJ=k.Entity$1("contact",bv.$0.$2.$0.$0),bJ!=null&&bJ.$==1&&(bv.$0.$2.$0.$1.$==0&&($.$1.$==0&&(bu=bJ.$0,true))))))):bv.$0.$0==null&&(bv.$0.$1==null&&((bK=bv.$0.$2,bK!=null&&bK.$==1)&&(bv.$0.$2.$0.$==1&&(bL=k.Entity$1("contact",bv.$0.$2.$0.$0),bL!=null&&bL.$==1&&(bv.$0.$2.$0.$1.$==0&&($.$1.$==0&&(bu=bL.$0,true)))))))):bv.$0.$0==null&&(bv.$0.$1==null&&((bM=bv.$0.$2,bM!=null&&bM.$==1)&&(bv.$0.$2.$0.$==1&&(bN=k.Entity$1("contact",bv.$0.$2.$0.$0),bN!=null&&bN.$==1&&(bv.$0.$2.$0.$1.$==0&&($.$1.$==0&&(bu=bN.$0,true)))))))))?b5("addUser",_7.get_Item("user")):$.$==1&&(bP=b9($.$0),bP!=null&&bP.$==1&&(bQ=k.Yes(bP.$0),bQ!=null&&bQ.$==1&&((bR=b$("addUser",bQ.$0),bR!=null&&bR.$==1)&&$.$1.$==0)))?(b3((function(cc){return function(cd){return cc("Added user "+N.prettyPrint(cd)+".");};}(a.id))(_7.get_Item("addUser"))),bY("addUser")):$.$==1&&(bT=b9($.$0),bT!=null&&bT.$==1&&(bU=k.No(bT.$0),bU!=null&&bU.$==1&&((bV=b$("addUser",bU.$0),bV!=null&&bV.$==1)&&$.$1.$==0)))?(b3("did not add user"),bY("addUser")):(E.debug((function(cc){return function(cd){return cc("Did not understand "+N.printList(function(ce){return I.p$7(ce);},cd)+".");};}(a.id))($)),bZ(),b3("Sorry I didn't understand what you meant."),_8.length>0?b3(S.nth(0,_8).get_Text()):void 0);E.debug((function(cc){return function(cd){return cc("End context: "+N.prettyPrint(cd)+".");};}(a.id))(_));E.debug((function(cc){return function(cd){return cc("End questions: "+N.prettyPrint(cd)+".");};}(a.id))(_8));};E.haveQuestion=function(_6){return R.exists(function(_7){return _7.get_Name()===_6;},E.questions());};E.getQuestion=function(_6){return S.tryFind(function(_7){return _7.get_Name()===_6;},E.questions());};E.questions=function(){F.$cctor();return F.questions;};E.debug=function(_6){d.debug("Main",_6);};F.$cctor=function(){F.$cctor=a.ignore;F.questions=R.ofArray([new p({$:0,$0:"addUser",$1:"Do you want me to add the user $0?"}),new p({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?"})]);};G.run=function(){var _6,_7;_6=M.ThisFunc(function(_8,_9){return((G.Main().get_Text())(_8))(_9);});_7=G.Main().get_Options();a.$("#main").terminal(_6,_7);return U.get_Empty();};G.Main=function(){H.$cctor();return H.Main;};G.container=function(){H.$cctor();return H.container;};G.wait=function(_6){d["Terminal.Echo'"](G.CUI().Term,"please wait");G.CUI().Term.pause();_6();G.CUI().Term.resume();};G.sayRandom=function(_6,_7){G.say(x.getRandomPhrase(_7,_6));};G.sayVoices=function(){var _6;_6=d.toArray(a.speechSynthesis.getVoices());G["say'"]((function(_7){return function(_8){return _7("There are currently "+a.String(_8)+" voices installed on this computer or device.");};}(a.id))(Q.length(_6)));Q.iteri(function(_7,_8){return G["say'"](((((M.Curried(function(_9,_,$,ba){return _9("Voice "+a.String(_)+". Name: "+N.toSafe($)+", Local: "+N.prettyPrint(ba)+".");},4))(a.id))(_7))(_8.name))(_8.localService));},_6);};G.say=function(_6){G.Responses().unshift(_6);G["say'"](_6);};G["say'"]=function(_6){var _7,_8,_9;_7=G.CUI().Voice;_7!=null&&_7.$==1?(_8=_7.$0,W.Start((_9=null,W.Delay(function(){var _;_=new a.SpeechSynthesisUtterance(_6);_.voice=_8;a.speechSynthesis.speak(_);G.CUI().Caption?d["Terminal.Echo'"](G.CUI().Term,_6):void 0;return W.Zero();})),null)):d["Terminal.Echo'"](G.CUI().Term,_6);};G.initMic=function(_6,_7){var _8,_9;G.set_CUI((_8={$:1,$0:new _1.Microphone(_2.getElementById("microphone"))},C.New(G.CUI().Voice,_8,G.CUI().Term,G.CUI().Caption)));_9=G.CUI().Mic.$0;_9.onconnecting=function(){G.set_MicState(z.MicConnecting);return G.debug("Mic connecting...");};_9.ondisconnected=function(){G.set_MicState(z.MicDisconnected);return G.debug("Mic disconnected.");};_9.onaudiostart=function(){G.set_MicState(z.MicAudioStart);return G.debug("Mic audio start...");};_9.onaudioend=function(){G.set_MicState(z.MicAudioEnd);return G.debug("Mic audio end.");};_9.onerror=function(_){G.set_MicState({$:6,$0:_});return G.debug((function($){return function(ba){return $("Mic error : "+N.toSafe(ba)+".");};}(a.id))(_));};_9.onready=function(){G.set_MicState(z.MicReady);return G.debug("Mic ready.");};_9.onresult=function(_,$){return G.ClientState().$==2?G.echo("I'm still trying to understand what you said before."):G.ClientState().$==0?d.error("Client is not intialized."):!(_==null||$==null)?(G.set_MicState({$:7,$0:_,$1:$}),G.debug((((M.Curried3(function(ba,bb,bc){return ba("Mic result: "+N.prettyPrint(bb)+" "+N.prettyPrint(bc)+".");}))(a.id))(_))($)),_6(_9,[_,$])):G.debug("Mic: No result returned.");};_9.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};G.initSpeech=function(){var _6;_6=d.toArray(G.synth().getVoices());Q.iter(function(_7){if(_3.Equals(G.CUI().Voice,null)&&(_7.name.indexOf("Microsoft Zira")!=-1||_7.name.toLowerCase().indexOf("female")!=-1)){G.set_CUI(C.New({$:1,$0:_7},G.CUI().Mic,G.CUI().Term,G.CUI().Caption));G.debug((function(_8){return function(_9){return _8("Using voice "+N.toSafe(_9)+".");};}(a.id))(G.CUI().Voice.$0.name));}},_6);_3.Equals(G.CUI().Voice,null)&&Q.length(_6)>0?(G.set_CUI(C.New({$:1,$0:Q.find(function(_7){return _7["default"];},_6)},G.CUI().Mic,G.CUI().Term,G.CUI().Caption)),G.debug((function(_7){return function(_8){return _7("Using default voice "+N.toSafe(_8)+".");};}(a.id))(G.CUI().Voice.$0.name))):_3.Equals(G.CUI().Voice,null)?G.echo("No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma."):void 0;};G.synth=function(){H.$cctor();return H.synth;};G.push=function(_6){G.Context().unshift(_6);return G.Context();};G.Props=function(){H.$cctor();return H.Props;};G.Responses=function(){H.$cctor();return H.Responses;};G.Questions=function(){H.$cctor();return H.Questions;};G.Context=function(){H.$cctor();return H.Context;};G.debug=function(_6){d.debug("CLIENT",_6);};G.echo=function(_6){if(!(G.CUI().Term==null))d["Terminal.EchoHtml'"](G.CUI().Term,(function(_7){return function(_8){return _7(N.prettyPrint(_8));};}(a.id))(_6));};G.ClientState=function(){H.$cctor();return H.ClientState;};G.set_ClientState=function(_6){H.$cctor();H.ClientState=_6;};G.MicState=function(){H.$cctor();return H.MicState;};G.set_MicState=function(_6){H.$cctor();H.MicState=_6;};G.CUI=function(){H.$cctor();return H.CUI;};G.set_CUI=function(_6){H.$cctor();H.CUI=_6;};H.$cctor=function(){var _6;H.$cctor=a.ignore;function _7(_9,_){var $,ba,bb,bc,bd,be,bf,bg,bh,bi;$=_[0];ba=_[1];G.debug((((M.Curried3(function(bj,bk,bl){return bj("Voice: "+N.prettyPrint(bk)+" "+N.prettyPrint(bl));}))(a.id))($))(ba));bb=(bc=q["Intent'"]($,ba),bc!=null&&bc.$==1?{$:1,$0:bc.$0}:null);bd=(be=q["Trait'"](ba),be!=null&&be.$==1?{$:1,$0:be.$0}:null);bf=(bg=q["Entity'$1"](ba),bg!=null&&bg.$==1?{$:1,$0:R.ofArray([bg.$0])}:null);return bb==null&&(bd==null&&bf==null)?null:(G.debug(((((M.Curried(function(bj,bk,bl,bm){return bj("Voice: "+I.p(bk)+" "+I.p$3(bl)+" "+I.p$5(bm));},4))(a.id))(bb))(bd))(bf)),bi=G.push(new o({$:0,$0:bb,$1:bd,$2:bf})),E.update(G.CUI(),G.Props(),G.Questions(),G.Responses(),bi));}function _8(_9,_){var $,ba,bb,bc,bd,be,bf,bg,bh,bi,bj;G.set_CUI(C.New(G.CUI().Voice,G.CUI().Mic,_9,G.CUI().Caption));_3.Equals(G.CUI().Mic,null)?G.initMic(_7,_9):void 0;_3.Equals(G.CUI().Voice,null)?G.initSpeech():void 0;G.ClientState().$===0?G.set_ClientState(A.ClientReady):void 0;return($=s.Blank(_),$!=null&&$.$==1)?G["say'"]("Tell me what you want me to do or ask me a question."):(ba=s.Debug(_),ba!=null&&ba.$==1)?(G.debug((function(bk){return function(bl){return bk("Context: "+N.prettyPrint(bl));};}(a.id))(G.Context())),G.debug((function(bk){return function(bl){return bk("Questions: "+N.prettyPrint(bl));};}(a.id))(G.Questions()))):(bb=s.Voices(_),bb!=null&&bb.$==1)?G.sayVoices():G.ClientState().$==1?(bd=s.QuickHello(_),bd!=null&&bd.$==1?(bc=bd.$0,true):(be=s.QuickHelp(_),be!=null&&be.$==1?(bc=be.$0,true):(bf=s.QuickYes(_),bf!=null&&bf.$==1?(bc=bf.$0,true):(bg=s.QuickNo(_),bg!=null&&bg.$==1?(bc=bg.$0,true):(bh=s.QuickPrograms(_),bh!=null&&bh.$==1&&(bc=bh.$0,true))))))?(G.debug((function(bk){return function(bl){return bk("Quick Text: "+I.p$7(bl)+".");};}(a.id))(bc)),bi=G.push(bc),E.update(G.CUI(),G.Props(),G.Questions(),G.Responses(),bi),G.set_ClientState(A.ClientReady)):G.CUI().Wait((bj=null,W.Delay(function(){G.set_ClientState(A.ClientUnderstand);return W.Combine(W.Bind((new _0.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:-1430995972",[_]),function(bk){var bl,bm,bn;bl=s.HasMeaning(bk);return bl!=null&&bl.$==1?(bm=bl.$0,(G.debug(((((M.Curried(function(bo,bp,bq,br){return bo("Text: "+I.p(bp)+" "+I.p$3(bq)+" "+I.p$5(br));},4))(a.id))(bm.get_Intent()))(bm.get_Trait()))(bm.get_Entities())),bn=G.push(bm),E.update(G.CUI(),G.Props(),G.Questions(),G.Responses(),bn),W.Zero())):(G.debug("Text: Did not receive a meaning from the server."),G["say'"]("Sorry I did not understand what you said."),W.Zero());}),W.Delay(function(){G.set_ClientState(A.ClientReady);return W.Zero();}));}))):G.ClientState().$==0?d.error("Client is not initialized."):G["say'"]("I'm still trying to understand what you said before.");}H.CUI=C.New(null,null,null,false);H.MicState=z.MicNotInitialized;H.ClientState=A.ClientNotInitialzed;H.Context=[];H.Questions=[];H.Responses=[];H.Props=new _5.New$5();H.synth=a.speechSynthesis;H.container=i.Container;H.Main=new B({$:0,$0:function(_9){return function(_){return _7(_9,_);};},$1:[function(_9){return function(_){return _8(_9,_);};},(_6={},_6.name="Main",_6.greetings="Welcome to Selma. Enter 'hello my name is...(you)' to begin and initialize speech or help for more assistance.",_6.prompt=">",_6)]});};I.p$8=function(_6){return"Question ("+N.prettyPrint(_6.$0)+", "+N.prettyPrint(_6.$1)+")";};I.p$2=function(_6){return _6==null?"null":"Some "+N.prettyPrint(_6.$0);};I.p$1=function(_6){return"Intent ("+N.prettyPrint(_6.$0)+", "+I.p$2(_6.$1)+")";};I.p=function(_6){return _6==null?"null":"Some "+I.p$1(_6.$0);};I.p$4=function(_6){return"Trait ("+N.prettyPrint(_6.$0)+", "+N.prettyPrint(_6.$1)+")";};I.p$3=function(_6){return _6==null?"null":"Some "+I.p$4(_6.$0);};I.p$6=function(_6){return"Entity ("+N.prettyPrint(_6.$0)+", "+N.prettyPrint(_6.$1)+", "+I.p$2(_6.$2)+")";};I.p$5=function(_6){return _6==null?"null":"Some "+N.printList(function(_7){return I.p$6(_7);},_6.$0);};I.p$7=function(_6){return"Meaning ("+I.p(_6.$0)+", "+I.p$3(_6.$1)+", "+I.p$5(_6.$2)+")";};}());
