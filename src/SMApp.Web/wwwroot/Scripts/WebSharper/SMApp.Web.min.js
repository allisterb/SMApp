(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=c.Bs=c.Bs||{};i=b.NLU=b.NLU||{};j=i.Babelfy=i.Babelfy||{};k=j.ApiResponse=j.ApiResponse||{};l=j.TokenFragment=j.TokenFragment||{};m=j.CharFragment=j.CharFragment||{};n=i.Witai=i.Witai||{};o=n.Utterance=n.Utterance||{};p=n.Intent=n.Intent||{};q=n.Entity=n.Entity||{};r=n.Trait=n.Trait||{};s=n["Utterance'"]=n["Utterance'"]||{};t=n["Value'"]=n["Value'"]||{};u=i.QnAMaker=i.QnAMaker||{};v=u.ITSQuestion=u.ITSQuestion||{};w=u.ITSAnswerContext=u.ITSAnswerContext||{};x=u.ITSAnswer=u.ITSAnswer||{};y=u.ITSAnswers=u.ITSAnswers||{};z=c.NLG=c.NLG||{};A=a.StartupCode$SMApp_Web$NLG=a.StartupCode$SMApp_Web$NLG||{};B=c.NLU=c.NLU||{};C=B.Intent=B.Intent||{};D=B.Trait=B.Trait||{};E=B.Entity=B.Entity||{};F=B.Utterance=B.Utterance||{};G=B.Question=B.Question||{};H=B.Voice=B.Voice||{};I=H["Entity'"]=H["Entity'"]||{};J=B.Text=B.Text||{};K=J["Utterance'"]=J["Utterance'"]||{};L=J["Intent'"]=J["Intent'"]||{};M=J["Entity'"]=J["Entity'"]||{};N=J["Trait'"]=J["Trait'"]||{};O=B.Domain=B.Domain||{};P=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};Q=c.CUI=c.CUI||{};R=Q.MicState=Q.MicState||{};S=Q.ClientState=Q.ClientState||{};T=Q.Interpreter=Q.Interpreter||{};U=Q.CUI=Q.CUI||{};V=c.Dialogue=c.Dialogue||{};W=V.Dialogue=V.Dialogue||{};X=c.Main=c.Main||{};Y=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};Z=c.Client=c.Client||{};_0=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};_1=a.GeneratedPrintf=a.GeneratedPrintf||{};_2=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};_3=a.WebSharper;_4=_3&&_3.UI;_5=_4&&_4.Client;_6=_5&&_5.Templates;_7=_4&&_4.Doc;_8=_4&&_4.AttrProxy;_9=_3&&_3.Arrays;_=a.IntelliFactory;$=_&&_.Runtime;ba=_3&&_3.Utils;bb=a.console;bc=a.jQuery;bd=_3&&_3.Strings;be=_3&&_3.List;bf=_3&&_3.Seq;bg=_4&&_4.AttrModule;bh=_3&&_3.Concurrency;bi=a.JSON;bj=_3&&_3.Random;bk=_3&&_3.Collections;bl=bk&&bk.Map;bm=_3&&_3.JavaScript;bn=bm&&bm.Pervasives;bo=a.SDK;bp=_3&&_3.Operators;bq=_3&&_3.Remoting;br=bq&&bq.AjaxRemotingProvider;bs=a.Wit;bt=a.document;bu=_3&&_3.Unchecked;bv=bk&&bk.Dictionary;d.speechSynthesis=function(){return a.speechSynthesis;};d.elementHTML=function(bw){return bw.innerHTML;};d.createElement=function(bw){var bx;bx=self.document.createElement("div");_6.LoadLocalTemplates("");_7.RunAppend(bx,bw);};d.container=function(bw){return _7.Element("div",[d.cls("container")],bw);};d.dindex=function(bw){return _8.Create("data-index",a.String(bw));};d.cls=function(bw){return _8.Create("class",bw);};d.eid=function(bw){return _8.Create("id",bw);};d.termOutput=function(){return _9.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(bw){return bw.toLowerCase();};d.debug=function(bw,bx){d.info(((($.Curried3(function(by,bz,bA){return by("DEBUG: "+ba.toSafe(bz)+": "+ba.prettyPrint(bA));}))(a.id))(bw.toUpperCase()))(bx));};d.error=function(bw){bb.error(bw);};d.info=function(bw){bb.info(bw);};d.jserror=function(bw){bc.error(bw);};d.toArray=function(bw){return _9.map(a.id,bc.makeArray(bw));};d["Terminal.EchoHtml'"]=function(bw,bx){bw.pause();bw.echo(bx,d.rawOpt());bw.resume();};d["Terminal.Echo'"]=function(bw,bx){bw.pause();bw.echo(bx);bw.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=$.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(bw){function bx(by){return function(bz){var bA,bB,bC,bD,bE,bF,bG;bB=bd.replicate(by," ");switch(bz.$==0?bz.$1.$==1?bz.$1.$0.$==2?bz.$1.$1.$==0?(bA=[bz.$1.$0.$0,bz.$0],1):(bA=[bz.$1,bz.$0],2):(bA=[bz.$1,bz.$0],2):(bA=[bz.$1,bz.$0],2):bz.$==2?(bA=bz.$0,3):(bA=[bz.$0,bz.$1],0)){case 0:return bA[0]+"=\""+bA[1]+"\"";case 1:bC=bA[1];return bB+"<"+bC+">"+bA[0]+"</"+bC+">\r\n";case 2:bD=bA[1];bE=be.partition(function(bH){return bH.$==1;},bA[0]);bF=bE[1];bG=bE[0];return bF.$==0?bB+"<"+bD+(bG.$===0?"":" "+bd.concat(" ",be.ofSeq(bf.delay(function(){return bf.map(function(bH){return(bx(0))(bH);},bG);}))))+"/>\r\n":bB+"<"+bD+(bG.$===0?"":" "+bd.concat(" ",be.ofSeq(bf.delay(function(){return bf.map(function(bH){return(bx(0))(bH);},bG);}))))+">\r\n"+bd.concat("",be.ofSeq(bf.delay(function(){return bf.map(function(bH){return(bx(by+1))(bH);},bF);})))+bB+"</"+bD+">\r\n";case 3:return bB+bA+"\r\n";}};}return(bx(0))(bw);};f.alt=function(bw){return new e({$:1,$0:"alt",$1:bw});};f.src=function(bw){return new e({$:1,$0:"src",$1:bw});};f.cls=function(bw){return new e({$:1,$0:"class",$1:bw});};f.str=function(bw){return e.toString(bw);};f.op_PercentEquals=function(bw,bx){return new e({$:1,$0:bw,$1:bx});};f.op_Splice=function(bw){var bx;return be.ofArray([new e({$:2,$0:(bx=bw,a.String(bx))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(bw,bx){return new e({$:0,$0:bw,$1:bx});};g.$cctor=function(){var bw;g.$cctor=a.ignore;g.rawOpt=(bw={},bw.raw=true,bw);g.html=function(bx){return f.elem("html",bx);};g.head=function(bx){return f.elem("head",bx);};g.title=function(bx){return f.elem("title",bx);};g.style=function(bx){return f.elem("style",bx);};g.body=function(bx){return f.elem("body",bx);};g.div=function(bx){return f.elem("div",bx);};g.br=function(bx){return f.elem("br",bx);};g.section=function(bx){return f.elem("section",bx);};g.span=function(bx){return f.elem("span",bx);};g.table=function(bx){return f.elem("table",bx);};g.thead=function(bx){return f.elem("thead",bx);};g.tbody=function(bx){return f.elem("tbody",bx);};g.tfoot=function(bx){return f.elem("tfoot",bx);};g.img=function(bx){return f.elem("img",bx);};g.map=function(bx){return f.elem("map",bx);};g.area=function(bx){return f.elem("area",bx);};g.p=function(bx){return f.elem("p",bx);};g.a=function(bx){return f.elem("a",bx);};g.tr=function(bx){return f.elem("tr",bx);};g.td=function(bx){return f.elem("td",bx);};g.th=function(bx){return f.elem("th",bx);};g.ul=function(bx){return f.elem("ul",bx);};g.li=function(bx){return f.elem("li",bx);};g.h1=function(bx){return f.elem("h1",bx);};g.h2=function(bx){return f.elem("h1",bx);};g.h3=function(bx){return f.elem("h1",bx);};g.h4=function(bx){return f.elem("h1",bx);};g.strong=function(bx){return f.elem("strong",bx);};};h.Radio=function(bw,bx,by,bz,bA){return _7.Element("div",new be.T({$:1,$0:d.cls("radio"),$1:bx}),[_7.Element("label",bz,[_7.Radio(bA,true,by),_7.TextNode(bw)])]);};h.checkbox=function(bw,bx,by,bz,bA){return _7.Element("div",new be.T({$:1,$0:d.cls("checkbox"),$1:bx}),[_7.Element("label",bz,[_7.CheckBox(bA,by),_7.TextNode(bw)])]);};h.textArea=function(bw,bx,by,bz,bA){return _7.Element("div",new be.T({$:1,$0:d.cls("form-group"),$1:bx}),[_7.Element("label",bz,[_7.TextNode(bw)]),_7.InputArea(new be.T({$:1,$0:d.cls("form-control"),$1:bA}),by)]);};h.inputPassword=function(bw,bx,by,bz,bA){return _7.Element("div",new be.T({$:1,$0:d.cls("form-group"),$1:bx}),[_7.Element("label",bz,[_7.TextNode(bw)]),_7.PasswordBox(new be.T({$:1,$0:d.cls("form-control"),$1:bA}),by)]);};h.input=function(bw,bx,by,bz,bA){return _7.Element("div",new be.T({$:1,$0:d.cls("form-group"),$1:bx}),[_7.Element("label",bz,[_7.TextNode(bw)]),_7.Input([d.cls("form-control"),bA],by)]);};h.btnSecondary=function(bw,bx,by){return _7.Element("button",[d.eid(bw),d.cls("btn btn-secondary"),bg.Handler("click",by)],[_7.TextNode(bx)]);};h.btnPrimary=function(bw,bx,by){return _7.Element("button",[d.eid(bw),d.cls("btn btn-primary"),bg.Handler("click",by)],[_7.TextNode(bx)]);};k.New=function(bw,bx,by,bz,bA,bB,bC,bD,bE){return{tokenFragment:bw,charFragment:bx,babelSynsetID:by,DBpediaURL:bz,BabelNetURL:bA,score:bB,cohrenceScore:bC,globalScore:bD,source:bE};};l.New=function(bw,bx){return{start:bw,end:bx};};m.New=function(bw,bx){return{start:bw,end:bx};};j.disambiguate=function(bw){function bx(by,bz){var bA;bc.ajax((bA={},bA.url=(function(bB){return function(bC){return bB("https://babelfy.io/v1/disambiguate?text="+ba.toSafe(bC)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bw),bA.type="GET",bA.success=function(bB){return by(bB);},bA.error=function(bB){return bz(new a.Error(bB.responseText));},bA));}return bh.FromContinuations(function(by,bz,bA){return bx.apply(null,[by,bz,bA]);});};o.New=function(bw,bx,by,bz){return{text:bw,intents:bx,entities:by,traits:bz};};p.New=function(bw,bx,by){return{id:bw,name:bx,confidence:by};};q.New=function(bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG){return{id:bw,name:bx,role:by,start:bz,end:bA,body:bB,confidence:bC,entities:bD,suggested:bE,value:bF,type:bG};};r.New=function(bw,bx,by){return{id:bw,value:bx,confidence:by};};s.New=function(bw){return{intent:bw};};t.New=function(bw){return{value:bw};};n.getMeaning2=function(bw,bx){function by(bz,bA){var bB;bc.ajax((bB={},bB.url=(function(bC){return function(bD){return bC("https://api.wit.ai/message?q="+ba.toSafe(bD));};}(a.id))(bx),bB.type="GET",bB.beforeSend=function(bC){return bC.setRequestHeader("Authorization","Bearer "+bw);},bB.success=function(bC){return bz(bC);},bB.error=function(bC){return bA(new a.Error(bC.responseText));},bB));}return bh.FromContinuations(function(bz,bA,bB){return by.apply(null,[bz,bA,bB]);});};n.getMeaning=function(bw,bx,by,bz){var bA;bc.ajax((bA={},bA.url=(function(bB){return function(bC){return bB("https://api.wit.ai/message?q="+ba.toSafe(bC));};}(a.id))(bx),bA.type="GET",bA.beforeSend=function(bB){return bB.setRequestHeader("Authorization","Bearer "+bw);},bA.success=by,bA.error=bz,bA));};v.New=function(bw){return{question:bw};};w.New=function(bw,bx){return{isContextOnly:bw,prompts:bx};};x.New=function(bw,bx,by,bz,bA,bB,bC){return{questions:bw,answer:bx,score:by,id:bz,source:bA,metadata:bB,context:bC};};y.New=function(bw){return{answers:bw};};u.getAnswer=function(bw){function bx(by,bz){var bA;bc.ajax((bA={},bA.url="https://lerna.azurewebsites.net/qnamaker/knowledgebases/13a6a026-942b-4612-a8cb-654086ec76ee/generateAnswer",bA.type="POST",bA.beforeSend=function(bB){return bB.setRequestHeader("Authorization","EndpointKey e5a55563-b1b0-4343-8796-bda5a0509385");},bA.contentType="application/json",bA.dataType="json",bA.data=bi.stringify(v.New(bw)),bA.success=function(bB){return by(bB);},bA.error=function(bB){return bz(new a.Error(bB.responseText));},bA));}return bh.FromContinuations(function(by,bz,bA){return bx.apply(null,[by,bz,bA]);});};z.waitAddPhrases=function(){A.$cctor();return A.waitAddPhrases;};z.waitRetrievePhrases=function(){A.$cctor();return A.waitRetrievePhrases;};z.helpPhrases=function(){A.$cctor();return A.helpPhrases;};z.helloUserPhrases=function(){A.$cctor();return A.helloUserPhrases;};z.helloPhrases=function(){A.$cctor();return A.helloPhrases;};z["getRandomPhrase'"]=function(bw){return z.replace_tok("$0","",bf.nth(z.rng().Next(0,bw.get_Length()),bw));};z.getRandomPhrase=function(bw,bx){return z.replace_tok("$0",bx,bf.nth(z.rng().Next(0,bw.get_Length()),bw));};z.replace_tok=function(bw,bx,by){return bd.Replace(by,bw,bx);};z.rng=function(){A.$cctor();return A.rng;};A.$cctor=function(){A.$cctor=a.ignore;A.rng=new bj.New();A.helloPhrases=be.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);A.helloUserPhrases=be.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);A.helpPhrases=be.ofArray(["What can I help you with $0?"]);A.waitRetrievePhrases=be.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);A.waitAddPhrases=be.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};C=B.Intent=$.Class({toString:function(){return((($.Curried3(function(bw,bx,by){return bw("Intent("+ba.toSafe(bx)+", "+_2.p$2(by)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,C);D=B.Trait=$.Class({toString:function(){return((($.Curried3(function(bw,bx,by){return bw("Trait("+ba.toSafe(bx)+", "+ba.prettyPrint(by)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,D);E=B.Entity=$.Class({toString:function(){return((((($.Curried(function(bw,bx,by,bz,bA){return bw("Entity("+ba.toSafe(bx)+", "+ba.toSafe(by)+", "+ba.toSafe(bz)+", "+_2.p$2(bA)+")");},5))(a.id))(this.get_Name()))(this.get_Role()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$3;},get_Value:function(){return this.$2;},get_Role:function(){return this.$1;},get_Name:function(){return this.$0;}},null,E);F=B.Utterance=$.Class({toString:function(){return(((($.Curried(function(bw,bx,by,bz){return bw(_2.p(bx)+" "+_2.p$3(by)+" "+_2.p$5(bz));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bw;bw=this.$3;return bw!=null?{$:1,$0:be.sortBy(function(bx){return bx.get_Name();},bw.$0)}:null;},get_Traits:function(){var bw;bw=this.$2;return bw!=null?{$:1,$0:be.sortBy(function(bx){return bx.get_Name();},bw.$0)}:null;},get_Intent:function(){return this.$1;},get_Text:function(){return this.$0;}},null,F);G=B.Question=$.Class({toString:function(){return((($.Curried3(function(bw,bx,by){return bw("Name: "+ba.toSafe(bx)+" Text: "+ba.toSafe(by));}))(a.id))(this.get_Name()))(this.get_Text());},get_Type:function(){return this.$2;},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);I.New=function(bw,bx,by,bz,bA){return{body:bw,end:bx,start:by,suggested:bz,value:bA};};H["Intent'"]=function(bw,bx){return!(bx.intent==null)?{$:1,$0:new C({$:0,$0:d.toLower(bx.intent.value),$1:null})}:null;};H["Trait'"]=function(bw){return!(bw.domain==null)?{$:1,$0:new D({$:0,$0:"domain",$1:d.toLower(bw.domain.value),$2:null})}:!(bw.dialogue_act==null)?{$:1,$0:new D({$:0,$0:"dialogue_act",$1:d.toLower(bw.dialogue_act.value),$2:null})}:null;};H["Entity'$1"]=function(bw){return!(bw.contact==null)?{$:1,$0:new E({$:0,$0:"contact",$1:"",$2:d.toLower(bw.contact.value),$3:null})}:null;};K=J["Utterance'"]=$.Class({get_TopIntent:function(){return be.head(be.sortBy(function(bw){return bw.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$3;},get_Entities:function(){return this.$2;},get_Intents:function(){return this.$1;},get_Text:function(){return this.$0;}},null,K);L=J["Intent'"]=$.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,L);M=J["Entity'"]=$.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,M);N=J["Trait'"]=$.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,N);J.HasUtterance=function(bw){var bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK;return bw!=null&&bw.$==1&&(bw.$0.$1.$==0&&(bw.$0.$2.get_Length()>0&&(bx=[bw.$0.$2,bw.$0.$0,bw.$0.$3],true)))?(by=be.map(function(bL){return new E({$:0,$0:bL.get_Name(),$1:d.toLower(bL.get_Role()),$2:bL.get_Value(),$3:{$:1,$0:bL.get_Confidence()}});},be.filter(function(bL){return bL.get_Confidence()>J.entityConfidenceThreshold();},bx[0])),{$:1,$0:new F({$:0,$0:bx[1],$1:null,$2:{$:1,$0:be.map(function(bL){return new D({$:0,$0:d.toLower(bL.get_Name()),$1:bL.get_Value(),$2:{$:1,$0:bL.get_Confidence()}});},be.filter(function(bL){return bL.get_Confidence()>J.entityConfidenceThreshold();},bx[2]))},$3:{$:1,$0:by}})}):bw!=null&&bw.$==1&&(bw.$0.$2.$==0&&(bw.$0.$3.$==0&&(bw.$0.$1.get_Length()>0&&bw.$0.get_TopIntent().get_Confidence()>J.intentConfidenceThreshold()&&(bz=[bw.$0.$1,bw,bw.$0.$0],true))))?(bA=bz[1],{$:1,$0:new F({$:0,$0:bz[2],$1:{$:1,$0:new C({$:0,$0:d.toLower(bA.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bA.$0.get_TopIntent().get_Confidence()}})},$2:null,$3:null})}):bw!=null&&bw.$==1&&(bw.$0.$3.$==0&&(bw.$0.$1.get_Length()>0&&bw.$0.get_TopIntent().get_Confidence()>J.intentConfidenceThreshold()&&(bB=[bw.$0.$1,bw,bw.$0.$0],true)))?(bC=bB[1],(bD=be.map(function(bL){return new E({$:0,$0:bL.get_Name(),$1:d.toLower(bL.get_Role()),$2:bL.get_Value(),$3:{$:1,$0:bL.get_Confidence()}});},be.filter(function(bL){return bL.get_Confidence()>J.entityConfidenceThreshold();},bC.$0.get_Entities())),{$:1,$0:new F({$:0,$0:bB[2],$1:{$:1,$0:new C({$:0,$0:d.toLower(bC.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bC.$0.get_TopIntent().get_Confidence()}})},$2:null,$3:{$:1,$0:bD}})})):bw!=null&&bw.$==1&&(bw.$0.$2.$==0&&(bw.$0.$1.get_Length()>0&&bw.$0.get_TopIntent().get_Confidence()>J.intentConfidenceThreshold()&&(bE=[bw.$0.$1,bw,bw.$0.$0],true)))?(bF=bE[1],(bG=be.map(function(bL){return new D({$:0,$0:d.toLower(bL.get_Name()),$1:bL.get_Value(),$2:{$:1,$0:bL.get_Confidence()}});},be.filter(function(bL){return bL.get_Confidence()>J.entityConfidenceThreshold();},bF.$0.get_Traits())),{$:1,$0:new F({$:0,$0:bE[2],$1:{$:1,$0:new C({$:0,$0:d.toLower(bF.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bF.$0.get_TopIntent().get_Confidence()}})},$2:{$:1,$0:bG},$3:null})})):bw!=null&&bw.$==1&&(bw.$0.$1.get_Length()>0&&bw.$0.get_TopIntent().get_Confidence()>J.intentConfidenceThreshold()&&(bH=[bw.$0.$1,bw,bw.$0.$0],true))?(bI=bH[1],(bJ=be.map(function(bL){return new E({$:0,$0:bL.get_Name(),$1:d.toLower(bL.get_Role()),$2:bL.get_Value(),$3:{$:1,$0:bL.get_Confidence()}});},be.filter(function(bL){return bL.get_Confidence()>J.entityConfidenceThreshold();},bI.$0.get_Entities())),(bK=be.map(function(bL){return new D({$:0,$0:d.toLower(bL.get_Name()),$1:bL.get_Value(),$2:{$:1,$0:bL.get_Confidence()}});},be.filter(function(bL){return bL.get_Confidence()>J.entityConfidenceThreshold();},bI.$0.get_Traits())),{$:1,$0:new F({$:0,$0:bH[2],$1:{$:1,$0:new C({$:0,$0:d.toLower(bI.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bI.$0.get_TopIntent().get_Confidence()}})},$2:{$:1,$0:bK},$3:{$:1,$0:bJ}})}))):null;};J.entityConfidenceThreshold=function(){P.$cctor();return P.entityConfidenceThreshold;};J.set_entityConfidenceThreshold=function(bw){P.$cctor();P.entityConfidenceThreshold=bw;};J.intentConfidenceThreshold=function(){P.$cctor();return P.intentConfidenceThreshold;};J.set_intentConfidenceThreshold=function(bw){P.$cctor();P.intentConfidenceThreshold=bw;};J.getUtterance2=function(bw){var bx;bx=null;return bh.Delay(function(){return bh.Bind(n.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bw),function(by){d.debug("NLU",(function(bz){return function(bA){return bz("Wit.ai returned "+_1.p(bA)+" ");};}(a.id))(by));return bh.Return(new K({$:0,$0:bw,$1:be.ofArray(_9.map(function(bz){return new L({$:0,$0:bz.name,$1:bz.confidence});},by.intents)),$2:be.map(function(bz){return new M({$:0,$0:bz.name,$1:bz.confidence,$2:bz.role,$3:bz.value});},be.ofSeq(bf.concat(bf.map(function(bz){return bz[1];},bl.ToSeq(by.entities))))),$3:be.ofSeq(bf.map(function(bz){var bA;bA=bz[1];return new N({$:0,$0:bz[0],$1:_9.get(bA,0).confidence,$2:_9.get(bA,0).value});},bl.ToSeq(by.traits)))}));});});};J.getUtterance=function(bw,bx){n.getMeaning("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bw,function(by){var bz,bA;d.debug("NLU",(function(bB){return function(bC){return bB("Wit.ai returned: "+ba.prettyPrint(bC));};}(a.id))(by));bz=!(by.intents==null)?be.ofArray(_9.map(function(bB){return new L({$:0,$0:bB.name,$1:bB.confidence});},by.intents)):be.T.Empty;bA=!(by.traits==null)?be.ofSeq(bf.concat(be.map(function(bB){return _9.map(function(bC){return new N({$:0,$0:bB,$1:bC.confidence,$2:bC.value});},bn.GetJS(by.traits,[bB]));},be.filter(function(bB){return!(bn.GetJS(by.traits,[bB])==null);},J.trait_types())))):be.T.Empty;return bx({$:1,$0:new K({$:0,$0:bw,$1:bz,$2:!(by.entities==null)?be.ofSeq(bf.concat(be.map(function(bB){return _9.map(function(bC){return new M({$:0,$0:bC.name,$1:bC.confidence,$2:bC.role,$3:bC.value});},bn.GetJS(by.entities,[bB]));},be.filter(function(bB){return!(bn.GetJS(by.entities,[bB])==null);},J.entity_types())))):be.T.Empty,$3:bA})});},function(by,bz,bA){d.error(((($.Curried3(function(bB,bC,bD){return bB("Wit.ai returned: "+ba.prettyPrint(bC)+" "+ba.prettyPrint(bD));}))(a.id))(bz))(bA));return bx(null);});};J.trait_types=function(){P.$cctor();return P.trait_types;};J.entity_types=function(){P.$cctor();return P.entity_types;};J.QuickNumber=function(bw){var bx,by,bz;return(by=J.One(bw),by!=null&&by.$==1?(bx=by.$0,true):(bz=J.Two(bw),bz!=null&&bz.$==1&&(bx=bz.$0,true)))?{$:1,$0:bx}:null;};J.Three=function(bw){var bx;return bw==="3"||bw==="three"?{$:1,$0:new F({$:0,$0:"three",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:be.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"three",$3:{$:1,$0:1}})])}})}:null;};J.Two=function(bw){var bx;return bw==="2"||bw==="two"?{$:1,$0:new F({$:0,$0:"two",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:be.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"two",$3:{$:1,$0:1}})])}})}:null;};J.One=function(bw){var bx;return bw==="1"||bw==="one"?{$:1,$0:new F({$:0,$0:"one",$1:{$:1,$0:new C({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:be.ofArray([new E({$:0,$0:"wit/ordinal",$1:"",$2:"one",$3:{$:1,$0:1}})])}})}:null;};J.QuickNo=function(bw){var bx;return bw==="no"||(bw==="nope"||(bw==="no way"||(bw==="nah"||(bw==="don't do it"||bw==="stop"))))?{$:1,$0:new F({$:0,$0:"no",$1:{$:1,$0:new C({$:0,$0:"reject",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};J.QuickYes=function(bw){var bx;return bw==="yes"||(bw==="ok"||(bw==="sure"||(bw==="yeah"||(bw==="yep"||(bw==="uh huh"||(bw==="go ahead"||bw==="go"))))))?{$:1,$0:new F({$:0,$0:"yes",$1:{$:1,$0:new C({$:0,$0:"verify",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};J.QuickHelp=function(bw){var bx;return bw==="help"||(bw==="help me"||(bw==="what's this?"||bw==="huh"))?{$:1,$0:new F({$:0,$0:"help",$1:{$:1,$0:new C({$:0,$0:"help",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};J.QuickHello=function(bw){var bx;return bw==="hello"||(bw==="hey"||(bw==="yo"||bw==="hi"))?{$:1,$0:new F({$:0,$0:"hello",$1:{$:1,$0:new C({$:0,$0:"greet",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};J.Voices=function(bw){return bw==="voices"?{$:1,$0:null}:null;};J.Debug=function(bw){return bw==="debug"?{$:1,$0:null}:null;};J.Blank=function(bw){return bw===""?{$:1,$0:null}:null;};O.Study=function(bw){return bw.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};B.No=function(bw){var bx,by;return(by=B.Intent$1("reject",bw),by!=null&&by.$==1&&(by.$0[0]==null&&(by.$0[1]==null&&(bx=bw,true))))?{$:1,$0:bx}:null;};B.Yes=function(bw){var bx,by;return(by=B.Intent$1("verify",bw),by!=null&&by.$==1&&(by.$0[0]==null&&(by.$0[1]==null&&(bx=bw,true))))?{$:1,$0:bx}:null;};B.EntityManyofMany=function(bw,bx){return{$:1,$0:bl.OfArray(_9.ofSeq(be.map(function(by){return be.exists(function(bz){return bz.get_Role()===by;},bx)?[by,{$:1,$0:be.filter(function(bz){return bz.get_Role()===by;},bx)}]:[by,null];},bw)))};};B.EntityManyOf1=function(bw,bx){var by;return bx!=null&&bx.$==1&&(be.exists(function(bz){return bz.get_Role()===bw;},bx.$0)&&(by=bx.$0,true))?{$:1,$0:be.filter(function(bz){return bz.get_Role()===bw;},by)}:null;};B.Entity1OfAny=function(bw,bx){var by;return bx!=null&&bx.$==1&&(be.exists(function(bz){return bz.get_Role()===bw;},bx.$0)&&(by=bx.$0,true))?{$:1,$0:be.head(be.sortBy(function(bz){return bz.get_Role();},be.filter(function(bz){return bz.get_Role()===bw;},by)))}:null;};B.Entity1Of1=function(bw,bx){var by;return bx!=null&&bx.$==1&&(bx.$0.$==1&&(bx.$0.$1.$==0&&(bx.$0.$0.get_Role()===bw&&(by=bx.$0.$0,true))))?{$:1,$0:by}:null;};B.Intent$1=function(bw,bx){return bx.get_Intent()!=null&&bx.get_Intent().$0.get_Name()===bw?{$:1,$0:[bx.get_Traits(),bx.get_Entities()]}:null;};P.$cctor=function(){P.$cctor=a.ignore;P.entity_types=be.ofArray(["wit$contact:name","wit$datetime:datetime","term:subject","term:object","term:verb"]);P.trait_types=be.ofArray(["domain","dialogue_act"]);P.intentConfidenceThreshold=0.85;P.entityConfidenceThreshold=0.85;};R.MicReady={$:5};R.MicAudioEnd={$:4};R.MicAudioStart={$:3};R.MicDisconnected={$:2};R.MicConnecting={$:1};R.MicNotInitialized={$:0};S.ClientUnderstand={$:2};S.ClientReady={$:1};S.ClientNotInitialzed={$:0};T=Q.Interpreter=$.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,T);U=Q.CUI=$.Class({SayVoices:function(){var bw,bx,by;bw=this;bx=a.speechSynthesis.getVoices();!(bx==null)?(by=d.toArray(bx),bw.Say((function(bz){return function(bA){return bz("There are currently "+a.String(bA)+" voices installed on this computer or device.");};}(a.id))(_9.length(by))),_9.iteri(function(bz,bA){return bw.Say((((($.Curried(function(bB,bC,bD,bE){return bB("Voice "+a.String(bC)+". Name: "+ba.toSafe(bD)+", Local: "+ba.prettyPrint(bE)+".");},4))(a.id))(bz))(bA.name))(bA.localService));},by)):void 0;},Wait:function(bw){this.Wait$1(function(){bh.Start(bw,null);});},Wait$1:function(bw){this["Echo'"]("please wait...");this.Term.pause();bw();this.Term.resume();},sayRandom:function(bw,bx){this.Say(z.getRandomPhrase(bw,bx));},SayAngry:function(bw){var bx,by;bx=this;bh.Start((by=null,bh.Delay(function(){return bh.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bo.chime(),bh.Zero()):bh.Zero(),bh.Delay(function(){a.addMessage(bx.Avatar,bw,"","");bx.Avatar.processMessages(0);return bh.Zero();}));})),null);},SayDoc:function(bw){var bx,by,bz;bx=_9.get(bc(".terminal-output").get(),0).childNodes.length;by=_7.Element("div",[d.cls("terminal-command"),d.dindex(bx+1)],[bw]);bz=d.termOutput();_6.LoadLocalTemplates("");_7.RunAppend(bz,by);},Say:function(bw){var bx,by;bx=this;bh.Start((by=null,bh.Delay(function(){return bh.Combine(a.speechSynthesis.speaking?(bo.chime(),bh.Zero()):bh.Zero(),bh.Delay(function(){bx.Avatar.addMessage(bw);bx.Avatar.processMessages(0);return bh.Zero();}));})),null);},Debug:function(bw,bx){d.debug(bw,bx);},"EchoHtml'":function(bw){var bx,by;bx=(by={},by.raw=true,by);this.Term.disable();this.Term.echo(bw,bx);this.Term.enable();},"Echo'":function(bw){this.Term.disable();this.Term.echo(bw);this.Term.enable();}},null,U);U.New=function(bw,bx,by,bz,bA){return new U({Voice:bw,Mic:bx,Term:by,Avatar:bz,Caption:bA});};W=V.Dialogue=$.Class({get_Utterances:function(){return this.$4;},get_Output:function(){return this.$3;},get_DialogueQuestions:function(){return this.$2;},get_Props:function(){return this.$1;},get_Cui:function(){return this.$0;}},null,W);V["Response'_"]=function(bw,bx,by,bz){var bA,bB,bC;return(bB=V.PropNotSet_(bw,"user",bz),bB!=null&&bB.$==1&&(V.haveQuestion(bx,by)&&bw.get_DialogueQuestions().length>0&&(bw.get_DialogueQuestions())[0].get_Name()===by&&(bA=bB.$0,true)))?(V.popu(bw),V.popq(bw),V.haveProp(bw,by)?(bC=bw.get_Props().get_Item(by),(V.deleteProp(bw,by),{$:1,$0:[bA,{$:1,$0:bC}]})):{$:1,$0:[bA,null]}):null;};V.Response_=function(bw,bx,by,bz){var bA,bB,bC;return(bB=V.PropSet_(bw,"user",bz),bB!=null&&bB.$==1&&(V.haveQuestion(bx,by)&&bw.get_DialogueQuestions().length>0&&(bw.get_DialogueQuestions())[0].get_Name()===by&&(bA=bB.$0,true)))?(V.popu(bw),V.popq(bw),V.haveProp(bw,by)?(bC=bw.get_Props().get_Item(by),(V.deleteProp(bw,by),{$:1,$0:[bA,{$:1,$0:bC}]})):{$:1,$0:[bA,null]}):null;};V["User'_"]=function(bw,bx){var by,bz;return(bz=V.PropNotSet_(bw,"user",bx),bz!=null&&bz.$==1&&(bw.get_DialogueQuestions().length===0&&(by=bz.$0,true)))?(V.popu(bw),{$:1,$0:by}):null;};V.User_=function(bw,bx){var by,bz;return(bz=V.PropSet_(bw,"user",bx),bz!=null&&bz.$==1&&(bw.get_DialogueQuestions().length===0&&(by=bz.$0,true)))?(V.popu(bw),{$:1,$0:by}):null;};V.PropNotSet_=function(bw,bx,by){return!V.haveProp(bw,bx)?{$:1,$0:by}:null;};V.PropSet_=function(bw,bx,by){return V.haveProp(bw,bx)?{$:1,$0:by}:null;};V.noUnderstand=function(bw,bx,by){var bz;bx((function(bA){return function(bB){return bA(ba.toSafe(bB)+" interpreter did not understand utterance.");};}(a.id))(by));V.say(bw,"Sorry I didn't understand what you meant.");bw.get_DialogueQuestions().length>0?(bz=bf.nth(0,bw.get_DialogueQuestions()),V.haveProp(bw,bz.get_Name())?V.say(bw,z.replace_tok("$0",bw.get_Props().get_Item(bz.get_Name()),bz.get_Text())):V.say(bw,bz.get_Text())):void 0;};V.ask=function(bw,bx,by,bz){V.addProp(bw,by,bz);V.pushq(bw,bx,by);V.say(bw,z.replace_tok("$0",bz,V.getQuestion(bx,by).$0.get_Text()));};V.pushq=function(bw,bx,by){var bz;bz=V.getQuestion(bx,by);bz==null?(function(bA){return function(bB){return bA("No such question: "+ba.toSafe(bB));};}(bp.FailWith))(by):bw.get_DialogueQuestions().unshift(bz.$0);};V.popq=function(bw){bw.get_DialogueQuestions().shift();};V.popu=function(bw){bw.get_Utterances().shift();};V.pushu=function(bw,bx){bw.get_Utterances().unshift(bx);};V.haveQuestion=function(bw,bx){return be.exists(function(by){return by.get_Name()===bx;},bw);};V.getQuestion=function(bw,bx){return bf.tryFind(function(by){return by.get_Name()===bx;},bw);};V.prop=function(bw,bx){return bw.get_Props().get_Item(bx);};V.deleteProp=function(bw,bx){bw.get_Props().Remove(bx);};V.addProp=function(bw,bx,by){bw.get_Props().Add(bx,by);};V.haveProp=function(bw,bx){return bw.get_Props().ContainsKey(bx);};V["sayRandom'"]=function(bw,bx){V.sayRandom(bw,bx,"");};V.sayRandom=function(bw,bx,by){var bz;bz=z.getRandomPhrase(bx,by);bw.get_Output().unshift(bz);bw.get_Cui().Say(bz);};V.say=function(bw,bx){bw.get_Output().unshift(bx);V["say'"](bw,bx);};V["say'"]=function(bw,bx){bw.get_Cui().Say(bx);};V.echo=function(bw,bx){(bw.get_Cui())["EchoHtml'"](bx);};X.update=function(bw){var bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs;function ct(cG){V.echo(bw,cG);}function cu(cG){V.say(bw,cG);}function cv(cG,cH){return V.sayRandom(bw,cG,cH);}function cw(cG,cH){return V.addProp(bw,cG,cH);}function cx(cG){return V.prop(bw,cG);}function cy(){return cx("user");}function cz(cG,cH){return V.ask(bw,X.moduleQuestions(),cG,cH);}function cA(cG){return V.User_(bw,cG);}function cB(cG){return V["User'_"](bw,cG);}function cC(cG,cH){return V.Response_(bw,X.moduleQuestions(),cG,cH);}function cD(cG,cH){return V["Response'_"](bw,X.moduleQuestions(),cG,cH);}function cE(cG){var cH;return cG!=null&&cG.$==1&&(typeof cG.$0=="string"&&(cH=cG.$0,true))?{$:1,$0:cH}:null;}function cF(cG,cH,cI){var cJ;return bh.Start((cJ=null,bh.Delay(function(){cv(z.waitAddPhrases(),"symptom entry");return bh.Bind((new br.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:-1573255930",[cy().Name,cG,cH,cI]),function(cK){return cK==null?(cu(function(cL){return cL("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),bh.Zero()):(cu((function(cL){return function(cM){return cL("OK I added that "+ba.toSafe(cM)+" symptom to your journal.");};}(a.id))(cG)),bh.Zero());});})),null);}bx=bw.$4;by=bw.$1;bz=bw.$2;X.debug(((($.Curried3(function(cG,cH,cI){return cG("Starting utterances:"+ba.prettyPrint(cH)+". Starting questions: "+ba.prettyPrint(cI)+".");}))(a.id))(bx))(bz));bA=be.ofSeq(bf.take(bx.length>=5?5:bx.length,bx));bA.$==1&&(bC=(bD=V.PropNotSet_(bw,"started",bA.$0),bD!=null&&bD.$==1?{$:1,$0:bD.$0}:null),bC!=null&&bC.$==1&&(bE=cB(bC.$0),bE!=null&&bE.$==1&&(bF=B.Intent$1("hello",bE.$0),bF!=null&&bF.$==1&&(bF.$0[1]==null&&bA.$1.$==0))))?(by.Add("started",true),V["sayRandom'"](bw,z.helloPhrases())):bA.$==1&&(bH=cB(bA.$0),bH!=null&&bH.$==1&&(bI=B.Intent$1("hello",bH.$0),bI!=null&&bI.$==1&&(bI.$0[1]==null&&bA.$1.$==0)))?cu("Hello, tell me your name to get started."):bA.$==1&&(bK=cB(bA.$0),bK!=null&&bK.$==1&&(bL=B.Intent$1("hello",bK.$0),bL!=null&&bL.$==1&&(bM=B.Entity1Of1("contact",bL.$0[1]),bM!=null&&bM.$==1&&(bA.$1.$==0&&(bJ=bM.$0,true)))))?(bN=bJ.get_Value(),cv(z.waitRetrievePhrases(),"user name"),bh.Start((bO=null,bh.Delay(function(){return bh.Bind((new br.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-1964848755",[bN]),function(cG){var cH;return cG==null?(cu((function(cI){return function(cJ){return cI("I did not find a user with the name "+ba.toSafe(cJ)+".");};}(a.id))(bN)),cz("addUser",bN),bh.Zero()):(cH=cG.$0,bh.Bind((new br.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:-329896276",[cH.Name]),function(){by.Add("user",cH);cv(z.helloUserPhrases(),(function(cI){return function(cJ){return cI(ba.prettyPrint(cJ));};}(a.id))(by.get_Item("user")));return cH.LastLoggedIn!=null?bh.Bind((new br.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:652369854",[cH.LastLoggedIn.$0]),function(cI){cu((function(cJ){return function(cK){return cJ("You last logged in "+ba.toSafe(cK)+".");};}(a.id))(cI));return bh.Zero();}):bh.Zero();}));});})),null)):bA.$==1&&(bQ=B.Yes(bA.$0),bQ!=null&&bQ.$==1&&(bR=cD("addUser",bQ.$0),bR!=null&&bR.$==1&&(bS=cE(bR.$0[1]),bS!=null&&bS.$==1&&(bA.$1.$==0&&(bP=bS.$0,true)))))?bh.Start((bT=null,bh.Delay(function(){cv(z.waitAddPhrases(),"user");return bh.Bind((new br.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:-329896276",[bP]),function(cG){return cG==null?(cu((function(cH){return function(cI){return cH("Sorry I was not able to add the user "+ba.toSafe(cI)+" to the system.");};}(a.id))(bP)),bh.Zero()):(cw("user",bP),cu((function(cH){return function(cI){return cH("Hello "+ba.prettyPrint(cI)+", nice to meet you.");};}(a.id))(by.get_Item("user"))),bh.Zero());});})),null):bA.$==1&&(bV=B.No(bA.$0),bV!=null&&bV.$==1&&(bW=cD("addUser",bV.$0),bW!=null&&bW.$==1&&(bX=cE(bW.$0[1]),bX!=null&&bX.$==1&&(bA.$1.$==0&&(bU=bX.$0,true)))))?cu((function(cG){return function(cH){return cG("Ok I did not add the user "+ba.toSafe(cH)+". But you must login for me to help you.");};}(a.id))(bU)):bA.$==1&&(bZ=cA(bA.$0),bZ!=null&&bZ.$==1&&(b0=B.Intent$1("hello",bZ.$0),b0!=null&&b0.$==1&&(b0.$0[0]==null&&(b1=B.Entity1Of1("contact",b0.$0[1]),b1!=null&&b1.$==1&&(bA.$1.$==0&&(bY=b1.$0,true))))))?bh.Start((b2=null,bh.Delay(function(){return bh.Bind((new br.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-1964848755",[bY.get_Value()]),function(cG){return cG==null?(cu((function(cH){return function(cI){return cH("Sorry, the user "+ba.toSafe(cI)+" does not exist.");};}(a.id))(bY.get_Value())),bh.Zero()):(cz("switchUser",cG.$0.Name),bh.Zero());});})),null):bA.$==1&&(b4=B.Yes(bA.$0),b4!=null&&b4.$==1&&(b5=cC("switchUser",b4.$0),b5!=null&&b5.$==1&&(b6=cE(b5.$0[1]),b6!=null&&b6.$==1&&(bA.$1.$==0&&(b3=b6.$0,true)))))?(by.set_Item("user",b3),cu((function(cG){return function(cH){return cG("Ok I switched to user "+ba.prettyPrint(cH)+".");};}(a.id))(b3))):bA.$==1&&(b8=B.No(bA.$0),b8!=null&&b8.$==1&&(b9=cC("switchUser",b8.$0),b9!=null&&b9.$==1&&(b_=cE(b9.$0[1]),b_!=null&&b_.$==1&&(bA.$1.$==0&&(b7=b_.$0,true)))))?cu((function(cG){return function(cH){return cG("Ok I did not switch to user "+ba.toSafe(cH)+".");};}(a.id))(b7)):bA.$==1&&(ca=cB(bA.$0),ca!=null&&ca.$==1?(cb=B.Intent$1("kbquery",ca.$0),cb!=null&&cb.$==1)?bA.$1.$==0&&(b$=ca.$0,true):(cc=cA(bA.$0),cc!=null&&cc.$==1&&((cd=B.Intent$1("kbquery",cc.$0),cd!=null&&cd.$==1)&&(bA.$1.$==0&&(b$=cc.$0,true)))):(ce=cA(bA.$0),ce!=null&&ce.$==1&&((cf=B.Intent$1("kbquery",ce.$0),cf!=null&&cf.$==1)&&(bA.$1.$==0&&(b$=ce.$0,true)))))?bh.Start((cg=null,bh.Delay(function(){return bh.Bind(u.getAnswer(b$.get_Text()),function(cG){var cH;return bh.Bind((cH=_9.get(cG.answers,0).answer,(new br.New()).Async("SMApp.Web:SMApp.Web.Server.mdtohtml:1938613710",[cH])),function(cI){var cJ;return bh.Bind((cJ=_9.get(cG.answers,0).answer,(new br.New()).Async("SMApp.Web:SMApp.Web.Server.mdtotext:1938613710",[cJ])),function(cK){ct(cI);cu(cK);return bh.Zero();});});});})),null):bA.$==1&&(ci=cA(bA.$0),ci!=null&&ci.$==1&&(cj=B.Intent$1("symptom",ci.$0),cj!=null&&cj.$==1&&(ck=B.Entity1OfAny("symptom_name",cj.$0[1]),ck!=null&&ck.$==1&&(bA.$1.$==0&&(ch=ck.$0,true)))))?bh.Start((cl=null,bh.Delay(function(){cu("Ok I'll add that entry to your symptom journal");cF(ch.get_Value(),null,null);return bh.Zero();})),null):bA.$==1&&(cn=B.Yes(bA.$0),cn!=null&&cn.$==1&&((co=cC("painVideo",cn.$0),co!=null&&co.$==1)&&bA.$1.$==0))?bw.$0["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bA.$==1&&(cq=cA(bA.$0),cq!=null&&cq.$==1&&(cr=B.Intent$1("medjournal",cq.$0),cr!=null&&cr.$==1&&((cs=cr.$0[1],cs!=null&&cs.$==1)&&(bA.$1.$==0&&(cp=cr.$0[1].$0,true)))))?(cu("ok I added that entry to your medication journal."),cu("You should be careful not to take too many painkillers over a short period of time.")):V.noUnderstand(bw,function(cG){X.debug(cG);},X.name());X.debug(((($.Curried3(function(cG,cH,cI){return cG("Ending utterances: "+ba.prettyPrint(cH)+". Ending questions:"+ba.prettyPrint(cI)+".");}))(a.id))(bx))(bz));};X.haveQuestion=function(bw){return be.exists(function(bx){return bx.get_Name()===bw;},X.moduleQuestions());};X.getQuestion=function(bw){return bf.tryFind(function(bx){return bx.get_Name()===bw;},X.moduleQuestions());};X.moduleQuestions=function(){Y.$cctor();return Y.moduleQuestions;};X.debug=function(bw){d.debug(X.name(),bw);};X.name=function(){Y.$cctor();return Y.name;};Y.$cctor=function(){Y.$cctor=a.ignore;Y.name="Main";Y.moduleQuestions=be.ofArray([new G({$:0,$0:"addUser",$1:"Do you want me to add the user $0?",$2:{$:0,$0:true}}),new G({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?",$2:{$:0,$0:true}})]);};Z.run=function(){var bw,bx;bw=$.ThisFunc(function(by,bz){return((Z.Main().get_Text())(by))(bz);});bx=Z.Main().get_Options();a.$("#term").terminal(bw,bx);return _7.get_Empty();};Z.Main=function(){_0.$cctor();return _0.Main;};Z.initMic=function(bw){var bx,by;Z.set_CUI((bx={$:1,$0:new bs.Microphone(bt.getElementById("microphone"))},U.New(Z.CUI().Voice,bx,Z.CUI().Term,Z.CUI().Avatar,Z.CUI().Caption)));by=Z.CUI().Mic.$0;by.onconnecting=function(){Z.set_MicState(R.MicConnecting);return Z.debug("Mic connecting...");};by.ondisconnected=function(){Z.set_MicState(R.MicDisconnected);return Z.debug("Mic disconnected.");};by.onaudiostart=function(){Z.set_MicState(R.MicAudioStart);return Z.debug("Mic audio start...");};by.onaudioend=function(){Z.set_MicState(R.MicAudioEnd);return Z.debug("Mic audio end.");};by.onerror=function(bz){Z.set_MicState({$:6,$0:bz});return Z.debug((function(bA){return function(bB){return bA("Mic error : "+ba.toSafe(bB)+".");};}(a.id))(bz));};by.onready=function(){Z.set_MicState(R.MicReady);return Z.debug("Mic ready.");};by.onresult=function(bz,bA){return Z.ClientState().$==2?Z.echo("I'm still trying to understand what you said before."):Z.ClientState().$==0?d.error("Client is not intialized."):!(bz==null||bA==null)?(Z.set_MicState({$:7,$0:bz,$1:bA}),Z.debug(((($.Curried3(function(bB,bC,bD){return bB("Mic result: "+ba.prettyPrint(bC)+" "+ba.prettyPrint(bD)+".");}))(a.id))(bz))(bA)),bw(bz,bA)):Z.debug("Mic: No result returned.");};by.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};Z.sayRandom=function(bw,bx){Z.say(z.getRandomPhrase(bx,bw));};Z.say=function(bw){Z.Output().unshift(bw);Z["say'"](bw);};Z["say'"]=function(bw){Z.CUI().Say(bw);};Z.initSpeech=function(){var bw;bw=d.toArray(Z.synth().getVoices());_9.length(bw)>0?(_9.iter(function(bx){if(bu.Equals(Z.CUI().Voice,null)&&(bx.name.indexOf("Microsoft Zira")!=-1||bx.name.toLowerCase().indexOf("female")!=-1)){Z.set_CUI(U.New({$:1,$0:bx},Z.CUI().Mic,Z.CUI().Term,Z.CUI().Avatar,Z.CUI().Caption));Z.debug((function(by){return function(bz){return by("Using browser speech synthesis voice "+ba.toSafe(bz)+".");};}(a.id))(Z.CUI().Voice.$0.name));}},bw),!bu.Equals(Z.CUI().Voice,null)?(Z.CUI().Avatar.nativeVoice=true,Z.CUI().Avatar.nativeVoiceName=Z.CUI().Voice.$0.name,Z.debug((function(bx){return function(by){return bx("Using browser speech synthesis voice "+ba.toSafe(by)+".");};}(a.id))(Z.CUI().Voice.$0.name))):void 0):void 0;bu.Equals(Z.CUI().Voice,null)?Z.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};Z.synth=function(){_0.$cctor();return _0.synth;};Z.push=function(bw){Z.Utterances().unshift(bw);return Z.Dialogue();};Z.Dialogue=function(){_0.$cctor();return _0.Dialogue;};Z.Utterances=function(){_0.$cctor();return _0.Utterances;};Z.Questions=function(){_0.$cctor();return _0.Questions;};Z.Output=function(){_0.$cctor();return _0.Output;};Z.Props=function(){_0.$cctor();return _0.Props;};Z.wait=function(bw){d["Terminal.Echo'"](Z.CUI().Term,"please wait");Z.CUI().Term.pause();bw();Z.CUI().Term.resume();};Z.debug=function(bw){d.debug("CLIENT",bw);};Z.echo=function(bw){d["Terminal.EchoHtml'"](Z.CUI().Term,(function(bx){return function(by){return bx(ba.prettyPrint(by));};}(a.id))(bw));};Z.ClientState=function(){_0.$cctor();return _0.ClientState;};Z.set_ClientState=function(bw){_0.$cctor();_0.ClientState=bw;};Z.MicState=function(){_0.$cctor();return _0.MicState;};Z.set_MicState=function(bw){_0.$cctor();_0.MicState=bw;};Z.CUI=function(){_0.$cctor();return _0.CUI;};Z.set_CUI=function(bw){_0.$cctor();_0.CUI=bw;};_0.$cctor=function(){var bw,bx,by;_0.$cctor=a.ignore;function bz(bB,bC){var bD,bE,bF,bG,bH,bI,bJ;Z.debug(((($.Curried3(function(bK,bL,bM){return bK("Voice: "+ba.prettyPrint(bL)+" "+ba.prettyPrint(bM));}))(a.id))(bB))(bC));bD=(bE=H["Intent'"](bB,bC),bE!=null&&bE.$==1?{$:1,$0:bE.$0}:null);bF=(bG=H["Trait'"](bC),bG!=null&&bG.$==1?{$:1,$0:be.ofArray([bG.$0])}:null);bH=(bI=H["Entity'$1"](bC),bI!=null&&bI.$==1?{$:1,$0:be.ofArray([bI.$0])}:null);bD==null&&(bF==null&&bH==null)?void 0:(Z.debug((((($.Curried(function(bK,bL,bM,bN){return bK("Voice: "+_2.p(bL)+" "+_2.p$3(bM)+" "+_2.p$5(bN));},4))(a.id))(bD))(bF))(bH)),X.update(Z.push(new F({$:0,$0:"",$1:bD,$2:bF,$3:bH}))));}function bA(bB,bC){var bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM;Z.set_CUI(U.New(Z.CUI().Voice,Z.CUI().Mic,bB,Z.CUI().Avatar,Z.CUI().Caption));bu.Equals(Z.CUI().Mic,null)?Z.initMic(bz):void 0;bu.Equals(Z.CUI().Voice,null)?Z.initSpeech():void 0;Z.ClientState().$===0?Z.set_ClientState(S.ClientReady):void 0;return(bD=J.Blank(bC),bD!=null&&bD.$==1)?Z["say'"]("Tell me what you want me to do or ask me a question."):(bE=J.Debug(bC),bE!=null&&bE.$==1)?(Z.debug((function(bN){return function(bO){return bN("Utterances: "+ba.prettyPrint(bO));};}(a.id))(Z.Utterances())),Z.debug((function(bN){return function(bO){return bN("Questions: "+ba.prettyPrint(bO));};}(a.id))(Z.Questions()))):(bF=J.Voices(bC),bF!=null&&bF.$==1)?(bG=d.toArray(d.speechSynthesis().getVoices()),(Z["say'"]((function(bN){return function(bO){return bN("There are currently "+a.String(bO)+" voices installed on this computer or device.");};}(a.id))(_9.length(bG))),_9.iteri(function(bN,bO){return Z["say'"]((((($.Curried(function(bP,bQ,bR,bS){return bP("Voice "+a.String(bQ)+". Name: "+ba.toSafe(bR)+", Local: "+ba.prettyPrint(bS)+".");},4))(a.id))(bN))(bO.name))(bO.localService));},bG))):Z.ClientState().$==1?(bI=J.QuickHello(bC),bI!=null&&bI.$==1?(bH=bI.$0,true):(bJ=J.QuickHelp(bC),bJ!=null&&bJ.$==1?(bH=bJ.$0,true):(bK=J.QuickYes(bC),bK!=null&&bK.$==1?(bH=bK.$0,true):(bL=J.QuickNo(bC),bL!=null&&bL.$==1&&(bH=bL.$0,true)))))?(Z.debug((function(bN){return function(bO){return bN("Quick Text: "+_2.p$7(bO)+".");};}(a.id))(bH)),X.update(Z.push(bH)),Z.set_ClientState(S.ClientReady)):Z.CUI().Wait((bM=null,bh.Delay(function(){Z.set_ClientState(S.ClientUnderstand);J.getUtterance(bC,function(bN){var bO,bP;bO=J.HasUtterance(bN);bO!=null&&bO.$==1?(bP=bO.$0,Z.debug((((($.Curried(function(bQ,bR,bS,bT){return bQ("Text: Intent: "+_2.p(bR)+", Traits: "+_2.p$3(bS)+", Entities: "+_2.p$5(bT));},4))(a.id))(bP.get_Intent()))(bP.get_Traits()))(bP.get_Entities())),X.update(Z.push(bP))):(Z.debug("Text: Did not receive a meaning from the server."),Z["say'"]("Sorry I did not understand what you said."));});Z.set_ClientState(S.ClientReady);return bh.Zero();}))):Z.ClientState().$==0?d.error("Client is not initialized."):Z["say'"]("I'm still trying to understand what you said before.");}_0.CUI=U.New(null,null,null,(bo.applicationId="4277115329081938617",bw=new a.SDKConnection(),bx=new a.WebAvatar(),bx.version=8.5,bx.connection=bw,bx.avatar="20926186",bx.voice="cmu-slt",bx.voiceMod="default",bx.width=175,bx.createBox(),bx.addMessage(""),bx.processMessages(0),bx),false);_0.MicState=R.MicNotInitialized;_0.ClientState=S.ClientNotInitialzed;_0.Props=new bv.New$5();_0.Output=[];_0.Questions=[];_0.Utterances=[];_0.Dialogue=new W({$:0,$0:Z.CUI(),$1:Z.Props(),$2:Z.Questions(),$3:Z.Output(),$4:Z.Utterances()});_0.synth=a.speechSynthesis;_0.Main=new T({$:0,$0:function(bB){return bz(bB[0],bB[1]);},$1:[function(bB){return function(bC){return bA(bB,bC);};},(by={},by.name="Main",by.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",by.prompt=">",by)]});};_1.p=function(bw){return"{"+("text = "+ba.prettyPrint(bw.text))+"; "+("intents = "+ba.printArray(function(bx){return _1.p$1(bx);},bw.intents))+"; "+("entities = "+ba.prettyPrint(bw.entities))+"; "+("traits = "+ba.prettyPrint(bw.traits))+"}";};_1.p$1=function(bw){return"{"+("id = "+ba.prettyPrint(bw.id))+"; "+("name = "+ba.prettyPrint(bw.name))+"; "+("confidence = "+ba.prettyPrint(bw.confidence))+"}";};_2.p$2=function(bw){return bw==null?"null":"Some "+ba.prettyPrint(bw.$0);};_2.p$1=function(bw){return"Intent ("+ba.prettyPrint(bw.$0)+", "+_2.p$2(bw.$1)+")";};_2.p=function(bw){return bw==null?"null":"Some "+_2.p$1(bw.$0);};_2.p$4=function(bw){return"Trait ("+ba.prettyPrint(bw.$0)+", "+ba.prettyPrint(bw.$1)+", "+_2.p$2(bw.$2)+")";};_2.p$3=function(bw){return bw==null?"null":"Some "+ba.printList(function(bx){return _2.p$4(bx);},bw.$0);};_2.p$6=function(bw){return"Entity ("+ba.prettyPrint(bw.$0)+", "+ba.prettyPrint(bw.$1)+", "+ba.prettyPrint(bw.$2)+", "+_2.p$2(bw.$3)+")";};_2.p$5=function(bw){return bw==null?"null":"Some "+ba.printList(function(bx){return _2.p$6(bx);},bw.$0);};_2.p$7=function(bw){return"Utterance ("+ba.prettyPrint(bw.$0)+", "+_2.p(bw.$1)+", "+_2.p$3(bw.$2)+", "+_2.p$5(bw.$3)+")";};}());
