(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=b.Bootstrap=b.Bootstrap||{};i=h.Controls=h.Controls||{};j=a.StartupCode$SMApp_Web$Bootstrap=a.StartupCode$SMApp_Web$Bootstrap||{};k=c.NLU=c.NLU||{};l=k.Intent=k.Intent||{};m=k.Trait=k.Trait||{};n=k.Entity=k.Entity||{};o=k.Meaning=k.Meaning||{};p=k.Voice=k.Voice||{};q=p["Entity'"]=p["Entity'"]||{};r=k.Text=k.Text||{};s=r["Meaning'"]=r["Meaning'"]||{};t=r["Intent'"]=r["Intent'"]||{};u=r["Entity'"]=r["Entity'"]||{};v=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};w=c.CUI=c.CUI||{};x=w.User=w.User||{};y=w.Interpreter=w.Interpreter||{};z=w.CUI=w.CUI||{};A=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};B=c.Main=c.Main||{};C=c.Client=c.Client||{};D=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};E=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};F=a.WebSharper;G=F&&F.Strings;H=F&&F.Arrays;I=a.jQuery;J=F&&F.Utils;K=a.console;L=a.IntelliFactory;M=L&&L.Runtime;N=F&&F.List;O=F&&F.Seq;P=F&&F.UI;Q=P&&P.Doc;R=P&&P.AttrModule;S=F&&F.Concurrency;T=F&&F.Random;U=F&&F.Remoting;V=U&&U.AjaxRemotingProvider;W=a.Wit;X=a.document;Y=F&&F.Unchecked;Z=F&&F.Collections;_0=Z&&Z.Dictionary;d.replace_tok=function(_1,_2,_3){return G.Replace(_3,_1,_2);};d.toLower=function(_1){return _1.toLowerCase();};d.toArray=function(_1){return H.map(a.id,I.makeArray(_1));};d.debug=function(_1){var _2;d.info((function(_3){return function(_4){return _3("DEBUG: "+J.toSafe(_4));};}(a.id))((_2=_1,a.String(_2))));};d.error=function(_1){K.error(_1);};d.info=function(_1){K.info(_1);};d.jserror=function(_1){I.error(_1);};d["Terminal.EchoHtml'"]=function(_1,_2){_1.disable();_1.echo(_2,d.rawOpt());_1.enable();};d["Terminal.Echo'"]=function(_1,_2){_1.disable();_1.echo(_2);_1.enable();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=M.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(_1){function _2(_3){return function(_4){var _5,_6,_7,_8,_9,_,$;_6=G.replicate(_3," ");switch(_4.$==0?_4.$1.$==1?_4.$1.$0.$==2?_4.$1.$1.$==0?(_5=[_4.$1.$0.$0,_4.$0],1):(_5=[_4.$1,_4.$0],2):(_5=[_4.$1,_4.$0],2):(_5=[_4.$1,_4.$0],2):_4.$==2?(_5=_4.$0,3):(_5=[_4.$0,_4.$1],0)){case 0:return _5[0]+"=\""+_5[1]+"\"";case 1:_7=_5[1];return _6+"<"+_7+">"+_5[0]+"</"+_7+">\r\n";case 2:_8=_5[1];_9=N.partition(function(ba){return ba.$==1;},_5[0]);_=_9[1];$=_9[0];return _.$==0?_6+"<"+_8+($.$===0?"":" "+G.concat(" ",N.ofSeq(O.delay(function(){return O.map(function(ba){return(_2(0))(ba);},$);}))))+"/>\r\n":_6+"<"+_8+($.$===0?"":" "+G.concat(" ",N.ofSeq(O.delay(function(){return O.map(function(ba){return(_2(0))(ba);},$);}))))+">\r\n"+G.concat("",N.ofSeq(O.delay(function(){return O.map(function(ba){return(_2(_3+1))(ba);},_);})))+_6+"</"+_8+">\r\n";case 3:return _6+_5+"\r\n";}};}return(_2(0))(_1);};f.alt=function(_1){return new e({$:1,$0:"alt",$1:_1});};f.src=function(_1){return new e({$:1,$0:"src",$1:_1});};f.cls=function(_1){return new e({$:1,$0:"class",$1:_1});};f.str=function(_1){return e.toString(_1);};f.op_PercentEquals=function(_1,_2){return new e({$:1,$0:_1,$1:_2});};f.op_Splice=function(_1){var _2;return N.ofArray([new e({$:2,$0:(_2=_1,a.String(_2))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(_1,_2){return new e({$:0,$0:_1,$1:_2});};g.$cctor=function(){var _1;g.$cctor=a.ignore;g.rawOpt=(_1={},_1.raw=true,_1);g.html=function(_2){return f.elem("html",_2);};g.head=function(_2){return f.elem("head",_2);};g.title=function(_2){return f.elem("title",_2);};g.style=function(_2){return f.elem("style",_2);};g.body=function(_2){return f.elem("body",_2);};g.div=function(_2){return f.elem("div",_2);};g.br=function(_2){return f.elem("br",_2);};g.section=function(_2){return f.elem("section",_2);};g.span=function(_2){return f.elem("span",_2);};g.table=function(_2){return f.elem("table",_2);};g.thead=function(_2){return f.elem("thead",_2);};g.tbody=function(_2){return f.elem("tbody",_2);};g.tfoot=function(_2){return f.elem("tfoot",_2);};g.img=function(_2){return f.elem("img",_2);};g.map=function(_2){return f.elem("map",_2);};g.area=function(_2){return f.elem("area",_2);};g.p=function(_2){return f.elem("p",_2);};g.a=function(_2){return f.elem("a",_2);};g.tr=function(_2){return f.elem("tr",_2);};g.td=function(_2){return f.elem("td",_2);};g.th=function(_2){return f.elem("th",_2);};g.ul=function(_2){return f.elem("ul",_2);};g.li=function(_2){return f.elem("li",_2);};g.h1=function(_2){return f.elem("h1",_2);};g.h2=function(_2){return f.elem("h1",_2);};g.h3=function(_2){return f.elem("h1",_2);};g.h4=function(_2){return f.elem("h1",_2);};g.strong=function(_2){return f.elem("strong",_2);};};i.Radio=function(_1,_2,_3,_4,_5){return Q.Element("div",new N.T({$:1,$0:(i.cls())("radio"),$1:_2}),[Q.Element("label",_4,[Q.Radio(_5,true,_3),Q.TextNode(_1)])]);};i.Checkbox=function(_1,_2,_3,_4,_5){return Q.Element("div",new N.T({$:1,$0:(i.cls())("checkbox"),$1:_2}),[Q.Element("label",_4,[Q.CheckBox(_5,_3),Q.TextNode(_1)])]);};i.TextArea=function(_1,_2,_3,_4,_5){return Q.Element("div",new N.T({$:1,$0:(i.cls())("form-group"),$1:_2}),[Q.Element("label",_4,[Q.TextNode(_1)]),Q.InputArea(new N.T({$:1,$0:(i.cls())("form-control"),$1:_5}),_3)]);};i.InputPassword=function(_1,_2,_3,_4,_5){return Q.Element("div",new N.T({$:1,$0:(i.cls())("form-group"),$1:_2}),[Q.Element("label",_4,[Q.TextNode(_1)]),Q.PasswordBox(new N.T({$:1,$0:(i.cls())("form-control"),$1:_5}),_3)]);};i.Input=function(_1,_2,_3,_4,_5){return Q.Element("div",new N.T({$:1,$0:(i.cls())("form-group"),$1:_2}),[Q.Element("label",_4,[Q.TextNode(_1)]),Q.Input(new N.T({$:1,$0:(i.cls())("form-control"),$1:_5}),_3)]);};i.Container=function(_1){return Q.Element("div",[(i.cls())("container")],_1);};i.Class=function(){j.$cctor();return j.Class;};i.cls=function(){j.$cctor();return j.cls;};j.$cctor=function(){j.$cctor=a.ignore;j.cls=R.Class;j.Class=R.Class;};l=k.Intent=M.Class({toString:function(){return(((M.Curried3(function(_1,_2,_3){return _1("Intent("+J.toSafe(_2)+", "+E.p$2(_3)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,l);m=k.Trait=M.Class({toString:function(){return(((M.Curried3(function(_1,_2,_3){return _1("Trait("+J.toSafe(_2)+", "+J.prettyPrint(_3)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,m);n=k.Entity=M.Class({toString:function(){return((((M.Curried(function(_1,_2,_3,_4){return _1("Entity("+J.toSafe(_2)+", "+J.toSafe(_3)+", "+E.p$2(_4)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return(this.get_Unwrap())[2];},get_Value:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,n);o=k.Meaning=M.Class({toString:function(){return((((M.Curried(function(_1,_2,_3,_4){return _1(E.p(_2)+" "+E.p$3(_3)+". "+E.p$5(_4));},4))(a.id))(this.get_Intent()))(this.get_Trait()))(this.get_Entities());},get_Entities:function(){return(this.Unwrap())[2];},get_Trait:function(){return(this.Unwrap())[1];},get_Intent:function(){return(this.Unwrap())[0];},Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,o);q.New=function(_1,_2,_3,_4,_5){return{body:_1,end:_2,start:_3,suggested:_4,value:_5};};p["Intent'"]=function(_1,_2){return!(_2.intent==null)?{$:1,$0:new l({$:0,$0:d.toLower(_2.intent.value),$1:null})}:null;};p["Trait'"]=function(_1){return!(_1.greetings==null)?{$:1,$0:new m({$:0,$0:"greetings",$1:d.toLower(_1.contact.value)})}:null;};p["Entity'$1"]=function(_1){return!(_1.contact==null)?{$:1,$0:new n({$:0,$0:"contact",$1:d.toLower(_1.contact.value),$2:null})}:null;};s=r["Meaning'"]=M.Class({get_TopIntent:function(){return N.head(N.sortBy(function(_1){return _1.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,s);t=r["Intent'"]=M.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,t);u=r["Entity'"]=M.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,u);r.HasMeaning=function(_1){var _2,_3,_4,_5,_6,_7;return _1!=null&&_1.$==1&&(_1.$0.$0.$==0&&(_1.$0.$1.get_Length()>0&&(_2=_1.$0.$1,true)))?{$:1,$0:new o({$:0,$0:null,$1:null,$2:{$:1,$0:N.map(function(_8){return new n({$:0,$0:d.toLower(_8.get_Role()),$1:_8.get_Value(),$2:{$:1,$0:_8.get_Confidence()}});},N.filter(function(_8){return _8.get_Confidence()>r.entityConfidenceThreshold();},_2))}})}:_1!=null&&_1.$==1&&(_1.$0.$1.$==0&&(_1.$0.get_TopIntent().get_Confidence()>r.intentConfidenceThreshold()&&(_3=[_1.$0.$0,_1],true)))?(_4=_3[1],{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(_4.$0.get_TopIntent().get_Name()),$1:{$:1,$0:_4.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):_1!=null&&_1.$==1&&(_1.$0.get_TopIntent().get_Confidence()>r.intentConfidenceThreshold()&&(_5=[_1.$0.$1,_1.$0.$0,_1],true))?(_6=_5[2],(_7=N.map(function(_8){return new n({$:0,$0:d.toLower(_8.get_Role()),$1:_8.get_Value(),$2:{$:1,$0:_8.get_Confidence()}});},N.filter(function(_8){return _8.get_Confidence()>r.entityConfidenceThreshold();},_6.$0.get_Entities())),{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:d.toLower(_6.$0.get_TopIntent().get_Name()),$1:{$:1,$0:_6.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:_7}})})):null;};r.entityConfidenceThreshold=function(){v.$cctor();return v.entityConfidenceThreshold;};r.set_entityConfidenceThreshold=function(_1){v.$cctor();v.entityConfidenceThreshold=_1;};r.intentConfidenceThreshold=function(){v.$cctor();return v.intentConfidenceThreshold;};r.set_intentConfidenceThreshold=function(_1){v.$cctor();v.intentConfidenceThreshold=_1;};r.QuickPrograms=function(_1){return _1==="programs"?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};r.QuickHelp=function(_1){var _2;return _1==="help"||(_1==="help me"||(_1==="what's this?"||_1==="huh"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"help",$1:null})},$1:null,$2:null})}:null;};r.QuickHello=function(_1){var _2;return _1==="hello"||(_1==="hey"||(_1==="yo"||_1==="hi"))?{$:1,$0:new o({$:0,$0:{$:1,$0:new l({$:0,$0:"hello",$1:null})},$1:null,$2:null})}:null;};r.DebugOff=function(_1){return _1==="debug off"?{$:1,$0:null}:null;};r.DebugOn=function(_1){return _1==="debug on"?{$:1,$0:null}:null;};r.Blank=function(_1){return _1===""?{$:1,$0:null}:null;};v.$cctor=function(){v.$cctor=a.ignore;v.intentConfidenceThreshold=0.85;v.entityConfidenceThreshold=0.85;};x.New=function(_1){return{Name:_1};};y=w.Interpreter=M.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,y);z=w.CUI=M.Class({get_StopSpeaking:function(){if(a.speechSynthesis.speaking||a.speechSynthesis.pending)a.speechSynthesis.cancel();},SayVoices:function(){var _1,_2,_3;_1=this;_2=a.speechSynthesis.getVoices();!(_2==null)?(_3=d.toArray(_2),_1.Say((function(_4){return function(_5){return _4("There are currently "+a.String(_5)+" voices installed on this computer or device.");};}(a.id))(H.length(_3))),H.iteri(function(_4,_5){return _1.Say(((((M.Curried(function(_6,_7,_8,_9){return _6("Voice "+a.String(_7)+". Name: "+J.toSafe(_8)+", Local: "+J.prettyPrint(_9)+".");},4))(a.id))(_4))(_5.name))(_5.localService));},_3)):void 0;},Wait:function(_1){this.Wait$1(function(){S.Start(_1,null);});},Wait$1:function(_1){this["Echo'"]("please wait...");this.Term.pause();_1();this.Term.resume();},sayRandom:function(_1,_2){this.Say(w.getRandomPhrase(_1,_2));},Say:function(_1){var _2,_3,_4;_2=this.Voice;_2!=null&&_2.$==1?(_3=_2.$0,S.Start((_4=null,S.Delay(function(){var _5;_5=new a.SpeechSynthesisUtterance(_1);_5.voice=_3;a.speechSynthesis.speak(_5);return S.Zero();})),null),this.Caption?this["Echo'"](_1):void 0):this["Echo'"](_1);},Debug:function(_1){d.debug(_1);this.DebugMode?this["EchoHtml'"](_1):void 0;},"EchoHtml'":function(_1){var _2,_3;_2=(_3={},_3.raw=true,_3);this.Term.disable();this.Term.echo(_1,_2);this.Term.enable();},"Echo'":function(_1){this.Term.disable();this.Term.echo(_1);this.Term.enable();}},null,z);z.New=function(_1,_2,_3,_4,_5){return new z({Voice:_1,Mic:_2,Term:_3,DebugMode:_4,Caption:_5});};w.helloUserPhrases=function(){A.$cctor();return A.helloUserPhrases;};w.helloPhrases=function(){A.$cctor();return A.helloPhrases;};w.waitRetrievePhrases=function(){A.$cctor();return A.waitRetrievePhrases;};w.getRandomPhrase=function(_1,_2){return d.replace_tok("$0",_2,O.nth(w.rng().Next(0,_1.get_Length()),_1));};w.rng=function(){A.$cctor();return A.rng;};A.$cctor=function(){A.$cctor=a.ignore;A.rng=new T.New();A.waitRetrievePhrases=N.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);A.helloPhrases=N.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?"]);A.helloUserPhrases=N.ofArray(["Hi $0, welcome back.","Welcome $0, nice to see you again..","Hello $0","Good to see you $0."]);};B.update=function(_1,_2,_3,_4){var _5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bP,bQ,bR,bS;function bM(bT,bU){return!_2.ContainsKey(bT)?{$:1,$0:bU}:null;}function bN(bT){var bU;_3.unshift((bU=bT,a.String(bU)));_1.Say(bT);}function bO(bT,bU){_1.sayRandom(bT,bU);return _3.unshift(a.String(void 0));}bP=_4.length>=5?5:_4.length;B.debug((function(bT){return function(bU){return bT("Current context: "+J.prettyPrint(bU)+".");};}(a.id))(_4));bQ=N.ofSeq(O.take(bP,_4));if(_6=bM("user",bQ),_6!=null&&_6.$==1&&(_6.$0.$==1&&((_7=B.Intent("hello",_6.$0.$0.$0),_7!=null&&_7.$==1)&&(_6.$0.$0.$1==null&&(_6.$0.$0.$2==null&&_6.$0.$1.$==0)))))bN(function(bT){return bT("Hello. My name is Selma. What's yours?");}(a.id));else if(_9=bM("user",bQ),_9!=null&&_9.$==1?_9.$0.$==1?(_=B.Intent("hello",_9.$0.$0.$0),_!=null&&_.$==1)?_9.$0.$0.$1==null?($=_9.$0.$0.$2,$!=null&&$.$==1)?_9.$0.$0.$2.$0.$==1?(ba=B.Entity("contact",_9.$0.$0.$2.$0.$0),ba!=null&&ba.$==1?_9.$0.$0.$2.$0.$1.$==0?_9.$0.$1.$==0?(_8=ba.$0,true):(bb=bM("user",bQ),bb!=null&&bb.$==1&&(bb.$0.$==1&&((bc=bb.$0.$0.$2,bc!=null&&bc.$==1)&&(bb.$0.$0.$2.$0.$==1&&(bd=B.Entity("contact",bb.$0.$0.$2.$0.$0),bd!=null&&bd.$==1&&(bb.$0.$0.$2.$0.$1.$==0&&(bb.$0.$1.$==1&&((be=B.Intent("hello",bb.$0.$1.$0.$0),be!=null&&be.$==1)&&(bb.$0.$1.$0.$1==null&&(bb.$0.$1.$0.$2==null&&(bb.$0.$1.$1.$==0&&(_8=bd.$0,true)))))))))))):(bf=bM("user",bQ),bf!=null&&bf.$==1&&(bf.$0.$==1&&((bg=bf.$0.$0.$2,bg!=null&&bg.$==1)&&(bf.$0.$0.$2.$0.$==1&&(bh=B.Entity("contact",bf.$0.$0.$2.$0.$0),bh!=null&&bh.$==1&&(bf.$0.$0.$2.$0.$1.$==0&&(bf.$0.$1.$==1&&((bi=B.Intent("hello",bf.$0.$1.$0.$0),bi!=null&&bi.$==1)&&(bf.$0.$1.$0.$1==null&&(bf.$0.$1.$0.$2==null&&(bf.$0.$1.$1.$==0&&(_8=bh.$0,true)))))))))))):(bj=bM("user",bQ),bj!=null&&bj.$==1&&(bj.$0.$==1&&((bk=bj.$0.$0.$2,bk!=null&&bk.$==1)&&(bj.$0.$0.$2.$0.$==1&&(bl=B.Entity("contact",bj.$0.$0.$2.$0.$0),bl!=null&&bl.$==1&&(bj.$0.$0.$2.$0.$1.$==0&&(bj.$0.$1.$==1&&((bm=B.Intent("hello",bj.$0.$1.$0.$0),bm!=null&&bm.$==1)&&(bj.$0.$1.$0.$1==null&&(bj.$0.$1.$0.$2==null&&(bj.$0.$1.$1.$==0&&(_8=bl.$0,true))))))))))))):(bn=bM("user",bQ),bn!=null&&bn.$==1&&(bn.$0.$==1&&((bo=bn.$0.$0.$2,bo!=null&&bo.$==1)&&(bn.$0.$0.$2.$0.$==1&&(bp=B.Entity("contact",bn.$0.$0.$2.$0.$0),bp!=null&&bp.$==1&&(bn.$0.$0.$2.$0.$1.$==0&&(bn.$0.$1.$==1&&((bq=B.Intent("hello",bn.$0.$1.$0.$0),bq!=null&&bq.$==1)&&(bn.$0.$1.$0.$1==null&&(bn.$0.$1.$0.$2==null&&(bn.$0.$1.$1.$==0&&(_8=bp.$0,true)))))))))))):(br=bM("user",bQ),br!=null&&br.$==1&&(br.$0.$==1&&((bs=br.$0.$0.$2,bs!=null&&bs.$==1)&&(br.$0.$0.$2.$0.$==1&&(bt=B.Entity("contact",br.$0.$0.$2.$0.$0),bt!=null&&bt.$==1&&(br.$0.$0.$2.$0.$1.$==0&&(br.$0.$1.$==1&&((bu=B.Intent("hello",br.$0.$1.$0.$0),bu!=null&&bu.$==1)&&(br.$0.$1.$0.$1==null&&(br.$0.$1.$0.$2==null&&(br.$0.$1.$1.$==0&&(_8=bt.$0,true)))))))))))):(bv=bM("user",bQ),bv!=null&&bv.$==1&&(bv.$0.$==1&&((bw=bv.$0.$0.$2,bw!=null&&bw.$==1)&&(bv.$0.$0.$2.$0.$==1&&(bx=B.Entity("contact",bv.$0.$0.$2.$0.$0),bx!=null&&bx.$==1&&(bv.$0.$0.$2.$0.$1.$==0&&(bv.$0.$1.$==1&&((by=B.Intent("hello",bv.$0.$1.$0.$0),by!=null&&by.$==1)&&(bv.$0.$1.$0.$1==null&&(bv.$0.$1.$0.$2==null&&(bv.$0.$1.$1.$==0&&(_8=bx.$0,true)))))))))))):(bz=bM("user",bQ),bz!=null&&bz.$==1&&(bz.$0.$==1&&((bA=bz.$0.$0.$2,bA!=null&&bA.$==1)&&(bz.$0.$0.$2.$0.$==1&&(bB=B.Entity("contact",bz.$0.$0.$2.$0.$0),bB!=null&&bB.$==1&&(bz.$0.$0.$2.$0.$1.$==0&&(bz.$0.$1.$==1&&((bC=B.Intent("hello",bz.$0.$1.$0.$0),bC!=null&&bC.$==1)&&(bz.$0.$1.$0.$1==null&&(bz.$0.$1.$0.$2==null&&(bz.$0.$1.$1.$==0&&(_8=bB.$0,true)))))))))))):(bD=bM("user",bQ),bD!=null&&bD.$==1&&(bD.$0.$==1&&((bE=bD.$0.$0.$2,bE!=null&&bE.$==1)&&(bD.$0.$0.$2.$0.$==1&&(bF=B.Entity("contact",bD.$0.$0.$2.$0.$0),bF!=null&&bF.$==1&&(bD.$0.$0.$2.$0.$1.$==0&&(bD.$0.$1.$==1&&((bG=B.Intent("hello",bD.$0.$1.$0.$0),bG!=null&&bG.$==1)&&(bD.$0.$1.$0.$1==null&&(bD.$0.$1.$0.$2==null&&(bD.$0.$1.$1.$==0&&(_8=bF.$0,true)))))))))))):(bH=bM("user",bQ),bH!=null&&bH.$==1&&(bH.$0.$==1&&((bI=bH.$0.$0.$2,bI!=null&&bI.$==1)&&(bH.$0.$0.$2.$0.$==1&&(bJ=B.Entity("contact",bH.$0.$0.$2.$0.$0),bJ!=null&&bJ.$==1&&(bH.$0.$0.$2.$0.$1.$==0&&(bH.$0.$1.$==1&&((bK=B.Intent("hello",bH.$0.$1.$0.$0),bK!=null&&bK.$==1)&&(bH.$0.$1.$0.$1==null&&(bH.$0.$1.$0.$2==null&&(bH.$0.$1.$1.$==0&&(_8=bJ.$0,true))))))))))))){for(bR=1,bS=2;bR<=bS;bR++)_4.shift();S.Start((bL=null,S.Delay(function(){bO(w.waitRetrievePhrases(),"user name");return S.Bind((new V.New()).Async("SMApp.Web:SMApp.Web.Server.GetUser2:872615755",[_8]),function(bT){var bU;return bT==null?(bN("Sorry I did not find that user."),S.Zero()):(bU=bT.$0,(_2.Add("user",bU),bN((function(bV){return function(bW){return bV("Hello "+J.toSafe(bW));};}(a.id))(bU.Name)),S.Zero()));});})),null);}else{_4.shift();bN("Sorry I didn't understand what you mean.t");}};B.Entity=function(_1,_2){return _2.get_Name()===_1?{$:1,$0:_2.get_Value()}:null;};B.Intent=function(_1,_2){var _3;return _2!=null&&_2.$==1&&(_2.$0.$0===_1&&(_3=_2.$0.$0,true))?{$:1,$0:null}:null;};B.debug=function(_1){d.debug((function(_2){return function(_3){return _2("Main: "+J.prettyPrint(_3));};}(a.id))(_1));};C.run=function(){var _1,_2;_1=M.ThisFunc(function(_3,_4){return((C.Main().get_Text())(_3))(_4);});_2=C.Main().get_Options();a.$("#main").terminal(_1,_2);return Q.get_Empty();};C.Main=function(){D.$cctor();return D.Main;};C.container=function(){D.$cctor();return D.container;};C.wait=function(_1){d["Terminal.Echo'"](C.CUI().Term,"please wait");C.CUI().Term.disable();_1();C.CUI().Term.enable();};C.stopSpeaking=function(){D.$cctor();return D.stopSpeaking;};C.sayRandom=function(_1,_2){C.say(w.getRandomPhrase(_2,_1));};C.sayVoices=function(){var _1,_2;_1=a.speechSynthesis.getVoices();!(_1==null)?(_2=d.toArray(_1),C.say((function(_3){return function(_4){return _3("There are currently "+a.String(_4)+" voices installed on this computer or device.");};}(a.id))(H.length(_2))),H.iteri(function(_3,_4){return C.say(((((M.Curried(function(_5,_6,_7,_8){return _5("Voice "+a.String(_6)+". Name: "+J.toSafe(_7)+", Local: "+J.prettyPrint(_8)+".");},4))(a.id))(_3))(_4.name))(_4.localService));},_2)):void 0;};C.say=function(_1){var _2,_3,_4;C.msgs().unshift(_1);_2=C.CUI().Voice;_2!=null&&_2.$==1?(_3=_2.$0,S.Start((_4=null,S.Delay(function(){var _5;_5=new a.SpeechSynthesisUtterance(_1);_5.voice=_3;a.speechSynthesis.speak(_5);C.CUI().Caption?d["Terminal.Echo'"](C.CUI().Term,_1):void 0;return S.Zero();})),null)):d["Terminal.Echo'"](C.CUI().Term,_1);};C.initMic=function(_1){var _2,_3;C.set_CUI((_2={$:1,$0:new W.Microphone(X.getElementById("microphone"))},z.New(C.CUI().Voice,_2,C.CUI().Term,C.CUI().DebugMode,C.CUI().Caption)));_3=C.CUI().Mic.$0;_3.onconnecting=function(){C.set_MicState({$:1});return C.debug("Mic connecting...");};_3.ondisconnected=function(){C.set_MicState({$:2});return C.debug("Mic disconnected.");};_3.onaudiostart=function(){C.set_MicState({$:3});return C.debug("Mic audio start...");};_3.onaudioend=function(){C.set_MicState({$:4});return C.debug("Mic audio end.");};_3.onerror=function(_4){C.set_MicState({$:6,$0:_4});return C.debug((function(_5){return function(_6){return _5("Mic error : "+J.toSafe(_6)+".");};}(a.id))(_4));};_3.onready=function(){C.set_MicState({$:5});return C.debug("Mic ready.");};_3.onresult=function(_4,_5){return!(_4==null||_5==null)?(C.set_MicState({$:7,$0:_4,$1:_5}),C.debug((((M.Curried3(function(_6,_7,_8){return _6("Mic result: "+J.prettyPrint(_7)+" "+J.prettyPrint(_8)+".");}))(a.id))(_4))(_5)),_1(_3,[_4,_5])):C.debug("Mic: No result returned.");};_3.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};C.initSpeech=function(){var _1,_2;_1=a.speechSynthesis.getVoices();!(_1==null)?(_2=d.toArray(_1),H.iter(function(_3){if(Y.Equals(C.CUI().Voice,null)&&(_3.name.indexOf("Microsoft Zira")!=-1||_3.name.toLowerCase().indexOf("female")!=-1)){C.set_CUI(z.New({$:1,$0:_3},C.CUI().Mic,C.CUI().Term,C.CUI().DebugMode,C.CUI().Caption));C.debug((function(_4){return function(_5){return _4("Using voice "+J.toSafe(_5)+".");};}(a.id))(C.CUI().Voice.$0.name));}},_2),Y.Equals(C.CUI().Voice,null)&&H.length(_2)>0?(C.set_CUI(z.New({$:1,$0:H.find(function(_3){return _3["default"];},_2)},C.CUI().Mic,C.CUI().Term,C.CUI().DebugMode,C.CUI().Caption)),C.debug((function(_3){return function(_4){return _3("Using default voice "+J.toSafe(_4)+".");};}(a.id))(C.CUI().Voice.$0.name))):void 0):void 0;Y.Equals(C.CUI().Voice,null)?(d.error("No speech synthesis voice is available."),d["Terminal.Echo'"](C.CUI().Term,"No speech synthesis voice is available. Install speech synthesis on this device or computer to use the voice output feature of Selma.")):void 0;};C.pushCtx=function(_1){C.Context().unshift(_1);return C.Context();};C.Context=function(){D.$cctor();return D.Context;};C.debug=function(_1){var _2;_2=(function(_3){return function(_4){return _3("Client: "+J.prettyPrint(_4));};}(a.id))(_1);d.debug(_2);C.CUI().DebugMode?d["Terminal.EchoHtml'"](C.CUI().Term,_2):void 0;};C.msgs=function(){D.$cctor();return D.msgs;};C.Props=function(){D.$cctor();return D.Props;};C.OpState=function(){D.$cctor();return D.OpState;};C.set_OpState=function(_1){D.$cctor();D.OpState=_1;};C.MicState=function(){D.$cctor();return D.MicState;};C.set_MicState=function(_1){D.$cctor();D.MicState=_1;};C.CUI=function(){D.$cctor();return D.CUI;};C.set_CUI=function(_1){D.$cctor();D.CUI=_1;};D.$cctor=function(){var _1;D.$cctor=a.ignore;function _2(_4,_5){var _6,_7,_8,_9,_,$,ba,bb,bc,bd,be;_6=_5[0];_7=_5[1];C.debug((((M.Curried3(function(bf,bg,bh){return bf("Voice: "+J.prettyPrint(bg)+" "+J.prettyPrint(bh));}))(a.id))(_6))(_7));_8=(_9=p["Intent'"](_6,_7),_9!=null&&_9.$==1?{$:1,$0:_9.$0}:null);_=($=p["Trait'"](_7),$!=null&&$.$==1?{$:1,$0:$.$0}:null);ba=(bb=p["Entity'$1"](_7),bb!=null&&bb.$==1?{$:1,$0:N.ofArray([bb.$0])}:null);return _8==null&&(_==null&&ba==null)?null:(C.debug(((((M.Curried(function(bf,bg,bh,bi){return bf("Voice: "+E.p(bg)+" "+E.p$3(bh)+" "+E.p$5(bi));},4))(a.id))(_8))(_))(ba)),(C.OpState()==null?false:C.OpState().$0.$==0)?C.say("I'm still working on understanding your last message."):(be=C.pushCtx(new o({$:0,$0:_8,$1:_,$2:ba})),B.update(C.CUI(),C.Props(),C.msgs(),be)));}function _3(_4,_5){var _6,_7,_8,_9,_,$,ba,bb,bc,bd;C.set_CUI(z.New(C.CUI().Voice,C.CUI().Mic,_4,C.CUI().DebugMode,C.CUI().Caption));Y.Equals(C.CUI().Voice,null)?C.initSpeech():void 0;Y.Equals(C.CUI().Mic,null)?C.initMic(_2):void 0;return(_6=r.Blank(_5),_6!=null&&_6.$==1)?C.say("Tell me what you want me to do or ask me a question."):(_7=r.DebugOn(_5),_7!=null&&_7.$==1)?(C.set_CUI(z.New(C.CUI().Voice,C.CUI().Mic,C.CUI().Term,true,C.CUI().Caption)),C.say("Debug mode is now on.")):(_8=r.DebugOff(_5),_8!=null&&_8.$==1)?(C.set_CUI(z.New(C.CUI().Voice,C.CUI().Mic,C.CUI().Term,false,C.CUI().Caption)),C.say("Debug mode is now off.")):(C.OpState()==null?false:C.OpState().$0.$==0)?C.say("I'm still working on understanding your last message."):($=r.QuickHello(_5),$!=null&&$.$==1?(_=$.$0,true):(ba=r.QuickHelp(_5),ba!=null&&ba.$==1?(_=ba.$0,true):(bb=r.QuickPrograms(_5),bb!=null&&bb.$==1&&(_=bb.$0,true))))?(C.debug((function(be){return function(bf){return be("Quick Text: "+E.p$7(bf)+".");};}(a.id))(_)),bc=C.pushCtx(_),B.update(C.CUI(),C.Props(),C.msgs(),bc)):C.CUI().Wait((bd=null,S.Delay(function(){C.set_OpState({$:1,$0:{$:0}});return S.Combine(S.Bind((new V.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:-1574345789",[_5]),function(be){var bf,bg,bh;bf=r.HasMeaning(be);return bf!=null&&bf.$==1?(bg=bf.$0,(C.debug(((((M.Curried(function(bi,bj,bk,bl){return bi("Text: "+E.p(bj)+" "+E.p$3(bk)+" "+E.p$5(bl));},4))(a.id))(bg.get_Intent()))(bg.get_Trait()))(bg.get_Entities())),bh=C.pushCtx(bg),B.update(C.CUI(),C.Props(),C.msgs(),bh),S.Zero())):(C.debug("Text: Did not receive a response from the server."),d["Terminal.Echo'"](_4,"Sorry I did not understand what you said."),S.Zero());}),S.Delay(function(){C.set_OpState(null);return S.Zero();}));})));}D.CUI=z.New(null,null,null,false,false);D.MicState={$:0};D.OpState=null;D.Props=new _0.New$5();D.msgs=[];D.Context=[];D.stopSpeaking=a.speechSynthesis.speaking||a.speechSynthesis.pending?a.speechSynthesis.cancel():null;D.container=i.Container;D.Main=new y({$:0,$0:function(_4){return function(_5){return _2(_4,_5);};},$1:[function(_4){return function(_5){return _3(_4,_5);};},(_1={},_1.name="Main",_1.greetings="Welcome to Selma. Enter 'hello my name is...(you)' to begin and initialize speech or help for more assistance.",_1.prompt=">",_1)]});};E.p$2=function(_1){return _1==null?"null":"Some "+J.prettyPrint(_1.$0);};E.p$1=function(_1){return"Intent ("+J.prettyPrint(_1.$0)+", "+E.p$2(_1.$1)+")";};E.p=function(_1){return _1==null?"null":"Some "+E.p$1(_1.$0);};E.p$4=function(_1){return"Trait ("+J.prettyPrint(_1.$0)+", "+J.prettyPrint(_1.$1)+")";};E.p$3=function(_1){return _1==null?"null":"Some "+E.p$4(_1.$0);};E.p$6=function(_1){return"Entity ("+J.prettyPrint(_1.$0)+", "+J.prettyPrint(_1.$1)+", "+E.p$2(_1.$2)+")";};E.p$5=function(_1){return _1==null?"null":"Some "+J.printList(function(_2){return E.p$6(_2);},_1.$0);};E.p$7=function(_1){return"Meaning ("+E.p(_1.$0)+", "+E.p$3(_1.$1)+", "+E.p$5(_1.$2)+")";};}());
