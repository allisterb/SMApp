(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=c.Bs=c.Bs||{};i=b.NLU=b.NLU||{};j=i.Babelfy=i.Babelfy||{};k=j.ApiResponse=j.ApiResponse||{};l=j.TokenFragment=j.TokenFragment||{};m=j.CharFragment=j.CharFragment||{};n=i.Witai=i.Witai||{};o=n.Utterance=n.Utterance||{};p=n.Intent=n.Intent||{};q=n.Entity=n.Entity||{};r=n.Trait=n.Trait||{};s=n["Utterance'"]=n["Utterance'"]||{};t=n["Value'"]=n["Value'"]||{};u=c.NLU=c.NLU||{};v=u.Intent=u.Intent||{};w=u.Trait=u.Trait||{};x=u.Entity=u.Entity||{};y=u.Utterance=u.Utterance||{};z=u.Question=u.Question||{};A=u.Voice=u.Voice||{};B=A["Entity'"]=A["Entity'"]||{};C=u.Text=u.Text||{};D=C["Utterance'"]=C["Utterance'"]||{};E=C["Intent'"]=C["Intent'"]||{};F=C["Entity'"]=C["Entity'"]||{};G=C["Trait'"]=C["Trait'"]||{};H=u.Domain=u.Domain||{};I=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};J=c.CUI=c.CUI||{};K=J.MicState=J.MicState||{};L=J.ClientState=J.ClientState||{};M=J.Interpreter=J.Interpreter||{};N=J.CUI=J.CUI||{};O=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};P=c.Main=c.Main||{};Q=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};R=c.Client=c.Client||{};S=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};T=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};U=a.WebSharper;V=U&&U.UI;W=V&&V.Client;X=W&&W.Templates;Y=V&&V.Doc;Z=U&&U.Strings;_0=a.IntelliFactory;_1=_0&&_0.Runtime;_2=U&&U.Utils;_3=a.console;_4=a.jQuery;_5=U&&U.Arrays;_6=U&&U.List;_7=U&&U.Seq;_8=V&&V.AttrProxy;_9=U&&U.Concurrency;_=U&&U.JavaScript;$=_&&_.Pervasives;ba=U&&U.Collections;bb=ba&&ba.Map;bc=a.SDK;bd=U&&U.Random;be=U&&U.Operators;bf=U&&U.Remoting;bg=bf&&bf.AjaxRemotingProvider;bh=a.Wit;bi=a.document;bj=U&&U.Unchecked;bk=ba&&ba.Dictionary;d.speechSynthesis=function(){return a.speechSynthesis;};d.elementHTML=function(bl){return bl.innerHTML;};d.createElement=function(bl,bm){var bn;bn=self.document.createElement(bl);X.LoadLocalTemplates("");Y.RunAppend(bn,bm);return bn;};d.replace_tok=function(bl,bm,bn){return Z.Replace(bn,bl,bm);};d.toLower=function(bl){return bl.toLowerCase();};d.debug=function(bl,bm){d.info((((_1.Curried3(function(bn,bo,bp){return bn("DEBUG: "+_2.toSafe(bo)+": "+_2.prettyPrint(bp));}))(a.id))(bl.toUpperCase()))(bm));};d.error=function(bl){_3.error(bl);};d.info=function(bl){_3.info(bl);};d.jserror=function(bl){_4.error(bl);};d.toArray=function(bl){return _5.map(a.id,_4.makeArray(bl));};d["Terminal.EchoHtml'"]=function(bl,bm){bl.pause();bl.echo(bm,d.rawOpt());bl.resume();};d["Terminal.Echo'"]=function(bl,bm){bl.pause();bl.echo(bm);bl.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=_1.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(bl){function bm(bn){return function(bo){var bp,bq,br,bs,bt,bu,bv;bq=Z.replicate(bn," ");switch(bo.$==0?bo.$1.$==1?bo.$1.$0.$==2?bo.$1.$1.$==0?(bp=[bo.$1.$0.$0,bo.$0],1):(bp=[bo.$1,bo.$0],2):(bp=[bo.$1,bo.$0],2):(bp=[bo.$1,bo.$0],2):bo.$==2?(bp=bo.$0,3):(bp=[bo.$0,bo.$1],0)){case 0:return bp[0]+"=\""+bp[1]+"\"";case 1:br=bp[1];return bq+"<"+br+">"+bp[0]+"</"+br+">\r\n";case 2:bs=bp[1];bt=_6.partition(function(bw){return bw.$==1;},bp[0]);bu=bt[1];bv=bt[0];return bu.$==0?bq+"<"+bs+(bv.$===0?"":" "+Z.concat(" ",_6.ofSeq(_7.delay(function(){return _7.map(function(bw){return(bm(0))(bw);},bv);}))))+"/>\r\n":bq+"<"+bs+(bv.$===0?"":" "+Z.concat(" ",_6.ofSeq(_7.delay(function(){return _7.map(function(bw){return(bm(0))(bw);},bv);}))))+">\r\n"+Z.concat("",_6.ofSeq(_7.delay(function(){return _7.map(function(bw){return(bm(bn+1))(bw);},bu);})))+bq+"</"+bs+">\r\n";case 3:return bq+bp+"\r\n";}};}return(bm(0))(bl);};f.alt=function(bl){return new e({$:1,$0:"alt",$1:bl});};f.src=function(bl){return new e({$:1,$0:"src",$1:bl});};f.cls=function(bl){return new e({$:1,$0:"class",$1:bl});};f.str=function(bl){return e.toString(bl);};f.op_PercentEquals=function(bl,bm){return new e({$:1,$0:bl,$1:bm});};f.op_Splice=function(bl){var bm;return _6.ofArray([new e({$:2,$0:(bm=bl,a.String(bm))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(bl,bm){return new e({$:0,$0:bl,$1:bm});};g.$cctor=function(){var bl;g.$cctor=a.ignore;g.rawOpt=(bl={},bl.raw=true,bl);g.html=function(bm){return f.elem("html",bm);};g.head=function(bm){return f.elem("head",bm);};g.title=function(bm){return f.elem("title",bm);};g.style=function(bm){return f.elem("style",bm);};g.body=function(bm){return f.elem("body",bm);};g.div=function(bm){return f.elem("div",bm);};g.br=function(bm){return f.elem("br",bm);};g.section=function(bm){return f.elem("section",bm);};g.span=function(bm){return f.elem("span",bm);};g.table=function(bm){return f.elem("table",bm);};g.thead=function(bm){return f.elem("thead",bm);};g.tbody=function(bm){return f.elem("tbody",bm);};g.tfoot=function(bm){return f.elem("tfoot",bm);};g.img=function(bm){return f.elem("img",bm);};g.map=function(bm){return f.elem("map",bm);};g.area=function(bm){return f.elem("area",bm);};g.p=function(bm){return f.elem("p",bm);};g.a=function(bm){return f.elem("a",bm);};g.tr=function(bm){return f.elem("tr",bm);};g.td=function(bm){return f.elem("td",bm);};g.th=function(bm){return f.elem("th",bm);};g.ul=function(bm){return f.elem("ul",bm);};g.li=function(bm){return f.elem("li",bm);};g.h1=function(bm){return f.elem("h1",bm);};g.h2=function(bm){return f.elem("h1",bm);};g.h3=function(bm){return f.elem("h1",bm);};g.h4=function(bm){return f.elem("h1",bm);};g.strong=function(bm){return f.elem("strong",bm);};};h.Radio=function(bl,bm,bn,bo,bp){return Y.Element("div",new _6.T({$:1,$0:h.cls("radio"),$1:bm}),[Y.Element("label",bo,[Y.Radio(bp,true,bn),Y.TextNode(bl)])]);};h.checkbox=function(bl,bm,bn,bo,bp){return Y.Element("div",new _6.T({$:1,$0:h.cls("checkbox"),$1:bm}),[Y.Element("label",bo,[Y.CheckBox(bp,bn),Y.TextNode(bl)])]);};h.textArea=function(bl,bm,bn,bo,bp){return Y.Element("div",new _6.T({$:1,$0:h.cls("form-group"),$1:bm}),[Y.Element("label",bo,[Y.TextNode(bl)]),Y.InputArea(new _6.T({$:1,$0:h.cls("form-control"),$1:bp}),bn)]);};h.inputPassword=function(bl,bm,bn,bo,bp){return Y.Element("div",new _6.T({$:1,$0:h.cls("form-group"),$1:bm}),[Y.Element("label",bo,[Y.TextNode(bl)]),Y.PasswordBox(new _6.T({$:1,$0:h.cls("form-control"),$1:bp}),bn)]);};h.input=function(bl,bm,bn,bo,bp){return Y.Element("div",new _6.T({$:1,$0:h.cls("form-group"),$1:bm}),[Y.Element("label",bo,[Y.TextNode(bl)]),Y.Input([h.cls("form-control"),bp],bn)]);};h.btn=function(bl){return Y.Element("button",[h.eid(bl),h.cls("btn")],[]);};h.container=function(bl){return Y.Element("div",[h.cls("container")],bl);};h.cls=function(bl){return _8.Create("class",bl);};h.eid=function(bl){return _8.Create("id",bl);};k.New=function(bl,bm,bn,bo,bp,bq,br,bs,bt){return{tokenFragment:bl,charFragment:bm,babelSynsetID:bn,DBpediaURL:bo,BabelNetURL:bp,score:bq,cohrenceScore:br,globalScore:bs,source:bt};};l.New=function(bl,bm){return{start:bl,end:bm};};m.New=function(bl,bm){return{start:bl,end:bm};};j.disambiguate=function(bl){function bm(bn,bo){var bp;_4.ajax((bp={},bp.url=(function(bq){return function(br){return bq("https://babelfy.io/v1/disambiguate?text="+_2.toSafe(br)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(bl),bp.type="GET",bp.success=function(bq){return bn(bq);},bp.error=function(bq){return bo(new a.Error(bq.responseText));},bp));}return _9.FromContinuations(function(bn,bo,bp){return bm.apply(null,[bn,bo,bp]);});};o.New=function(bl,bm,bn,bo){return{text:bl,intents:bm,entities:bn,traits:bo};};p.New=function(bl,bm,bn){return{id:bl,name:bm,confidence:bn};};q.New=function(bl,bm,bn,bo,bp,bq,br,bs,bt,bu){return{id:bl,name:bm,role:bn,start:bo,end:bp,body:bq,entities:br,suggested:bs,value:bt,type:bu};};r.New=function(bl,bm,bn){return{id:bl,value:bm,confidence:bn};};s.New=function(bl){return{intent:bl};};t.New=function(bl){return{value:bl};};n.getMeaning2=function(bl,bm){function bn(bo,bp){var bq;_4.ajax((bq={},bq.url=(function(br){return function(bs){return br("https://api.wit.ai/message?q="+_2.toSafe(bs));};}(a.id))(bm),bq.type="GET",bq.beforeSend=function(br){return br.setRequestHeader("Authorization","Bearer "+bl);},bq.success=function(br){return bo(br);},bq.error=function(br){return bp(new a.Error(br.responseText));},bq));}return _9.FromContinuations(function(bo,bp,bq){return bn.apply(null,[bo,bp,bq]);});};n.getMeaning=function(bl,bm,bn,bo){var bp;_4.ajax((bp={},bp.url=(function(bq){return function(br){return bq("https://api.wit.ai/message?q="+_2.toSafe(br));};}(a.id))(bm),bp.type="GET",bp.beforeSend=function(bq){return bq.setRequestHeader("Authorization","Bearer "+bl);},bp.success=bn,bp.error=bo,bp));};v=u.Intent=_1.Class({toString:function(){return(((_1.Curried3(function(bl,bm,bn){return bl("Intent("+_2.toSafe(bm)+", "+T.p$2(bn)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,v);w=u.Trait=_1.Class({toString:function(){return(((_1.Curried3(function(bl,bm,bn){return bl("Trait("+_2.toSafe(bm)+", "+_2.prettyPrint(bn)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,w);x=u.Entity=_1.Class({toString:function(){return((((_1.Curried(function(bl,bm,bn,bo){return bl("Entity("+_2.toSafe(bm)+", "+_2.toSafe(bn)+", "+T.p$2(bo)+")");},4))(a.id))(this.get_Name()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,x);y=u.Utterance=_1.Class({toString:function(){return((((_1.Curried(function(bl,bm,bn,bo){return bl(T.p(bm)+" "+T.p$3(bn)+" "+T.p$5(bo));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var bl;bl=this.$2;return bl!=null?{$:1,$0:_6.sortBy(function(bm){return bm.get_Name();},bl.$0)}:null;},get_Traits:function(){var bl;bl=this.$1;return bl!=null?{$:1,$0:_6.sortBy(function(bm){return bm.get_Name();},bl.$0)}:null;},get_Intent:function(){return this.$0;}},null,y);z=u.Question=_1.Class({toString:function(){return(((_1.Curried3(function(bl,bm,bn){return bl("Name: "+_2.toSafe(bm)+" Text: "+_2.toSafe(bn));}))(a.id))(this.get_Name()))(this.get_Text());},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,z);B.New=function(bl,bm,bn,bo,bp){return{body:bl,end:bm,start:bn,suggested:bo,value:bp};};A["Intent'"]=function(bl,bm){return!(bm.intent==null)?{$:1,$0:new v({$:0,$0:d.toLower(bm.intent.value),$1:null})}:null;};A["Trait'"]=function(bl){return!(bl.domain==null)?{$:1,$0:new w({$:0,$0:"domain",$1:d.toLower(bl.domain.value),$2:null})}:!(bl.dialogue_act==null)?{$:1,$0:new w({$:0,$0:"dialogue_act",$1:d.toLower(bl.dialogue_act.value),$2:null})}:null;};A["Entity'$1"]=function(bl){return!(bl.contact==null)?{$:1,$0:new x({$:0,$0:"contact",$1:d.toLower(bl.contact.value),$2:null})}:null;};D=C["Utterance'"]=_1.Class({get_TopIntent:function(){return _6.head(_6.sortBy(function(bl){return bl.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$2;},get_Entities:function(){return this.$1;},get_Intents:function(){return this.$0;}},null,D);E=C["Intent'"]=_1.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,E);F=C["Entity'"]=_1.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,F);G=C["Trait'"]=_1.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,G);C.HasUtterance=function(bl){var bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz;return bl!=null&&bl.$==1&&(bl.$0.$0.$==0&&(bl.$0.$1.get_Length()>0&&(bm=[bl.$0.$1,bl.$0.$2],true)))?(bn=_6.map(function(bA){return new x({$:0,$0:d.toLower(bA.get_Role()),$1:bA.get_Value(),$2:{$:1,$0:bA.get_Confidence()}});},_6.filter(function(bA){return bA.get_Confidence()>C.entityConfidenceThreshold();},bm[0])),{$:1,$0:new y({$:0,$0:null,$1:{$:1,$0:_6.map(function(bA){return new w({$:0,$0:d.toLower(bA.get_Name()),$1:bA.get_Value(),$2:{$:1,$0:bA.get_Confidence()}});},_6.filter(function(bA){return bA.get_Confidence()>C.entityConfidenceThreshold();},bm[1]))},$2:{$:1,$0:bn}})}):bl!=null&&bl.$==1&&(bl.$0.$1.$==0&&(bl.$0.$2.$==0&&(bl.$0.$0.get_Length()>0&&bl.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bo=[bl.$0.$0,bl],true))))?(bp=bo[1],{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:d.toLower(bp.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bp.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:null})}):bl!=null&&bl.$==1&&(bl.$0.$2.$==0&&(bl.$0.$0.get_Length()>0&&bl.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bq=[bl.$0.$0,bl],true)))?(br=bq[1],(bs=_6.map(function(bA){return new x({$:0,$0:d.toLower(bA.get_Role()),$1:bA.get_Value(),$2:{$:1,$0:bA.get_Confidence()}});},_6.filter(function(bA){return bA.get_Confidence()>C.entityConfidenceThreshold();},br.$0.get_Entities())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:d.toLower(br.$0.get_TopIntent().get_Name()),$1:{$:1,$0:br.$0.get_TopIntent().get_Confidence()}})},$1:null,$2:{$:1,$0:bs}})})):bl!=null&&bl.$==1&&(bl.$0.$1.$==0&&(bl.$0.$0.get_Length()>0&&bl.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bt=[bl.$0.$0,bl],true)))?(bu=bt[1],(bv=_6.map(function(bA){return new w({$:0,$0:d.toLower(bA.get_Name()),$1:bA.get_Value(),$2:{$:1,$0:bA.get_Confidence()}});},_6.filter(function(bA){return bA.get_Confidence()>C.entityConfidenceThreshold();},bu.$0.get_Traits())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:d.toLower(bu.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bu.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bv},$2:null})})):bl!=null&&bl.$==1&&(bl.$0.$0.get_Length()>0&&bl.$0.get_TopIntent().get_Confidence()>C.intentConfidenceThreshold()&&(bw=[bl.$0.$0,bl],true))?(bx=bw[1],(by=_6.map(function(bA){return new x({$:0,$0:d.toLower(bA.get_Role()),$1:bA.get_Value(),$2:{$:1,$0:bA.get_Confidence()}});},_6.filter(function(bA){return bA.get_Confidence()>C.entityConfidenceThreshold();},bx.$0.get_Entities())),(bz=_6.map(function(bA){return new w({$:0,$0:d.toLower(bA.get_Name()),$1:bA.get_Value(),$2:{$:1,$0:bA.get_Confidence()}});},_6.filter(function(bA){return bA.get_Confidence()>C.entityConfidenceThreshold();},bx.$0.get_Traits())),{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:d.toLower(bx.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bx.$0.get_TopIntent().get_Confidence()}})},$1:{$:1,$0:bz},$2:{$:1,$0:by}})}))):null;};C.entityConfidenceThreshold=function(){I.$cctor();return I.entityConfidenceThreshold;};C.set_entityConfidenceThreshold=function(bl){I.$cctor();I.entityConfidenceThreshold=bl;};C.intentConfidenceThreshold=function(){I.$cctor();return I.intentConfidenceThreshold;};C.set_intentConfidenceThreshold=function(bl){I.$cctor();I.intentConfidenceThreshold=bl;};C.getUtterance=function(bl,bm){n.getMeaning("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bl,function(bn){var bo,bp;d.debug("NLU",(function(bq){return function(br){return bq("Wit.ai returned: "+_2.prettyPrint(br));};}(a.id))(bn));bo=!(bn.intents==null)?_6.ofArray(_5.map(function(bq){return new E({$:0,$0:bq.name,$1:bq.confidence});},bn.intents)):_6.T.Empty;bp=!(bn.traits==null)?_6.ofSeq(_7.concat(_6.map(function(bq){return _5.map(function(br){return new G({$:0,$0:bq,$1:br.confidence,$2:br.value});},$.GetJS(bn.traits,[bq]));},_6.filter(function(bq){return!($.GetJS(bn.traits,[bq])==null);},C.trait_types())))):_6.T.Empty;return bm({$:1,$0:new D({$:0,$0:bo,$1:!(bn.intents==null)?_6.ofSeq(_7.concat(_6.map(function(bq){return _5.map(function(br){return new F({$:0,$0:br.name,$1:br.confidence,$2:br.role,$3:br.value});},$.GetJS(bn.entities,[bq]));},_6.filter(function(bq){return!($.GetJS(bn.entities,[bq])==null);},C.entity_types())))):_6.T.Empty,$2:bp})});},function(bn,bo,bp){d.error((((_1.Curried3(function(bq,br,bs){return bq("Wit.ai returned: "+_2.prettyPrint(br)+" "+_2.prettyPrint(bs));}))(a.id))(bo))(bp));return bm(null);});};C.getUtterance2=function(bl){return n.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",bl);};C.trait_types=function(){I.$cctor();return I.trait_types;};C.entity_types=function(){I.$cctor();return I.entity_types;};C.QuickPrograms=function(bl){return bl==="programs"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"Program",$1:null})},$1:null,$2:null})}:null;};C.QuickNumber=function(bl){var bm,bn,bo;return(bn=C.One(bl),bn!=null&&bn.$==1?(bm=bn.$0,true):(bo=C.Two(bl),bo!=null&&bo.$==1&&(bm=bo.$0,true)))?{$:1,$0:bm}:null;};C.Three=function(bl){var bm;return bl==="3"||bl==="three"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_6.ofArray([new x({$:0,$0:"wit/ordinal",$1:"three",$2:{$:1,$0:1}})])}})}:null;};C.Two=function(bl){var bm;return bl==="2"||bl==="two"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_6.ofArray([new x({$:0,$0:"wit/ordinal",$1:"two",$2:{$:1,$0:1}})])}})}:null;};C.One=function(bl){var bm;return bl==="1"||bl==="one"?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$1:null,$2:{$:1,$0:_6.ofArray([new x({$:0,$0:"wit/ordinal",$1:"one",$2:{$:1,$0:1}})])}})}:null;};C.QuickNo=function(bl){var bm;return bl==="no"||(bl==="NO"||(bl==="No"||(bl==="nope"||(bl==="no way"||(bl==="nah"||(bl==="don't do it"||bl==="stop"))))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"no",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickYes=function(bl){var bm;return bl==="yes"||(bl==="YES"||(bl==="Yes"||(bl==="YEs"||(bl==="ok"||(bl==="sure"||(bl==="yeah"||(bl==="yep"||(bl==="uh huh"||(bl==="go ahead"||bl==="go")))))))))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"yes",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickHelp=function(bl){var bm;return bl==="help"||(bl==="help me"||(bl==="what's this?"||bl==="huh"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"help",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.QuickHello=function(bl){var bm;return bl==="hello"||(bl==="hey"||(bl==="yo"||bl==="hi"))?{$:1,$0:new y({$:0,$0:{$:1,$0:new v({$:0,$0:"hello",$1:{$:1,$0:1}})},$1:null,$2:null})}:null;};C.Voices=function(bl){return bl==="voices"?{$:1,$0:null}:null;};C.Debug=function(bl){return bl==="debug"?{$:1,$0:null}:null;};C.Blank=function(bl){return bl===""?{$:1,$0:null}:null;};H.Study=function(bl){return bl.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};u.No=function(bl){var bm,bn,bo,bp,bq,br;return(bn=u.Intent$1("no",bl),bn!=null&&bn.$==1&&(bn.$0[0]==null&&(bn.$0[1]==null&&(bm=bl,true))))?{$:1,$0:bm}:(bp=u.Intent$1("noresponse",bl),bp!=null&&bp.$==1&&(bp.$0[0]==null&&(bp.$0[1]==null&&(bo=bl,true))))?{$:1,$0:bo}:(br=u.Intent$1("NoResponse",bl),br!=null&&br.$==1&&(br.$0[0]==null&&(br.$0[1]==null&&(bq=bl,true))))?{$:1,$0:bq}:null;};u.Yes=function(bl){var bm,bn,bo,bp,bq,br;return(bn=u.Intent$1("yes",bl),bn!=null&&bn.$==1&&(bn.$0[0]==null&&(bn.$0[1]==null&&(bm=bl,true))))?{$:1,$0:bm}:(bp=u.Intent$1("yesresponse",bl),bp!=null&&bp.$==1&&(bp.$0[0]==null&&(bp.$0[1]==null&&(bo=bl,true))))?{$:1,$0:bo}:(br=u.Intent$1("YesResponse",bl),br!=null&&br.$==1&&(br.$0[0]==null&&(br.$0[1]==null&&(bq=bl,true))))?{$:1,$0:bq}:null;};u.EntityManyofMany=function(bl,bm){return{$:1,$0:bb.OfArray(_5.ofSeq(_6.map(function(bn){return _6.exists(function(bo){return bo.get_Name()===bn;},bm)?[bn,{$:1,$0:_6.filter(function(bo){return bo.get_Name()===bn;},bm)}]:[bn,null];},bl)))};};u.EntityManyOf1=function(bl,bm){var bn;return bm!=null&&bm.$==1&&(_6.exists(function(bo){return bo.get_Name()===bl;},bm.$0)&&(bn=bm.$0,true))?{$:1,$0:_6.filter(function(bo){return bo.get_Name()===bl;},bn)}:null;};u.Entity1OfAny=function(bl,bm){var bn;return bm!=null&&bm.$==1&&(_6.exists(function(bo){return bo.get_Name()===bl;},bm.$0)&&(bn=bm.$0,true))?{$:1,$0:_6.head(_6.sortBy(function(bo){return bo.get_Name();},_6.filter(function(bo){return bo.get_Name()===bl;},bn)))}:null;};u.Entity1Of1=function(bl,bm){var bn;return bm!=null&&bm.$==1&&(bm.$0.$==1&&(bm.$0.$1.$==0&&(bm.$0.$0.get_Name()===bl&&(bn=bm.$0.$0,true))))?{$:1,$0:bn}:null;};u.Intent$1=function(bl,bm){return bm.get_Intent()!=null&&bm.get_Intent().$0.get_Name()===bl?{$:1,$0:[bm.get_Traits(),bm.get_Entities()]}:null;};I.$cctor=function(){I.$cctor=a.ignore;I.entity_types=_6.ofArray(["wit$contact:contact","wit$datetime:datetime","subject:subject","term:term"]);I.trait_types=_6.ofArray(["domain","dialogue_act"]);I.intentConfidenceThreshold=0.85;I.entityConfidenceThreshold=0.85;};K.MicReady={$:5};K.MicAudioEnd={$:4};K.MicAudioStart={$:3};K.MicDisconnected={$:2};K.MicConnecting={$:1};K.MicNotInitialized={$:0};L.ClientUnderstand={$:2};L.ClientReady={$:1};L.ClientNotInitialzed={$:0};M=J.Interpreter=_1.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,M);N=J.CUI=_1.Class({SayVoices:function(){var bl,bm,bn;bl=this;bm=a.speechSynthesis.getVoices();!(bm==null)?(bn=d.toArray(bm),bl.Say((function(bo){return function(bp){return bo("There are currently "+a.String(bp)+" voices installed on this computer or device.");};}(a.id))(_5.length(bn))),_5.iteri(function(bo,bp){return bl.Say(((((_1.Curried(function(bq,br,bs,bt){return bq("Voice "+a.String(br)+". Name: "+_2.toSafe(bs)+", Local: "+_2.prettyPrint(bt)+".");},4))(a.id))(bo))(bp.name))(bp.localService));},bn)):void 0;},Wait:function(bl){this.Wait$1(function(){_9.Start(bl,null);});},Wait$1:function(bl){this["Echo'"]("please wait...");this.Term.pause();bl();this.Term.resume();},sayRandom:function(bl,bm){this.Say(J.getRandomPhrase(bl,bm));},SayAngry:function(bl){var bm,bn;bm=this;_9.Start((bn=null,_9.Delay(function(){return _9.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bc.chime(),_9.Zero()):_9.Zero(),_9.Delay(function(){a.addMessage(bm.Avatar,bl,"","");bm.Avatar.processMessages(0);return _9.Zero();}));})),null);},Say:function(bl){var bm,bn;bm=this;_9.Start((bn=null,_9.Delay(function(){return _9.Combine(a.speechSynthesis.speaking?(bc.chime(),_9.Zero()):_9.Zero(),_9.Delay(function(){bm.Avatar.addMessage(bl);bm.Avatar.processMessages(0);return _9.Zero();}));})),null);},Debug:function(bl,bm){d.debug(bl,bm);},"EchoHtml'":function(bl){var bm,bn;bm=(bn={},bn.raw=true,bn);this.Term.disable();this.Term.echo(bl,bm);this.Term.enable();},"Echo'":function(bl){this.Term.disable();this.Term.echo(bl);this.Term.enable();}},null,N);N.New=function(bl,bm,bn,bo,bp){return new N({Voice:bl,Mic:bm,Term:bn,Avatar:bo,Caption:bp});};J.waitAddPhrases=function(){O.$cctor();return O.waitAddPhrases;};J.waitRetrievePhrases=function(){O.$cctor();return O.waitRetrievePhrases;};J.helpPhrases=function(){O.$cctor();return O.helpPhrases;};J.helloUserPhrases=function(){O.$cctor();return O.helloUserPhrases;};J.helloPhrases=function(){O.$cctor();return O.helloPhrases;};J["getRandomPhrase'"]=function(bl){return d.replace_tok("$0","",_7.nth(J.rng().Next(0,bl.get_Length()),bl));};J.getRandomPhrase=function(bl,bm){return d.replace_tok("$0",bm,_7.nth(J.rng().Next(0,bl.get_Length()),bl));};J.rng=function(){O.$cctor();return O.rng;};O.$cctor=function(){O.$cctor=a.ignore;O.rng=new bd.New();O.helloPhrases=_6.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);O.helloUserPhrases=_6.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);O.helpPhrases=_6.ofArray(["What can I help you with $0?"]);O.waitRetrievePhrases=_6.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);O.waitAddPhrases=_6.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};P.update=function(bl,bm,bn,bo,bp){var bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd;function ce(cy){bl.Say(cy);}function cf(cy){bo.unshift(cy);ce(cy);}function cg(cy,cz){var cA;cA=J.getRandomPhrase(cy,cz);bo.unshift(cA);return bl.Say(cA);}function ch(cy){return bm.ContainsKey(cy);}function ci(cy,cz){return bm.Add(cy,cz);}function cj(cy){bm.Remove(cy);}function ck(){return bm.get_Item("user");}function cl(){bp.shift();}function cm(){bn.shift();}function cn(cy){var cz;cz=P.getQuestion(cy);cz==null?(function(cA){return function(cB){return cA("No such question: "+_2.toSafe(cB));};}(be.FailWith))(cy):bn.unshift(cz.$0);}function co(cy,cz){ci(cy,cz);cn(cy);P.debug((function(cA){return function(cB){return cA("Added question: "+T.p$8(cB)+".");};}(a.id))(bn[0]));return cf(d.replace_tok("$0",cz,P.getQuestion(cy).$0.get_Text()));}function cp(cy,cz){return ch(cy)?{$:1,$0:cz}:null;}function cq(cy,cz){return!ch(cy)?{$:1,$0:cz}:null;}function cr(cy){var cz,cA;return(cA=cp("user",cy),cA!=null&&cA.$==1&&(bn.length===0&&(cz=cA.$0,true)))?(cl(),{$:1,$0:cz}):null;}function cs(cy,cz){var cA,cB,cC;return(cB=cp("user",cz),cB!=null&&cB.$==1&&(P.haveQuestion(cy)&&bn.length>0&&bn[0].get_Name()===cy&&(cA=cB.$0,true)))?(cl(),cm(),ch(cy)?(cC=bm.get_Item(cy),(cj(cy),{$:1,$0:[cA,{$:1,$0:cC}]})):{$:1,$0:[cA,null]}):null;}function ct(cy,cz){var cA,cB,cC;return(cB=cq("user",cz),cB!=null&&cB.$==1&&(P.haveQuestion(cy)&&bn.length>0&&bn[0].get_Name()===cy&&(cA=cB.$0,true)))?(cl(),cm(),ch(cy)?(cC=bm.get_Item(cy),(cj(cy),{$:1,$0:[cA,{$:1,$0:cC}]})):{$:1,$0:[cA,null]}):null;}function cu(cy){var cz,cA;return(cA=cq("user",cy),cA!=null&&cA.$==1&&(bn.length===0&&(cz=cA.$0,true)))?(cl(),{$:1,$0:cz}):null;}function cv(cy){var cz;return cy!=null&&cy.$==1&&(typeof cy.$0=="string"&&(cz=cy.$0,true))?{$:1,$0:cz}:null;}function cw(cy,cz,cA){var cB;return _9.Start((cB=null,_9.Delay(function(){cg(J.waitAddPhrases(),"symptom entry");return _9.Bind((new bg.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:1126931596",[ck().Name,cy,cz,cA]),function(cC){return cC==null?(cf(function(cD){return cD("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),_9.Zero()):(cf((function(cD){return function(cE){return cD("OK I added that "+_2.toSafe(cE)+" symptom to your journal.");};}(a.id))(cy)),_9.Zero());});})),null);}function cx(cy){var cz;cz=null;return _9.Delay(function(){cg(J.waitRetrievePhrases(),"symptom journal");return(new bg.New()).Async("SMApp.Web:SMApp.Web.Server.getSymptomJournal:59525302",[cy]);});}P.debug((((_1.Curried3(function(cy,cz,cA){return cy("Starting utterances:"+_2.prettyPrint(cz)+". Starting questions: "+_2.prettyPrint(cA)+".");}))(a.id))(bp))(bn));bq=_6.ofSeq(_7.take(bp.length>=5?5:bp.length,bp));bq.$==1&&(bs=(bt=cq("started",bq.$0),bt!=null&&bt.$==1?{$:1,$0:bt.$0}:null),bs!=null&&bs.$==1&&(bu=cu(bs.$0),bu!=null&&bu.$==1&&(bv=u.Intent$1("hello",bu.$0),bv!=null&&bv.$==1&&(bv.$0[1]==null&&bq.$1.$==0))))?(bm.Add("started",true),cg(J.helloPhrases(),"")):bq.$==1&&(bx=cu(bq.$0),bx!=null&&bx.$==1&&(by=u.Intent$1("hello",bx.$0),by!=null&&by.$==1&&(by.$0[1]==null&&bq.$1.$==0)))?cf("Hello, tell me your name to get started."):bq.$==1&&(bA=cu(bq.$0),bA!=null&&bA.$==1&&(bB=u.Intent$1("hello",bA.$0),bB!=null&&bB.$==1&&(bC=u.Entity1Of1("contact",bB.$0[1]),bC!=null&&bC.$==1&&(bq.$1.$==0&&(bz=bC.$0,true)))))?(bD=bz.get_Value(),cg(J.waitRetrievePhrases(),"user name"),_9.Start((bE=null,_9.Delay(function(){return _9.Bind((new bg.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-1249169759",[bD]),function(cy){var cz;return cy==null?(cf((function(cA){return function(cB){return cA("I did not find a user with the name "+_2.toSafe(cB)+".");};}(a.id))(bD)),co("addUser",bD),_9.Zero()):(cz=cy.$0,_9.Bind((new bg.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:1790003096",[cz.Name]),function(){bm.Add("user",cz);cg(J.helloUserPhrases(),(function(cA){return function(cB){return cA(_2.prettyPrint(cB));};}(a.id))(bm.get_Item("user")));return cz.LastLoggedIn!=null?_9.Bind((new bg.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:2010625893",[cz.LastLoggedIn.$0]),function(cA){cf((function(cB){return function(cC){return cB("You last logged in "+_2.toSafe(cC)+".");};}(a.id))(cA));return _9.Zero();}):_9.Zero();}));});})),null)):bq.$==1&&(bG=u.Yes(bq.$0),bG!=null&&bG.$==1&&(bH=ct("addUser",bG.$0),bH!=null&&bH.$==1&&(bI=cv(bH.$0[1]),bI!=null&&bI.$==1&&(bq.$1.$==0&&(bF=bI.$0,true)))))?_9.Start((bJ=null,_9.Delay(function(){cg(J.waitAddPhrases(),"user");return _9.Bind((new bg.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:1790003096",[bF]),function(cy){return cy==null?(cf((function(cz){return function(cA){return cz("Sorry I was not able to add the user "+_2.toSafe(cA)+" to the system.");};}(a.id))(bF)),_9.Zero()):(ci("user",bF),cf((function(cz){return function(cA){return cz("Hello "+_2.prettyPrint(cA)+", nice to meet you.");};}(a.id))(bm.get_Item("user"))),_9.Zero());});})),null):bq.$==1&&(bL=u.No(bq.$0),bL!=null&&bL.$==1&&(bM=ct("addUser",bL.$0),bM!=null&&bM.$==1&&(bN=cv(bM.$0[1]),bN!=null&&bN.$==1&&(bq.$1.$==0&&(bK=bN.$0,true)))))?cf((function(cy){return function(cz){return cy("Ok I did not add the user "+_2.toSafe(cz)+". But you must login for me to help you.");};}(a.id))(bK)):bq.$==1&&((bP=cu(bq.$0),bP!=null&&bP.$==1)&&bq.$1.$==0)?cf("Could you introduce yourself so we can get started?"):bq.$==1&&(bR=cr(bq.$0),bR!=null&&bR.$==1&&(bS=u.Intent$1("hello",bR.$0),bS!=null&&bS.$==1&&(bS.$0[0]==null&&(bT=u.Entity1Of1("contact",bS.$0[1]),bT!=null&&bT.$==1&&(bq.$1.$==0&&(bQ=bT.$0,true))))))?_9.Start((bU=null,_9.Delay(function(){return _9.Bind((new bg.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:-1249169759",[bQ.get_Value()]),function(cy){return cy==null?(cf((function(cz){return function(cA){return cz("Sorry, the user "+_2.toSafe(cA)+" does not exist.");};}(a.id))(bQ.get_Value())),_9.Zero()):(co("switchUser",cy.$0.Name),_9.Zero());});})),null):bq.$==1&&(bW=u.Yes(bq.$0),bW!=null&&bW.$==1&&(bX=cs("switchUser",bW.$0),bX!=null&&bX.$==1&&(bY=cv(bX.$0[1]),bY!=null&&bY.$==1&&(bq.$1.$==0&&(bV=bY.$0,true)))))?(bm.set_Item("user",bV),cf((function(cy){return function(cz){return cy("Ok I switched to user "+_2.prettyPrint(cz)+".");};}(a.id))(bV))):bq.$==1&&(b0=u.No(bq.$0),b0!=null&&b0.$==1&&(b1=cs("switchUser",b0.$0),b1!=null&&b1.$==1&&(b2=cv(b1.$0[1]),b2!=null&&b2.$==1&&(bq.$1.$==0&&(bZ=b2.$0,true)))))?cf((function(cy){return function(cz){return cy("Ok I did not switch to user "+_2.toSafe(cz)+".");};}(a.id))(bZ)):bq.$==1&&(b4=cr(bq.$0),b4!=null&&b4.$==1&&(b5=u.Intent$1("symptom",b4.$0),b5!=null&&b5.$==1&&(b6=u.Entity1OfAny("symptom_name",b5.$0[1]),b6!=null&&b6.$==1&&(bq.$1.$==0&&(b3=b6.$0,true)))))?_9.Start((b7=null,_9.Delay(function(){cf("Ok I'll add that entry to your symptom journal");cw(b3.get_Value(),null,null);return _9.Bind(cx(ck().Name),function(){co("painVideo","");return _9.Zero();});})),null):bq.$==1&&(b9=u.Yes(bq.$0),b9!=null&&b9.$==1&&((b_=cs("painVideo",b9.$0),b_!=null&&b_.$==1)&&bq.$1.$==0))?bl["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bq.$==1&&(ca=cr(bq.$0),ca!=null&&ca.$==1&&(cb=u.Intent$1("medjournal",ca.$0),cb!=null&&cb.$==1&&((cc=cb.$0[1],cc!=null&&cc.$==1)&&(bq.$1.$==0&&(b$=cb.$0[1].$0,true)))))?(cf("ok I added that entry to your medication journal."),cf("You should be careful not to take too many painkillers over a short period of time.")):(cl(),P.debug("Main interpreter did not understand utterance."),cf("Sorry I didn't understand what you meant."),bn.length>0?(cd=_7.nth(0,bn),ch(cd.get_Name())?cf(d.replace_tok("$0",bm.get_Item(cd.get_Name()),cd.get_Text())):cf(cd.get_Text())):void 0);P.debug((((_1.Curried3(function(cy,cz,cA){return cy("Ending utterances: "+_2.prettyPrint(cz)+". Ending questions:"+_2.prettyPrint(cA)+".");}))(a.id))(bp))(bn));};P.haveQuestion=function(bl){return _6.exists(function(bm){return bm.get_Name()===bl;},P.questions());};P.getQuestion=function(bl){return _7.tryFind(function(bm){return bm.get_Name()===bl;},P.questions());};P.questions=function(){Q.$cctor();return Q.questions;};P.debug=function(bl){d.debug("Main",bl);};Q.$cctor=function(){Q.$cctor=a.ignore;Q.questions=_6.ofArray([new z({$:0,$0:"addUser",$1:"Do you want me to add the user $0?"}),new z({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?"}),new z({$:0,$0:"painSurvey",$1:"Would you like to take a short survey on your pain symptoms so I can understand them better."}),new z({$:0,$0:"painVideo",$1:"Would you like to see a video about pain management that might help you?"}),new z({$:0,$0:"medReminder",$1:"Would you like me to add a reminder about your meds so you won't forget them later?"})]);};R.run=function(){var bl,bm;bl=_1.ThisFunc(function(bn,bo){return((R.Main().get_Text())(bn))(bo);});bm=R.Main().get_Options();a.$("#term").terminal(bl,bm);return Y.get_Empty();};R.Main=function(){S.$cctor();return S.Main;};R.initMic=function(bl){var bm,bn;R.set_CUI((bm={$:1,$0:new bh.Microphone(bi.getElementById("microphone"))},N.New(R.CUI().Voice,bm,R.CUI().Term,R.CUI().Avatar,R.CUI().Caption)));bn=R.CUI().Mic.$0;bn.onconnecting=function(){R.set_MicState(K.MicConnecting);return R.debug("Mic connecting...");};bn.ondisconnected=function(){R.set_MicState(K.MicDisconnected);return R.debug("Mic disconnected.");};bn.onaudiostart=function(){R.set_MicState(K.MicAudioStart);return R.debug("Mic audio start...");};bn.onaudioend=function(){R.set_MicState(K.MicAudioEnd);return R.debug("Mic audio end.");};bn.onerror=function(bo){R.set_MicState({$:6,$0:bo});return R.debug((function(bp){return function(bq){return bp("Mic error : "+_2.toSafe(bq)+".");};}(a.id))(bo));};bn.onready=function(){R.set_MicState(K.MicReady);return R.debug("Mic ready.");};bn.onresult=function(bo,bp){return R.ClientState().$==2?R.echo("I'm still trying to understand what you said before."):R.ClientState().$==0?d.error("Client is not intialized."):!(bo==null||bp==null)?(R.set_MicState({$:7,$0:bo,$1:bp}),R.debug((((_1.Curried3(function(bq,br,bs){return bq("Mic result: "+_2.prettyPrint(br)+" "+_2.prettyPrint(bs)+".");}))(a.id))(bo))(bp)),bl(bo,bp)):R.debug("Mic: No result returned.");};bn.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};R.sayRandom=function(bl,bm){R.say(J.getRandomPhrase(bm,bl));};R.say=function(bl){R.Responses().unshift(bl);R["say'"](bl);};R["say'"]=function(bl){R.CUI().Say(bl);};R.initSpeech=function(){var bl;bl=d.toArray(R.synth().getVoices());_5.length(bl)>0?(_5.iter(function(bm){if(bj.Equals(R.CUI().Voice,null)&&(bm.name.indexOf("Microsoft Zira")!=-1||bm.name.toLowerCase().indexOf("female")!=-1)){R.set_CUI(N.New({$:1,$0:bm},R.CUI().Mic,R.CUI().Term,R.CUI().Avatar,R.CUI().Caption));R.debug((function(bn){return function(bo){return bn("Using browser speech synthesis voice "+_2.toSafe(bo)+".");};}(a.id))(R.CUI().Voice.$0.name));}},bl),!bj.Equals(R.CUI().Voice,null)?(R.CUI().Avatar.nativeVoice=true,R.CUI().Avatar.nativeVoiceName=R.CUI().Voice.$0.name,R.debug((function(bm){return function(bn){return bm("Using browser speech synthesis voice "+_2.toSafe(bn)+".");};}(a.id))(R.CUI().Voice.$0.name))):void 0):void 0;bj.Equals(R.CUI().Voice,null)?R.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};R.synth=function(){S.$cctor();return S.synth;};R.push=function(bl){R.Utterances().unshift(bl);return R.Utterances();};R.Props=function(){S.$cctor();return S.Props;};R.Responses=function(){S.$cctor();return S.Responses;};R.Questions=function(){S.$cctor();return S.Questions;};R.Utterances=function(){S.$cctor();return S.Utterances;};R.wait=function(bl){d["Terminal.Echo'"](R.CUI().Term,"please wait");R.CUI().Term.pause();bl();R.CUI().Term.resume();};R.debug=function(bl){d.debug("CLIENT",bl);};R.echo=function(bl){d["Terminal.EchoHtml'"](R.CUI().Term,(function(bm){return function(bn){return bm(_2.prettyPrint(bn));};}(a.id))(bl));};R.ClientState=function(){S.$cctor();return S.ClientState;};R.set_ClientState=function(bl){S.$cctor();S.ClientState=bl;};R.MicState=function(){S.$cctor();return S.MicState;};R.set_MicState=function(bl){S.$cctor();S.MicState=bl;};R.CUI=function(){S.$cctor();return S.CUI;};R.set_CUI=function(bl){S.$cctor();S.CUI=bl;};S.$cctor=function(){var bl,bm,bn;S.$cctor=a.ignore;function bo(bq,br){var bs,bt,bu,bv,bw,bx,by,bz;R.debug((((_1.Curried3(function(bA,bB,bC){return bA("Voice: "+_2.prettyPrint(bB)+" "+_2.prettyPrint(bC));}))(a.id))(bq))(br));bs=(bt=A["Intent'"](bq,br),bt!=null&&bt.$==1?{$:1,$0:bt.$0}:null);bu=(bv=A["Trait'"](br),bv!=null&&bv.$==1?{$:1,$0:_6.ofArray([bv.$0])}:null);bw=(bx=A["Entity'$1"](br),bx!=null&&bx.$==1?{$:1,$0:_6.ofArray([bx.$0])}:null);bs==null&&(bu==null&&bw==null)?void 0:(R.debug(((((_1.Curried(function(bA,bB,bC,bD){return bA("Voice: "+T.p(bB)+" "+T.p$3(bC)+" "+T.p$5(bD));},4))(a.id))(bs))(bu))(bw)),bz=R.push(new y({$:0,$0:bs,$1:bu,$2:bw})),P.update(R.CUI(),R.Props(),R.Questions(),R.Responses(),bz));}function bp(bq,br){var bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE;R.set_CUI(N.New(R.CUI().Voice,R.CUI().Mic,bq,R.CUI().Avatar,R.CUI().Caption));bj.Equals(R.CUI().Mic,null)?R.initMic(bo):void 0;bj.Equals(R.CUI().Voice,null)?R.initSpeech():void 0;R.ClientState().$===0?R.set_ClientState(L.ClientReady):void 0;return(bs=C.Blank(br),bs!=null&&bs.$==1)?R["say'"]("Tell me what you want me to do or ask me a question."):(bt=C.Debug(br),bt!=null&&bt.$==1)?(R.debug((function(bF){return function(bG){return bF("Utterances: "+_2.prettyPrint(bG));};}(a.id))(R.Utterances())),R.debug((function(bF){return function(bG){return bF("Questions: "+_2.prettyPrint(bG));};}(a.id))(R.Questions())),bu=self.document.createElement("insert"),bv=Y.Element("div",[_8.Create("id","bar")],[]),X.LoadLocalTemplates(""),Y.RunAppend(bu,bv),R.debug(bu.innerHTML)):(bw=C.Voices(br),bw!=null&&bw.$==1)?(bx=d.toArray(d.speechSynthesis().getVoices()),(R["say'"]((function(bF){return function(bG){return bF("There are currently "+a.String(bG)+" voices installed on this computer or device.");};}(a.id))(_5.length(bx))),_5.iteri(function(bF,bG){return R["say'"](((((_1.Curried(function(bH,bI,bJ,bK){return bH("Voice "+a.String(bI)+". Name: "+_2.toSafe(bJ)+", Local: "+_2.prettyPrint(bK)+".");},4))(a.id))(bF))(bG.name))(bG.localService));},bx))):R.ClientState().$==1?(bz=C.QuickHello(br),bz!=null&&bz.$==1?(by=bz.$0,true):(bA=C.QuickHelp(br),bA!=null&&bA.$==1?(by=bA.$0,true):(bB=C.QuickYes(br),bB!=null&&bB.$==1?(by=bB.$0,true):(bC=C.QuickNo(br),bC!=null&&bC.$==1&&(by=bC.$0,true)))))?(R.debug((function(bF){return function(bG){return bF("Quick Text: "+T.p$7(bG)+".");};}(a.id))(by)),bD=R.push(by),P.update(R.CUI(),R.Props(),R.Questions(),R.Responses(),bD),R.set_ClientState(L.ClientReady)):R.CUI().Wait((bE=null,_9.Delay(function(){R.set_ClientState(L.ClientUnderstand);C.getUtterance(br,function(bF){var bG,bH,bI;bG=C.HasUtterance(bF);bG!=null&&bG.$==1?(bH=bG.$0,R.debug(((((_1.Curried(function(bJ,bK,bL,bM){return bJ("Text: Intent: "+T.p(bK)+", Traits: "+T.p$3(bL)+", Entities: "+T.p$5(bM));},4))(a.id))(bH.get_Intent()))(bH.get_Traits()))(bH.get_Entities())),bI=R.push(bH),P.update(R.CUI(),R.Props(),R.Questions(),R.Responses(),bI)):(R.debug("Text: Did not receive a meaning from the server."),R["say'"]("Sorry I did not understand what you said."));});R.set_ClientState(L.ClientReady);return _9.Zero();}))):R.ClientState().$==0?d.error("Client is not initialized."):R["say'"]("I'm still trying to understand what you said before.");}S.CUI=N.New(null,null,null,(bc.applicationId="4277115329081938617",bl=new a.SDKConnection(),bm=new a.WebAvatar(),bm.version=8.5,bm.connection=bl,bm.avatar="20926186",bm.voice="cmu-slt",bm.voiceMod="default",bm.width=175,bm.createBox(),bm.addMessage(""),bm.processMessages(0),bm),false);S.MicState=K.MicNotInitialized;S.ClientState=L.ClientNotInitialzed;S.Utterances=[];S.Questions=[];S.Responses=[];S.Props=new bk.New$5();S.synth=a.speechSynthesis;S.Main=new M({$:0,$0:function(bq){return bo(bq[0],bq[1]);},$1:[function(bq){return function(br){return bp(bq,br);};},(bn={},bn.name="Main",bn.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bn.prompt=">",bn)]});};T.p$8=function(bl){return"Question ("+_2.prettyPrint(bl.$0)+", "+_2.prettyPrint(bl.$1)+")";};T.p$2=function(bl){return bl==null?"null":"Some "+_2.prettyPrint(bl.$0);};T.p$1=function(bl){return"Intent ("+_2.prettyPrint(bl.$0)+", "+T.p$2(bl.$1)+")";};T.p=function(bl){return bl==null?"null":"Some "+T.p$1(bl.$0);};T.p$4=function(bl){return"Trait ("+_2.prettyPrint(bl.$0)+", "+_2.prettyPrint(bl.$1)+", "+T.p$2(bl.$2)+")";};T.p$3=function(bl){return bl==null?"null":"Some "+_2.printList(function(bm){return T.p$4(bm);},bl.$0);};T.p$6=function(bl){return"Entity ("+_2.prettyPrint(bl.$0)+", "+_2.prettyPrint(bl.$1)+", "+T.p$2(bl.$2)+")";};T.p$5=function(bl){return bl==null?"null":"Some "+_2.printList(function(bm){return T.p$6(bm);},bl.$0);};T.p$7=function(bl){return"Utterance ("+T.p(bl.$0)+", "+T.p$3(bl.$1)+", "+T.p$5(bl.$2)+")";};}());
