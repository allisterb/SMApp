(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.ClientExtensions=c.ClientExtensions||{};e=c._Html=c._Html||{};f=c.htmModule=c.htmModule||{};g=a.StartupCode$SMApp_Web$ClientExtensions=a.StartupCode$SMApp_Web$ClientExtensions||{};h=c.Bs=c.Bs||{};i=b.NLU=b.NLU||{};j=i.Babelfy=i.Babelfy||{};k=j.ApiResponse=j.ApiResponse||{};l=j.TokenFragment=j.TokenFragment||{};m=j.CharFragment=j.CharFragment||{};n=i.Witai=i.Witai||{};o=n.Utterance=n.Utterance||{};p=n.Intent=n.Intent||{};q=n.Entity=n.Entity||{};r=n.Trait=n.Trait||{};s=n["Utterance'"]=n["Utterance'"]||{};t=n["Value'"]=n["Value'"]||{};u=i.QnAMaker=i.QnAMaker||{};v=u.ITSQuestion=u.ITSQuestion||{};w=u.ITSAnswerContext=u.ITSAnswerContext||{};x=u.ITSAnswer=u.ITSAnswer||{};y=u.ITSAnswers=u.ITSAnswers||{};z=c.TypingDNA=c.TypingDNA||{};A=z.Response=z.Response||{};B=c.NLG=c.NLG||{};C=a.StartupCode$SMApp_Web$NLG=a.StartupCode$SMApp_Web$NLG||{};D=c.NLU=c.NLU||{};E=D.Intent=D.Intent||{};F=D.Trait=D.Trait||{};G=D.Entity=D.Entity||{};H=D.Utterance=D.Utterance||{};I=D.Question=D.Question||{};J=D.Voice=D.Voice||{};K=J["Entity'"]=J["Entity'"]||{};L=D.Text=D.Text||{};M=L["Utterance'"]=L["Utterance'"]||{};N=L["Intent'"]=L["Intent'"]||{};O=L["Entity'"]=L["Entity'"]||{};P=L["Trait'"]=L["Trait'"]||{};Q=D.Domain=D.Domain||{};R=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};S=c.CUI=c.CUI||{};T=S.MicState=S.MicState||{};U=S.ClientState=S.ClientState||{};V=S.Interpreter=S.Interpreter||{};W=S.CUI=S.CUI||{};X=c.Dialogue=c.Dialogue||{};Y=X.Dialogue=X.Dialogue||{};Z=c.Main=c.Main||{};_0=a.StartupCode$SMApp_Web$Main=a.StartupCode$SMApp_Web$Main||{};_1=c.Client=c.Client||{};_2=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};_3=a.GeneratedPrintf=a.GeneratedPrintf||{};_4=a.SMApp$Web_GeneratedPrintf=a.SMApp$Web_GeneratedPrintf||{};_5=a.WebSharper;_6=_5&&_5.UI;_7=_6&&_6.Client;_8=_7&&_7.Templates;_9=_6&&_6.Doc;_=_6&&_6.AttrProxy;$=_5&&_5.Arrays;ba=a.IntelliFactory;bb=ba&&ba.Runtime;bc=_5&&_5.Utils;bd=a.console;be=a.jQuery;bf=_5&&_5.Strings;bg=_5&&_5.List;bh=_5&&_5.Seq;bi=_6&&_6.AttrModule;bj=_5&&_5.Concurrency;bk=a.JSON;bl=_5&&_5.Random;bm=_5&&_5.Collections;bn=bm&&bm.Map;bo=_5&&_5.JavaScript;bp=bo&&bo.Pervasives;bq=a.SDK;br=_5&&_5.Operators;bs=_5&&_5.Remoting;bt=bs&&bs.AjaxRemotingProvider;bu=a.Wit;bv=a.document;bw=_5&&_5.Unchecked;bx=bm&&bm.Dictionary;d.speechSynthesis=function(){return a.speechSynthesis;};d.elementHTML=function(by){return by.innerHTML;};d.createElement=function(by){var bz;bz=self.document.createElement("div");_8.LoadLocalTemplates("");_9.RunAppend(bz,by);};d.container=function(by){return _9.Element("div",[d.cls("container")],by);};d.dindex=function(by){return _.Create("data-index",a.String(by));};d.cls=function(by){return _.Create("class",by);};d.eid=function(by){return _.Create("id",by);};d.termOutput=function(){return $.get(a.jQuery(".terminal-output").get(),0);};d.toLower=function(by){return by.toLowerCase();};d.debug=function(by,bz){d.info((((bb.Curried3(function(bA,bB,bC){return bA("DEBUG: "+bc.toSafe(bB)+": "+bc.prettyPrint(bC));}))(a.id))(by.toUpperCase()))(bz));};d.error=function(by){bd.error(by);};d.info=function(by){bd.info(by);};d.jserror=function(by){be.error(by);};d.toArray=function(by){return $.map(a.id,be.makeArray(by));};d["Terminal.EchoHtml'"]=function(by,bz){by.pause();by.echo(bz,d.rawOpt());by.resume();};d["Terminal.Echo'"]=function(by,bz){by.pause();by.echo(bz);by.resume();};d.rawOpt=function(){g.$cctor();return g.rawOpt;};e=c._Html=bb.Class({toString:function(){return e.toString(this);}},null,e);e.toString=function(by){function bz(bA){return function(bB){var bC,bD,bE,bF,bG,bH,bI;bD=bf.replicate(bA," ");switch(bB.$==0?bB.$1.$==1?bB.$1.$0.$==2?bB.$1.$1.$==0?(bC=[bB.$1.$0.$0,bB.$0],1):(bC=[bB.$1,bB.$0],2):(bC=[bB.$1,bB.$0],2):(bC=[bB.$1,bB.$0],2):bB.$==2?(bC=bB.$0,3):(bC=[bB.$0,bB.$1],0)){case 0:return bC[0]+"=\""+bC[1]+"\"";case 1:bE=bC[1];return bD+"<"+bE+">"+bC[0]+"</"+bE+">\r\n";case 2:bF=bC[1];bG=bg.partition(function(bJ){return bJ.$==1;},bC[0]);bH=bG[1];bI=bG[0];return bH.$==0?bD+"<"+bF+(bI.$===0?"":" "+bf.concat(" ",bg.ofSeq(bh.delay(function(){return bh.map(function(bJ){return(bz(0))(bJ);},bI);}))))+"/>\r\n":bD+"<"+bF+(bI.$===0?"":" "+bf.concat(" ",bg.ofSeq(bh.delay(function(){return bh.map(function(bJ){return(bz(0))(bJ);},bI);}))))+">\r\n"+bf.concat("",bg.ofSeq(bh.delay(function(){return bh.map(function(bJ){return(bz(bA+1))(bJ);},bH);})))+bD+"</"+bF+">\r\n";case 3:return bD+bC+"\r\n";}};}return(bz(0))(by);};f.alt=function(by){return new e({$:1,$0:"alt",$1:by});};f.src=function(by){return new e({$:1,$0:"src",$1:by});};f.cls=function(by){return new e({$:1,$0:"class",$1:by});};f.str=function(by){return e.toString(by);};f.op_PercentEquals=function(by,bz){return new e({$:1,$0:by,$1:bz});};f.op_Splice=function(by){var bz;return bg.ofArray([new e({$:2,$0:(bz=by,a.String(bz))})]);};f.strong=function(){g.$cctor();return g.strong;};f.h4=function(){g.$cctor();return g.h4;};f.h3=function(){g.$cctor();return g.h3;};f.h2=function(){g.$cctor();return g.h2;};f.h1=function(){g.$cctor();return g.h1;};f.li=function(){g.$cctor();return g.li;};f.ul=function(){g.$cctor();return g.ul;};f.th=function(){g.$cctor();return g.th;};f.td=function(){g.$cctor();return g.td;};f.tr=function(){g.$cctor();return g.tr;};f.a=function(){g.$cctor();return g.a;};f.p=function(){g.$cctor();return g.p;};f.area=function(){g.$cctor();return g.area;};f.map=function(){g.$cctor();return g.map;};f.img=function(){g.$cctor();return g.img;};f.tfoot=function(){g.$cctor();return g.tfoot;};f.tbody=function(){g.$cctor();return g.tbody;};f.thead=function(){g.$cctor();return g.thead;};f.table=function(){g.$cctor();return g.table;};f.span=function(){g.$cctor();return g.span;};f.section=function(){g.$cctor();return g.section;};f.br=function(){g.$cctor();return g.br;};f.div=function(){g.$cctor();return g.div;};f.body=function(){g.$cctor();return g.body;};f.style=function(){g.$cctor();return g.style;};f.title=function(){g.$cctor();return g.title;};f.head=function(){g.$cctor();return g.head;};f.html=function(){g.$cctor();return g.html;};f.elem=function(by,bz){return new e({$:0,$0:by,$1:bz});};g.$cctor=function(){var by;g.$cctor=a.ignore;g.rawOpt=(by={},by.raw=true,by);g.html=function(bz){return f.elem("html",bz);};g.head=function(bz){return f.elem("head",bz);};g.title=function(bz){return f.elem("title",bz);};g.style=function(bz){return f.elem("style",bz);};g.body=function(bz){return f.elem("body",bz);};g.div=function(bz){return f.elem("div",bz);};g.br=function(bz){return f.elem("br",bz);};g.section=function(bz){return f.elem("section",bz);};g.span=function(bz){return f.elem("span",bz);};g.table=function(bz){return f.elem("table",bz);};g.thead=function(bz){return f.elem("thead",bz);};g.tbody=function(bz){return f.elem("tbody",bz);};g.tfoot=function(bz){return f.elem("tfoot",bz);};g.img=function(bz){return f.elem("img",bz);};g.map=function(bz){return f.elem("map",bz);};g.area=function(bz){return f.elem("area",bz);};g.p=function(bz){return f.elem("p",bz);};g.a=function(bz){return f.elem("a",bz);};g.tr=function(bz){return f.elem("tr",bz);};g.td=function(bz){return f.elem("td",bz);};g.th=function(bz){return f.elem("th",bz);};g.ul=function(bz){return f.elem("ul",bz);};g.li=function(bz){return f.elem("li",bz);};g.h1=function(bz){return f.elem("h1",bz);};g.h2=function(bz){return f.elem("h1",bz);};g.h3=function(bz){return f.elem("h1",bz);};g.h4=function(bz){return f.elem("h1",bz);};g.strong=function(bz){return f.elem("strong",bz);};};h.Radio=function(by,bz,bA,bB,bC){return _9.Element("div",new bg.T({$:1,$0:d.cls("radio"),$1:bz}),[_9.Element("label",bB,[_9.Radio(bC,true,bA),_9.TextNode(by)])]);};h.checkbox=function(by,bz,bA,bB,bC){return _9.Element("div",new bg.T({$:1,$0:d.cls("checkbox"),$1:bz}),[_9.Element("label",bB,[_9.CheckBox(bC,bA),_9.TextNode(by)])]);};h.textArea=function(by,bz,bA,bB,bC){return _9.Element("div",new bg.T({$:1,$0:d.cls("form-group"),$1:bz}),[_9.Element("label",bB,[_9.TextNode(by)]),_9.InputArea(new bg.T({$:1,$0:d.cls("form-control"),$1:bC}),bA)]);};h.inputPassword=function(by,bz,bA,bB,bC){return _9.Element("div",new bg.T({$:1,$0:d.cls("form-group"),$1:bz}),[_9.Element("label",bB,[_9.TextNode(by)]),_9.PasswordBox(new bg.T({$:1,$0:d.cls("form-control"),$1:bC}),bA)]);};h.input=function(by,bz,bA,bB,bC){return _9.Element("div",new bg.T({$:1,$0:d.cls("form-group"),$1:bz}),[_9.Element("label",bB,[_9.TextNode(by)]),_9.Input([d.cls("form-control"),bC],bA)]);};h.btnSecondary=function(by,bz,bA){return _9.Element("button",[d.eid(by),d.cls("btn btn-secondary"),bi.Handler("click",bA)],[_9.TextNode(bz)]);};h.btnPrimary=function(by,bz,bA){return _9.Element("button",[d.eid(by),d.cls("btn btn-primary"),bi.Handler("click",bA)],[_9.TextNode(bz)]);};k.New=function(by,bz,bA,bB,bC,bD,bE,bF,bG){return{tokenFragment:by,charFragment:bz,babelSynsetID:bA,DBpediaURL:bB,BabelNetURL:bC,score:bD,cohrenceScore:bE,globalScore:bF,source:bG};};l.New=function(by,bz){return{start:by,end:bz};};m.New=function(by,bz){return{start:by,end:bz};};j.disambiguate=function(by){function bz(bA,bB){var bC;be.ajax((bC={},bC.url=(function(bD){return function(bE){return bD("https://babelfy.io/v1/disambiguate?text="+bc.toSafe(bE)+"&lang=EN&extAIDA=true&key=983fc0ec-a6fa-49ef-bd02-203c18aef272");};}(a.id))(by),bC.type="GET",bC.success=function(bD){return bA(bD);},bC.error=function(bD){return bB(new a.Error(bD.responseText));},bC));}return bj.FromContinuations(function(bA,bB,bC){return bz.apply(null,[bA,bB,bC]);});};o.New=function(by,bz,bA,bB){return{text:by,intents:bz,entities:bA,traits:bB};};p.New=function(by,bz,bA){return{id:by,name:bz,confidence:bA};};q.New=function(by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI){return{id:by,name:bz,role:bA,start:bB,end:bC,body:bD,confidence:bE,entities:bF,suggested:bG,value:bH,type:bI};};r.New=function(by,bz,bA){return{id:by,value:bz,confidence:bA};};s.New=function(by){return{intent:by};};t.New=function(by){return{value:by};};n.getMeaning2=function(by,bz){function bA(bB,bC){var bD;be.ajax((bD={},bD.url=(function(bE){return function(bF){return bE("https://api.wit.ai/message?q="+bc.toSafe(bF));};}(a.id))(bz),bD.type="GET",bD.beforeSend=function(bE){return bE.setRequestHeader("Authorization","Bearer "+by);},bD.success=function(bE){return bB(bE);},bD.error=function(bE){return bC(new a.Error(bE.responseText));},bD));}return bj.FromContinuations(function(bB,bC,bD){return bA.apply(null,[bB,bC,bD]);});};n.getMeaning=function(by,bz,bA,bB){var bC;be.ajax((bC={},bC.url=(function(bD){return function(bE){return bD("https://api.wit.ai/message?q="+bc.toSafe(bE));};}(a.id))(bz),bC.type="GET",bC.beforeSend=function(bD){return bD.setRequestHeader("Authorization","Bearer "+by);},bC.success=bA,bC.error=bB,bC));};v.New=function(by){return{question:by};};w.New=function(by,bz){return{isContextOnly:by,prompts:bz};};x.New=function(by,bz,bA,bB,bC,bD,bE){return{questions:by,answer:bz,score:bA,id:bB,source:bC,metadata:bD,context:bE};};y.New=function(by){return{answers:by};};u.getAnswer=function(by){function bz(bA,bB){var bC;be.ajax((bC={},bC.url="https://lerna.azurewebsites.net/qnamaker/knowledgebases/13a6a026-942b-4612-a8cb-654086ec76ee/generateAnswer",bC.type="POST",bC.beforeSend=function(bD){return bD.setRequestHeader("Authorization","EndpointKey e5a55563-b1b0-4343-8796-bda5a0509385");},bC.contentType="application/json",bC.dataType="json",bC.data=bk.stringify(v.New(by)),bC.success=function(bD){return bA(bD);},bC.error=function(bD){return bB(new a.Error(bD.responseText));},bC));}return bj.FromContinuations(function(bA,bB,bC){return bz.apply(null,[bA,bB,bC]);});};A.New=function(by,bz,bA,bB){return{name:by,message:bz,message_code:bA,status:bB};};B.waitAddPhrases=function(){C.$cctor();return C.waitAddPhrases;};B.waitRetrievePhrases=function(){C.$cctor();return C.waitRetrievePhrases;};B.helpPhrases=function(){C.$cctor();return C.helpPhrases;};B.helloUserPhrases=function(){C.$cctor();return C.helloUserPhrases;};B.helloPhrases=function(){C.$cctor();return C.helloPhrases;};B["getRandomPhrase'"]=function(by){return B.replace_tok("$0","",bh.nth(B.rng().Next(0,by.get_Length()),by));};B.getRandomPhrase=function(by,bz){return B.replace_tok("$0",bz,bh.nth(B.rng().Next(0,by.get_Length()),by));};B.replace_tok=function(by,bz,bA){return bf.Replace(bA,by,bz);};B.rng=function(){C.$cctor();return C.rng;};C.$cctor=function(){C.$cctor=a.ignore;C.rng=new bl.New();C.helloPhrases=bg.ofArray(["Welcome!","Welcome, my name is Selma.","Welcome to Selma. How can I help?","Hello this is Selma, how can I help?","Hello, I am Selma. How can I help?","Hello, I am Selma. How may I help you now?","I'm Selma. Tell me your name so we can get started."]);C.helloUserPhrases=bg.ofArray(["Hello $0, welcome back.","Welcome $0, nice to see you again.","Hello $0.","Good to see you $0.","Hello $0, nice to see you."]);C.helpPhrases=bg.ofArray(["What can I help you with $0?"]);C.waitRetrievePhrases=bg.ofArray(["Ok, let me check that $0 for you","Please wait while I check that $0 for you.","Wait while I check that $0.","Ok let me see if I can find that $0."]);C.waitAddPhrases=bg.ofArray(["Ok, let me add that $0 for you","Please wait while I add that $0 for you.","Wait while I add that $0.","I'll add that $0 now."]);};E=D.Intent=bb.Class({toString:function(){return(((bb.Curried3(function(by,bz,bA){return by("Intent("+bc.toSafe(bz)+", "+_4.p$2(bA)+")");}))(a.id))(this.get_Name()))(this.get_Confidence());},get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,E);F=D.Trait=bb.Class({toString:function(){return(((bb.Curried3(function(by,bz,bA){return by("Trait("+bc.toSafe(bz)+", "+bc.prettyPrint(bA)+")");}))(a.id))(this.get_Name()))(this.get_Value());},get_Confidence:function(){return this.$2;},get_Value:function(){return this.$1;},get_Name:function(){return this.$0;}},null,F);G=D.Entity=bb.Class({toString:function(){return(((((bb.Curried(function(by,bz,bA,bB,bC){return by("Entity("+bc.toSafe(bz)+", "+bc.toSafe(bA)+", "+bc.toSafe(bB)+", "+_4.p$2(bC)+")");},5))(a.id))(this.get_Name()))(this.get_Role()))(this.get_Value()))(this.get_Confidence());},get_Confidence:function(){return this.$3;},get_Value:function(){return this.$2;},get_Role:function(){return this.$1;},get_Name:function(){return this.$0;}},null,G);H=D.Utterance=bb.Class({toString:function(){return((((bb.Curried(function(by,bz,bA,bB){return by(_4.p(bz)+" "+_4.p$3(bA)+" "+_4.p$5(bB));},4))(a.id))(this.get_Intent()))(this.get_Traits()))(this.get_Entities());},get_Entities:function(){var by;by=this.$3;return by!=null?{$:1,$0:bg.sortBy(function(bz){return bz.get_Name();},by.$0)}:null;},get_Traits:function(){var by;by=this.$2;return by!=null?{$:1,$0:bg.sortBy(function(bz){return bz.get_Name();},by.$0)}:null;},get_Intent:function(){return this.$1;},get_Text:function(){return this.$0;}},null,H);I=D.Question=bb.Class({toString:function(){return(((bb.Curried3(function(by,bz,bA){return by("Name: "+bc.toSafe(bz)+" Text: "+bc.toSafe(bA));}))(a.id))(this.get_Name()))(this.get_Text());},get_Type:function(){return this.$2;},get_Text:function(){return this.$1;},get_Name:function(){return this.$0;}},null,I);K.New=function(by,bz,bA,bB,bC){return{body:by,end:bz,start:bA,suggested:bB,value:bC};};J["Intent'"]=function(by,bz){return!(bz.intent==null)?{$:1,$0:new E({$:0,$0:d.toLower(bz.intent.value),$1:null})}:null;};J["Trait'"]=function(by){return!(by.domain==null)?{$:1,$0:new F({$:0,$0:"domain",$1:d.toLower(by.domain.value),$2:null})}:!(by.dialogue_act==null)?{$:1,$0:new F({$:0,$0:"dialogue_act",$1:d.toLower(by.dialogue_act.value),$2:null})}:null;};J["Entity'$1"]=function(by){return!(by.contact==null)?{$:1,$0:new G({$:0,$0:"contact",$1:"",$2:d.toLower(by.contact.value),$3:null})}:null;};M=L["Utterance'"]=bb.Class({get_TopIntent:function(){return bg.head(bg.sortBy(function(by){return by.get_Confidence();},this.get_Intents()));},get_Traits:function(){return this.$3;},get_Entities:function(){return this.$2;},get_Intents:function(){return this.$1;},get_Text:function(){return this.$0;}},null,M);N=L["Intent'"]=bb.Class({get_Confidence:function(){return this.$1;},get_Name:function(){return this.$0;}},null,N);O=L["Entity'"]=bb.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,O);P=L["Trait'"]=bb.Class({get_Value:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2];}},null,P);L.HasUtterance=function(by){var bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM;return by!=null&&by.$==1&&(by.$0.$1.$==0&&(by.$0.$2.get_Length()>0&&(bz=[by.$0.$2,by.$0.$0,by.$0.$3],true)))?(bA=bg.map(function(bN){return new G({$:0,$0:bN.get_Name(),$1:d.toLower(bN.get_Role()),$2:bN.get_Value(),$3:{$:1,$0:bN.get_Confidence()}});},bg.filter(function(bN){return bN.get_Confidence()>L.entityConfidenceThreshold();},bz[0])),{$:1,$0:new H({$:0,$0:bz[1],$1:null,$2:{$:1,$0:bg.map(function(bN){return new F({$:0,$0:d.toLower(bN.get_Name()),$1:bN.get_Value(),$2:{$:1,$0:bN.get_Confidence()}});},bg.filter(function(bN){return bN.get_Confidence()>L.entityConfidenceThreshold();},bz[2]))},$3:{$:1,$0:bA}})}):by!=null&&by.$==1&&(by.$0.$2.$==0&&(by.$0.$3.$==0&&(by.$0.$1.get_Length()>0&&by.$0.get_TopIntent().get_Confidence()>L.intentConfidenceThreshold()&&(bB=[by.$0.$1,by,by.$0.$0],true))))?(bC=bB[1],{$:1,$0:new H({$:0,$0:bB[2],$1:{$:1,$0:new E({$:0,$0:d.toLower(bC.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bC.$0.get_TopIntent().get_Confidence()}})},$2:null,$3:null})}):by!=null&&by.$==1&&(by.$0.$3.$==0&&(by.$0.$1.get_Length()>0&&by.$0.get_TopIntent().get_Confidence()>L.intentConfidenceThreshold()&&(bD=[by.$0.$1,by,by.$0.$0],true)))?(bE=bD[1],(bF=bg.map(function(bN){return new G({$:0,$0:bN.get_Name(),$1:d.toLower(bN.get_Role()),$2:bN.get_Value(),$3:{$:1,$0:bN.get_Confidence()}});},bg.filter(function(bN){return bN.get_Confidence()>L.entityConfidenceThreshold();},bE.$0.get_Entities())),{$:1,$0:new H({$:0,$0:bD[2],$1:{$:1,$0:new E({$:0,$0:d.toLower(bE.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bE.$0.get_TopIntent().get_Confidence()}})},$2:null,$3:{$:1,$0:bF}})})):by!=null&&by.$==1&&(by.$0.$2.$==0&&(by.$0.$1.get_Length()>0&&by.$0.get_TopIntent().get_Confidence()>L.intentConfidenceThreshold()&&(bG=[by.$0.$1,by,by.$0.$0],true)))?(bH=bG[1],(bI=bg.map(function(bN){return new F({$:0,$0:d.toLower(bN.get_Name()),$1:bN.get_Value(),$2:{$:1,$0:bN.get_Confidence()}});},bg.filter(function(bN){return bN.get_Confidence()>L.entityConfidenceThreshold();},bH.$0.get_Traits())),{$:1,$0:new H({$:0,$0:bG[2],$1:{$:1,$0:new E({$:0,$0:d.toLower(bH.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bH.$0.get_TopIntent().get_Confidence()}})},$2:{$:1,$0:bI},$3:null})})):by!=null&&by.$==1&&(by.$0.$1.get_Length()>0&&by.$0.get_TopIntent().get_Confidence()>L.intentConfidenceThreshold()&&(bJ=[by.$0.$1,by,by.$0.$0],true))?(bK=bJ[1],(bL=bg.map(function(bN){return new G({$:0,$0:bN.get_Name(),$1:d.toLower(bN.get_Role()),$2:bN.get_Value(),$3:{$:1,$0:bN.get_Confidence()}});},bg.filter(function(bN){return bN.get_Confidence()>L.entityConfidenceThreshold();},bK.$0.get_Entities())),(bM=bg.map(function(bN){return new F({$:0,$0:d.toLower(bN.get_Name()),$1:bN.get_Value(),$2:{$:1,$0:bN.get_Confidence()}});},bg.filter(function(bN){return bN.get_Confidence()>L.entityConfidenceThreshold();},bK.$0.get_Traits())),{$:1,$0:new H({$:0,$0:bJ[2],$1:{$:1,$0:new E({$:0,$0:d.toLower(bK.$0.get_TopIntent().get_Name()),$1:{$:1,$0:bK.$0.get_TopIntent().get_Confidence()}})},$2:{$:1,$0:bM},$3:{$:1,$0:bL}})}))):null;};L.entityConfidenceThreshold=function(){R.$cctor();return R.entityConfidenceThreshold;};L.set_entityConfidenceThreshold=function(by){R.$cctor();R.entityConfidenceThreshold=by;};L.intentConfidenceThreshold=function(){R.$cctor();return R.intentConfidenceThreshold;};L.set_intentConfidenceThreshold=function(by){R.$cctor();R.intentConfidenceThreshold=by;};L.getUtterance2=function(by){var bz;bz=null;return bj.Delay(function(){return bj.Bind(n.getMeaning2("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT",by),function(bA){d.debug("NLU",(function(bB){return function(bC){return bB("Wit.ai returned "+_3.p(bC)+" ");};}(a.id))(bA));return bj.Return(new M({$:0,$0:by,$1:bg.ofArray($.map(function(bB){return new N({$:0,$0:bB.name,$1:bB.confidence});},bA.intents)),$2:bg.map(function(bB){return new O({$:0,$0:bB.name,$1:bB.confidence,$2:bB.role,$3:bB.value});},bg.ofSeq(bh.concat(bh.map(function(bB){return bB[1];},bn.ToSeq(bA.entities))))),$3:bg.ofSeq(bh.map(function(bB){var bC;bC=bB[1];return new P({$:0,$0:bB[0],$1:$.get(bC,0).confidence,$2:$.get(bC,0).value});},bn.ToSeq(bA.traits)))}));});});};L.getUtterance=function(by,bz){n.getMeaning("OOGDHEQL7JZRQASXN2N2GHFUKGO3SCNV",by,function(bA){var bB,bC;d.debug("NLU",(function(bD){return function(bE){return bD("Wit.ai returned: "+bc.prettyPrint(bE));};}(a.id))(bA));bB=!(bA.intents==null)?bg.ofArray($.map(function(bD){return new N({$:0,$0:bD.name,$1:bD.confidence});},bA.intents)):bg.T.Empty;bC=!(bA.traits==null)?bg.ofSeq(bh.concat(bg.map(function(bD){return $.map(function(bE){return new P({$:0,$0:bD,$1:bE.confidence,$2:bE.value});},bp.GetJS(bA.traits,[bD]));},bg.filter(function(bD){return!(bp.GetJS(bA.traits,[bD])==null);},L.trait_types())))):bg.T.Empty;return bz({$:1,$0:new M({$:0,$0:by,$1:bB,$2:!(bA.entities==null)?bg.ofSeq(bh.concat(bg.map(function(bD){return $.map(function(bE){return new O({$:0,$0:bE.name,$1:bE.confidence,$2:bE.role,$3:bE.value});},bp.GetJS(bA.entities,[bD]));},bg.filter(function(bD){return!(bp.GetJS(bA.entities,[bD])==null);},L.entity_types())))):bg.T.Empty,$3:bC})});},function(bA,bB,bC){d.error((((bb.Curried3(function(bD,bE,bF){return bD("Wit.ai returned: "+bc.prettyPrint(bE)+" "+bc.prettyPrint(bF));}))(a.id))(bB))(bC));return bz(null);});};L.trait_types=function(){R.$cctor();return R.trait_types;};L.entity_types=function(){R.$cctor();return R.entity_types;};L.QuickNumber=function(by){var bz,bA,bB;return(bA=L.One(by),bA!=null&&bA.$==1?(bz=bA.$0,true):(bB=L.Two(by),bB!=null&&bB.$==1&&(bz=bB.$0,true)))?{$:1,$0:bz}:null;};L.Three=function(by){var bz;return by==="3"||by==="three"?{$:1,$0:new H({$:0,$0:"three",$1:{$:1,$0:new E({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bg.ofArray([new G({$:0,$0:"wit/ordinal",$1:"",$2:"three",$3:{$:1,$0:1}})])}})}:null;};L.Two=function(by){var bz;return by==="2"||by==="two"?{$:1,$0:new H({$:0,$0:"two",$1:{$:1,$0:new E({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bg.ofArray([new G({$:0,$0:"wit/ordinal",$1:"",$2:"two",$3:{$:1,$0:1}})])}})}:null;};L.One=function(by){var bz;return by==="1"||by==="one"?{$:1,$0:new H({$:0,$0:"one",$1:{$:1,$0:new E({$:0,$0:"questionresponse",$1:{$:1,$0:1}})},$2:null,$3:{$:1,$0:bg.ofArray([new G({$:0,$0:"wit/ordinal",$1:"",$2:"one",$3:{$:1,$0:1}})])}})}:null;};L.QuickNo=function(by){var bz;return by==="no"||(by==="nope"||(by==="no way"||(by==="nah"||(by==="don't do it"||by==="stop"))))?{$:1,$0:new H({$:0,$0:"no",$1:{$:1,$0:new E({$:0,$0:"reject",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};L.QuickYes=function(by){var bz;return by==="yes"||(by==="ok"||(by==="sure"||(by==="yeah"||(by==="yep"||(by==="uh huh"||(by==="go ahead"||by==="go"))))))?{$:1,$0:new H({$:0,$0:"yes",$1:{$:1,$0:new E({$:0,$0:"verify",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};L.QuickHelp=function(by){var bz;return by==="help"||(by==="help me"||(by==="what's this?"||by==="huh"))?{$:1,$0:new H({$:0,$0:"help",$1:{$:1,$0:new E({$:0,$0:"help",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};L.QuickHello=function(by){var bz;return by==="hello"||(by==="hey"||(by==="yo"||by==="hi"))?{$:1,$0:new H({$:0,$0:"hello",$1:{$:1,$0:new E({$:0,$0:"greet",$1:{$:1,$0:1}})},$2:null,$3:null})}:null;};L.Voices=function(by){return by==="voices"?{$:1,$0:null}:null;};L.Debug=function(by){return by==="debug"?{$:1,$0:null}:null;};L.Blank=function(by){return by===""?{$:1,$0:null}:null;};Q.Study=function(by){return by.get_Traits()!=null?{$:0,$0:null}:{$:1,$0:null};};D.No=function(by){var bz,bA;return(bA=D.Intent$1("reject",by),bA!=null&&bA.$==1&&(bA.$0[0]==null&&(bA.$0[1]==null&&(bz=by,true))))?{$:1,$0:bz}:null;};D.Yes=function(by){var bz,bA;return(bA=D.Intent$1("verify",by),bA!=null&&bA.$==1&&(bA.$0[0]==null&&(bA.$0[1]==null&&(bz=by,true))))?{$:1,$0:bz}:null;};D.EntityManyofMany=function(by,bz){return{$:1,$0:bn.OfArray($.ofSeq(bg.map(function(bA){return bg.exists(function(bB){return bB.get_Role()===bA;},bz)?[bA,{$:1,$0:bg.filter(function(bB){return bB.get_Role()===bA;},bz)}]:[bA,null];},by)))};};D.EntityManyOf1=function(by,bz){var bA;return bz!=null&&bz.$==1&&(bg.exists(function(bB){return bB.get_Role()===by;},bz.$0)&&(bA=bz.$0,true))?{$:1,$0:bg.filter(function(bB){return bB.get_Role()===by;},bA)}:null;};D.Entity1OfAny=function(by,bz){var bA;return bz!=null&&bz.$==1&&(bg.exists(function(bB){return bB.get_Role()===by;},bz.$0)&&(bA=bz.$0,true))?{$:1,$0:bg.head(bg.sortBy(function(bB){return bB.get_Role();},bg.filter(function(bB){return bB.get_Role()===by;},bA)))}:null;};D.Entity1Of1=function(by,bz){var bA;return bz!=null&&bz.$==1&&(bz.$0.$==1&&(bz.$0.$1.$==0&&(bz.$0.$0.get_Role()===by&&(bA=bz.$0.$0,true))))?{$:1,$0:bA}:null;};D.Intent$1=function(by,bz){return bz.get_Intent()!=null&&bz.get_Intent().$0.get_Name()===by?{$:1,$0:[bz.get_Traits(),bz.get_Entities()]}:null;};R.$cctor=function(){R.$cctor=a.ignore;R.entity_types=bg.ofArray(["wit$contact:name","wit$datetime:datetime","term:subject","term:object","term:verb"]);R.trait_types=bg.ofArray(["domain","dialogue_act"]);R.intentConfidenceThreshold=0.85;R.entityConfidenceThreshold=0.85;};T.MicReady={$:5};T.MicAudioEnd={$:4};T.MicAudioStart={$:3};T.MicDisconnected={$:2};T.MicConnecting={$:1};T.MicNotInitialized={$:0};U.ClientUnderstand={$:2};U.ClientReady={$:1};U.ClientNotInitialzed={$:0};V=S.Interpreter=bb.Class({get_Options:function(){return(this.get_Unwrap())[2];},get_Text:function(){return(this.get_Unwrap())[1];},get_Voice:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1[0],this.$1[1]];}},null,V);W=S.CUI=bb.Class({SayVoices:function(){var by,bz,bA;by=this;bz=a.speechSynthesis.getVoices();!(bz==null)?(bA=d.toArray(bz),by.Say((function(bB){return function(bC){return bB("There are currently "+a.String(bC)+" voices installed on this computer or device.");};}(a.id))($.length(bA))),$.iteri(function(bB,bC){return by.Say(((((bb.Curried(function(bD,bE,bF,bG){return bD("Voice "+a.String(bE)+". Name: "+bc.toSafe(bF)+", Local: "+bc.prettyPrint(bG)+".");},4))(a.id))(bB))(bC.name))(bC.localService));},bA)):void 0;},Wait:function(by){this.Wait$1(function(){bj.Start(by,null);});},Wait$1:function(by){this["Echo'"]("please wait...");this.Term.pause();by();this.Term.resume();},sayRandom:function(by,bz){this.Say(B.getRandomPhrase(by,bz));},SayAngry:function(by){var bz,bA;bz=this;bj.Start((bA=null,bj.Delay(function(){return bj.Combine(a.speechSynthesis.speaking?(a.speechSynthesis.cancel(),bq.chime(),bj.Zero()):bj.Zero(),bj.Delay(function(){a.addMessage(bz.Avatar,by,"","");bz.Avatar.processMessages(0);return bj.Zero();}));})),null);},SayDoc:function(by){var bz,bA,bB;bz=$.get(be(".terminal-output").get(),0).childNodes.length;bA=_9.Element("div",[d.cls("terminal-command"),d.dindex(bz+1)],[by]);bB=d.termOutput();_8.LoadLocalTemplates("");_9.RunAppend(bB,bA);},Say:function(by){var bz,bA;bz=this;bj.Start((bA=null,bj.Delay(function(){return bj.Combine(a.speechSynthesis.speaking?(bq.chime(),bj.Zero()):bj.Zero(),bj.Delay(function(){bz.Avatar.addMessage(by);bz.Avatar.processMessages(0);return bj.Zero();}));})),null);},Debug:function(by,bz){d.debug(by,bz);},"EchoHtml'":function(by){var bz,bA;bz=(bA={},bA.raw=true,bA);this.Term.disable();this.Term.echo(by,bz);this.Term.enable();},"Echo'":function(by){this.Term.disable();this.Term.echo(by);this.Term.enable();}},null,W);W.New=function(by,bz,bA,bB,bC){return new W({Voice:by,Mic:bz,Term:bA,Avatar:bB,Caption:bC});};Y=X.Dialogue=bb.Class({get_Utterances:function(){return this.$4;},get_Output:function(){return this.$3;},get_DialogueQuestions:function(){return this.$2;},get_Props:function(){return this.$1;},get_Cui:function(){return this.$0;}},null,Y);X["Response'_"]=function(by,bz,bA,bB){var bC,bD,bE;return(bD=X.PropNotSet_(by,"user",bB),bD!=null&&bD.$==1&&(X.haveQuestion(bz,bA)&&by.get_DialogueQuestions().length>0&&(by.get_DialogueQuestions())[0].get_Name()===bA&&(bC=bD.$0,true)))?(X.popu(by),X.popq(by),X.haveProp(by,bA)?(bE=by.get_Props().get_Item(bA),(X.deleteProp(by,bA),{$:1,$0:[bC,{$:1,$0:bE}]})):{$:1,$0:[bC,null]}):null;};X.Response_=function(by,bz,bA,bB){var bC,bD,bE;return(bD=X.PropSet_(by,"user",bB),bD!=null&&bD.$==1&&(X.haveQuestion(bz,bA)&&by.get_DialogueQuestions().length>0&&(by.get_DialogueQuestions())[0].get_Name()===bA&&(bC=bD.$0,true)))?(X.popu(by),X.popq(by),X.haveProp(by,bA)?(bE=by.get_Props().get_Item(bA),(X.deleteProp(by,bA),{$:1,$0:[bC,{$:1,$0:bE}]})):{$:1,$0:[bC,null]}):null;};X["User'_"]=function(by,bz){var bA,bB;return(bB=X.PropNotSet_(by,"user",bz),bB!=null&&bB.$==1&&(by.get_DialogueQuestions().length===0&&(bA=bB.$0,true)))?(X.popu(by),{$:1,$0:bA}):null;};X.User_=function(by,bz){var bA,bB;return(bB=X.PropSet_(by,"user",bz),bB!=null&&bB.$==1&&(by.get_DialogueQuestions().length===0&&(bA=bB.$0,true)))?(X.popu(by),{$:1,$0:bA}):null;};X.PropNotSet_=function(by,bz,bA){return!X.haveProp(by,bz)?{$:1,$0:bA}:null;};X.PropSet_=function(by,bz,bA){return X.haveProp(by,bz)?{$:1,$0:bA}:null;};X.noUnderstand=function(by,bz,bA){var bB;bz((function(bC){return function(bD){return bC(bc.toSafe(bD)+" interpreter did not understand utterance.");};}(a.id))(bA));X.say(by,"Sorry I didn't understand what you meant.");by.get_DialogueQuestions().length>0?(bB=bh.nth(0,by.get_DialogueQuestions()),X.haveProp(by,bB.get_Name())?X.say(by,B.replace_tok("$0",by.get_Props().get_Item(bB.get_Name()),bB.get_Text())):X.say(by,bB.get_Text())):void 0;};X.ask=function(by,bz,bA,bB){X.addProp(by,bA,bB);X.pushq(by,bz,bA);X.say(by,B.replace_tok("$0",bB,X.getQuestion(bz,bA).$0.get_Text()));};X.pushq=function(by,bz,bA){var bB;bB=X.getQuestion(bz,bA);bB==null?(function(bC){return function(bD){return bC("No such question: "+bc.toSafe(bD));};}(br.FailWith))(bA):by.get_DialogueQuestions().unshift(bB.$0);};X.popq=function(by){by.get_DialogueQuestions().shift();};X.popu=function(by){by.get_Utterances().shift();};X.pushu=function(by,bz){by.get_Utterances().unshift(bz);};X.haveQuestion=function(by,bz){return bg.exists(function(bA){return bA.get_Name()===bz;},by);};X.getQuestion=function(by,bz){return bh.tryFind(function(bA){return bA.get_Name()===bz;},by);};X.prop=function(by,bz){return by.get_Props().get_Item(bz);};X.deleteProp=function(by,bz){by.get_Props().Remove(bz);};X.addProp=function(by,bz,bA){by.get_Props().Add(bz,bA);};X.haveProp=function(by,bz){return by.get_Props().ContainsKey(bz);};X["sayRandom'"]=function(by,bz){X.sayRandom(by,bz,"");};X.sayRandom=function(by,bz,bA){var bB;bB=B.getRandomPhrase(bz,bA);by.get_Output().unshift(bB);by.get_Cui().Say(bB);};X.say=function(by,bz){by.get_Output().unshift(bz);X["say'"](by,bz);};X["say'"]=function(by,bz){by.get_Cui().Say(bz);};X.echo=function(by,bz){(by.get_Cui())["EchoHtml'"](bz);};Z.update=function(by){var bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu;function cv(cI){X.echo(by,cI);}function cw(cI){X.say(by,cI);}function cx(cI,cJ){return X.sayRandom(by,cI,cJ);}function cy(cI,cJ){return X.addProp(by,cI,cJ);}function cz(cI){return X.prop(by,cI);}function cA(){return cz("user");}function cB(cI,cJ){return X.ask(by,Z.moduleQuestions(),cI,cJ);}function cC(cI){return X.User_(by,cI);}function cD(cI){return X["User'_"](by,cI);}function cE(cI,cJ){return X.Response_(by,Z.moduleQuestions(),cI,cJ);}function cF(cI,cJ){return X["Response'_"](by,Z.moduleQuestions(),cI,cJ);}function cG(cI){var cJ;return cI!=null&&cI.$==1&&(typeof cI.$0=="string"&&(cJ=cI.$0,true))?{$:1,$0:cJ}:null;}function cH(cI,cJ,cK){var cL;return bj.Start((cL=null,bj.Delay(function(){cx(B.waitAddPhrases(),"symptom entry");return bj.Bind((new bt.New()).Async("SMApp.Web:SMApp.Web.Server.addSymptomJournalEntry:-793552281",[cA().Name,cI,cJ,cK]),function(cM){return cM.$==1?(cw(function(cN){return cN("Sorry I wasn't able to add that symptom to your journal. Could you try again?");}(a.id)),bj.Zero()):(cw((function(cN){return function(cO){return cN("OK I added that "+bc.toSafe(cO)+" symptom to your journal.");};}(a.id))(cI)),bj.Zero());});})),null);}bz=by.$4;bA=by.$1;bB=by.$2;Z.debug((((bb.Curried3(function(cI,cJ,cK){return cI("Starting utterances:"+bc.prettyPrint(cJ)+". Starting questions: "+bc.prettyPrint(cK)+".");}))(a.id))(bz))(bB));bC=bg.ofSeq(bh.take(bz.length>=5?5:bz.length,bz));bC.$==1&&(bE=(bF=X.PropNotSet_(by,"started",bC.$0),bF!=null&&bF.$==1?{$:1,$0:bF.$0}:null),bE!=null&&bE.$==1&&(bG=cD(bE.$0),bG!=null&&bG.$==1&&(bH=D.Intent$1("greet",bG.$0),bH!=null&&bH.$==1&&(bH.$0[1]==null&&bC.$1.$==0))))?(bA.Add("started",true),X["sayRandom'"](by,B.helloPhrases())):bC.$==1&&(bJ=cD(bC.$0),bJ!=null&&bJ.$==1&&(bK=D.Intent$1("greet",bJ.$0),bK!=null&&bK.$==1&&(bK.$0[1]==null&&bC.$1.$==0)))?cw("Hello, tell me your name to get started."):bC.$==1&&(bM=cD(bC.$0),bM!=null&&bM.$==1&&(bN=D.Intent$1("greet",bM.$0),bN!=null&&bN.$==1&&(bO=D.Entity1Of1("name",bN.$0[1]),bO!=null&&bO.$==1&&(bC.$1.$==0&&(bL=bO.$0,true)))))?(bP=bL.get_Value(),cx(B.waitRetrievePhrases(),"user name"),bj.Start((bQ=null,bj.Delay(function(){return bj.Bind((new bt.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:938652619",[bP]),function(cI){var cJ;return cI==null?(cw((function(cK){return function(cL){return cK("I did not find a user with the name "+bc.toSafe(cL)+".");};}(a.id))(bP)),cB("addUser",bP),bj.Zero()):(cJ=cI.$0,bj.Bind((new bt.New()).Async("SMApp.Web:SMApp.Web.Server.updateUserLastLogin:1413590366",[cJ.Name]),function(){bA.Add("user",cJ);cx(B.helloUserPhrases(),(function(cK){return function(cL){return cK(bc.prettyPrint(cL));};}(a.id))(bA.get_Item("user")));return cJ.LastLoggedIn!=null?bj.Bind((new bt.New()).Async("SMApp.Web:SMApp.Web.Server.humanize:1252089268",[cJ.LastLoggedIn.$0]),function(cK){cw((function(cL){return function(cM){return cL("You last logged in "+bc.toSafe(cM)+".");};}(a.id))(cK));return bj.Zero();}):bj.Zero();}));});})),null)):bC.$==1&&(bS=D.Yes(bC.$0),bS!=null&&bS.$==1&&(bT=cF("addUser",bS.$0),bT!=null&&bT.$==1&&(bU=cG(bT.$0[1]),bU!=null&&bU.$==1&&(bC.$1.$==0&&(bR=bU.$0,true)))))?bj.Start((bV=null,bj.Delay(function(){cx(B.waitAddPhrases(),"user");return bj.Bind((new bt.New()).Async("SMApp.Web:SMApp.Web.Server.addUser:1413590366",[bR]),function(cI){return cI.$==1?(cw((function(cJ){return function(cK){return cJ("Sorry I was not able to add the user "+bc.toSafe(cK)+" to the system.");};}(a.id))(bR)),bj.Zero()):(cy("user",bR),cw((function(cJ){return function(cK){return cJ("Hello "+bc.prettyPrint(cK)+", nice to meet you.");};}(a.id))(bA.get_Item("user"))),bj.Zero());});})),null):bC.$==1&&(bX=D.No(bC.$0),bX!=null&&bX.$==1&&(bY=cF("addUser",bX.$0),bY!=null&&bY.$==1&&(bZ=cG(bY.$0[1]),bZ!=null&&bZ.$==1&&(bC.$1.$==0&&(bW=bZ.$0,true)))))?cw((function(cI){return function(cJ){return cI("Ok I did not add the user "+bc.toSafe(cJ)+". But you must login for me to help you.");};}(a.id))(bW)):bC.$==1&&(b1=cC(bC.$0),b1!=null&&b1.$==1&&(b2=D.Intent$1("hello",b1.$0),b2!=null&&b2.$==1&&(b2.$0[0]==null&&(b3=D.Entity1Of1("name",b2.$0[1]),b3!=null&&b3.$==1&&(bC.$1.$==0&&(b0=b3.$0,true))))))?bj.Start((b4=null,bj.Delay(function(){return bj.Bind((new bt.New()).Async("SMApp.Web:SMApp.Web.Server.getUser:938652619",[b0.get_Value()]),function(cI){return cI==null?(cw((function(cJ){return function(cK){return cJ("Sorry, the user "+bc.toSafe(cK)+" does not exist.");};}(a.id))(b0.get_Value())),bj.Zero()):(cB("switchUser",cI.$0.Name),bj.Zero());});})),null):bC.$==1&&(b6=D.Yes(bC.$0),b6!=null&&b6.$==1&&(b7=cE("switchUser",b6.$0),b7!=null&&b7.$==1&&(b8=cG(b7.$0[1]),b8!=null&&b8.$==1&&(bC.$1.$==0&&(b5=b8.$0,true)))))?(bA.set_Item("user",b5),cw((function(cI){return function(cJ){return cI("Ok I switched to user "+bc.prettyPrint(cJ)+".");};}(a.id))(b5))):bC.$==1&&(b_=D.No(bC.$0),b_!=null&&b_.$==1&&(b$=cE("switchUser",b_.$0),b$!=null&&b$.$==1&&(ca=cG(b$.$0[1]),ca!=null&&ca.$==1&&(bC.$1.$==0&&(b9=ca.$0,true)))))?cw((function(cI){return function(cJ){return cI("Ok I did not switch to user "+bc.toSafe(cJ)+".");};}(a.id))(b9)):bC.$==1&&(cc=cD(bC.$0),cc!=null&&cc.$==1?(cd=D.Intent$1("kbquery",cc.$0),cd!=null&&cd.$==1)?bC.$1.$==0&&(cb=cc.$0,true):(ce=cC(bC.$0),ce!=null&&ce.$==1&&((cf=D.Intent$1("kbquery",ce.$0),cf!=null&&cf.$==1)&&(bC.$1.$==0&&(cb=ce.$0,true)))):(cg=cC(bC.$0),cg!=null&&cg.$==1&&((ch=D.Intent$1("kbquery",cg.$0),ch!=null&&ch.$==1)&&(bC.$1.$==0&&(cb=cg.$0,true)))))?bj.Start((ci=null,bj.Delay(function(){return bj.Bind(u.getAnswer(cb.get_Text()),function(cI){var cJ;return bj.Bind((cJ=$.get(cI.answers,0).answer,(new bt.New()).Async("SMApp.Web:SMApp.Web.Server.mdtohtml:1974737106",[cJ])),function(cK){var cL;return bj.Bind((cL=$.get(cI.answers,0).answer,(new bt.New()).Async("SMApp.Web:SMApp.Web.Server.mdtotext:1974737106",[cL])),function(cM){cv(cK);cw(cM);return bj.Zero();});});});})),null):bC.$==1&&(ck=cC(bC.$0),ck!=null&&ck.$==1&&(cl=D.Intent$1("symptom",ck.$0),cl!=null&&cl.$==1&&(cm=D.Entity1OfAny("symptom_name",cl.$0[1]),cm!=null&&cm.$==1&&(bC.$1.$==0&&(cj=cm.$0,true)))))?bj.Start((cn=null,bj.Delay(function(){cw("Ok I'll add that entry to your symptom journal");cH(cj.get_Value(),null,null);return bj.Zero();})),null):bC.$==1&&(cp=D.Yes(bC.$0),cp!=null&&cp.$==1&&((cq=cE("painVideo",cp.$0),cq!=null&&cq.$==1)&&bC.$1.$==0))?by.$0["EchoHtml'"]("<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/SkAqOditKN0\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>"):bC.$==1&&(cs=cC(bC.$0),cs!=null&&cs.$==1&&(ct=D.Intent$1("medjournal",cs.$0),ct!=null&&ct.$==1&&((cu=ct.$0[1],cu!=null&&cu.$==1)&&(bC.$1.$==0&&(cr=ct.$0[1].$0,true)))))?(cw("ok I added that entry to your medication journal."),cw("You should be careful not to take too many painkillers over a short period of time.")):X.noUnderstand(by,function(cI){Z.debug(cI);},Z.name());Z.debug((((bb.Curried3(function(cI,cJ,cK){return cI("Ending utterances: "+bc.prettyPrint(cJ)+". Ending questions:"+bc.prettyPrint(cK)+".");}))(a.id))(bz))(bB));};Z.haveQuestion=function(by){return bg.exists(function(bz){return bz.get_Name()===by;},Z.moduleQuestions());};Z.getQuestion=function(by){return bh.tryFind(function(bz){return bz.get_Name()===by;},Z.moduleQuestions());};Z.moduleQuestions=function(){_0.$cctor();return _0.moduleQuestions;};Z.debug=function(by){d.debug(Z.name(),by);};Z.name=function(){_0.$cctor();return _0.name;};_0.$cctor=function(){_0.$cctor=a.ignore;_0.name="Main";_0.moduleQuestions=bg.ofArray([new I({$:0,$0:"addUser",$1:"Do you want me to add the user $0?",$2:{$:0,$0:true}}),new I({$:0,$0:"switchUser",$1:"Do you want me to switch to the user $0?",$2:{$:0,$0:true}})]);};_1.run=function(){var by,bz;by=bb.ThisFunc(function(bA,bB){return((_1.Main().get_Text())(bA))(bB);});bz=_1.Main().get_Options();a.$("#term").terminal(by,bz);return _9.get_Empty();};_1.Main=function(){_2.$cctor();return _2.Main;};_1.dna=function(){_2.$cctor();return _2.dna;};_1.initMic=function(by){var bz,bA;_1.set_CUI((bz={$:1,$0:new bu.Microphone(bv.getElementById("microphone"))},W.New(_1.CUI().Voice,bz,_1.CUI().Term,_1.CUI().Avatar,_1.CUI().Caption)));bA=_1.CUI().Mic.$0;bA.onconnecting=function(){_1.set_MicState(T.MicConnecting);return _1.debug("Mic connecting...");};bA.ondisconnected=function(){_1.set_MicState(T.MicDisconnected);return _1.debug("Mic disconnected.");};bA.onaudiostart=function(){_1.set_MicState(T.MicAudioStart);return _1.debug("Mic audio start...");};bA.onaudioend=function(){_1.set_MicState(T.MicAudioEnd);_1.debug("Mic audio end.");return _1.debug(self.lastMicData);};bA.onerror=function(bB){_1.set_MicState({$:6,$0:bB});return _1.debug((function(bC){return function(bD){return bC("Mic error : "+bc.toSafe(bD)+".");};}(a.id))(bB));};bA.onready=function(){_1.set_MicState(T.MicReady);return _1.debug("Mic ready.");};bA.onresult=function(bB,bC){return _1.ClientState().$==2?_1.echo("I'm still trying to understand what you said before."):_1.ClientState().$==0?d.error("Client is not intialized."):!(bB==null||bC==null)?(_1.set_MicState({$:7,$0:bB,$1:bC}),_1.debug((((bb.Curried3(function(bD,bE,bF){return bD("Mic result: "+bc.prettyPrint(bE)+" "+bc.prettyPrint(bF)+".");}))(a.id))(bB))(bC)),by(bB,bC)):_1.debug("Mic: No result returned.");};bA.connect("4Y2BLQY5TWLIN7HFIV264S53MY4PCUAT");};_1.sayRandom=function(by,bz){_1.say(B.getRandomPhrase(bz,by));};_1.say=function(by){_1.Output().unshift(by);_1["say'"](by);};_1["say'"]=function(by){_1.CUI().Say(by);};_1.initSpeech=function(){var by;by=d.toArray(_1.synth().getVoices());$.length(by)>0?($.iter(function(bz){if(bw.Equals(_1.CUI().Voice,null)&&(bz.name.indexOf("Microsoft Zira")!=-1||bz.name.toLowerCase().indexOf("female")!=-1)){_1.set_CUI(W.New({$:1,$0:bz},_1.CUI().Mic,_1.CUI().Term,_1.CUI().Avatar,_1.CUI().Caption));_1.debug((function(bA){return function(bB){return bA("Using browser speech synthesis voice "+bc.toSafe(bB)+".");};}(a.id))(_1.CUI().Voice.$0.name));}},by),!bw.Equals(_1.CUI().Voice,null)?(_1.CUI().Avatar.nativeVoice=true,_1.CUI().Avatar.nativeVoiceName=_1.CUI().Voice.$0.name,_1.debug((function(bz){return function(bA){return bz("Using browser speech synthesis voice "+bc.toSafe(bA)+".");};}(a.id))(_1.CUI().Voice.$0.name))):void 0):void 0;bw.Equals(_1.CUI().Voice,null)?_1.debug("No female browser speech synthesis voice is available. Using CMU SLT Female voice via TTS."):void 0;};_1.synth=function(){_2.$cctor();return _2.synth;};_1.push=function(by){_1.Utterances().unshift(by);return _1.Dialogue();};_1.Dialogue=function(){_2.$cctor();return _2.Dialogue;};_1.Utterances=function(){_2.$cctor();return _2.Utterances;};_1.Questions=function(){_2.$cctor();return _2.Questions;};_1.Output=function(){_2.$cctor();return _2.Output;};_1.Props=function(){_2.$cctor();return _2.Props;};_1.wait=function(by){d["Terminal.Echo'"](_1.CUI().Term,"please wait");_1.CUI().Term.pause();by();_1.CUI().Term.resume();};_1.debug=function(by){d.debug("CLIENT",by);};_1.echo=function(by){d["Terminal.EchoHtml'"](_1.CUI().Term,(function(bz){return function(bA){return bz(bc.prettyPrint(bA));};}(a.id))(by));};_1.ClientState=function(){_2.$cctor();return _2.ClientState;};_1.set_ClientState=function(by){_2.$cctor();_2.ClientState=by;};_1.MicState=function(){_2.$cctor();return _2.MicState;};_1.set_MicState=function(by){_2.$cctor();_2.MicState=by;};_1.CUI=function(){_2.$cctor();return _2.CUI;};_1.set_CUI=function(by){_2.$cctor();_2.CUI=by;};_2.$cctor=function(){var by,bz,bA;_2.$cctor=a.ignore;function bB(bD,bE){var bF,bG,bH,bI,bJ,bK,bL;_1.debug((((bb.Curried3(function(bM,bN,bO){return bM("Voice: "+bc.prettyPrint(bN)+" "+bc.prettyPrint(bO));}))(a.id))(bD))(bE));bF=(bG=J["Intent'"](bD,bE),bG!=null&&bG.$==1?{$:1,$0:bG.$0}:null);bH=(bI=J["Trait'"](bE),bI!=null&&bI.$==1?{$:1,$0:bg.ofArray([bI.$0])}:null);bJ=(bK=J["Entity'$1"](bE),bK!=null&&bK.$==1?{$:1,$0:bg.ofArray([bK.$0])}:null);bF==null&&(bH==null&&bJ==null)?void 0:(_1.debug(((((bb.Curried(function(bM,bN,bO,bP){return bM("Voice: "+_4.p(bN)+" "+_4.p$3(bO)+" "+_4.p$5(bP));},4))(a.id))(bF))(bH))(bJ)),Z.update(_1.push(new H({$:0,$0:"",$1:bF,$2:bH,$3:bJ}))));}function bC(bD,bE){var bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP;_1.set_CUI(W.New(_1.CUI().Voice,_1.CUI().Mic,bD,_1.CUI().Avatar,_1.CUI().Caption));bw.Equals(_1.CUI().Mic,null)?_1.initMic(bB):void 0;bw.Equals(_1.CUI().Voice,null)?_1.initSpeech():void 0;_1.ClientState().$===0?_1.set_ClientState(U.ClientReady):void 0;return(bF=L.Blank(bE),bF!=null&&bF.$==1)?_1["say'"]("Tell me what you want me to do or ask me a question."):(bG=L.Debug(bE),bG!=null&&bG.$==1)?(_1.debug(_1.dna().getTypingPattern((bH={type:0},bH.length=100,bH))),_1.debug((function(bQ){return function(bR){return bQ("Utterances: "+bc.prettyPrint(bR));};}(a.id))(_1.Utterances())),_1.debug((function(bQ){return function(bR){return bQ("Questions: "+bc.prettyPrint(bR));};}(a.id))(_1.Questions()))):(bI=L.Voices(bE),bI!=null&&bI.$==1)?(bJ=d.toArray(d.speechSynthesis().getVoices()),(_1["say'"]((function(bQ){return function(bR){return bQ("There are currently "+a.String(bR)+" voices installed on this computer or device.");};}(a.id))($.length(bJ))),$.iteri(function(bQ,bR){return _1["say'"](((((bb.Curried(function(bS,bT,bU,bV){return bS("Voice "+a.String(bT)+". Name: "+bc.toSafe(bU)+", Local: "+bc.prettyPrint(bV)+".");},4))(a.id))(bQ))(bR.name))(bR.localService));},bJ))):_1.ClientState().$==1?(bL=L.QuickHello(bE),bL!=null&&bL.$==1?(bK=bL.$0,true):(bM=L.QuickHelp(bE),bM!=null&&bM.$==1?(bK=bM.$0,true):(bN=L.QuickYes(bE),bN!=null&&bN.$==1?(bK=bN.$0,true):(bO=L.QuickNo(bE),bO!=null&&bO.$==1&&(bK=bO.$0,true)))))?(_1.debug((function(bQ){return function(bR){return bQ("Quick Text: "+_4.p$7(bR)+".");};}(a.id))(bK)),Z.update(_1.push(bK)),_1.set_ClientState(U.ClientReady)):_1.CUI().Wait((bP=null,bj.Delay(function(){_1.set_ClientState(U.ClientUnderstand);L.getUtterance(bE,function(bQ){var bR,bS;bR=L.HasUtterance(bQ);bR!=null&&bR.$==1?(bS=bR.$0,_1.debug(((((bb.Curried(function(bT,bU,bV,bW){return bT("Text: Intent: "+_4.p(bU)+", Traits: "+_4.p$3(bV)+", Entities: "+_4.p$5(bW));},4))(a.id))(bS.get_Intent()))(bS.get_Traits()))(bS.get_Entities())),Z.update(_1.push(bS))):(_1.debug("Text: Did not receive a meaning from the server."),_1["say'"]("Sorry I did not understand what you said."));});_1.set_ClientState(U.ClientReady);return bj.Zero();}))):_1.ClientState().$==0?d.error("Client is not initialized."):_1["say'"]("I'm still trying to understand what you said before.");}_2.CUI=W.New(null,null,null,(bq.applicationId="4277115329081938617",by=new a.SDKConnection(),bz=new a.WebAvatar(),bz.version=8.5,bz.connection=by,bz.avatar="20926186",bz.voice="cmu-slt",bz.voiceMod="default",bz.width=175,bz.createBox(),bz.addMessage(""),bz.processMessages(0),bz),false);_2.MicState=T.MicNotInitialized;_2.ClientState=U.ClientNotInitialzed;_2.Props=new bx.New$5();_2.Output=[];_2.Questions=[];_2.Utterances=[];_2.Dialogue=new Y({$:0,$0:_1.CUI(),$1:_1.Props(),$2:_1.Questions(),$3:_1.Output(),$4:_1.Utterances()});_2.synth=a.speechSynthesis;_2.dna=new a.TypingDNA();_2.Main=new V({$:0,$0:function(bD){return bB(bD[0],bD[1]);},$1:[function(bD){return function(bE){return bC(bD,bE);};},(bA={},bA.name="Main",bA.greetings="Welcome to Selma. Enter 'hello' or 'hello my name is...(you) to initialize speech.",bA.prompt=">",bA)]});};_3.p=function(by){return"{"+("text = "+bc.prettyPrint(by.text))+"; "+("intents = "+bc.printArray(function(bz){return _3.p$1(bz);},by.intents))+"; "+("entities = "+bc.prettyPrint(by.entities))+"; "+("traits = "+bc.prettyPrint(by.traits))+"}";};_3.p$1=function(by){return"{"+("id = "+bc.prettyPrint(by.id))+"; "+("name = "+bc.prettyPrint(by.name))+"; "+("confidence = "+bc.prettyPrint(by.confidence))+"}";};_4.p$2=function(by){return by==null?"null":"Some "+bc.prettyPrint(by.$0);};_4.p$1=function(by){return"Intent ("+bc.prettyPrint(by.$0)+", "+_4.p$2(by.$1)+")";};_4.p=function(by){return by==null?"null":"Some "+_4.p$1(by.$0);};_4.p$4=function(by){return"Trait ("+bc.prettyPrint(by.$0)+", "+bc.prettyPrint(by.$1)+", "+_4.p$2(by.$2)+")";};_4.p$3=function(by){return by==null?"null":"Some "+bc.printList(function(bz){return _4.p$4(bz);},by.$0);};_4.p$6=function(by){return"Entity ("+bc.prettyPrint(by.$0)+", "+bc.prettyPrint(by.$1)+", "+bc.prettyPrint(by.$2)+", "+_4.p$2(by.$3)+")";};_4.p$5=function(by){return by==null?"null":"Some "+bc.printList(function(bz){return _4.p$6(bz);},by.$0);};_4.p$7=function(by){return"Utterance ("+bc.prettyPrint(by.$0)+", "+_4.p(by.$1)+", "+_4.p$3(by.$2)+", "+_4.p$5(by.$3)+")";};}());
