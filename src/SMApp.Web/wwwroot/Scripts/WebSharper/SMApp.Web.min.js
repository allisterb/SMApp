(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.User=c.User||{};e=c.Meaning=c.Meaning||{};f=c.Intent=c.Intent||{};g=c.Entity=c.Entity||{};h=c.Interpreter=c.Interpreter||{};i=c.CUIContext=c.CUIContext||{};j=c.Resource=c.Resource||{};k=c.NLU=c.NLU||{};l=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};m=c.ClientExtensions=c.ClientExtensions||{};n=c.Client=c.Client||{};o=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};p=a.IntelliFactory;q=p&&p.Runtime;r=a.WebSharper;s=r&&r.List;t=r&&r.UI;u=t&&t.Doc;v=r&&r.Utils;w=r&&r.Concurrency;x=r&&r.Remoting;y=x&&x.AjaxRemotingProvider;d.New=function(z){return{UserName:z};};e=c.Meaning=q.Class({get_TopIntent:function(){return s.head(s.sortBy(function(z){return z.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,e);f=c.Intent=q.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,f);g=c.Entity=q.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,g);h=c.Interpreter=q.Class({get_Options:function(){return(this.get_Unwrap())[1];},get_Func:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0[0],this.$0[1]];}},null,h);i.Input={$:2};i.MenuChoice={$:1};j.New=function(z,A,B){return{Name:z,Description:A,Url:B};};k.HelloUser=function(z){var A,B;return(B=k.Hello(z),B!=null&&B.$==1&&(B.$0.$==1&&(B.$0.$1.$==0&&(B.$0.$0.get_Role()==="contact"&&(A=B.$0.$0,true)))))?{$:1,$0:A}:null;};k.Hello=function(z){var A,B;return z!=null&&z.$==1&&(B=k.Intent("Hello",z.$0),B!=null&&B.$==1&&(A=B.$0,true))?{$:1,$0:A}:null;};k.Help=function(z){return z==="help"?{$:0,$0:null}:z==="debug on"?{$:1,$0:null}:z==="debug off"?{$:2,$0:null}:{$:3,$0:null};};k.Intent=function(z,A){return A.get_TopIntent().get_Name()===z&&A.get_TopIntent().get_Confidence()>k.intentConfidenceThreshold()?{$:1,$0:s.filter(function(B){return B.get_Confidence()>k.entityConfidenceThreshold();},A.get_Entities())}:null;};k.entityConfidenceThreshold=function(){l.$cctor();return l.entityConfidenceThreshold;};k.set_entityConfidenceThreshold=function(z){l.$cctor();l.entityConfidenceThreshold=z;};k.intentConfidenceThreshold=function(){l.$cctor();return l.intentConfidenceThreshold;};k.set_intentConfidenceThreshold=function(z){l.$cctor();l.intentConfidenceThreshold=z;};l.$cctor=function(){l.$cctor=a.ignore;l.intentConfidenceThreshold=0.8;l.entityConfidenceThreshold=0.8;};m["Terminal.Push"]=function(z,A){var B,C;B=A.get_Func();C=A.get_Options();z.push(q.CreateFuncWithThis(B),C);};n.Term=function(){var z,A,B;z=(A={},A.name="_",A.greetings="Welcome to Selma",A.onInit=function(C){n.speak("Welcome to Selma 1 2 3 4.");return m["Terminal.Push"](C,n.Main());},A);B=q.ThisFunc(function(){return null;});a.$("#main").terminal(B,z);return u.get_Empty();};n.Main=function(){o.$cctor();return o.Main;};n.debugMode=function(){o.$cctor();return o.debugMode;};n.set_debugMode=function(z){o.$cctor();o.debugMode=z;};n.speak=function(z){a.speechSynthesis.speak(new a.SpeechSynthesisUtterance(z));};o.$cctor=function(){var z;o.$cctor=a.ignore;function A(B,C){var D,E;D=k.Help(C);return D.$==1?(n.set_debugMode(true),B.echo((function(F){return function(G){return F("Debug mode is now "+v.prettyPrint(G)+".");};}(a.id))(n.debugMode()))):D.$==2?(n.set_debugMode(false),B.echo((function(F){return function(G){return F("Debug mode is now "+v.prettyPrint(G)+".");};}(a.id))(n.debugMode()))):D.$==3?(B.disable(),w.Start((E=null,w.Delay(function(){return w.Combine(w.Bind((new y.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:-1248913656",[C]),function(F){var G,H;G=k.HelloUser(F);return G!=null&&G.$==1?(B.echo((function(I){return function(J){return I("This is the hello intent. The user name is "+v.toSafe(J)+".");};}(a.id))(G.$0.get_Value())),w.Zero()):(H=k.Hello(F),H!=null&&H.$==1)?(B.echo("This is the hello intent but I don't know who the user is."),w.Zero()):(B.echo("This is the whatever intent"),w.Zero());}),w.Delay(function(){B.enable();return w.Zero();}));})),null)):B.echo("This is the help commnd");}o.debugMode=false;o.Main=new h({$:0,$0:[function(B){return function(C){return A(B,C);};},(z={},z.name="Main",z.prompt=">",z)]});};}());
