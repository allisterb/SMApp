(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;a=self;b=a.SMApp=a.SMApp||{};c=b.Web=b.Web||{};d=c.User=c.User||{};e=c.Meaning=c.Meaning||{};f=c.Intent=c.Intent||{};g=c.Entity=c.Entity||{};h=c.Interpreter=c.Interpreter||{};i=c.Resource=c.Resource||{};j=c.NLU=c.NLU||{};k=a.StartupCode$SMApp_Web$NLU=a.StartupCode$SMApp_Web$NLU||{};l=c.CUI=c.CUI||{};m=a.StartupCode$SMApp_Web$CUI=a.StartupCode$SMApp_Web$CUI||{};n=c.ClientExtensions=c.ClientExtensions||{};o=c.Client=c.Client||{};p=a.StartupCode$SMApp_Web$Client=a.StartupCode$SMApp_Web$Client||{};q=a.IntelliFactory;r=q&&q.Runtime;s=a.WebSharper;t=s&&s.List;u=s&&s.Seq;v=s&&s.Random;w=s&&s.UI;x=w&&w.Doc;y=s&&s.Concurrency;z=s&&s.Utils;A=s&&s.Remoting;B=A&&A.AjaxRemotingProvider;d.New=function(C){return{UserName:C};};e=c.Meaning=r.Class({get_TopIntent:function(){return t.head(t.sortBy(function(C){return C.get_Confidence();},this.get_Intents()));},get_Entities:function(){return(this.get_Unwrap())[1];},get_Intents:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,e);f=c.Intent=r.Class({get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1];}},null,f);g=c.Entity=r.Class({get_Value:function(){return(this.get_Unwrap())[3];},get_Role:function(){return(this.get_Unwrap())[2];},get_Confidence:function(){return(this.get_Unwrap())[1];},get_Name:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0,this.$1,this.$2,this.$3];}},null,g);h=c.Interpreter=r.Class({get_Options:function(){return(this.get_Unwrap())[1];},get_Func:function(){return(this.get_Unwrap())[0];},get_Unwrap:function(){return[this.$0[0],this.$0[1]];}},null,h);i.New=function(C,D,E){return{Name:C,Description:D,Url:E};};j.HelloUser=function(C){var D,E;return(E=j.Hello(C),E!=null&&E.$==1&&(E.$0.$==1&&(E.$0.$1.$==0&&(E.$0.$0.get_Role()==="contact"&&(D=E.$0.$0,true)))))?{$:1,$0:D}:null;};j.Hello=function(C){var D,E;return C!=null&&C.$==1&&(E=j.Intent("Hello",C.$0),E!=null&&E.$==1&&(D=E.$0,true))?{$:1,$0:D}:null;};j.Help=function(C){return C==="help"?{$:0,$0:null}:C==="debug on"?{$:1,$0:null}:C==="debug off"?{$:2,$0:null}:{$:3,$0:null};};j.Intent=function(C,D){return D.get_TopIntent().get_Name()===C&&D.get_TopIntent().get_Confidence()>j.intentConfidenceThreshold()?{$:1,$0:t.filter(function(E){return E.get_Confidence()>j.entityConfidenceThreshold();},D.get_Entities())}:null;};j.entityConfidenceThreshold=function(){k.$cctor();return k.entityConfidenceThreshold;};j.set_entityConfidenceThreshold=function(C){k.$cctor();k.entityConfidenceThreshold=C;};j.intentConfidenceThreshold=function(){k.$cctor();return k.intentConfidenceThreshold;};j.set_intentConfidenceThreshold=function(C){k.$cctor();k.intentConfidenceThreshold=C;};k.$cctor=function(){k.$cctor=a.ignore;k.intentConfidenceThreshold=0.8;k.entityConfidenceThreshold=0.8;};l.helloUserPhrases=function(){m.$cctor();return m.helloUserPhrases;};l.helloPhrases=function(){m.$cctor();return m.helloPhrases;};l.getRandomPhrase=function(C){return u.nth(l.rng().Next(0,C.get_Length()),C);};l.rng=function(){m.$cctor();return m.rng;};m.$cctor=function(){m.$cctor=a.ignore;m.rng=new v.New();m.helloPhrases=t.ofArray(["Welcome!","Welcome to Selma","I am Selma. How can I help?","Hi I'm Selma, how can I help?","Hello I'm Selma, how can I help?","My name is Selma."]);m.helloUserPhrases=t.ofArray(["Hi $user, welcome back.","Welcome $user, nice to see you again..","Hello $user","Good to see you $user."]);};n["Terminal.Push"]=function(C,D){var E,F;E=D.get_Func();F=D.get_Options();C.push(r.CreateFuncWithThis(E),F);};n["Terminal.Echo'"]=function(C,D){C.disable();C.echo(D);C.enable();};o.Term=function(){var C,D;C=r.ThisFunc(function(E,F){return((o.Main().get_Func())(E))(F);});D=o.Main().get_Options();a.$("#main").terminal(C,D);o.context().unshift({$:0,$0:o.Main()});return x.get_Empty();};o.Main=function(){p.$cctor();return p.Main;};o.speakRandomPhrase=function(C){o.speak(l.getRandomPhrase(C));};o.speak=function(C){var D;y.Start((D=null,y.Delay(function(){a.speechSynthesis.speak(new a.SpeechSynthesisUtterance(C));return y.Zero();})),null);};o.transcribe=function(){p.$cctor();return p.transcribe;};o.set_transcribe=function(C){p.$cctor();p.transcribe=C;};o.debugMode=function(){p.$cctor();return p.debugMode;};o.set_debugMode=function(C){p.$cctor();p.debugMode=C;};o.context=function(){p.$cctor();return p.context;};p.$cctor=function(){var C;p.$cctor=a.ignore;function D(E,F){var G,H;G=j.Help(F);return G.$==1?(o.set_debugMode(true),n["Terminal.Echo'"](E,(function(I){return function(J){return I("Debug mode is now "+z.prettyPrint(J)+".");};}(a.id))(o.debugMode()))):G.$==2?(o.set_debugMode(false),n["Terminal.Echo'"](E,(function(I){return function(J){return I("Debug mode is now "+z.prettyPrint(J)+".");};}(a.id))(o.debugMode()))):G.$==3?(E.disable(),y.Start((H=null,y.Delay(function(){return y.Combine(y.Bind((new B.New()).Async("SMApp.Web:SMApp.Web.Server.GetMeaning:1524111558",[F]),function(I){var J,K;J=j.HelloUser(I);return J!=null&&J.$==1?(E.echo((function(L){return function(M){return L("This is the hello intent. The user name is "+z.toSafe(M)+".");};}(a.id))(J.$0.get_Value())),y.Zero()):(K=j.Hello(I),K!=null&&K.$==1)?(o.speakRandomPhrase(l.helloPhrases()),y.Zero()):(E.echo("This is the whatever intent"),y.Zero());}),y.Delay(function(){E.enable();return y.Zero();}));})),null)):n["Terminal.Echo'"](E,"This is the help commnd");}p.context=[];p.debugMode=false;p.transcribe=false;p.Main=new h({$:0,$0:[function(E){return function(F){return D(E,F);};},(C={},C.name="Main",C.greetings="Welcome to Selma. Type hello to begin or help.",C.prompt=">",C)]});};}());
